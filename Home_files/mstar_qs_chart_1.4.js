var __isMobile=/WebKit.+Mobile/i.test(navigator.userAgent);if(__isMobile){(function(a){jQuery.fn.originBind=jQuery.fn.bind;jQuery.fn.originUnBind=jQuery.fn.unbind;a.extend(true,jQuery.fn,{bind:function(b,d,c){if(typeof(d)=="function"&&typeof(c)=="undefined"){c=d;d=undefined}if(b.indexOf("mousedown")>-1){this.bind(b.replace(/mousedown/ig,"touchstart"),d,c)}else{if(b.indexOf("mousemove")>-1){this.bind(b.replace(/mousemove/ig,"touchmove"),d,c)}else{if(b.indexOf("mouseup")>-1){this.bind(b.replace(/mouseup/ig,"touchend"),d,c)}else{jQuery.fn.originBind.call(this,b,d,c)}}}return this}});a.extend(true,jQuery.fn,{unbind:function(b,c){if(typeof(b)=="undefined"){return this}if(b.indexOf("mousedown")>-1){this.unbind(b.replace(/mousedown/ig,"touchstart"),c)}else{if(b.indexOf("mousemove")>-1){this.unbind(b.replace(/mousemove/ig,"touchmove"),c)}else{if(b.indexOf("mouseup")>-1){this.unbind(b.replace(/mouseup/ig,"touchend"),c)}else{}}}jQuery.fn.originUnBind.call(this,b,c);return this}})})(jQuery)};if(!Util){var Util={}}jQuery.extend({isSupportTextoverflow:("textOverflow" in document.documentElement.style||"OTextOverflow" in document.documentElement.style)});(function(a){a.fn.ellipsis=function(b,c){var d=b||false;var e=typeof c!="undefined";return this.each(function(){var l=a(this);if(l.css("overflow")=="hidden"){var g=l;if(!e||c>=0){var p=0;g=l;while(g.children().length>0&&(!e||p<c)){g=g.children();p++}}g=g.eq(0);var m=g.text();if(m.length==0){this.aimDom=null;return}var f;if(b){f=l.html()}var h=g.width();var i=g.clone(true).css({position:"absolute",width:"auto",overflow:"visible"}).hide();g.after(i);var n=m;if(!jQuery.isSupportTextoverflow){if(!g.data("realvalue")){g.data("realvalue",m)}var j=g.data("realvalue");if(m.lastIndexOf("...")!=-1){i.text(j);n=j}else{if(m!=g.data("realvalue")){g.data("realvalue",m);g.data("bestpx",i.width())}}var k=n.length;while(k>0&&i.width()>h){n=n.substr(0,--k);i.text(n+"...")}g.text(i.text());g.attr("title",g.data("realvalue"))}else{if(!g.hasClass("qs-common-ellipsis")||m!=g.data("realvalue")){g.data("realvalue",m);g.addClass("qs-common-ellipsis");g.attr("title",m)}}i.remove();if(d){var o=l.width();setInterval(function(){if(l.width()!=o){o=l.width();l.html(f);l.ellipsis()}},200)}}})}})(jQuery);Util.FixIE=(function(){if(document.all){document.execCommand("BackgroundImageCache",false,true)}})();Util.DelayRun=function(d,b,c,a){if(a.__DelayRunTimer){if(a.__DelayRunTimer[d]){clearTimeout(a.__DelayRunTimer[d]);a.__DelayRunTimer[d]=-1}}else{a.__DelayRunTimer={}}a.__DelayRunTimer[d]=setTimeout(function(){b.call(a)},c)};Util.getScrollPosition=function(){if(typeof(window.pageYOffset)=="number"){this.getScrollPosition=function(){return{scrollx:window.pageXOffset,scrolly:window.pageYOffset}}}else{if(document.documentElement&&(typeof document.documentElement.scrollLeft!="undefined"||typeof document.documentElement.scrollTop!="undefined")){this.getScrollPosition=function(){return{scrollx:document.documentElement.scrollLeft,scrolly:document.documentElement.scrollTop}}}else{if(document.body&&typeof document.body.scrollLeft!="undefined"){this.getScrollPosition=function(){return{scrollx:document.body.scrollLeft,scrolly:document.body.scrollTop}}}else{return{scrollx:0,scrolly:0}}}}return this.getScrollPosition()};Util.contains=function(d,b){if(d==null){return false}var a=false;if(d.contains){a=d.contains(b)}else{a=(d.compareDocumentPosition(b)==20)?true:false}return a};Util.addBetaTip=function(e,c){var a=(e[0]||e);a.innerHTML+=" (beta)";var d=null;var b=$("<div class='wstl-options-tip'>This is a new feature that might have a few kinks to work out.</div>").appendTo(document.body);$(c?(c[0]||c):a).bind("mouseover",function(f){var g=$(f.target);var h=g.parent().attr("value");if(d!=null){clearTimeout(d)}d=setTimeout(function(){b.show();b.css({left:f.clientX+10,top:f.clientY+10})},100)}).bind("mouseout",function(){if(d!=null){clearTimeout(d)}b.hide()})};Util.panel=function(a){var b='<div class="rtq-panel"><div class="shadow"></div><div class="container"><div class="hd"><h4>Title</h4><div class="hd-btn"><a class="close">X</a></div></div><div class="ctn"></div></div></div>';this.jqDOM=$(b);this.title=null;this.ctn=null;this.utilType="";this.closeCallback=a;this._init();return this};Util.panel.prototype={_init:function(){var a=this;this.title=this.jqDOM.find(".hd h4");this.ctn=this.jqDOM.find(".ctn");this.jqDOM.find(".hd a.close").click(function(){a.hide();if(typeof a.closeCallback=="function"){a.closeCallback()}});this.jqDOM.appendTo(document.body)},addToContent:function(a){this.ctn.append(a)},setTitle:function(a){this.title.html(a)},show:function(){this.jqDOM.find(".shadow").css({height:this.jqDOM.height()});this.jqDOM.show()},hide:function(){this.jqDOM.hide();if(this.utilType!="message"){QS_FullMarsk.hide()}},del:function(){this.jqDOM.remove()},setCloseCallback:function(a){this.closeCallback=a}};Util.promptObj=null;Util.prompt=function(d,g,a){if(!Util.promptObj){var f=new Util.panel();f.jqDOM.addClass("rtq-prompt rtq-a-c-p");var h=(a&&a.label)?'<div class="qs-ui-label">'+a.label+":</div>":"";f.addToContent('<div class="qs-ui-content">'+h+'<input class="qs-ui-ipt name-ipt" type="text" /></div><div class="btn-ctn"><a href="javascript:void(0)" class="qs-ui-btn ok">OK</a><a class="qs-ui-btn cancel" href="javascript:void(0)">Cancel</a></div>');f.setTitle("Confirm");f.okCallback=function(i){};f.config={validateMethod:function(){return true},cancelCallBack:null,beforeCloseCallBack:null};f.input=f.ctn.find(".name-ipt");var b=f.ctn.find(".ok");var c=f.ctn.find(".cancel");var e=function(){if(!f.config.validateMethod(f.input.val())){return false}if(typeof(f.config.beforeCloseCallBack)=="function"){if(f.config.beforeCloseCallBack(f.input.val())){f.hide();f.okCallback(f.input.val())}else{f.input.val("");f.input.focus()}}else{f.hide();f.okCallback(f.input.val())}};f.input.bind("keydown",function(i){if(i.keyCode==13){e()}});b.click(e);c.click(function(i){if(typeof(f.config.cancelCallBack)=="function"){f.config.cancelCallBack()}f.hide();return false});Util.promptObj=f}Util.promptObj.okCallback=g;if(a){$.extend(true,Util.promptObj.config,a)}Util.promptObj.input.val("");Util.promptObj.setTitle(d);Util.promptObj.show();Util.promptObj.input.focus()};Util.confirmObj=null;Util.confirm=function(){var cacheRquest={};var isLoading=false;var doNext=function(){for(var msg in cacheRquest){show(msg,cacheRquest[msg].callbacks[0],cacheRquest[msg]);return}};var createConfirmObj=function(){var panel=new Util.panel();panel.jqDOM.addClass("rtq-confirm rtq-a-c-p");panel.addToContent('<h5>Message</h5><div class="btn-ctn"><input type="text" class="qs-ui-ipt" value="" /><a href="javascript:void(0)" class="qs-ui-btn ok">Ok</a><a class="qs-ui-btn cancel" href="javascript:void(0)">Cancel</a></div>');panel.setTitle("Confirm");panel.msg=panel.ctn.find("h5");panel.callback=function(){};var fnSubmit=function(){panel.hide();panel.callback(true);doNext()};panel.setOkText=function(text){panel.ctn.find(".ok").text(text)};panel.setOkTip=function(text){panel.ctn.find(".ok")[0].title=text};panel.setCancelText=function(text){panel.ctn.find(".cancel").text(text)};panel.setCancelTip=function(text){panel.ctn.find(".cancel")[0].title=text};panel.ctn.find(".ok").click(fnSubmit);panel.ctn.find(".cancel").click(function(e){panel.hide();panel.callback(false);doNext()});panel.ctn.find("input").bind("keydown",function(e){if(e.keyCode==13){fnSubmit()}});Util.confirmObj=panel};var show=function(msg,callback,config){if(!Util.confirmObj){createConfirmObj()}if(!cacheRquest[msg]){cacheRquest[msg]={msg:msg,config:config,callbacks:[],closeCallbacks:[]};if(typeof callback=="function"){cacheRquest[msg].callbacks.push(callback)}if(config&&typeof config.closeCallback=="function"){cacheRquest[msg].closeCallbacks.push(config.closeCallback)}if(!isLoading){Util.confirmObj.msg.html(msg);Util.confirmObj.msg.html(msg);Util.confirmObj.setTitle("Confirm");Util.confirmObj.setOkText("Ok");Util.confirmObj.setCancelText("Cancel");Util.confirmObj.setOkTip("");Util.confirmObj.setCancelTip("");if(config){if(config.title){Util.confirmObj.setTitle(config.title)}if(config.okText){Util.confirmObj.setOkText(config.okText)}if(config.cancelText){Util.confirmObj.setCancelText(config.cancelText)}if(config.okTipText){Util.confirmObj.setOkTip(config.okTipText)}if(config.cancelTipText){Util.confirmObj.setCancelTip(config.cancelTipText)}if(typeof config.closeCallback=="function"){with({message:msg}){Util.confirmObj.setCloseCallback(function(){while(cacheRquest[message].closeCallbacks.length>0){cacheRquest[message].closeCallbacks.shift()()}delete cacheRquest[message];isLoading=false;doNext()})}}else{with({message:msg}){Util.confirmObj.setCloseCallback(function(){isLoading=false;delete cacheRquest[message];doNext()})}}}if(typeof callback=="function"){with({message:msg}){Util.confirmObj.callback=function(b){while(cacheRquest[message].callbacks.length>0){cacheRquest[message].callbacks.shift()(b)}delete cacheRquest[message];isLoading=false}}}Util.confirmObj.show();Util.confirmObj.ctn.find("input").focus();isLoading=true}}else{if(typeof callback=="function"){cacheRquest[msg].callbacks.push(callback)}if(config&&typeof config.closeCallback=="function"){cacheRquest[msg].closeCallbacks.push(config.closeCallbacks)}}};return show}();Util.alertObj=null;Util.alert=function(d,b){if(!Util.alertObj){var a=new Util.panel();a.jqDOM.addClass("rtq-alert rtq-a-c-p");a.addToContent('<h5>Message</h5><div class="btn-ctn"><a href="javascript:void(0)" class="qs-ui-btn ok">OK</a></div>');a.setTitle("Alert");a.msg=a.ctn.find("h5");var c=function(){a.hide();return};a.ctn.find(".ok").click(c);a.jqDOM.bind("keydown",function(f){if(f.keyCode==13){c()}});Util.alertObj=a}Util.alertObj.msg.html(d);if(b){if(b.title){Util.alertObj.setTitle(b.title)}}Util.alertObj.show()};Util.messageObj=null;Util.message=function(c){if(!Util.messageObj){var a=new Util.panel();a.utilType="message";a.jqDOM.addClass("rtq-msg rtq-a-c-p");a.addToContent("<h5>Message</h5>");a.msg=a.ctn.find("h5");var b=null;a.autoHide=function(d){if(b){clearTimeout(b);b=-1}b=setTimeout(function(){a.hide()},d||8000)};a.jqDOM.bind("keydown",function(d){if(d.keyCode==13){a.hide()}});Util.messageObj=a}Util.messageObj.msg.html(c);Util.messageObj.show();Util.messageObj.autoHide()};Util.DropDownList=function(c,d,e,a,b){this.dom=c[0]||c;this.data=e;this.cfg={triggerByClick:false,animSlide:false,width:$(this.dom).width()||80,disable:false,actionAtInit:true,syncListWidth:true,className:"",showScrollbar:false,defaultIndex:0,ellipsis:false};$.extend(this.cfg,a);this.selectedIndex=0||this.cfg.defaultIndex;this.viewScope=b||$("body");this.onChange=d||function(){};this.bMenuHaveReversed=false;this.init()};Util.DropDownList.CurrentMENU=null;$(document.body).click(function(a){if(Util.DropDownList.CurrentMENU!=null&&!Util.contains(Util.DropDownList.CurrentMENU.dom,a.target)&&a.target!=Util.DropDownList.CurrentMENU.dom){Util.DropDownList.CurrentMENU.hideMenu()}});Util.DropDownList.prototype={init:function(){this.mod=$(document.createElement("div")).addClass("rtq-ddl");this.menu=$(document.createElement("ul")).addClass("rtq-ddl-menu");this.menuScroll=$(document.createElement("div")).addClass("rtq-ddl-menuScroll").append(this.menu);this.menuWrap=$(document.createElement("div")).addClass("rtq-ddl-menuWrap").append(this.menuScroll);this.ipt=$('<div class="rtq-ddl-ipt"></div>').attr("readonly","readonly");if(this.cfg.ellipsis){this.menuWrap.addClass("qs-ddl-ellipsis");this.ipt.addClass("qs-common-ellipsis")}this._bindData(this.data);$(this.dom).append(this.mod.append(this.ipt).append(this.menuWrap));if(this.cfg.showScrollbar){this.scrollpanel=new Util.ScrollPanel(this.menuScroll,{showY:true,showX:true,delayRun:false})}this.mod.css({width:this.cfg.width}).addClass(this.cfg.className);this.ipt.css({width:this.cfg.width-20});if(this.cfg.disable){this.setDisable(true)}this._bindEvent()},_bindEvent:function(){var a=this;if(this.cfg.triggerByClick){this.mod.bind("click.dropdown",function(b){if($(b.target).closest(".rtq-scrollbar").length!=0){return}if(a.menuWrap.css("overflow")=="hidden"){Util.DelayRun("ui_dropdownlist",a.showMenu,100,a)}else{Util.DelayRun("ui_dropdownlist",a.hideMenu,100,a)}})}else{this.mod.bind("mouseover.dropdown",function(b){Util.DelayRun("ui_dropdownlist",a.showMenu,200,a)}).bind("mouseout.dropdown",function(b){Util.DelayRun("ui_dropdownlist",a.hideMenu,200,a)})}this.menuScroll.bind("click.dropdown",function(d){d.stopPropagation();var j=[],b=$(d.target);if(b.closest(".rtq-scrollbar").length==0&&d.target.tagName.toLowerCase()=="a"){a.selectedIndex=a.menu.children("li").index(b.parent());var h=b.attr("value"),g=0;j=a.menu.find("li a[value = '"+h+"']");for(var c=0,f=j.length;c<f;c++){if(j.get(c)==d.target){break}else{g++}}a.menu.find("li a").removeClass("on");b.addClass("on");a._changeValue(a._getTxtByValue(h),h,g);a.hideMenu()}});$(document.body).click(function(b){if(!Util.contains(a.dom,b.target)&&b.target!=a.dom){a.hideMenu()}});if(this.cfg.actionAtInit){if(this.cfg.defaultSelect){this.selectItemByValue(this.cfg.defaultSelect)}else{this.selectItemByIndex(this.selectedIndex)}}else{this.setTextValue(null,this.menu.children("li").eq(this.selectedIndex).children("a").attr("value"))}},showMenu:function(){if(this.cfg.disable||!this.menuWrap.hasClass("hideMenu")){return}if(Util.DropDownList.CurrentMENU){Util.DropDownList.CurrentMENU.hideMenu()}if(this.cfg.animSlide){this.menuWrap.slideDown("fast")}else{this.menuWrap.removeClass("hideMenu")}this.mod.css({zIndex:100});var a=this._getPostion();var b={zIndex:9999,top:a.top,left:a.left};if(this.cfg.syncListWidth){b.width=this.mod.width();this.cfg.width=b.width}if(this.cfg.showScrollbar){this.scrollpanel.reSize(this.cfg.width,a.AvailHeight)}this.menuWrap.css(b);if(this.cfg.ellipsis){this.menu.find("li").ellipsis()}Util.DropDownList.CurrentMENU=this},_ellipsis:function(b,a){if(this.cfg.ellipsis){this.ipt.ellipsis(false)}},resize:function(b,a){var b=b||$(this.dom).width();this.cfg.width=b;this.mod.css({width:b});this.ipt.css({width:b-20});if(typeof a!="undefined"){this.cfg.height=a}this._ellipsis()},_menuReverse:function(a){if(a==this.bMenuHaveReversed){return}this.bMenuHaveReversed=a;$(this.menu.children().get().reverse()).appendTo(this.menu.empty())},_getPostion:function(){var i=this.mod.height();var c=this.mod.offset();var f=Util.getScrollPosition();var h=this.viewScope.offset();var g=this.menu.height();var e=c.top-h.top;var a=this.viewScope[0].nodeName.toLowerCase()=="body"?$(document).height():this.viewScope.height();var d=a-e-i-12;var b={top:i,left:"-1px"};if(this.cfg.showScrollbar){this._menuReverse(false);if(d>=g){b.showScroll=false;b.AvailHeight=g}else{if(typeof this.cfg.height=="undefined"){b.showScroll=true;b.AvailHeight=d}else{b.showScroll=true;b.AvailHeight=Math.min(this.cfg.height,d)}}}else{if(d>=g){this._menuReverse(false);b.showScroll=false;b.AvailHeight=d}else{if(e>=g){this._menuReverse(true);b.showScroll=false;b.AvailHeight=g;b.top=-g}else{this._menuReverse(false);b.showScroll=true;b.AvailHeight=d}}}if(b.AvailHeight<30&&b.AvailHeight<g){this._menuReverse(true);if(e>=g){b.showScroll=false;b.AvailHeight=g;b.top=-g}else{b.showScroll=true;b.AvailHeight=e;b.top=-e}}return b},hideMenu:function(){if(this.menu!=null){this.menuWrap.addClass("hideMenu");this.mod.css({zIndex:90})}},_changeValue:function(c,b,a){this.ipt.html(this._convertSpecialValue(c));this.ipt.attr("val",b);this.onChange(c,b,a);this._ellipsis()},_bindData:function(f){this.clearList();var c=[];for(var a=0,d=f.length;a<d;a++){if(f[a]==null){c.push(a);continue}var e=typeof f[a].val=="undefined"?f[a].id:f[a].val;var b=null;if(this.cfg.ellipsis){if(typeof(f[a].title)=="undefined"){b=$('<li><a value="'+e+'" href="javascript:void(0)">'+f[a].txt+"</a></li>")}else{b=$('<li><a value="'+e+'" href="javascript:void(0)" title="'+f[a].title+'">'+f[a].txt+"</a></li>")}}else{if(typeof(f[a].title)=="undefined"){b=$('<li><a value="'+e+'" href="javascript:void(0)">'+f[a].txt+"</a></li>")}else{b=$('<li><a value="'+e+'" href="javascript:void(0)" title="'+f[a].title+'">'+f[a].txt+"</a></li>")}}this.menu.append(b)}for(var a=0,d=c.length;a<d;a++){f.splice(c[a],1)}},_getTxtByValue:function(c){var d;for(var a=0,b=this.data.length;a<b;a++){d=this.data[a];if(d.val==c){return d.txt}}},getValue:function(){return this.ipt.attr("val")||""},getText:function(){return this.ipt.html()},getSelectedIndex:function(){return this.selectedIndex},clearList:function(){this.menu.html("")},rebindData:function(a){this.data=a;this._bindData(this.data)},insertItem:function(b,a){this.menu.append('<li><a value="'+a+'" href="javascript:void(0)">'+b+"</a></li>");if(!this.bMenuHaveReversed){this.data.unshift({txt:b,val:a})}else{this.data.push({txt:b,val:a})}},removeItemByValue:function(c){this.menu.find('a[value="'+c+'"]').parent().remove();for(var a=0,b=this.data.length;a<b;a++){data=this.data[a];if(data.val==value){this.data.splice(a,1);return}}},selectItemByValue:function(a){this.menu.find('a[value="'+a+'"]').click()},selectItemByIndex:function(a){this.menu.find("li a").eq(a).click()},_convertSpecialValue:function(a){return a.replace(/&gt;/g,">").replace(/&lt;/g,"<")},setTextValue:function(d,c,b){if(d){this.ipt.html(this._convertSpecialValue(d))}if(typeof(c)!="undefined"){this.ipt.attr("val",c)}var a=this.menu.find('li a[value="'+c+'"]');if(a.length>0){a=a.eq(b||0);this.ipt.html(this._convertSpecialValue(a.html()));this.selectedIndex=this.menu.children("li").index(a.parent());this.menu.find("li a").removeClass("on");a.addClass("on")}this.hideMenu();this._ellipsis()},hideItemByValue:function(a){this.menu.find('a[value="'+a+'"]').parent().hide()},showItemByValue:function(a){this.menu.find('a[value="'+a+'"]').parent().show()},setDisable:function(a){this.cfg.disable=(typeof a=="undefined")?true:a;if(this.cfg.disable){this.mod.addClass("rtq-ddl-disable")}else{this.mod.removeClass("rtq-ddl-disable")}},clearUp:function(){},clear:function(){this.mod.unbind("click").unbind("mouseout").unbind("mouseover");this.menu.unbind("click");this.dom=this.ipt=this.menu=this.data=this.cfg=this.onChange=this.ss=null;this.mod.remove();this.mod=null}};Util.Silder=function(a,b){this.options={min:0,max:100,values:[0,10],disabled:false,widthOfHandle:7};this.onchange=null;this.onchanged=null;this.element=$(a);this.handles;this.midHandle;this._keySliding=false;this._handleIndex=null;this._dragStart=false;this._lastValPercent;this.perHandleWidth=1;this._clickOffset={x:0,y:0,dx:0};if(b){$.extend(this.options,b)}this._init()};Util.Silder.prototype={_init:function(){var a=this,b=this.options;this.element.addClass("rtq-slider");this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()};this.element.find(".rtq-slider-handle").remove();this.perHandleWidth=100*this.options.widthOfHandle/this.elementSize.width;this.element.append('<div class = "rtq-slider-handle"><a class="rtq-slider-left" href="javascript:void(0)"></a></div><div class="rtq-slider-mid"><a></a></div><div class = "rtq-slider-handle"><a class="rtq-slider-right" href="javascript:void(0)"></a></div>');this.handles=this.element.find(".rtq-slider-handle");this.handles.each(function(c){$(this).data("index.sliderHandle",c);$(this).mousedown(function(d){var f=d.target.tagName.toLowerCase();if(f=="a"){a._handleIndex=$(d.target).parent().data("index.sliderHandle");a._startDrag(d)}})});this.midHandle=this.element.find(".rtq-slider-mid");this.midHandle.find("a").mousedown(function(c){a._handleIndex=2;a._clickOffset=a._getMousePostion(c);a._clickOffset.dx=0;a._startDrag(c)});this._refreshValue()},_startDrag:function(a){a.preventDefault();this._dragStart=true;$(document).bind("mousemove",this,this._mouseDrag);$(document).bind("mouseup",this,this._mouseStop)},_mouseDrag:function(g){var l=g.data;if(!l._dragStart){return false}g.preventDefault();var j=l._getMousePostion(g);var e=l.elementSize.width,b,i=l.options;var f=i.max-i.min;if(l._handleIndex==2){var k=j.x-l._clickOffset.x-l._clickOffset.dx;var d=f*k/e;l._clickOffset.dx+=k;l._slide(g,l._handleIndex,d.toFixed(2))}else{b=j.x-l.element.offset().left;var h=(b/e);if(h>1){h=1}if(h<0){h=0}var c=h*f,a=i.min+c;l._slide(g,l._handleIndex,a.toFixed(2))}},_mouseStop:function(b){var a=b.data;$(document).unbind("mousemove",a._mouseDrag);$(document).unbind("mouseup",a._mouseStop);a._dragStart=false;a._stop(b,a._handleIndex);a._handleIndex=null},_slide:function(c,b,d){var a=parseFloat(d);var f=this.options;var h=false;if(f.values&&f.values.length>1){if(b==2){var g=a;if(f.values[0]+a<f.min||f.values[1]+a>f.max){return}f.values[0]=f.values[0]+g,f.values[1]=f.values[1]+g;h=g!=0}else{var e=f.values[b==1?0:1];if((f.values.length==2)&&((b==0&&a>e)||(b==1&&a<e))){a=e}h=(a!=f.values[b]);if(h){f.values[b]=a}}if(h){if(this.onchange){this.onchange(f.values)}this._refreshValue()}}},_stop:function(a,b){if(this.onchanged){this.onchanged(this.options.values)}},_refreshValue:function(){var d=this.options,c=this;if(this.options.values&&this.options.values.length){var a=[];for(var b=0;b<2;b++){a[b]=(d.values[b]-d.min)/(d.max-d.min)*100;a[b]=a[b]>(100-c.perHandleWidth)?100-c.perHandleWidth:a[b];a[b]=a[b]<c.perHandleWidth?c.perHandleWidth:a[b]}this.handles.each(function(e,f){if(e==0){$(this).css({width:a[0]+"%"})}if(e==1){$(this).css({left:a[1]+"%",width:(100-a[1])+"%"})}});this._lastValPercent=a;this.midHandle.css({left:a[0]+"%",width:a[1]-a[0]+"%"})}},_getMousePostion:function(d){var c=document.documentElement,g=document.body,f={};var a=c&&c.scrollLeft||g.scrollLeft||0,h=c&&c.scrollTop||g.scrollTop||0;if(d.pageX==null&&d.clientX!=null){f.x=d.clientX+a;f.y=d.clientY+h}else{f.x=d.pageX+a;f.y=d.pageY+h}return f},changeOutSize:function(b,a){this.elementSize={width:b,height:a};this.perHandleWidth=100*this.options.widthOfHandle/this.elementSize.width;this._handleIndex=null},setOption:function(a){$.extend(this.options,a);if(a.values){this._refreshValue()}},clear:function(){this.handles.unbind("mousedown");this.midHandle.find("a").unbind("mousedown");this.handles.remove();this.handles=this.midHandle=this.options=this.onchange=this.onchanged=null;this.element.removeClass("rtq-slider").removeData("slider").unbind(".slider");this.element=null}};Util.GroupBox=function(c,d,a,b){this.container=c[0]||c;this.el;this.groups={};this.data=d;this.cfg={disable:false,width:"100%",groupBoxHeight:100,animate:false,autoHeight:false,expendAll:false};$.extend(this.cfg,a);this.cb={};$.extend(this.cb,b);this.currentGroup=null;this.selectedIndex=0;this.html='<div class="rtq-groupbox"></div>';this.init()};Util.GroupBox.prototype={init:function(){var b=this;this.el=$(this.html).width(this.cfg.width);this.bindData(this.data);if(typeof b.cfg.defaultExpand!="undefined"&&b.cfg.defaultExpand!="all"){setTimeout(function(){b.expand(b.cfg.defaultExpand)},0)}else{if(b.cfg.defaultExpand=="all"){setTimeout(function(){b.expand()},0)}else{for(var a in this.groups){setTimeout(function(){b.groups[a].expand()},0);break}}}this.el.appendTo(this.container)},bindData:function(b){this.data=b;for(var a=0;a<b.length;a++){this.createGroup(b[a])}},expend:function(b){if(typeof b!="undefined"){if(typeof this.groups[b]!="undefined"){this.groups[b].expand()}}else{for(var a in this.groups){this.groups[a].expand()}}},dexpand:function(b){if(typeof b!="undefined"){for(var a in this.groups){if(a!=b){this.groups[a].dexpand()}}}else{for(var a in this.groups){this.groups[a].dexpand()}}},createGroup:function(d){var b=this;var a={};a.groupHeight=this.cfg.groupBoxHeight;$.extend(a,d);var c="";if(this.cfg.autoHeight==true){c="auto"}else{c=this.cfg.groupBoxHeight+"px"}a.el=$('<div class="rtq-groupbox-group"><h3 class="rtq-groupbox-group-hd">'+d.name+'</h3><div class="rtq-groupbox-group-bd" style="height:'+c+'"></div></div>');a.hd=a.el.children(".rtq-groupbox-group-hd");a.bd=a.el.children(".rtq-groupbox-group-bd");a.bdHeight=null;a.expand=function(){if(b.currentGroup&&b.currentGroup!=a&&!b.cfg.expendAll){b.currentGroup.dexpand()}a.isShow=true;a.el.addClass("rtq-groupbox-group-open");b.currentGroup=a;if(b.cfg.animate){if(!a.bdHeight){a.bdHeight=a.bd.height()}a.bd.css({overflow:"auto"});a.bd.height(0).animate({height:b.cfg.autoHeight==true?a.bdHeight:a.groupHeight})}else{a.bd.show()}};a.dexpand=function(){a.isShow=false;a.el.removeClass("rtq-groupbox-group-open");if(b.cfg.animate){a.bd.css({overflow:"hidden"});a.bd.animate({height:0})}else{a.bd.hide()}};a.hd.click(function(){if(a.isShow){a.dexpand()}else{a.expand()}if(b.cb.onClickHead){b.cb.onClickHead(b.groups[d.id])}});this.groups[d.id]=a;this.el.append(a.el)},getGroup:function(b){for(var a in this.groups){if(this.groups[a].id==b){return this.groups[a]}}return null},clear:function(){if(this.groups){for(var a in this.groups){this.groups[a].hd.unbind("click");this.groups[a].hd=this.groups[a].bd=this.groups[a].expand=this.groups[a].dexpand=this.groups[a].data=null;this.data=null;this.groups[a].el.remove();this.groups[a].el=null}}}};Util.SelectButton=function(b,d,a,c){this.container=b[0]?b:$(b);this.el;this.data=d;this.txt=d.txt;this.val=d.val;this.title=d.title;this.isSelected=d.isSelected?d.isSelected:false;this.cb={onClick:function(f,e){},afterSelect:function(f,e){},afterInverse:function(f,e){}};$.extend(this.cb,a);this.cfg={type:"radio",withGroup:false,disable:false};$.extend(this.cfg,c);this.className=this.cfg.type=="radio"?"rtq-radio":"rtq-checkbox";this.html="";this.init()};Util.SelectButton.prototype={init:function(){var c=document.createElement("a");c.innerHTML=this.txt;c.className=this.className;if(this.title&&this.title!=""){c.setAttribute("title",this.title)}else{if(this.cfg.needTitle){c.setAttribute("title",this.txt)}}var b=this;this.el=$(c).click(function(a){if(b.cfg.disable){return}if(!b.cfg.withGroup){if(b.isSelected){b.inverse()}else{b.select()}}b.cb.onClick(b.val,b)});if(this.cfg.disable){this.disable(true)}if(this.isSelected){this.select()}this.container.append(c)},disable:function(a){this.cfg.disable=a===true?true:false;if(this.cfg.disable){this.el.addClass("rtq-btn-disable")}else{this.el.removeClass("rtq-btn-disable")}},select:function(){this.el.addClass(this.className+"-on");this.isSelected=true;this.cb.afterSelect(this.val,this)},inverse:function(){this.el.removeClass(this.className+"-on");this.isSelected=false;this.cb.afterInverse(this.val,this)},clear:function(){this.el.unbind("click");this.cfg.afterInverse=this.cfg.afterSelect=this.cfg.onClick=null;this.data=null;this.el.remove()}};Util.ButtonGroup=function(b,d,a,c){this.container=b[0]?b:$(b);this.el;this.data=d;this.btns={};this.cb={onClick:function(f,e){}};$.extend(this.cb,a);this.cfg={type:"radio",multiSelect:false,inverse:true,vertical:false,disable:false,needTitle:false,defaultSelected:[]};$.extend(this.cfg,c);this.cfg.multiSelect=this.cfg.type=="checkbox"?true:false;this.init()};Util.ButtonGroup.prototype={init:function(){this.el=$('<div class="rtq-btngroup'+(this.cfg.vertical?" rtq-btngroup-v":"")+'"></div>').appendTo(this.container);this.bindData(this.data);if(this.cfg.disable){this.disable(true)}},bindData:function(c){var b=this;this.data=c;this.el.empty();this.btns={};for(var a=0;a<c.length;a++){this.btns[c[a].val]=new Util.SelectButton(this.el,{txt:c[a].txt,val:c[a].val,isSelected:$.inArray(c[a].val,this.cfg.defaultSelected)!=-1?true:false,title:c[a].title},{onClick:function(d,e){b._onClick(d,e)}},{type:this.cfg.type,withGroup:true,needTitle:this.cfg.needTitle});if(typeof(c[a].checked)!="undefined"&&c[a].checked==true){this.btns[c[a].val].select()}}},_onClick:function(b,c){var a=c.isSelected;if(!this.cfg.multiSelect){for(var d in this.btns){this.btns[d].inverse()}}if(this.cfg.inverse){if(a){c.inverse()}else{c.select()}}else{c.select()}this.cb.onClick(b,c)},disable:function(a){this.cfg.disable=a===true?true:false;for(var b in this.btns){this.btns[b].disable(this.cfg.disable)}},getValue:function(){var a=[];for(var b in this.btns){if(this.btns[b].isSelected){a.push(this.btns[b].val)}}return a},clear:function(){if(this.btns){for(var a in this.btns){if(typeof(this.btns[a].clear)=="function"){this.btns[a].clear()}}}this.el=null,this.data=null}};Util.CascadeMenu=function(b,c,a,d){this.option={display:true,isTraceMouse:false,autoHide:false,menuContainment:"document",fixedDirection:true};this._menuOffset={left:0,top:0};this._ulSize=[];this._itemDirection=[];this.data=a;this.menu;this.container=b;this.menuContainment=[];this.menuItems={};this.callbacks={onHide:null,onClick:null};$.extend(this.callbacks,d);this._timeOut=null;$.extend(true,this.option,c);this._init()};Util.CascadeMenu.currentMenu=null;Util.CascadeMenu.prototype={_init:function(b){this.menuItems={};if(this.menu){this.menu.remove();this.menu=null}this.menu=this._createMenuItems(this.container,this.data,0,"",null)||$('<ul class="rtq-menu-ul"></ul>').appendTo(this.container);this.menu.addClass("rtq-menu").hide();var a=this;this._itemBindEvent(this.menu,this);this.menu.unbind("click.cascadeMenu").bind("click.cascadeMenu",this,this.menuOnClick).bind("mouseover.cascadeMenu",function(c){a.show();if(a._timeOut){clearTimeout(a._timeOut)}});if(this.option.autoHide){this.menu.unbind("mouseout.cascadeMenu").bind("mouseout.cascadeMenu",function(c){if(a._timeOut){clearTimeout(a._timeOut)}a._timeOut=setTimeout(function(){a.hide()},300)})}$(window).resize(function(){a._setDragContainment()});if(!this.option.display&&!b){this.hide()}else{this._menuOffset=this.menu.offset()}this._setDragContainment()},_itemBindEvent:function(a,c){var b=this;a.find(".rtq-menu-item").bind("mouseenter",this,function(f){var k=f.data;var n=$(this);n.addClass("rtq-menu-hover");var m=n.attr("index");var p=k.menuItems[m].data.tip;if(typeof(p)!="undefined"){var l=k.container.find(".cascademenu-tip");if(l.length>0){l.show()}else{k.container.append("<div class='cascademenu-tip'>"+p+"</div>");l=k.container.find(".cascademenu-tip");l.show()}l.html(p);l.css({top:n.position().top+23,left:n.parent().position().left+n.width()})}if(!c.option.fixedDirection){var o=n.parent().data("layer.CascadeMenu");var q=n.find(">.rtq-menu-ul");if(q.length){c._ulSize[o+1]={width:q.width(),height:q.height()};var t=c._setDirection(o+1,n.offset().top),r,j;if(t.horizontal){r="100%"}else{r=(-c._ulSize[o+1].width)}if(t.vertical){j=0}else{j=(-c._ulSize[o+1].height+15)}if(t.drag){j=j+t.drag}q.css({left:r,top:j})}}else{var q=n.find(">.rtq-menu-ul");if(q.css("top")!=0||q.css("top")!="0px"){q.css("top","0px")}if(q.size()==0){var q=n}var s=q.offset().top;var i=q.height();var g=k.menuContainment[1]+k.menuContainment[3];if(s+i>g){if(i>g){q.css({top:-s})}else{q.css({top:g-(s+i)})}}}}).bind("mouseleave",this,function(d){$(this).removeClass("rtq-menu-hover");if(typeof(d.data.container.find)=="function"){d.data.container.find(".cascademenu-tip").hide()}})},_getDataObj:function(c,d){if(typeof(c)=="undefined"||c==null){return null}var e=null,b;for(var a=0;a<=c;a++){b=parseInt(d[a]);if(a==0){e=this.data[b]}else{e=e.subMenu[b]}}return e},reBindSecondLevelMenu:function(c,d,b){var a=this.getItemByVal(c);if(!a.el.hasClass("rtq-menu-arrow")){a.el.addClass("rtq-menu-arrow")}a.el.find(".rtq-menu-ul").remove();this._createMenuItems(a.el,d,b,a.el.attr("index"),a);this._itemBindEvent(a.el,this)},_createMenuItems:function(j,d,c,h,m){var l="",e="",b="",f=h,n,g,a="";if(d==null){return}if(d.length){g=$('<ul class ="rtq-menu-ul"></ul>').appendTo(j).data("layer.CascadeMenu",c);for(var k=0;k<d.length;k++){if(!d[k]){continue}if(d[k].display==false){continue}a=typeof(d[k]["className"])!="undefined"?d[k]["className"]:"";f=h+"_"+k;this.menuItems[f]={};this.menuItems[f]["data"]=this._copyItemData(d[k]);this.menuItems[f]["parent"]=m;this.menuItems[f]["el"]=$("<li index="+f+' class="rtq-menu-item '+a+((d[k].subMenu&&d[k].subMenu.length)?" rtq-menu-arrow":"")+(d[k].disable?" disable":"")+'"></li>').appendTo(g);if(typeof(d[k].renderer)=="function"){d[k].renderer(this.menuItems[f]["el"])}else{if(d[k].type=="separator"){this.menuItems[f]["el"].append('<div class="rtq-menu-separator"></div>')}else{b="rtq-menu-a";if(d[k].type=="checkbox"){e='class = "'+(d[k].checked?"rtq-chkbox ":"rtq-chkbox rtq-chkbox-off ")+b+'"'}else{if(d[k].type=="ratio"){e='class = "rtq-ratio rtq-ratio-off '+b+'"'}else{if(d[k].type=="switch"){if(d[k].txt==d[k].sTxt[0]){e='class = "on '+b+'"'}else{e='class = "'+b+'"'}}else{e='class = "'+b+'"'}}}n=d[k].type?d[k].type:"&nbsp;";l="<a "+e+"type="+n+" sq="+c+" >"+d[k].txt+"</a>";this.menuItems[f]["el"].append(l)}}if(d[k].subMenu&&d[k].subMenu.length){this._createMenuItems(this.menuItems[f]["el"],d[k].subMenu,c+1,f,this.menuItems[f])}if(typeof(d[k].selected)!="undefined"&&d[k].selected==true){this.menuItems[f]["el"].children().removeClass("rtq-ratio-off")}if(d[k].disable===true){this.menuItems[f]._isDisable=true}}}return g},_copyItemData:function(c){var a={};for(var b in c){if(b!="subMenu"){a[b]=c[b]}}return a},_getPostion:function(a,d){var b=Util.getScrollPosition();var c=d.offset();return{left:a.pageX+b.scrollx-c.left,top:a.pageY+b.scrolly-c.top}},setPosition:function(b,a){this.menu.css({top:a,left:b})},_selectMenuItem:function(d,f){var a=d.data.type,e=d.el.find(">a"),c=d.data.autoHighlight;if(a=="ratio"){if(!f){e.addClass("rtq-ratio-off")}else{if(e.hasClass("rtq-ratio-off")){e.closest("ul",this.menu).find(">li>a").addClass("rtq-ratio-off");e.removeClass("rtq-ratio-off")}else{if(d.el.hasClass("rtq-menu-on")){e.closest("ul",this.menu).find(">li").removeClass("rtq-menu-on")}}}}else{if(a=="checkbox"){if(f){e.removeClass("rtq-chkbox-off")}else{e.addClass("rtq-chkbox-off")}d.checked=f}else{if(a=="switch"){if(f){e.addClass("on")}else{e.removeClass("on")}var b=f?0:1;e.html(d.data.sTxt[b]);d["switch"]=f?"on":"off"}}}},menuOnClick:function(a){var f=a.data;var g=true;var d=$(a.target).closest(".rtq-menu-item",f.menu);var b=d.attr("index");if(typeof(b)=="undefined"){return false}var c=f.menuItems[b];if(c._isDisable===true){return false}if(c.data&&(typeof(c.data.selectable)=="undefined"||c.data.selectable)){if(c.data.type=="checkbox"){g=d.find("a").hasClass("rtq-chkbox-off")}else{if(c.data.type=="switch"){g=!d.find("a").hasClass("on")}}f._selectMenuItem(c,g);if(typeof(f.callbacks.onClick=="function")){f.callbacks.onClick(c)}}},show:function(a){if(Util.CascadeMenu.currentMenu!=null&&Util.CascadeMenu.currentMenu!=this){Util.CascadeMenu.currentMenu.hide()}var c=0,b;if(typeof(this._ulSize[0])=="undefined"){this._ulSize[0]={width:this.menu.width(),height:this.menu.height()}}if(this.option.isTraceMouse&&typeof(a)!="undefined"){this._menuOffset={left:a.pageX,top:a.pageY};b=this._getPostion(a,this.container);this._setDragContainment();var d=this._setDirection(0,b.top);if(!d.horizontal){b.left=b.left-this._ulSize[0].width}if(!d.vertical){b.top=b.top-this._ulSize[0].height}if(d.drag){b.top=b.top+d.drag}this.menu.css(b).show();this._itemDirection[0]={horizontal:1,vertical:1};this._menuOffset=this.menu.offset()}else{this.menu.show()}Util.CascadeMenu.currentMenu=this;clearTimeout(this._timeOut)},hide:function(){this.menu.hide();if(this.callbacks.onHide){this.callbacks.onHide()}},getDisplayState:function(){return this.menu.css("display")!="none"},getItemByVal:function(e,f){var a,b;for(var c in this.menuItems){a=this.menuItems[c].data;b=this.menuItems[c].parent==null?null:this.menuItems[c].parent.data;if(e==a.val&&(typeof(f)=="undefined"||f==null||(b!=null&&f==b.val))){return this.menuItems[c]}}return null},changeUIState:function(b,c,d){var a=this.getItemByVal(b,c);if(a){this._selectMenuItem(a,d)}},disableItem:function(b,c){var a=this.getItemByVal(b,c);if(a&&!a._isDisable){a._isDisable=true;a.el.addClass("disable")}},enableItem:function(b,c){var a=this.getItemByVal(b,c);if(a&&a._isDisable){a._isDisable=false;a.el.removeClass("disable")}},changeItemClass:function(e,b,g,h,a){var i,c;if(typeof(a)=="undefined"){a=false}for(var f in this.menuItems){i=this.menuItems[f].data;c=this.menuItems[f].parent==null?null:this.menuItems[f].parent.data;if(e==i.val&&(typeof(b)=="undefined"||b==null||(c!=null&&b==c.val))){if(a){if(h){this.menuItems[f].el.find(">a").addClass(g)}else{this.menuItems[f].el.parent().find("li a").addClass(g);this.menuItems[f].el.find(">a").removeClass(g)}}else{h?this.menuItems[f].el.addClass(g):this.menuItems[f].el.removeClass(g)}}}},reBind:function(b,a){this.data=b;this._init(a)},_setDragContainment:function(){var b=this.option;if(b.menuContainment=="document"||b.menuContainment=="window"){this.menuContainment=[0,0,$(b.menuContainment=="document"?document:window).width(),$(document.body.parentNode).height()]}if(!(/^(document|window)$/).test(b.menuContainment)&&b.menuContainment.constructor!=Array){var c=$(b.menuContainment)[0];if(!c){return}var a=$(b.menuContainment).offset();var d=($(c).css("overflow")!="hidden");this.menuContainment=[(parseInt($(c).css("borderLeftWidth"),10)||0)+(parseInt($(c).css("paddingLeft"),10)||0),(parseInt($(c).css("borderTopWidth"),10)||0)+(parseInt($(c).css("paddingTop"),10)||0),(d?Math.max(c.scrollWidth,c.offsetWidth):c.offsetWidth)-(parseInt($(c).css("borderLeftWidth"),10)||0)-(parseInt($(c).css("paddingRight"),10)||0),(d?Math.max(c.scrollHeight,c.offsetHeight):c.offsetHeight)-(parseInt($(c).css("borderTopWidth"),10)||0)-(parseInt($(c).css("paddingBottom"),10)||0)]}else{if(b.menuContainment.constructor==Array){this.menuContainment=b.menuContainment}}},_setDirection:function(f,g){if(f<0||typeof(f)=="undefined"||this._itemDirection.length<f){return 1}var b=0,c=0,d,a,j=0;for(var e=0;e<f;e++){if(this._itemDirection[e].horizontal==1){b+=this._ulSize[e].width}else{b-=this._ulSize[e].width}if(this._itemDirection[e].vertical==1){c+=this._ulSize[e].height}else{c-=this._ulSize[e].height}}if(this._menuOffset.left+b+this._ulSize[f].width>(this.menuContainment[0]+this.menuContainment[2])){d=0}else{d=1}if(g+this._ulSize[f].height>(this.menuContainment[1]+this.menuContainment[3])){a=0;if(g<this._ulSize[f].height-(g==0?0:15)&&(this.menuContainment[1]+this.menuContainment[3])>this._ulSize[f].height){a=1;j=(this.menuContainment[1]+this.menuContainment[3])-(g+this._ulSize[f].height)}else{if(g<this._ulSize[f].height-(g==0?0:15)){j=this._ulSize[f].height-(g)}}}else{a=1}this._itemDirection[f]={horizontal:d,vertical:a,drag:j};return this._itemDirection[f]},clear:function(){this.menu.unbind(".cascadeMenu");this.menu.find(".rtq-menu-item").unbind();for(var a in this.menuItems){this.menuItems[a].parent=null;this.menuItems[a].el=null;this.menuItems[a].data=null}this.data=null;this.menuItems=null;this.menu.remove()}};Util.customConfirmObj=null;Util.customConfirm=function(e,a,b){if(!Util.customConfirmObj){var c=new Util.panel();c.jqDOM.addClass("rtq-customConfirm rtq-a-c-p");c.addToContent('<h5>Message</h5><div class="radio-container"></div><div class="btn-ctn"><a href="javascript:void(0)" class="qs-ui-btn ok">OK</a></div>');c.setTitle("<br/>");c.msg=c.ctn.find("h5");c.callback=function(){};c.radioBtn=new Util.ButtonGroup(c.ctn.find(".radio-container"),[{txt:"Yes",val:"yes",selected:true},{txt:"No",val:"no"}],{onClick:function(f){}},{vertical:true});c.autoSelect=function(h){for(var f=0,g=h.length;f<g;f++){if(h[f].selected){c.radioBtn.btns[h[f].val].select();break}}};c.autoSelect(c.radioBtn.data);var d=function(){c.hide();c.callback(c.radioBtn.getValue())};c.ctn.find(".ok").click(d);c.jqDOM.bind("keydown",function(f){if(f.keyCode==13){d()}});Util.customConfirmObj=c}Util.customConfirmObj.callback=a||function(){};Util.customConfirmObj.msg.html(e);if(b){if(b.title){Util.customConfirmObj.setTitle(b.title)}if(b.radioData){Util.customConfirmObj.radioBtn.bindData(b.radioData);Util.customConfirmObj.autoSelect(b.radioData)}}Util.customConfirmObj.show()};Util.qsFullMarsk=function(){this.html="<div class='window-body-full-marsk'></div>";this.obj=null;this.init()};Util.qsFullMarsk.prototype={init:function(){this.obj=$(this.html);this.obj.appendTo(document.body);this.hide()},show:function(){this.obj.show()},hide:function(){this.obj.hide()}};var QS_FullMarsk=new Util.qsFullMarsk();if(!Util){var Util={}}Util.TabMenu=function(c,d,a,b){this.dom=c;this.mod;this.tabs=[];this.dMenus=null;this.dPanels=null;this.disableMask=null;this.data=d||[];this.cfg={width:110,autoResize:false,marginRightWidth:0,disable:false,customCls:"",switchType:"hide",isExcuteCallbackAtInit:true,tabsList:false,closeAction:"hide",autoFixtoText:true,vertical:false,hoverEvent:true,activeTabId:null,activeTabIndex:0,tabsMask:false,needTitle:false,autoSlideToActiveTab:true,plusSymbol:false,rearrange:false};if(b){$.extend(this.cfg,b)}this.callback=a||{};this.currentTab=null;this._panelHeight=500;this._panelWidth="100%";this._tabWidth=this.cfg.width;this.plusTabRightEl=null;this.plusTabInTabEl=null;this.showPlusinTab=true;this.marginRightWidth=[22,44];this.init()};Util.TabMenu.prototype={init:function(){var a=this;this.mod=$('<div class="rtq-tabs'+(this.cfg.vertical?" rtq-tabs-v":"")+'">');this.dMenus=$('<ul class="rtq-tab-menus">');this.mod.append('<div class="rtq-tab-wrap"><div class="rtq-tab-tablist">'+(this.cfg.plusSymbol?'<a class="qs-tabmenu-plus qs-tabmenu-plus-right"></a>':"")+'</div><div class="rtq-tab-menus-wrap"></div></div>');this.tableListWrap=this.mod.find(".rtq-tab-tablist");this.menusWrap=this.mod.find(".rtq-tab-menus-wrap").append(this.dMenus);this.plusTabRightEl=this.tableListWrap.find(".qs-tabmenu-plus-right");this.disableMask=this.mod.append('<div class="rtq-tab-mask"></div>');if(this.cfg.tabsList){this.tabList=new Util.DropDownList(this.mod.find(".rtq-tab-tablist"),function(d,c,b){a.cfg.activeTabIndex=b;a.getTabById(c).active()},{},{width:22,syncListWidth:false,actionAtInit:false,ellipsis:true})}else{this.marginRightWidth[0]=0}if(this.cfg.plusSymbol){this.plusTabRightEl.bind("click",function(){a._onClickPlusTab()});this._createPlusObj()}this.dPanels=$('<div class="rtq-tab-panels">').appendTo(this.mod);if(this.cfg.tabsMask){this.menusWrap.append('<div class="rtq-tab-mask-l"></div><div class="rtq-tab-mask-r"></div>')}if(this.cfg.customCls!=""){this.mod.addClass(this.cfg.customCls);this.dMenus.addClass(this.cfg.customCls+"-menus");this.dPanels.addClass(this.cfg.customCls+"-panels");this.mod.find(".rtq-tab-wrap").addClass(this.cfg.customCls+"-wrap");this.mod.find(".rtq-tab-mask-r").addClass(this.cfg.customCls+"-mask-r");this.mod.find(".rtq-tab-mask-l").addClass(this.cfg.customCls+"-mask-l");this.menusWrap.addClass(this.cfg.customCls+"-menus-wrap")}if(this.cfg.rearrange){this.dropTip=$('<div class="drop-tip"></div>').appendTo(this.menusWrap)}this.mod.appendTo(this.dom);if(this.cfg.plusSymbol&&this.plusTabRightEl){this.marginRightWidth[1]=this.plusTabRightEl.outerWidth(true)+this.marginRightWidth[0]}this.plusTabRightEl.css("display","none");if(this.cfg.marginRightWidth>0){this.marginRightWidth[1]=this.cfg.marginRightWidth+this.plusTabRightEl.outerWidth(true);this.marginRightWidth[0]=this.cfg.marginRightWidth}if(this.cfg.tabsList){this.menusWrap[0].style.marginRight=this.marginRightWidth[0]+"px"}this._bindData(this.data);this._resizeTabMenu()},_onClickPlusTab:function(){if(typeof(this.callback.onAddTab)=="function"){this.callback.onAddTab()}},reSize:function(){this._resizeTabMenu()},_createPlusObj:function(){var b={id:"plus"};var a=this;b.menu=$('<li class="qs-tabmenu-plus-tab"></li>').html('<a class="qs-tabmenu-plus"></a>');this.plusTabInTabEl=b.menu;this.plusTabInTabEl.find(".qs-tabmenu-plus").bind("click",function(){a._onClickPlusTab()});this.dMenus.append(b.menu);return b},_createTabObj:function(d){var c={};var b=this;c.isClose=false;c.closable=true;c.disabled=false;$.extend(c,d);c.id=typeof d.id=="undefined"?d.val:d.id;c.menu=$('<li class="menu'+(!c.closable?" noclose":"")+(c.disabled?" disabled":"")+'" >').html("<a><span>"+d.txt+'</span><em title="Close this Tab.">x</em></a>');if(this.cfg.needTitle){c.menu.find("a span").attr("title",d.txt)}if(!this.cfg.autoFixtoText){c.menu.width(b.cfg.width)}c.panel=$('<div class="rtq-tab-panel">');if(b.cfg.customCls!=""){c.panel.addClass(b.cfg.customCls+"-panel")}c.reName=function(f){c.menu.find("a span").text(f);if(b.cfg.needTitle){c.menu.find("a span").attr("title",f)}c.menu.width("auto")},c.active=function(f,g){if((b.currentTab&&b.currentTab==c)||c.disabled){return}else{if(b.currentTab){b.currentTab.deactive()}b.currentTab=c;if(!b.cfg.hoverEvent){c.menu.addClass("over")}c.menu.addClass("on");if(b.cfg.switchType=="position"){c.panel.css({position:"relative",left:0,width:b._panelWidth,height:b._panelHeight})}else{c.panel.show()}if(c.isClose){c.menu.show();c.isClose=false}b.cfg.activeTabIndex=b.getTabIndex();if(b.tabList){b.tabList.setTextValue(null,c.id,b.cfg.activeTabIndex)}b._adjustPlus();if(b.callback.onActive&&!g){b.callback.onActive(c)}}};c.deactive=function(f){if(b.callback.onDeActive){b.callback.onDeActive(c)}if(!b.cfg.hoverEvent){c.menu.removeClass("over")}c.menu.removeClass("on");if(b.cfg.switchType=="position"){c.panel.css({position:"absolute",left:-10000})}else{c.panel.hide()}};c.close=function(){if(b.callback.beforeClose){b.callback.beforeClose(c)}if(c.closable){c.deactive();c.menu.hide();c.isClose=true;if(c.id==b.currentTab.id||b.currentTab==null){b.currentTab=null;b._activeNextTab(c.index)}b._resizeTabMenu();b.reBindTabList()}if(b.callback.afterClose){b.callback.afterClose(c)}};c.menu.click(function(f){if(b.cfg.disable==true){return false}var g=$(f.target);switch(f.target.tagName.toLowerCase()){case"span":c.active(f);break;case"li":c.active(f);break;case"a":c.active(f);break;case"em":if(b.cfg.closeAction=="remove"){b.removeTab(c,true)}else{c.close(f)}break}});if(this.cfg.hoverEvent){c.menu.hover(function(f){$(this).addClass("over")},function(f){$(this).removeClass("over")})}if(this.cfg.rearrange){var a=new Util.Dragable(c.menu,{onDragStart:function(f,g){c.menu.addClass("ondrag");g.dragingTab=c;g.html(c.txt);g.hide()},onDrag:function(g,h){if(h.droppingTab){var f=h.droppingTab.menu.offset();var i=h.droppingTab.menu.width();if(g.clientX<f.left+i/2){b.dropTip.css({left:h.droppingTab.menu.position().left-2,display:"block"})}else{b.dropTip.css({left:h.droppingTab.menu.position().left+i,display:"block"})}}h.css({top:b.menusWrap.offset().top+3,display:"block"})},onDragEnd:function(f,g){c.menu.removeClass("ondrag")}},{group:"QS_TABMENU",customClass:"rtq-tabs-dd-proxy",delay:30});var e=new Util.Dropable(c.menu,{onEnter:function(f,g){c.menu.addClass("ondrop");g.droppingTab=c;if(b.callback.beforeRearrange){b.callback.beforeRearrange(c)}},onDrop:function(f,h){if(h.dragingTab!=c&&h.droppingTab){var g=h.droppingTab.menu.offset();var n=h.droppingTab.menu.width();var j=0;var m=h.dragingTab.menu.width();h.dragingTab.menu.width(0);if(f.clientX<g.left+n/2){h.dragingTab.menu.insertBefore(c.menu);j=c.index}else{h.dragingTab.menu.insertAfter(c.menu);j=c.index+1}if(h.dragingTab.index<c.index){j--}h.dragingTab.menu.animate({width:m},{duration:200});b.tabs.splice(h.dragingTab.index,1);b.tabs.splice(j,0,h.dragingTab);for(var k=0,o=b.tabs.length;k<o;k++){b.tabs[k].index=k}b.reBindTabList();if(b.callback.afterRearrange){b.callback.afterRearrange(c)}}b.dropTip.hide();c.menu.removeClass("ondrop");h.droppingTab=null},onOut:function(f,g){b.dropTip.hide();c.menu.removeClass("ondrop");g.droppingTab=null}},{group:"QS_TABMENU"})}if(b.callback.onTabRender){b.callback.onTabRender(c)}return c},_resizePlusPosition:function(){Util.DelayRun("resizePlus",function(){var b=this.menusWrap.outerWidth(true)-this.marginRightWidth[0];var a=this.dMenus.outerWidth();if(a>b){if(this.showPlusinTab){this.plusTabRightEl.css("display","block");this.plusTabInTabEl.css("visibility","hidden");this.menusWrap[0].style.marginRight=this.marginRightWidth[1]+"px";this.showPlusinTab=false}}else{this.plusTabRightEl.css("display","none");this.plusTabInTabEl.css("visibility","visible");this.menusWrap[0].style.marginRight=this.marginRightWidth[0]+"px";this.showPlusinTab=true}},100,this)},_checkTabPosition:function(a){var b=a.menu;Util.DelayRun("slidetotab",function(){if(!this.cfg.vertical){var h=b.outerWidth(true);if(h>0){var f=this.menusWrap.offset().left;var g=b.offset().left-f,i=this.menusWrap.width();if(this.currentMenuLeft==g+h&&this.tabsWidth==i){return}var d=g+h+this.menusWrap.scrollLeft();this.tabsWidth=i;var c=this._hasNext(a)?(d-i+30):(d-i);var e=this;if(d>this.tabsWidth){this.menusWrap.animate({scrollLeft:c},function(){e.currentMenuLeft=b.offset().left-f+h})}else{this.menusWrap.animate({scrollLeft:0},function(){e.currentMenuLeft=b.offset().left-f+h})}}}},200,this)},_activeNextTab:function(b,c){if(this.tabs.length<2){return}c=c||"next";var a=c=="next"?this.tabs[(b>0)?b-1:1]:this.tabs[(b<this.tabs.length)?b+1:0];if(a){if(a.isClose){if(a.index==0){this._activeNextTab(a.index,"prev")}else{this._activeNextTab(a.index,c)}}else{a.active(null,false)}}},_hasNext:function(a){var c=a.index;var b=this.tabs[c+1];if(b){if(b.isClose){return this._hasNext(b)}else{return true}}else{return false}},_resizeTabMenu:function(){var a=this;Util.DelayRun("resizeTabmenu",function(){if(a.cfg.autoResize){var e=a.menusWrap.width();var c=0;for(var b=0;b<a.tabs.length;b++){if(!a.tabs[b].isClose){c++}}if(!a.tabs||a.tabs.length<1){return}var d=a.tabs[0].menu.width();if(d<=a.cfg.width&&e>a.cfg.width*(c+1)){a.setTabWidth(a.cfg.width)}else{a.setTabWidth(e/c-5)}}a._adjustPlus()},200,a)},_adjustPlus:function(){if(this.cfg.plusSymbol){this._resizePlusPosition()}if(this.cfg.autoSlideToActiveTab){this.showActiveTab()}},showActiveTab:function(){if(this.currentTab){this._checkTabPosition(this.currentTab)}},getIdList:function(){var c=[];for(var a=0,b=this.tabs.length;a<b;a++){if(!this.tabs[a].isClose){c.push(this.tabs[a].id)}}return c},_bindData:function(e){this.data=e;var b=null;for(var a=0,c=this.data.length;a<c;a++){b=this._createTabObj(this.data[a]);b.dataindex=a;this._addTab(b)}if(this.tabs.length>0){var d=this.getTabById(this.cfg.activeTabId)||this.tabs[0];if(d.active){d.active(null,!this.cfg.isExcuteCallbackAtInit)}}for(var a=0,c=this.tabs.length;a<c;a++){this.tabs[a].index=a}this.reBindTabList()},reBindData:function(b){this.menusWrap.scrollLeft(0);this.currentTab=null;for(var a=this.tabs.length-1;a>=0;a--){this._removeTab(this.tabs[a])}this.tabs.length=0;this._bindData(b.slice());this._resizeTabMenu()},reBindTabList:function(){if(this.tabList){var c=[];for(var a=0,b=this.tabs.length;a<b;a++){if(!this.tabs[a].isClose){c.push({val:this.tabs[a].id,txt:this.tabs[a].txt})}}this.tabList.rebindData(c);if(this.currentTab){this.tabList.setTextValue(this.currentTab.txt,this.currentTab.id,this.getTabIndex())}}},_addTab:function(b,c){if(typeof c=="undefined"){if(this.cfg.plusSymbol){this.plusTabInTabEl.before(b.menu)}else{this.dMenus.append(b.menu)}}else{if(this.tabs.length>0){this.dMenus.find("li").eq(c).before(b.menu)}else{if(this.cfg.plusSymbol){this.plusTabInTabEl.before(b.menu)}else{this.dMenus.append(b.menu)}}}this.dPanels.append(b.panel);var a=this.tabs.length;if(typeof c=="undefined"){this.tabs.push(b)}else{this.tabs.splice(c,0,b)}},addTab:function(d,e){this.data.push(d);var b=this._createTabObj(d);b.dataindex=this.data.length-1;this._addTab(b,e);for(var a=0,c=this.tabs.length;a<c;a++){this.tabs[a].index=a}this.reBindTabList();this._resizeTabMenu();return b},_removeTab:function(a){this.cfg.activeTabIndex=0;a.menu.remove();if(a.panel){a.panel.remove()}},reNameCurTab:function(a){this.currentTab.reName(a)},removeTabs:function(c,b){for(var a=0,d=c.length;a<d;a++){this.removeTab(c[a],b)}},removeTab:function(d,b){if(!d){return}var e=d.dataindex;this.data.splice(e,1);if(b===true){d.close()}this._removeTab(d);this.tabs.splice(d.index,1);delete d;for(var a=0,c=this.tabs.length;a<c;a++){this.tabs[a].index=a;if(this.tabs[a].dataindex>e){this.tabs[a].dataindex--}}},changeToTab:function(a){a.active(null)},getTabById:function(d){var b=this.cfg.activeTabIndex;for(var a=0,c=this.tabs.length;a<c;a++){if(this.tabs[a].id==d){b--;if(b<0){return this.tabs[a]}}}return null},getTabsByid:function(d){var b=[];for(var a=0,c=this.tabs.length;a<c;a++){if(this.tabs[a].id==d){b.push(this.tabs[a])}}return b},getTabByIndex:function(c){for(var a=0,b=this.tabs.length;a<b;a++){if(this.tabs[a].index==c){return this.tabs[a]}}return null},changeTabByIndex:function(a,c){var b=this.getTabByIndex(a);b.active(null,!c)},changeTabById:function(b,a){this.getTabById(b).active(null,!a)},setPanelOutSize:function(b,a){this._panelHeight=a;this._panelWidth=b;if(this.currentTab){this.currentTab.panel.css({width:b,height:a})}},getTabIndex:function(c){var b=0;if(!c){c=this.currentTab}for(var a=0,d=this.tabs.length;a<d;a++){if(c.id==this.tabs[a].id&&!this.tabs[a].isClose){if(c==this.tabs[a]){return b}b++}}},setDisable:function(a){this.cfg.disable=a===false?false:true;if(this.cfg.disable){this.mod.addClass("rtq-tabs-disable")}else{this.mod.removeClass("rtq-tabs-disable")}},setTabWidth:function(c){if(c>0&&!this.cfg.autoFixtoText){this._tabWidth=c;for(var a=0,b=this.tabs.length;a<b;a++){this.tabs[a].menu.css({width:c})}}},clear:function(){if(this.tabs){for(var a in this.tabs){if(this.tabs[a].menu){this.tabs[a].menu.unbind()}this.tabs[a].active=this.tabs[a].deactive=this.tabs[a].close=null}}if(this.tabList&&typeof(this.tabList.clear)=="function"){this.tabList.clear()}this.mod.remove();this.mod=null}};if(!Util){var Util={}}Util.Scrollbar=function(d,c,a,b){this.panelObj=d;this.container=d.el;this.target=c;this.html='<a class="rtq-scrollbar-up">UP</a><div class="rtq-scrollbar-bar"></div><a class="rtq-scrollbar-down">DOWN</a>';this.mod;this.bar;this.btnUp;this.btnDown;this.scrollTimer=null;this.scrolling=false;this.dragPos={x:0,y:0};this.len=0;this.scrollLength=0;this.isShow=false;this.parentPadding=0;this.barBorder=2;this.barLen=0;this.cfg={disable:false,type:"y",modBorder:2,aW:12};if(a){$.extend(this.cfg,a)}this.CB={onScroll:function(e){},onScrollEnd:function(e){}};if(b){$.extend(this.CB,b)}this.init()};Util.Scrollbar.prototype={init:function(){var a=this;this.mod=$('<div class="rtq-scrollbar">').html(this.html).addClass((this.cfg.type=="y")?"rtq-scrollbar-y":"rtq-scrollbar-x").bind("click",{self:this},this._clickScroll);this.bar=this.mod.find(".rtq-scrollbar-bar").bind("mousedown",{self:this},this._startDrag).bind("mouseup",{self:this},this._stopDrag);this.btnUp=this.mod.find(".rtq-scrollbar-up").bind("mousedown",{self:this},this._startScrollUp).bind("mouseup",{self:this},this._stopScroll);this.btnDown=this.mod.find(".rtq-scrollbar-down").bind("mousedown",{self:this},this._startScrollDown).bind("mouseup",{self:this},this._stopScroll);this.parentPadding=this.cfg.aW;this.mod.appendTo(this.container);this.scrollTo(0)},reSize:function(a){this._resetBar();this.scrollTo(this._getScrollTop());if(a){if(!this.isShow){this.show();this._setParentPadding(this.parentPadding)}}else{if(this.isShow){this.hide();this._setParentPadding(0)}}},scrollTo:function(a){var b=this.scrollLength-this.len;a=a<0?0:(a>b?b:a);if(a<=b&&a>=0){this._scrollTo(a)}},scrollPercentTo:function(a){this.scrollTo(a*(this.scrollLength-this.len))},show:function(){this.mod.show();this.isShow=true},hide:function(){this.mod.hide();this.isShow=false},_resetBar:function(){if(this.cfg.type=="y"){var a=this.target.height();if(a&&a>=this.cfg.aW*2){this.len=a-this.cfg.modBorder;this.scrollLength=this.target[0].scrollHeight||1;this.mod.css({height:this.len});this.barLen=Math.round((this.len-this.cfg.aW*2)*this.len/this.scrollLength);this.bar.css({height:Math.max(this.barLen-this.barBorder,2)})}}else{var b=this.target.width();if(b&&b>=this.cfg.aW*2){this.len=b-this.cfg.modBorder;this.scrollLength=this.target[0].scrollWidth||1;this.mod.css({width:this.len});this.barLen=Math.round((this.len-this.cfg.aW*2)*this.len/this.scrollLength);this.bar.css({width:Math.max(this.barLen-this.barBorder,2)})}}},_setParentPadding:function(a){if(this.cfg.type=="y"){this.target.css({width:this.container.width()-a})}else{this.target.css({height:this.container.height()-a})}},_scrollTo:function(a){this.CB.onScroll(a);var b=Math.round((a*(this.len-this.cfg.aW*2-this.barLen)/(this.scrollLength-this.len))+this.cfg.aW);if(b<this.cfg.aW){b=this.cfg.aW}else{if((b+this.barLen+this.barBorder)>(this.len-this.cfg.aW)){b=this.len-this.cfg.aW-this.barLen+this.cfg.modBorder}}if(this.cfg.type=="y"){this.target.scrollTop(a);this.bar.css({top:b||0})}else{this.target.scrollLeft(a);this.bar.css({left:b||0})}},_getScrollTop:function(){return(this.cfg.type=="y")?this.target.scrollTop():this.target.scrollLeft()},_clickScroll:function(b){if($(b.target).hasClass("rtq-scrollbar")){var c=b.data.self;c.scrolling=true;var a=(c.cfg.type=="y")?b.clientY-c.bar.offset().top:b.clientX-c.bar.offset().left;if(a>0){c.scrollTo(c._getScrollTop()+100)}else{c.scrollTo(c._getScrollTop()-100)}c.CB.onScrollEnd(c.cfg.type=="y"?c.target.scrollTop():c.target.scrollLeft())}},_startScrollUp:function(a){var b=a.data.self;b.scrolling=true;b._scroll(-10)},_startScrollDown:function(a){var b=a.data.self;b.scrolling=true;b._scroll(10)},_startDrag:function(a){var d=a.data.self;var b=d.bar.position();d.dragPos={x:parseInt(a.clientX-b.left),y:parseInt(a.clientY-b.top)};d.scrolling=true;var c=a.target;$(document).bind("mousemove.Scrollbar",function(e){e.preventDefault();if(d.cfg.type=="y"){d.scrollTo((e.clientY-d.dragPos.y-d.cfg.aW)*d.scrollLength/(d.len-2*d.cfg.aW))}else{d.scrollTo((e.clientX-d.dragPos.x-d.cfg.aW)*d.scrollLength/(d.len-2*d.cfg.aW))}});$(document).bind("mouseup.Scrollbar",function(){d._stopDrag(a)});if(c.setCapture){document.body.unselectable="on";document.body.onselectstart=function(){return false};c.setCapture()}document.body.onselectstart=function(){return false};c.style.userSelect=c.style.MozUserSelect="none"},_stopDrag:function(a){var c=a.data.self;$(document).unbind("mousemove.Scrollbar").unbind("mouseup.Scrollbar");c.CB.onScrollEnd(c.cfg.type=="y"?c.target.scrollTop():c.target.scrollLeft());var b=a.target;if(b.releaseCapture){document.body.unselectable="";document.body.onselectstart=null;b.releaseCapture()}document.body.onselectstart=function(){return true};b.style.userSelect=b.style.MozUserSelect=""},_scroll:function(a){var b=this;if(this.scrolling){this.scrollTimer=setTimeout(function(){b.scrollTo(b._getScrollTop()+a);b._scroll(a)},30)}else{clearTimeout(this.scrollTimer);this.scrollTimer=0}},_stopScroll:function(a){var b=a.data.self;b.scrolling=false;b.CB.onScrollEnd(b.cfg.type=="y"?b.target.scrollTop():b.target.scrollLeft())},clear:function(){this.mod.unbind(),this.bar.unbind(),this.btnUp.unbind(),this.btnDown.unbind();this.bar=this.btnUp=this.btnDown=null;this.mod.remove(),this.mod=null;for(var a in this){if(!a||a=="clear"){continue}this[a]=null;delete this[a]}}};Util.ScrollPanel=function(b,a,c){this.el;this.target=$(b);this.scrollbarX={scrollTo:function(){},reSize:function(){}};this.scrollbarY={scrollTo:function(){},reSize:function(){}};this.cfg={disable:false,arrowSize:14,barWidth:12,showX:true,showY:true,delayRun:true};if(a){$.extend(this.cfg,a)}this.CB={onScroll:function(d,e){},onScrollEnd:function(d,e){}};if(c){$.extend(this.CB,c)}this.scrollLeft=0;this.scrollTop=0;this.init()};Util.ScrollPanel.prototype={init:function(){var a=this;this.el=$('<div class="rtq-scrollpanel">').css({}).mousewheel(function(f,c){if(a.scrollbarY.isShow){f.preventDefault()}if(c>0){a.scrollbarY.scrollTo(a._getScrollTop()-30)}else{a.scrollbarY.scrollTo(a._getScrollTop()+30)}if(a.cfg.showY){a.scrollTop=a.scrollbarY.target.scrollTop();a._onScrollEnd()}});this.target.css({overflow:"hidden"});if(this.cfg.showX){this.scrollbarX=new Util.Scrollbar(this,this.target,{type:"x",aW:this.cfg.arrowSize},{onScroll:function(c){a.scrollLeft=c;a._onScroll()},onScrollEnd:function(c){a.scrollLeft=c;a._onScrollEnd()}});this.scrollLeft=this.scrollbarX.target.scrollLeft()}if(this.cfg.showY){this.scrollbarY=new Util.Scrollbar(this,this.target,{type:"y",aW:this.cfg.arrowSize},{onScroll:function(c){a.scrollTop=c;a._onScroll()},onScrollEnd:function(c){a.scrollTop=c;a._onScrollEnd()}});this.scrollTop=this.scrollbarY.target.scrollTop()}var b=this.target.parent();this.target.appendTo(this.el);this.el.appendTo(b)},_checkNeedShowXY:function(e,a){var f=e||this.target.width();var c=a||this.target.height();if(f<=0&&c<=0){return 0}this.target[0].style.width=(f-this.cfg.arrowSize)>0?f-this.cfg.arrowSize+"px":0+"px";this.target[0].style.height=(c-this.cfg.arrowSize)>0?c-this.cfg.arrowSize+"px":0+"px";var b=this.target[0].scrollWidth;var d=this.target[0].scrollHeight;this.target[0].style.width=f>0?f+this.cfg.arrowSize+"px":f;this.target[0].style.height=c+this.cfg.arrowSize+"px";if(f>=b&&c>=d){return 0}else{if(f<b){if(c-(this.scrollbarX.isShow?0:this.cfg.arrowSize)<d){return 3}else{return 1}}else{if(c-(this.scrollbarY.isShow?0:this.cfg.arrowSize)<d){if(f<b){return 3}else{return 2}}}}},_onScroll:function(){this.CB.onScroll(this.scrollLeft,this.scrollTop)},_onScrollEnd:function(){this.CB.onScrollEnd(this.scrollLeft,this.scrollTop)},_resize:function(c,a){var e=this.el.parent();c=c||e.width();a=a||e.height();var b=this._checkNeedShowXY(c,a);var f=this.cfg.showY&&(b==3||b==2)?this.cfg.barWidth:0;var d=this.cfg.showX&&(b==3||b==1)?this.cfg.barWidth:0;this.el.css({width:c,height:a});this.target.css({width:(c>f)?c-f:0,height:(a>d)?a-d:0});if(!this.cfg.showX){this.target[0].style.width="auto";if(f>=0){this.target[0].style.paddingRight=f+"px"}this.el[0].style.width="auto"}if(!this.cfg.showY){this.target[0].style.height="auto";if(d>=0){this.target[0].style.paddingBottom=d+"px"}this.el[0].style.height="auto"}this.scrollbarX.reSize(this.cfg.showX&&(b==3||b==1));this.scrollbarY.reSize(this.cfg.showY&&(b==3||b==2));if(this.scrollbarY.isShow&&this.scrollbarX.isShow){this.el.addClass("rtq-scrollpanel-both")}else{this.el.removeClass("rtq-scrollpanel-both")}},reSize:function(c,a,d){var b=this;if(this.cfg.delayRun==true){Util.DelayRun("resize",function(){b._resize(c,a);if(d){d()}},10,this)}else{b._resize(c,a);if(d){d()}}},reSizeRealTime:function(b,a){this._resize(b,a)},_getScrollTop:function(){return this.target.scrollTop()},setDelayRun:function(a){this.cfg.delayRun=a},clear:function(){if(this.scrollbarX!=null&&typeof(this.scrollbarX.clear)=="function"){this.scrollbarX.clear()}if(this.scrollbarY!=null&&typeof(this.scrollbarY.clear)=="function"){this.scrollbarY.clear()}this.el.unbind();this.el.remove()}};if(typeof QS_Lang=="undefined"){var QS_Lang={autocomplete:{}}}else{if(!QS_Lang.autocomplete){QS_Lang.autocomplete={}}}var SYMBLETYPE={ST:"Equities",Funds:"Funds",Futures:"",FOREX:"Forex",Bonds:"",XI:"Index",FE:"ETF",FC:"Closed-End Fund",FO:"Mutual Fund",1:"Equities",20:"Forex",2:"Options",3:"Futures",7:"Bonds",8:"Mutual Fund",9:"Government Bonds",10:"Index",13:"Strategies & Spreads",16:"Unspecified Bonds"};var ACBFieldMap={SecId:"SecId",Name:"OS01W",OS05K:"CUSIP",ISIN:"OS05J",Ticker:"OS001",SecurityType:"OS010",ExchangeId:"LS01Z",CountryId:"XI018",CurrencyId:"ST460",PerformanceId:"OS06Y",CategoryId:"CA675",TFSecurityType:"AC003"};var ING_MICMapping={"159":"XLIF","161":"XMON","196":"MFOX","203":"XEUE","209":"XBRD","160":"XPAR","195":"XLIS","202":"XAMS","207":"XBRU","204":"TOMX","208":"MTCH","197":"XHFT","213":"XETR","9":"IXUS","11":"IXUS","29":"IXUS","30":"IXUS","33":"IXUS","190":"XDUB","223":"MTAA","151":"XLON","198":"XMAD","199":"XMAD","2":"XBOS","13":"XCHI","19":"XNAS","23":"BATY","25":"XOTC","26":"XCIS","170":"XSTO","172":"XCSE","174":"XOSL","176":"XHEL","175":"XOSL","181":"XSWX","182":"XSWX","185":"XSWX","194":"XWBO"};function setAutoCompletePath(a){GB_autoCompleteBoxDataManager.dataUrls=a+"acb.jsp"}function setAutoCompleteDataURL(a){GB_autoCompleteBoxDataManager.dataUrls=a}function setAutocompleteCrossDomain(a){GB_autoCompleteBoxDataManager.isCrossDomain=a}function setAutocompleteNonChecker(a){GB_autoCompleteBoxDataManager.noCheckPermission=a}var QS_autoCompleteBoxDataManager=function(b,a){this.dataUrls="acb.jsp";this.path=b;this.idMap={};this.cacheData={};this.cacheKeyLen={};this.lastestQueryTime=0;this._callback={};this._PIDInstIDList=["QUEST","QSTPUB"];this.isCrossDomain=false;this.acbInstitutionId=(typeof InstitutionId!="undefined"&&InstitutionId!="null"&&$.trim(InstitutionId).length>0)?InstitutionId:"";this.noCheckPermission=false};QS_autoCompleteBoxDataManager.prototype={_setCategory:function(a){if(a[ACBFieldMap.TFSecurityType]=="8"&&(typeof a[ACBFieldMap.SecurityType]=="undefined"||$.trim(a[ACBFieldMap.SecurityType])=="")&&a.AC018=="127"){a[ACBFieldMap.SecurityType]="ST"}},setPIDInstID:function(a){this._PIDInstIDList=[a]},acceptPID:function(a){return $.inArray(a||InstitutionId,this._PIDInstIDList)>-1},_dataOnArrived:function(data){var o=null;if(typeof(data)!="string"){o=data}else{o=eval("("+data.replace("\r\n","")+")")}var arrkey="";var id=o.id,result=o.result,item=null;iData={};var self=GB_autoCompleteBoxDataManager;var tempPidMap={},securityType=null;for(var i=0;i<result.length;i++){item=result[i];if(typeof(item)=="undefined"){continue}if(item.OS010.toUpperCase()=="FOREX"){item[ACBFieldMap.Ticker]=item.AC009.replace("FLIT","");item[ACBFieldMap.Name]=item.AC010;item[ACBFieldMap.ExchangeId]=item.AC011}else{item[ACBFieldMap.ExchangeId]=item[ACBFieldMap.ExchangeId].substr(6).replace(/\$/ig,"")}if(item.LS01Z!=""&&!self.noCheckPermission&&typeof(QS_Permission)!="undefined"&&!QS_Permission.checkACBPermission(item[ACBFieldMap.ExchangeId],item[ACBFieldMap.CountryId].toUpperCase())){continue}if(item.OS001==""){item.OS001=item.AC001}if(item.OS01W==""){item.OS01W=item.AC020}if(item.AC018&&item.AC003&&item.AC030){if(item.AC003==10&&item.AC018==200&&item.AC030==213){item.AC018=item.AC030}}if(item.LS01Z==""&&item.AC018&&ING_MICMapping.hasOwnProperty(item.AC018)){item.LS01Z=ING_MICMapping[item.AC018]}var key=item.OS06Y||item.OS00I;if(item.AC018&&item.AC003&&item.AC001){key=item.AC018+"."+item.AC003+"."+item.AC001}if(typeof(item.OS06Y)=="undefined"||item.OS06Y==null||item.OS06Y==""){if(item.AC018&&item.AC003&&item.AC001){item.OS06Y=item.AC018+":"+item.AC003+":"+item.AC001}else{if(item.OS00I){item.OS06Y=item.OS00I}}}if(tempPidMap.hasOwnProperty(key)||key==""){continue}self._setCategory(item);if(item[ACBFieldMap.SecurityType]==""){item[ACBFieldMap.SecurityType]=item[ACBFieldMap.TFSecurityType]}securityType=item[ACBFieldMap.SecurityType].toUpperCase();if(typeof(securityType)=="undefined"||securityType==""){continue}arrkey=SYMBLETYPE[securityType];if(typeof(iData[arrkey])=="undefined"){iData[arrkey]=[]}self.idMap[key]=item;item.key=key;tempPidMap[key]=true;iData[arrkey].push(item)}self.cacheData[self._callback[id].key]=iData;if(parseInt(id)>self.lastestQueryTime&&typeof(self._callback[id].callback)=="function"){self.lastestQueryTime=parseInt(id);self._callback[id].callback(iData);self._callback[id]=null;delete self._callback[id]}},getData:function(b,d,a){var c=d+"&kw="+encodeURIComponent(b);if(!this.cacheData.hasOwnProperty(c)){var e=new Date().getTime()+"";this._callback[e]={callback:a,key:c};if(this.isCrossDomain){$.getScript(this.dataUrls+"?"+d+"&acbinstid="+this.acbInstitutionId+"&kw="+encodeURIComponent(b)+"&id="+e+"&callback=GB_autoCompleteBoxDataManager._dataOnArrived")}else{$.get(this.dataUrls+"?"+d+"&acbinstid="+this.acbInstitutionId+"&kw="+encodeURIComponent(b)+"&id="+e,GB_autoCompleteBoxDataManager._dataOnArrived)}}else{a(this.cacheData[c])}}};var GB_autoCompleteBoxDataManager=new QS_autoCompleteBoxDataManager("GB_autoCompleteBoxDataManager");var QS_autoCompleteBox=function(){this.subscriptions={};this.scrollPanel=null;this.acbDom={dom:null,wrap:null,tip:null,scroll:null};this.isVertical=true;this.mouseoverObj=null;this.mouseOverAble=true;this.init()};QS_autoCompleteBox.prototype={init:function(){if(this.acbDom.dom==null){this.acbDom.dom=$("<div class='qs-autoCompleteBox'><div><div class='qs-autoCompleteBox-scroll'><div class='qs-autoCompleteBox-wrap'><table></table></div></div></div><div class='advance-search-link'><a href='javascript:void(0)'>Advanced Search</a></div><div class='acb-row-tip' style='display:none;position:absolute;'></div></div>");$(document.body).append(this.acbDom.dom);this.acbDom.wrap=this.acbDom.dom.find(".qs-autoCompleteBox-wrap");this.acbDom.scroll=this.acbDom.dom.find(".qs-autoCompleteBox-scroll");this.acbDom.table=this.acbDom.wrap.find("table");this.boxHide()}this._bindEvent()},hideAdvacedSearch:function(){this.acbDom.dom.find(".advance-search-link").remove()},subscription:function(c,a,b){this.subscriptions[c]=new QS_autoCompleteBox_implement(c,a,b,this)},unSubscription:function(a){if(typeof(a)!="undefined"&&a!=null&&typeof(this.subscriptions[a])!="undefined"&&this.subscriptions[a]!=null){this.subscriptions[a].input.unbind("autocompletebox-input");this.subscriptions[a]=null;delete this.subscriptions[a]}},_bindEvent:function(){this._mouseOver();this._mouseClick();this._documentMouseDown();var a=this;this.acbDom.dom.find(".advance-search-link").bind("click.autocompletebox-self",function(){if(typeof(workspaceManager)!="undefined"&&typeof(workspaceManager.openSearchDlg)=="function"){workspaceManager.openSearchDlg();a.boxHide()}})},getPidByTicker:function(b,a){if(typeof(b)!="undefined"&&b!=null&&typeof(this.subscriptions[b])!="undefined"&&this.subscriptions[b]!=null){return this.subscriptions[b].getPidByTicker(a)}},_mouseOver:function(){var a=this;this.acbDom.wrap.bind("mouseover.autocompletebox-self",function(b){clearTimeout(a.mouseoverObj);a.mouseoverObj=setTimeout(function(){if(!a.mouseOverAble){return}var c=$(b.target).closest("tr");a.acbDom.wrap.find("tr").removeClass("mover");if(c.length>0&&c.prop("class").indexOf("qs-autocomplete-column-title")==-1){c.addClass("mover");var d=a.acbDom.dom.attr("inputid");a.subscriptions[d].mouseOver(parseInt(c.attr("columnindex")))}},0)})},_mouseClick:function(){var a=this;this.acbDom.wrap.bind("click.autocompletebox-self",function(b){a._triggerClick()})},_triggerClick:function(){var a=this.acbDom.dom.attr("inputid");this.subscriptions[a]._setInputData()},_documentMouseDown:function(){var a=this;$(document).bind("mousedown.autocompletebox-self",function(b){if(!$.contains(a.acbDom.dom[0],b.target)){a.boxHide()}})},boxHide:function(){this.acbDom.dom.hide();for(var a in this.subscriptions){if(this.subscriptions[a]&&typeof(this.subscriptions[a].cfg.onHeightChange)=="function"){this.subscriptions[a].cfg.onHeightChange({width:null,height:40})}}},triggerACB:function(a){if(typeof(a)!="undefined"&&a!=null&&typeof(this.subscriptions[a])!="undefined"&&this.subscriptions[a]!=null){this.subscriptions[a].triggerACB()}},changeBoxPosition:function(a){this.boxHide();if(typeof(this.subscriptions[a])!="undefined"){this.subscriptions[a].changeBoxPosition()}},setTicker:function(b,a){if(typeof(this.subscriptions[b])!="undefined"){this.subscriptions[b].setTicker(a)}},hideBox:function(){this.boxHide()},listVisible:function(){return this.acbDom.dom.find(":visible").length>0},clearValue:function(a){this.subscriptions[a].data.realValue="";this.subscriptions[a].data.lastValue=""}};var QS_autoCompleteBox_implement=function(d,a,c,b){this.id=d;c=c||{};this.acbObj=b||GB_qsAutoCompleteBox;this.callback=a;this.selectedIndex=0;this.isMobile=/WebKit.+Mobile/i.test(navigator.userAgent);this.showCUSP=typeof(QSPC)!="undefined"&&QSPC&&typeof(QSPC.checkPermission)=="function"?QSPC.checkPermission(29.01):false;this.cfg=$.extend(true,{fixHeight:true,needClear:false,needRemember:true,focusClear:true,blurClear:false,secondClick:false,reCall:false,nickName:{},showAdvancedSearch:true,allowExchange:null,deniedMIC:[],hideExchange:null,urlCfg:{condition:"ST,FE,FC,XI,FO,FOREX,1,2,10"},preciseQuery:true,category:["Equities","Funds","Forex","Bonds","ETF","Closed-End Fund","Mutual Fund","Index","Options"]},c);this.input=null;if(c.category){this.cfg.category=c.category}this.displayFields=[ACBFieldMap.Ticker,ACBFieldMap.Name,ACBFieldMap.ExchangeId];this.config={moverDelay:10,textChangeDelay:300,hlColor:"#93A7C3",hlBlod:true,cMaxLen:14};this.dataMap={};this.textChangeTimeout=null;this.mouseOutTimeout=null;this.boxIsAvailable=false;this.data={};this.searchData={Equities:{data:[],ml:12,dl:0,al:0},Funds:{data:[],ml:5,dl:0,al:0},Forex:{data:[],ml:5,dl:0,al:0},Bonds:{data:[],ml:5,dl:0,al:0},Index:{data:[],ml:5,dl:0,al:0},ETF:{data:[],ml:5,dl:0,al:0},"Closed-End Fund":{data:[],ml:5,dl:0,al:0},"Mutual Fund":{data:[],ml:5,dl:0,al:0},Options:{data:[],ml:5,dl:0,al:0}};this.direction="down";this.isLock=false;this.storeValue=null;this.totalColumnCount=0;this.url=null;this.scrollPanel=null;this.intervalScroll=[];this.scrollMouseOverTime=null;this.init()};QS_autoCompleteBox_implement.prototype={_inputKeyUpDelay:function(a){if(!this.boxIsAvailable&&this.acbObj.acbDom.dom){this.acbObj.acbDom.dom.css({top:this.input.offset().top+this.input.outerHeight()+"px",left:this.input.offset().left})}var b=this.input.val();if(typeof(QS_Validator)!="undefined"&&b!=""&&$.trim(b)!=""&&!QS_Validator.test(b,"ticker")){this.input.val(QS_Validator.sliceInvalidChar(b,"ticker"));return}if(this.input.val()==""){this._boxHide();return}if(a.keyCode==13){this._keyEnter();return}var c=this._getRequestURL(this.cfg.urlCfg);this.data.realValue=this.input.val();this.url=c+"&kw="+this.data.realValue;var d=this;GB_autoCompleteBoxDataManager.getData(this.input.val()+(this.cfg.preciseQuery?"":"*"),c,function(e){if(!d.isLock){d._createUI(e)}});this.textChangeTimeout=null},_inputKeyUp:function(a){var b=this;if(a.keyCode==40||a.keyCode==37||a.keyCode==38||a.keyCode==39||a.keyCode==13){return}this.boxIsAvailable=false;if(this.textChangeTimeout!=null){clearTimeout(this.textChangeTimeout)}this.isLock=false;this.textChangeTimeout=setTimeout(function(){b._inputKeyUpDelay(a)},this.config.textChangeDelay)},_inputKeyDown:function(a){if(a.keyCode==13&&this.input.val()!=""&&this.selectedIndex<1){this.data.realValue=this.input.val();this.triggerACB();return}if(!this.boxIsAvailable&&a.keyCode!=13||this.input==null||this.input.val()==""){return}if(a.keyCode==40){this._WASD(true)}else{if(a.keyCode==38){this._WASD(false)}else{if(a.keyCode==37){this._WASD(false)}else{if(a.keyCode==39){this._WASD(true)}else{if(a.keyCode==13){if(this.isLock&&this.cfg.secondClick){this.triggerACB()}else{this._setInputData()}}}}}}},init:function(){var b=this;var a=$("#"+b.id);if(!this.cfg.showAdvancedSearch){this.acbObj.acbDom.wrap.find(".advance-search-link").hide()}this.input=a;a.bind("keyup.autocompletebox-input",function(c){b._inputKeyUp(c)});a.bind("keydown.autocompletebox-input",function(c){b._inputKeyDown(c)});a.bind("click.autocompletebox-input",function(c){if(b.cfg.focusClear){b.data.lastValue=a.val();a.val("")}});a.bind("blur.autocompletebox-input",function(c){Util.DelayRun("onblur",function(){if(b.cfg.needRemember&&b.data.lastValue!=null&&b.data.lastValue!=""){b.input.val(b.data.lastValue)}},200,b)});if(!this.cfg.fixHeight&&typeof(this.cfg.onHeightChange)=="function"){this.cfg.onHeightChange({width:null,height:40})}this._setResultCount(this.cfg.searchDataCfg)},_setResultCount:function(b){if(b){for(var c in b){for(var a in b[c]){this.searchData[c][a]=b[c][a]}}}},changeBoxPosition:function(){if(this.input!=null){this._adjustPos()}},getPidByTicker:function(f){var g=GB_autoCompleteBoxDataManager.cacheData[this.url],e=null,b=null;if(typeof(g)=="undefined"){return null}for(var c=0;c<this.cfg.category.length;c++){e=g[this.cfg.category[c]];if(typeof(e)!="undefined"&&e!=null){for(var a=0;a<e.length;a++){if(!e[a]||!e[a]["OS001"]){continue}if(e[a]["OS001"]==f){b=e[a]}if(b!=null&&typeof(b.XI018)!="undefined"&&b.XI018=="USA"){break}}}if(b!=null){return{pid:b.OS06Y,ticker:b.OS001,exch:b.LS01Z};break}}return null},hideBox:function(){if(typeof(this.acbObj.acbDom.dom)!="undefined"&&this.acbObj.acbDom.dom!=null){this.acbObj.acbDom.dom.hide()}this._boxHide()},setTicker:function(b){if(!b||!b.ticker){return}this.data.realValue=b.ticker;var a="";if(b.pid!=null&&gIdMap[b.pid]){a=gData[gIdMap[b.pid]].clientTicker||gData[gIdMap[b.pid]].ticker}else{a=b.clientTicker||b.ticker}this.input.val(b.needUpperCase===false?a:a.toUpperCase())},triggerACB:function(){this.data.realValue=this.input.val();if(typeof(this.callback)=="function"){var h=GB_autoCompleteBoxDataManager.cacheData[this.url],e=null,b=null;if(this.stroeValue!=null){this._execCallBack(this.stroeValue.ticker,this.stroeValue.info)}else{if(typeof(h)!="undefined"){for(var c=0;c<this.cfg.category.length;c++){e=h[this.cfg.category[c]];if(typeof(e!=null)&&e!=null){for(var g=0;g<e.length;g++){if(e[g]["OS001"]==this.data.realValue){b=e[g]}if(b!=null&&typeof(b.XI018)!="undefined"&&b.XI018=="USA"){break}}}if(b!=null){break}}}if(b!=null){var a="",f=b.OS06Y;if(b.LS01Z=="FLIT"){a="245:"+b.OS001+b.LS01Z;f=a}else{if(b.AC018&&b.AC003&&b.AC001){a=b.AC018+"."+b.AC003+"."+b.AC001}}if($.trim(f)==""){f=a}this._execCallBack(GB_autoCompleteBoxDataManager.acceptPID()?f:(a||f),$.extend({ticker:b.OS001,exch:b.LS01Z},b))}else{if(this.data.realValue){this._execCallBack(this.data.realValue,{ticker:this.data.realValue,exch:""})}else{this._execCallBack("",{ticker:"",exch:""})}}}}},_getPID:function(a,b){if(!a&&$.trim(a)==""){return b}else{return a}},listVisible:function(){return this.acbObj.acbDom.dom.find(":visible").length>0},mouseOver:function(a){this.selectedIndex=a},_getRequestURL:function(c){var a="";for(var b in c){if(b!=null){a+="&"+b+"="+c[b]}}return a},_pretreatmentData:function(e){this.boxIsAvailable=false;if(this.input==null||typeof(e)=="undefined"||e==null||e.length==0){return}var h=this.input.val();if(h==""){return}if(h.indexOf("$")!=-1){h="\\$"+h.substr(1,h.length)}var q=new RegExp(h,"i");var b=new RegExp("^"+h+"$","i");var g=this.cfg.category,o=null,l=null,d=null,s=false;tex=null,sd=null,arr1=[],arr2=[];for(var m=0;m<g.length;m++){o=g[m],l=e[o];sd=this.searchData[o];sd.data.length=0,sd.dl=0,sd.al=0,arr1=[],arr2=[];if(typeof(l)!="undefined"&&l!=null&&l.length>0){for(var p=0;p<l.length;p++){s=false;var f=l[p]["XI018"],c=l[p]["AC018"],n=l[p]["LS01Z"];var a=l[p]["AC003"]=="7"?true:false;if(f&&this.cfg.allowExchange!=null){if((!this.cfg.allowExchange.hasOwnProperty(f))||(!$.isPlainObject(this.cfg.allowExchange)&&typeof c!="undefined"&&!this.cfg.allowExchange[f].hasOwnProperty(c))){continue}}if(this.cfg.deniedMIC.length>0&&$.inArray(n,this.cfg.deniedMIC)>-1&&!a){continue}if(f==""&&this.cfg.allowExchange!=null){continue}tex=$.extend(true,{},l[p]);tex.origin=tex[this.displayFields[0]];tex.ticker=tex.origin;if(tex.origin==""){continue}if(tex.key){this.dataMap[tex.key]=l[p]}d=(l[p][this.displayFields[0]]||"").match(q);if(d!=null){s=true;tex.ticker=tex[this.displayFields[0]].replace(q,"<b class='highlight'>"+d[0]+"</b>");arr1.push(tex)}else{d=(tex[this.displayFields[1]]||"").match(q);if(d!=null){s=true;tex[this.displayFields[1]]=l[p][this.displayFields[1]].replace(q,"<b class='highlight'>"+d[0]+"</b>");arr2.push(tex)}else{if(this.showCUSP){s=true;var r="459200101";if(tex.OS05K&&h.toUpperCase()==tex.OS05K.toUpperCase()){tex.ticker="<b class='highlight'>"+tex[this.displayFields[0]]+"</b>"}arr2.push(tex)}else{arr2.push(tex);s=true}}}if(s){this.boxIsAvailable=true}}sd.data=arr1.concat(arr2);sd.dl=sd.data.length;sd.al=sd.dl>sd.ml?sd.ml:sd.dl}}},_createUI:function(a){this.selectedIndex=0;this.direction="down";this._pretreatmentData(a);if(!this.boxIsAvailable){this._boxHide();return}this.acbObj.acbDom.table.html(this._buildContentUI(this.searchData));this.acbObj.acbDom.dom.show();if(typeof(this.cfg.onHeightChange)=="function"){this.cfg.onHeightChange({width:this.acbObj.acbDom.table.width(),height:this.acbObj.acbDom.table.height()+40})}this.acbObj.acbDom.dom.attr("inputid",this.id);this._adjustPos()},_buildContentUI:function(b){var c=[],g=null,l=0,d=null,k="";for(var e=0;e<this.cfg.category.length;e++){g=this.cfg.category[e];d=b[g];if(d.al==0){continue}var f="";c.push("<tr columnIndex='-"+c.length+"' class='qs-autocomplete-column-title'><td colspan='3' >"+(this.cfg.nickName[g]||QS_Lang.autocomplete[g.toLowerCase()]||g)+"</td></tr>");for(var h=0;h<b[g].al;h++){k=this._filterFields(d.data[h][this.displayFields[2]],d.data[h]["AC018"]);var a="";f=d.data[h]["SecId"];if(typeof(f)=="undefined"||!f||f==""){f=d.data[h].OS06Y}a="<tr columnIndex='"+c.length+"' key='"+d.data[h].key+"' realValue='"+d.data[h].origin+"' secid='"+f+"' pid='"+d.data[h].OS06Y+"' miccode='"+d.data[h][this.displayFields[2]]+"'><td class='qs-autocomplete-col-ticker'>"+d.data[h].ticker+"</td><td class='qs-autocomplete-col-name'>"+(d.data[h][this.displayFields[1]]||"")+"</td><td class='acb-right'>"+k+"</td></tr>";c.push(a)}}this.totalColumnCount=c.length;return c.join("")},_filterFields:function(b,a){if(typeof(a)!="undefined"&&typeof(gExchangeMap)!="undefined"&&gExchangeMap&&gExchangeMap[a]){b=gExchangeMap[a]}else{if(typeof(gMICExangeMap)!="undefined"&&typeof(gMICExangeMap[b])!="undefined"){b=gMICExangeMap[b]}}return b.replace(/\$/ig,"")},_adjustPos:function(){var e=this.acbObj,f=this.input.offset(),m=e.acbDom.dom.offset(),j=this.input.outerHeight(true);var i=f.top;var g=0;var a=$(window).height(),k=$(window).width();if(a==null){a=0}var c=0;if(e.acbDom.dom.find(".advance-search-link").length>0){c=e.acbDom.dom.find(".advance-search-link").outerHeight(true)}var h=0;if(this.input!=null){if((a-i)<80&&this.cfg.fixHeight){g=i-c;var d=i-(this.acbObj.acbDom.table.height()+c);if(d<0){d=0}e.acbDom.dom.css({top:d+"px",left:f.left});h=this.acbObj.acbDom.table.height()+c}else{e.acbDom.dom.css({top:i+j+"px",left:f.left});h=this.acbObj.acbDom.table.height()+i+j;g=a-(i+j+c+2)}}var b=0;if(h>a&&this.cfg.fixHeight){if(!this.acbObj.scrollPanel){this.acbObj.scrollPanel=new Util.ScrollPanel(this.acbObj.acbDom.scroll)}b=this.acbObj.acbDom.table.width()+12+2;if(b>k&&this.isMobile){b=k}this.acbObj.scrollPanel.reSize(b,g)}else{if(this.acbObj.scrollPanel){b=this.acbObj.acbDom.table.width();if(b>k&&this.isMobile){b=k}var l=this;if($.browser.msie){this.acbObj.scrollPanel.reSize(b,this.acbObj.acbDom.table.height()+2)}else{this.acbObj.scrollPanel.reSize(b,this.acbObj.acbDom.table.height())}}else{b=this.acbObj.acbDom.table.width()}}if(k<(b+m.left)){e.acbDom.dom.css({left:k-b-2})}},_getAvailableIndex:function(a,b){if(a<0||this.acbObj.acbDom.wrap.find("tr[columnindex='"+(-a)+"']").length>0){return this._getAvailableIndex(Math.abs(a)+(b?1:-1),b)}else{if(this.acbObj.acbDom.wrap.find("tr[columnindex='"+a+"']").length>0){return a}else{return b?1:this.acbObj.acbDom.wrap.find("tr").length-1}}},_WASD:function(b){var a=this.acbObj.acbDom.wrap;this.selectedIndex=this._getAvailableIndex(Math.abs(this.selectedIndex)+(b?1:-1),b);if(this.acbObj.scrollPanel){var c=this.selectedIndex/(this.totalColumnCount-1);this.acbObj.mouseOverAble=false;if(this.scrollMouseOverTime){clearTimeout(this.scrollMouseOverTime)}this.acbObj.scrollPanel.scrollbarY.scrollPercentTo(c);var d=this;this.scrollMouseOverTime=setTimeout(function(){d.acbObj.mouseOverAble=true},500)}a.find("tr").removeClass("mover");var e=a.find("tr[columnindex='"+this.selectedIndex+"']");e.addClass("mover")},_setInputData:function(){this.isLock=true;var c=this.acbObj.acbDom.wrap.find("tr[columnindex='"+this.selectedIndex+"']");var f=c.attr("miccode"),g=c.attr("realValue"),b=c.attr("pid"),d=c.attr("secid"),a=c.attr("key");if(typeof(g)!="undefined"){if(f=="FLIT"){if(b==""){b="245:"+g+f;a=b}}var e={ticker:g,exch:f};if(a&&this.dataMap[a]!="undefined"&&this.dataMap[a]!=null){e=$.extend(true,e,this.dataMap[a])}if(!this.cfg.secondClick){this._execCallBack(!GB_autoCompleteBoxDataManager.acceptPID()?a:this._getPID(d,b),e)}else{if(this.storeValue==null){this.stroeValue={ticker:!GB_autoCompleteBoxDataManager.acceptPID()?a:this._getPID(d,b),info:e};this.input.val(g)}else{this._execCallBack(this.stroeValue.ticker,this.stroeValue.info)}}}this._boxHide()},_execCallBack:function(b,a){this.isLock=true;if(typeof(this.callback)=="function"){if(!this.cfg.needClear&&typeof(a)!="undefined"){this.input.val(a.ticker)}else{this.input.val("")}this.callback(b,a);this.data.realValue="";this.data.lastValue=a.ticker;this.stroeValue=null}this._boxHide();this.selectedIndex=0},_boxHide:function(){if(typeof(this.acbObj.acbDom.dom)!="undefined"&&this.acbObj.acbDom.dom!=null){this.acbObj.acbDom.dom.hide()}this.selectedIndex=0;if(typeof(this.cfg.onHeightChange)=="function"){this.cfg.onHeightChange({width:null,height:40})}},clear:function(){this._unbindEvent();for(var a in this){if(!a||a=="clear"){continue}this[a]=null;delete this[a]}}};var GB_qsAutoCompleteBox=new QS_autoCompleteBox();if(typeof(mstar)=="undefined"){var mstar={}}if(typeof(QS_Theme)=="undefined"){QS_Theme="default"}if(typeof(QS_ImgServer)=="undefined"){QS_ImgServer="//rtqimg.morningstar.com/"}mstar.draw=function(a,d,c){this.target=c;this.width=c.width();this.height=c.height();this.workspaceId=a;this.windowId=d;this.series=null;this.drawing={type:{trendline:false,rectangle:false,ellipse:false,note:false,levelline:false,fibonacci:false},abbDom:null,start:"",operationType:"",trendline:{func:{movingDraw:true,dbClickDeleteLine:true,moveLine:false,clickRedraw:true,dragReDraw:true},abbDom:$("<div class='rtc-dr rtc-dr-trendline'></div>"),style:{weight:1,color:"#65A125",lineWrapColor:"#fff",lineWrapWidth:1},depot:[],move:{moving:false,cp:[],sp:[],ep:[],ix:0},currentIndex:0,count:0,end:true},rectangle:{func:{movingDraw:true,clickRedraw:true,dragReDraw:true},style:{border:{width:1,color:"#65A125"},fill:{show:false,opacity:0.3,color:"#fffef9"}},abbDom:$("<div class='rtc-dr rtc-dr-rectangle'></div>"),count:0,depot:[],move:{moving:false,cp:[],sp:[],ep:[],ix:0}},ellipse:{func:{movingDraw:true,clickRedraw:true,dragReDraw:true},style:{border:{width:1,color:"#65A125"},fill:{show:true,opacity:0.3,color:"#fffef9"}},abbDom:$("<div class='rtc-dr rtc-dr-ellipse'></div>"),count:0,depot:[],move:{moving:false,cp:[],sp:[],ep:[],ix:0}},levelline:{func:{dbClickDeleteLine:true,movingDraw:true,dragReDraw:true},style:{lineWidth:2,lineColor:"#65A125",lineWrapWidth:8,lineWrapColor:"#fff"},abbDom:$("<div class='rtc-dr rtc-dr-ellipse'></div>"),count:0,depot:[],move:{moving:false,cp:[],sp:[],ep:[],ix:0}},note:{func:{moving:true},depot:[],currentIndex:0,count:0,abbDom:$("<span class='qs-flot-abb-ellipse-hint'>NOTE</span>")},fibonacci:{func:{movingDraw:true,moveLine:false,clickRedraw:true},abbDom:$("<div class='rtc-dr rtc-dr-fibonacci'></div>"),style:{"100":{weight:2,color:"#ED0D0D"},"61.8":{weight:1,color:"#DB5858"},"50":{weight:1,color:"#DB5858"},"38.2":{weight:1,color:"#DB5858"},"0":{weight:2,color:"#ED0D0D"},sepoint:{weight:1,color:"#ED0D0D"},weight:1,color:"#627BA4"},depot:[],end:true,count:0,move:{moving:false,cp:[],sp:[],ep:[],ix:0}},count:0,startend:""}};mstar.draw.prototype={getStart:function(){return this.drawing.start},setDrawType:function(a,c){this.drawing.type[a]=c},getDrawTypes:function(){return this.drawing.type},drawGraph:function(e,a,d,f,g,c){this._drawingTrendLine(e,a,d);this._drawRectangle(e,a);this._drawEllipse(e,a);this._drawingLevelline(e,a,d,f,g,c);this._drawingFibonacci(e,a,d,f,g,c)},saveNotes:function(a){},renderNote:function(m,s,u){var d=null,p={},r=0,n=null,f=null;for(var g=0;g<m.data.length-1;g++){d=m.data[g],tn=m.data[g+1];if(d[d.length-1]>100000){time1=d[d.length-1];time2=tn[tn.length-1]}else{time1=RTQ_ChartUtil.toDateFromIndex(d[d.length-1]).getTime();time2=RTQ_ChartUtil.toDateFromIndex(tn[tn.length-1]).getTime()}for(r=0;r<s.list.length;r++){f=s.list[r].eventTime;if(f>=time1&&f<time2){if(typeof(p[g])=="undefined"){p[g]=[]}p[g].push(s.list[r])}else{if(f>time2){break}}}}for(var g in p){var e=0;for(var r=0;r<p[g].length;r++){var v=g,w=parseFloat(p[g][r].eventInfo.y);var h=p[g][r];var q=this.drawing,a=q.note;var o=m;if(typeof(m.otherInfo)=="undefined"){o=m[0]}var l=new mstar.note(u,o,new mstar.noteDataManager($.extend(true,{secId:o.otherInfo.ticker},h)));l.setPosition(o.xaxis.p2c(v),e*12);l.currentIndex=a.depot.length;l.dom.attr("idx",a.depot.length);h.eventInfo=p[g][r].eventInfo==""?{text:"",status:"",h:"",w:""}:$.evalJSON(p[g][r].eventInfo);h.eventInfo.status="close";l.restoreNote(h.eventInfo);l.nx=g;var c={note:l,dataIndex:1,x:v,y:w};a.depot.push(c);a.count++;e++}}},_drawingFibonacci:function(o,n,p){if(this.drawing.fibonacci.depot.length==0||this.drawing.fibonacci.count<=0){return}o.save();o.beginPath();var m=this.drawing.fibonacci,f;var d=0,e=0,g=0,h=0,c=0,a=0;for(var l=0;l<m.depot.length;l++){f=m.depot[l];if(f==undefined){continue}d=n.xaxis.p2c(f.start.x),e=n.yaxis.p2c(f.start.y);g=n.xaxis.p2c(f.end.x);h=n.yaxis.p2c(f.end.y);c=h-e;a=f.end.y-f.start.y;var j=maxx=0;if(f.end.x!=undefined&&f.end.y!=undefined){o.beginPath();o.fillStyle=m.style.sepoint.color;o.lineWidth=m.style.sepoint.weight;o.arc(d,e,3,0,2*Math.PI,true);o.arc(g,h,3,0,2*Math.PI,true);o.fill();o.beginPath();o.strokeStyle=m.style.color;o.lineWidth=m.style.weight;o.moveTo(d,e);o.lineTo(g,h);o.stroke();o.beginPath();o.strokeStyle=m.style["0"].color;o.lineWidth=m.style["0"].weight;o.moveTo(d,h);o.lineTo(g,h);o.stroke();o.beginPath();o.strokeStyle=m.style["100"].color;o.lineWidth=m.style["100"].weight;o.moveTo(d,e);o.lineTo(g,e);o.stroke();o.beginPath();o.strokeStyle=m.style["61.8"].color;o.lineWidth=m.style["61.8"].weight;o.moveTo(d,h-c*0.618);o.lineTo(g,h-c*0.618);o.stroke();o.beginPath();o.strokeStyle=m.style["50"].color;o.lineWidth=m.style["50"].weight;o.moveTo(d,h-c*0.5);o.lineTo(g,h-c*0.5);o.stroke();o.beginPath();o.strokeStyle=m.style["38.2"].color;o.lineWidth=m.style["38.2"].weight;o.moveTo(d,h-c*0.382);o.lineTo(g,h-c*0.382);if(f.opDom!=null){j=Math.min(g,d)+p.left,maxx=Math.max(g,d)+p.left;f.opDom[0].css({left:maxx-37,top:h+3});f.opDom[9].css({left:j,top:h+3});f.opDom[0].html(QS_NumFmt.Fmt2(f.end.y,true," ",2));if(typeof(f.opDom[10])!="undefined"&&f.opDom[10]!=null){f.opDom[10].css({left:maxx+1,top:Math.min(e,h)-3})}f.opDom[1].css({left:maxx-37,top:e+3});f.opDom[5].css({left:j,top:e+3});f.opDom[1].html(QS_NumFmt.Fmt2(f.start.y,true," ",2));f.opDom[2].css({left:maxx-37,top:h-c*0.618+3});f.opDom[6].css({left:j,top:h-c*0.618+3});f.opDom[2].html(QS_NumFmt.Fmt2(f.start.y+a*0.382,true," ",2));f.opDom[3].css({left:maxx-37,top:h-c*0.5+3});f.opDom[7].css({left:j,top:h-c*0.5+3});f.opDom[3].html(QS_NumFmt.Fmt2(f.start.y+a*0.5,true," ",2));f.opDom[4].css({left:maxx-37,top:h-c*0.382+3});f.opDom[8].css({left:j,top:h-c*0.382+3});f.opDom[4].html(QS_NumFmt.Fmt2(f.start.y+a*0.618,true," ",2))}}}o.stroke();o.restore()},_drawingTrendLine:function(a,g,c){if(this.drawing.trendline.depot.length==0||this.drawing.trendline.count<=0){return}a.save();a.beginPath();var j=this.drawing.trendline,d;a.strokeStyle=j.style.color;a.lineWidth=j.style.weight;for(var f=0;f<j.depot.length;f++){d=j.depot[f];if(d==undefined){continue}if(d.end.x!=undefined&&d.end.y!=undefined){a.moveTo(g.xaxis.p2c(d.start.x),g.yaxis.p2c(d.start.y));a.lineTo(g.xaxis.p2c(d.end.x),g.yaxis.p2c(d.end.y));if(d.opDom!=null){var h=g.xaxis.p2c(d.end.x)+c.left+18,e=g.yaxis.p2c(d.end.y)-c.top-13;d.opDom.show().css({left:h>(this.width-80)?(this.width-80):h,top:e});if(h<0||e<-20||e>this.height||h>this.width){d.opDom.hide()}}}}a.stroke();a.beginPath();if(this.drawing.operationType=="drag-trendline"){a.strokeStyle=mstar.flotUtil.colorToRGB(j.style.lineWrapColor,0.4);a.lineWidth=j.style.lineWrapWidth;a.lineCap="round";for(var f=0;f<j.depot.length;f++){d=j.depot[f];if(d==undefined){continue}if(f==j.currentIndex&&d.end.x!=undefined&&d.end.y!=undefined){a.moveTo(g.xaxis.p2c(d.start.x),g.yaxis.p2c(d.start.y)+2);a.lineTo(g.xaxis.p2c(d.end.x),g.yaxis.p2c(d.end.y)+2);a.moveTo(g.xaxis.p2c(d.start.x),g.yaxis.p2c(d.start.y)-2);a.lineTo(g.xaxis.p2c(d.end.x),g.yaxis.p2c(d.end.y)-2);a.stroke();a.fillStyle=mstar.flotUtil.colorToRGB(j.style.lineWrapColor,0.4);a.arc(g.xaxis.p2c(d.end.x),g.yaxis.p2c(d.end.y)-1,2,-Math.PI,Math.PI,false);a.arc(g.xaxis.p2c(d.start.x),g.yaxis.p2c(d.start.y),2,-Math.PI,Math.PI,false);a.fill();break}}a.stroke()}a.restore()},_getEllipsePoints:function(f,j){var e=[],i=[];var c=this._calculateRectangle(f,j);var d=c.w/2,l=c.h/2;for(var g=l;g>=0;g-=0.5){i.push(g);var h=d*d-d*d*g*g/(l*l);if(h<0){h=0}e.push(Math.sqrt(h))}var a=[c.x+d,c.y+l];return[e,i,a]},_drawEllipse:function(m,o){var l=this.drawing.ellipse,d;if(l.depot.length==0){return}m.save();m.beginPath();m.strokeStyle=l.style.border.color;m.lineWidth=1;var n=[],f=[],j=[],c=[],a=[];for(var g=0;g<l.depot.length;g++){n=[],f=[];d=l.depot[g];if(d==undefined){continue}if(d.end.x!=undefined&&d.end.y!=undefined){var p=this._getEllipsePoints(d,o);n=p[0],f=p[1],a=p[2];if(isNaN(n[0])){continue}m.moveTo(a[0]+n[0],a[1]-f[0]);for(var h=0;h<n.length;h++){m.lineTo(a[0]+n[h],a[1]-f[h])}for(var h=n.length-1;h>=0;h--){m.lineTo(a[0]+n[h],a[1]+f[h])}for(var h=0;h<n.length;h++){m.lineTo(a[0]-n[h],a[1]+f[h])}for(var h=n.length-1;h>=0;h--){m.lineTo(a[0]-n[h],a[1]-f[h])}}}m.stroke();var e=l.depot[l.currentIndex];if(l.resizeHandler){if(e&&e.start.x&&e.start.y){m.beginPath();m.arc(o.xaxis.p2c(e.start.x)+1,o.yaxis.p2c(e.start.y)-1,2,-Math.PI,Math.PI,false);m.stroke()}if(e&&e.end.x&&e.end.y){m.beginPath();m.arc(o.xaxis.p2c(e.end.x)+1,o.yaxis.p2c(e.end.y)-1,2,-Math.PI,Math.PI,false);m.stroke()}}if(this.drawing.operationType=="drag-ellipse"&&l.style.fill.show){m.fillStyle=mstar.flotUtil.colorToRGB(l.style.fill.color,0.3);if(e.end.x!=undefined&&e.end.y!=undefined){var p=this._getEllipsePoints(e,o);n=p[0],f=p[1],a=p[2];if(!isNaN(n[0])){m.moveTo(a[0]+n[0],a[1]-f[0]);for(var h=0;h<n.length;h++){m.lineTo(a[0]+n[h],a[1]-f[h])}for(var h=n.length-1;h>=0;h--){m.lineTo(a[0]+n[h],a[1]+f[h])}for(var h=0;h<n.length;h++){m.lineTo(a[0]-n[h],a[1]+f[h])}for(var h=n.length-1;h>=0;h--){m.lineTo(a[0]-n[h],a[1]-f[h])}}}m.fill()}m.restore()},_drawRectangle:function(f,a){var h=this.drawing,c=h.rectangle,g=null,e=null;f.save();f.beginPath();f.lineWidth=c.style.border.width;f.strokeStyle=c.style.border.color;for(var d=0;d<c.depot.length;d++){g=c.depot[d];if(g!=undefined&&g.start!=undefined&&g.end!=undefined&&g.end.x!=undefined&&g.end.y!=undefined&&g.start.x!=undefined&&g.start.y!=undefined){e=this._calculateRectangle(g,a);f.rect(e.x,e.y,e.w,e.h)}}f.stroke();f.beginPath();if(h.operationType=="drag-rectangle"){g=c.depot[c.currentIndex];if(g!=undefined&&g.start!=undefined&&g.end!=undefined&&g.end.x!=undefined&&g.end.y!=undefined&&g.start.x!=undefined&&g.start.y!=undefined){e=this._calculateRectangle(g,a);f.fillStyle=mstar.flotUtil.colorToRGB(c.style.fill.color,0.3);f.rect(e.x,e.y,e.w,e.h);f.fill()}}f.restore()},_drawingLevelline:function(l,h,c,j,f,e){if(this.drawing.levelline.depot.length==0||this.drawing.levelline.count<=0){return}l.save();var a=this.drawing.levelline,d;l.beginPath();l.strokeStyle=mstar.flotUtil.colorToRGB(a.style.lineWrapColor,0.5);l.lineWidth=a.style.lineWrapWidth;l.lineCap="round";var n=a.style.lineWrapWidth/2,m=j-a.style.lineWrapWidth/2;for(var g=0;g<a.depot.length;g++){d=a.depot[g];if(d==undefined||d.start.y<h.yaxis.min||d.start.y>h.yaxis.max){continue}if(g==a.currentIndex){if(d.start.x!=undefined&&d.start.y!=undefined){l.moveTo(n,h.yaxis.p2c(d.start.y));l.lineTo(m,h.yaxis.p2c(d.start.y))}}}l.stroke();l.beginPath();l.strokeStyle=a.style.lineColor;l.lineWidth=a.style.lineWidth;n=0,m=j;if(f=="left"){}for(var g=0;g<a.depot.length;g++){d=a.depot[g];if(d==undefined||d.start.y<h.yaxis.min||d.start.y>h.yaxis.max){continue}var o=true;if(d.start.x!=undefined&&d.start.y!=undefined){if(g!=a.currentIndex){l.moveTo(n,h.yaxis.p2c(d.start.y));l.lineTo(m,h.yaxis.p2c(d.start.y));if(h.yaxis.p2c(d.start.y)<0||h.yaxis.p2c(d.start.y)>e){o=false;d.opDom.hide()}}else{l.moveTo(n+a.style.lineWrapWidth/2,h.yaxis.p2c(d.start.y));l.lineTo(m-a.style.lineWrapWidth/2,h.yaxis.p2c(d.start.y))}if(d.opDom!=null&&o){d.opDom.show();d.opDom.find("span.chart-flot-txt").html(QS_NumFmt.Fmt2(d.start.y,true," ",2));d.opDom.css({left:f=="right"?j:0,top:h.yaxis.p2c(d.start.y)-c.top-5})}}}l.stroke();l.restore()},_storeCurrent:function(d,f,c,a){var e={start:{x:d.datapoint[0],y:d.series.yaxis.c2p(f),dIdx:d.datapoint[d.datapoint.length-1]},end:{},opDom:c};a.depot.push(e);a.currentIndex=a.depot.length-1;a.count++},_storeBeforeMoving:function(a,d,c,e,f){d.oldStart=$.extend(true,{},d.start);d.oldEnd=$.extend(true,{},d.end);a.move.moving=true;f.css("cursor","move");a.move.cp=[c.datapoint[0],c.series.yaxis.c2p(e),c.datapoint[c.datapoint.length-1]];a.move.sp=[d.start.x,d.start.y,d.start.dIdx];a.move.ep=[d.end.x,d.end.y,d.end.dIdx]},_storeBeforeDraging:function(a){a.oldStart=$.extend(true,{},a.start);a.oldEnd=$.extend(true,{},a.end)},_createTrendLineLegend:function(e,d){var c=this;var a=$("<div class='changeHintDiv rtq-chart-hover-hint'><div class='wrap-img'><img class='arrow' src='"+QS_ImgServer+(QS_Theme=="black"?"theme/black/arrow.gif":"img/arrow.gif")+"' border='0'/><span class='wrap-text-close'><span class='rtq-trendline-hinttext'></span> <a href='javascript:void(0)'><img src='"+QS_ImgServer+(QS_Theme=="black"?"theme/black/btn_close.gif":"img/btn_close.gif")+"' border='0'/></a> </span></div></div>");a.appendTo(d).hide().find("a").bind("click.tline",function(){setTimeout(function(){c._clearTrendLine(c,e)},50)});return a},_creatLevelLineLegend:function(e,c){var a=this;var d=$("<div class='chart-flot-drawing j-chart-flot-drawing-levelline'><span class='chart-flot-txt'></span><span class='chart-flot-colose-span'>X</span></div>");d.appendTo(c).hover(function(){$(this).find(".chart-flot-colose-span").toggle()}).bind("click.levelline",function(){a._clearLevelline(a,e)});return d},_createFibaccLegend:function(c,f){var e="chart-fibonacci-index-"+c;var d="<div class='rtq-chart-fibonacci-tip "+e+"' index='l1'>"+QS_NumFmt.Fmt2(100,true," ",1)+QSLGTXT.percent+"</div><div class='rtq-chart-fibonacci-tip "+e+"' index='l2'>"+QS_NumFmt.Fmt2(61.8,true," ",1)+QSLGTXT.percent+"</div><div class='rtq-chart-fibonacci-tip "+e+"' index='l3'>"+QS_NumFmt.Fmt2(50,true," ",1)+QSLGTXT.percent+"</div><div class='rtq-chart-fibonacci-tip "+e+"' index='l4'>"+QS_NumFmt.Fmt2(38.2,true," ",1)+QSLGTXT.percent+"</div><div class='rtq-chart-fibonacci-tip "+e+"' index='l5'>"+QS_NumFmt.Fmt2(0,true," ",1)+QSLGTXT.percent+"</div><div class='rtq-chart-fibonacci-tip "+e+"' index='r1'>1</div><div class='rtq-chart-fibonacci-tip "+e+"' index='r2'>2</div><div class='rtq-chart-fibonacci-tip "+e+"' index='r3'>3</div><div class='rtq-chart-fibonacci-tip "+e+"' index='r4'>4</div><div class='rtq-chart-fibonacci-tip "+e+"' index='r5'>5</div>";var a=$(d);a.appendTo(f);return[f.find("."+e+"[index='r1']"),f.find("."+e+"[index='r2']"),f.find("."+e+"[index='r3']"),f.find("."+e+"[index='r4']"),f.find("."+e+"[index='r5']"),f.find("."+e+"[index='l1']"),f.find("."+e+"[index='l2']"),f.find("."+e+"[index='l3']"),f.find("."+e+"[index='l4']"),f.find("."+e+"[index='l5']")]},mouseDown:function(C,x,P,K,I,A,M){this.series=M;var f=x[0],g=x[1];var U=this;var q=this.drawing,v=q.trendline,c=q.rectangle,J=q.ellipse;ll=q.levelline,nt=q.note,fi=q.fibonacci;if(P==null){return}if(q.type.trendline){var h=this._createTrendLineLegend(v.depot.length,I);if(v.movingDraw){h.show(100)}q.start="trendline";this._storeCurrent(P,x[1],h,v)}else{if(q.type.rectangle){q.start="rectangle";this._storeCurrent(P,x[1],null,c)}else{if(q.type.ellipse){q.start="ellipse";this._storeCurrent(P,x[1],null,J)}else{if(q.type.levelline){tdom=this._creatLevelLineLegend(ll.depot.length,I);q.start="levelline";this._storeCurrent(P,x[1],tdom,ll)}else{if(q.type.note){var T=P.datapoint[P.datapoint.length-1];var G=M;if(typeof(M.otherInfo)=="undefined"){G=M[0]}var V=T<100000?RTQ_ChartUtil.toDateFromIndex(T).getTime():T;var m=new mstar.noteDataManager({secId:G.otherInfo.ticker,eventTime:V});var B=new mstar.note(I,G,m);B.setPosition(P.series.xaxis.p2c(P.datapoint[0])+A.left,P.series.yaxis.p2c(P.series.yaxis.c2p(x[1])));B.currentIndex=nt.depot.length;B.dom.attr("idx",nt.depot.length);var w={note:B,x:P.datapoint[0],y:P.series.yaxis.c2p(x[1])};nt.depot.push(w);nt.currentIndex=nt.depot.length-1;q.start="note";nt.count++;B.addNote()}else{if(q.type.fibonacci){var w={start:{x:P.datapoint[0],y:P.series.yaxis.c2p(x[1]),dIdx:P.datapoint[P.datapoint.length-1]},end:{},opDom:null};w.opDom=U._createFibaccLegend(fi.depot.length,I);fi.depot.push(w);fi.currentIndex=fi.depot.length-1;q.start="fibonacci";fi.count++}else{var a=false;if((v.func.clickRedraw||v.func.dragReDraw)&&v.count>0){var p=null;var F=false;for(var S=0;S<v.depot.length;S++){p=v.depot[S];if(p==undefined||p==null){continue}F=false;if(Math.abs(P.series.xaxis.p2c(p.end.x)-x[0])<4&&Math.abs(P.series.yaxis.p2c(p.end.y)-x[1])<4){F=true}if(Math.abs(P.series.xaxis.p2c(p.start.x)-x[0])<4&&Math.abs(P.series.yaxis.p2c(p.start.y)-x[1])<4){v.end=false;F=true}if(F){if(p.start.x==p.end.x&&p.start.y==p.end.y){v.end=true}q.start="trendline";I.css("cursor","nw-resize");v.currentIndex=S;this._storeBeforeDraging(v.depot[v.currentIndex]);a=true;break}else{if(v.func.dragReDraw){var N=this._mouseOverLine(x,{spos:[P.series.xaxis.p2c(p.start.x),P.series.yaxis.p2c(p.start.y)],epos:[P.series.xaxis.p2c(p.end.x),P.series.yaxis.p2c(p.end.y)]});if(N){this._storeBeforeMoving(v,p,P,x[1],I);q.start="trendline";v.currentIndex=S;a=true;break}}}}if(a){q.operationType="drag-trendline"}}if((c.func.clickRedraw||c.func.dragReDraw)&&c.count>0&&!a){var L=null,H=false;var n=[],Q={spos:[],epos:[]};for(var S=0;S<c.depot.length;S++){L=c.depot[S];if(L==undefined){continue}L.haveDrag=false;L.oldStart=$.extend(true,{},L.start);L.oldEnd=$.extend(true,{},L.end);Q.spos=[K.xaxis.p2c(L.start.x),K.yaxis.p2c(L.start.y)];Q.epos=[K.xaxis.p2c(L.end.x),K.yaxis.p2c(L.end.y)];if(Q!=undefined){if(f>(Q.spos[0]-2)&&f<(Q.epos[0]+2)&&g>(Q.spos[1]-2)&&g<(Q.epos[1]+2)){if(c.func.clickRedraw){H=true;if(Math.abs(Q.spos[0]-f)<3&&Math.abs(Q.spos[1]-g)<3){I.css("cursor","nw-resize");L.start.x=L.end.x;L.start.y=L.end.y}else{if(Math.abs(Q.epos[0]-f)<3&&Math.abs(Q.epos[1]-g)<3){I.css("cursor","nw-resize")}else{if(Math.abs(Q.epos[0]-f)<3&&Math.abs(Q.spos[1]-g)<3){I.css("cursor","ne-resize");L.start.x=L.start.x;L.start.y=L.end.y}else{if(Math.abs(Q.spos[0]-f)<3&&Math.abs(Q.epos[1]-g)<3){I.css("cursor","ne-resize");L.start.x=L.end.x;L.start.y=L.start.y}else{H=false}}}}}if(H){this._storeBeforeDraging(L)}if(c.func.dragReDraw&&!H){if(c.func.dragReDraw){H=true;this._storeBeforeMoving(c,L,P,x[1],I)}else{H=false}}}if(H){c.currentIndex=S;q.start="rectangle";a=true;q.operationType="drag-rectangle";break}}}}if((J.func.clickRedraw||J.func.dragReDraw)&&J.count>0&&!a){var O=null,H=false;var n=[],Q={spos:[],epos:[]};for(var S=0;S<J.depot.length;S++){O=J.depot[S];if(O==undefined){continue}Q.spos=[K.xaxis.p2c(O.start.x),K.yaxis.p2c(O.start.y)];Q.epos=[K.xaxis.p2c(O.end.x),K.yaxis.p2c(O.end.y)];if(Q!=undefined){if(f>(Q.spos[0]-2)&&f<(Q.epos[0]+2)&&g>(Q.spos[1]-2)&&g<(Q.epos[1]+2)){if(J.func.clickRedraw){H=true;if(Math.abs(Q.spos[0]-f)<3&&Math.abs(Q.spos[1]-g)<3){I.css("cursor","nw-resize");var Q=$.extend(true,{},O.start);O.start.x=O.end.x;O.start.y=O.end.y;O.end.x=Q.x;O.end.y=Q.y}else{if(Math.abs(Q.epos[0]-f)<3&&Math.abs(Q.epos[1]-g)<3){I.css("cursor","nw-resize")}else{H=false}}}if(H){this._storeBeforeDraging(O)}if(J.func.dragReDraw&&!H){H=true;this._storeBeforeMoving(J,O,P,x[1],I)}if(H){J.currentIndex=S;J.resizeHandler=true;q.operationType="drag-ellipse";q.start="ellipse";a=true;break}}}}if(!a){J.resizeHandler=false}}if((fi.func.clickRedraw||fi.func.movingDraw)&&fi.count>0&&!a){var p=null;var F=false;for(var S=0;S<fi.depot.length;S++){p=fi.depot[S];fi.end=true;if(p==undefined||p==null){continue}F=false;if(Math.abs(P.series.xaxis.p2c(p.end.x)-x[0])<4&&Math.abs(P.series.yaxis.p2c(p.end.y)-x[1])<4){F=true}if(Math.abs(P.series.xaxis.p2c(p.start.x)-x[0])<4&&Math.abs(P.series.yaxis.p2c(p.start.y)-x[1])<4){F=true;fi.end=false}if(F){if(p.start.x==p.end.x&&p.start.y==p.end.y){v.end=true}I.css("cursor","se-resize");q.start="fibonacci";q.operationType="drag-fibonacci";fi.currentIndex=S;this._storeBeforeDraging(p);a=true;break}else{if(fi.func.movingDraw){var s=P.series.xaxis.p2c(p.start.x),u=P.series.yaxis.p2c(p.start.y);var d=P.series.xaxis.p2c(p.end.x);y2=P.series.yaxis.p2c(p.end.y);var j=y2-u;var E={spos:[s,u],epos:[d,y2]},o={spos:[s,y2],epos:[d,y2]},l={spos:[s,u],epos:[d,u]},R={spos:[s,y2-j*0.618],epos:[d,y2-j*0.618]},D={spos:[s,y2-j*0.5],epos:[d,y2-j*0.5]},y={spos:[s,y2-j*0.382],epos:[d,y2-j*0.382]};if(this._mouseOverLine(x,E)||this._mouseOverLine(x,o)||this._mouseOverLine(x,l)||this._mouseOverLine(x,R)||this._mouseOverLine(x,D)||this._mouseOverLine(x,y)){I.css("cursor","move");q.start="fibonacci";fi.currentIndex=S;fi.depot[S].oldStart=$.extend(true,{},fi.depot[S].start);fi.depot[S].oldEnd=$.extend(true,{},fi.depot[S].end);fi.move.moving=true;fi.move.cp=[P.datapoint[0],P.series.yaxis.c2p(x[1]),P.datapoint[P.datapoint.length-1]];fi.move.sp=[p.start.x,p.start.y,p.start.dIdx];fi.move.ep=[p.end.x,p.end.y,p.end.dIdx];a=true;break}}}}}if(ll.func.dragReDraw&&ll.count>0&&!a){var z=null,H=false;var n=[],Q={spos:[],epos:[]};for(var S=0;S<ll.depot.length;S++){z=ll.depot[S];if(z==undefined){continue}var W=K.yaxis.p2c(z.start.y);if(Math.abs(g-W)<2){q.start="levelline";ll.currentIndex=S;a=true;z.oldStart=$.extend(true,{},z.start);z.oldEnd=$.extend(true,{},z.end);ll.move.moving=true;I.css("cursor","move");break}}}if(nt.func.moving&&nt.count>0&&!a){var O=null,H=false;var n=[],Q={spos:[],epos:[]}}if(a){C.preventDefault();C.stopPropagation()}}}}}}}if(q.abbDom!=null){q.abbDom.remove()}},_levellineRelateMovingDraw:function(a,f,g,d,e){if(a.func.movingDraw){var c=a.depot[a.currentIndex];if(f>-e.left&&d!=null){c.start={x:d.datapoint[0],y:d.series.yaxis.c2p(g)}}}},_setTrendlineText:function(f){var c=this.convertToPrice(f,true);var d=(c.end.y-c.start.y)/Math.abs(c.start.y)*100;var a=QS_NumFmt.Fmt2(d,true," ",2);var e=d>=0?("+"+a+QSLGTXT.percent):(a+QSLGTXT.percent);c.opDom.find(".rtq-trendline-hinttext").html(e)},mouseMove:function(n,g,h,d,l){var c=this.drawing;var a=c.trendline,e=c.rectangle,m=c.note,j=c.ellipse,i=c.fibonacci;if(c.start!=""){if(c.start=="trendline"){if(a.move.moving){this._rectangleRelateMovingDraw(a,g,h,n,d)}else{if(a.func.movingDraw&&n!=null){var f=a.depot[a.currentIndex];if(a.end){f.end={x:n.datapoint[0],y:n.series.yaxis.c2p(h),dIdx:n.datapoint[n.datapoint.length-1]}}else{f.start={x:n.datapoint[0],y:n.series.yaxis.c2p(h),dIdx:n.datapoint[n.datapoint.length-1]}}if(f.opDom.find(".changeHintDiv:visible").length==0){f.opDom.show(100);this._setTrendlineText(f)}}}}else{if(c.start=="rectangle"){this._rectangleRelateMovingDraw(e,g,h,n,d)}else{if(c.start=="ellipse"){this._rectangleRelateMovingDraw(j,g,h,n,d)}else{if(c.start=="levelline"){this._levellineRelateMovingDraw(ll,g,h,n,d)}else{if(c.start=="fibonacci"){this._fibonacciRelateMovingDraw(i,g,h,n,d)}}}}}}if(c.start==""){if(c.abbDom!=undefined&&c.abbDom!=null){c.abbDom.remove()}if(c.type.trendline){c.abbDom=a.abbDom;l.append(c.abbDom)}else{if(c.type.rectangle){c.abbDom=e.abbDom;l.append(c.abbDom)}else{if(c.type.note){c.abbDom=m.abbDom;l.append(c.abbDom)}else{if(c.type.ellipse){c.abbDom=j.abbDom;l.append(c.abbDom)}else{if(c.type.fibonacci){c.abbDom=i.abbDom;l.append(c.abbDom)}}}}}}if(c.abbDom!=null&&c.start==""){c.abbDom.css({position:"absolute",left:(g+d.left+10),top:h-5})}},dbClick:function(a,f,n){if(this.drawing.trendline.func.dbClickDeleteLine){var j=this.drawing.trendline.depot;var g=0,l,d;for(var h=0;h<j.length;h++){g=j[h];if(g==undefined){continue}l={spos:[n.series.xaxis.p2c(g.start.x),n.series.yaxis.p2c(g.start.y)],epos:[n.series.xaxis.p2c(g.end.x),n.series.yaxis.p2c(g.end.y)]};d=this._mouseOverLine(f,l);if(d){this._clearTrendLine(this,h);break}}}if(this.drawing.levelline.func.dbClickDeleteLine){var j=this.drawing.levelline.depot;var g=0,l,d;for(var h=0;h<j.length;h++){g=j[h];if(g==undefined){continue}var m=n.series.yaxis.p2c(g.start.y);if(Math.abs(f[1]-m)<2){this._clearLevelline(this,h);break}}}},_autoDrawThmbunail:function(g){var c=this.series[0].data,h=c.length;var j=Math.floor(h*5/11),a=Math.ceil(h*6/11);var f=this.series[0].yaxis.datamax-this.series[0].yaxis.datamin;var i=this.series[0].yaxis.datamin+f*5/8,e=this.series[0].yaxis.datamin+f*3/8;g.depot[g.currentIndex].start={dataIndex:11,x:j,y:i};g.depot[g.currentIndex].end={dataIndex:11,x:a,y:e}},mouseUp:function(c,h,f,m,j,g,t,s){var q=h[0],p=h[1];var d=this.drawing;var d=this.drawing,n=d.trendline,l=d.rectangle,i=d.ellipse;nt=d.note,ll=d.levelline,fi=d.fibonacci;var q=h[0],p=h[1];var o="",r=false,v=d.operationType.split("-")[0]=="drag";if(d.start!=""){if(f){f.pageX=parseInt(f.series.xaxis.p2c(f.datapoint[0])+m.left+j.left);f.pageY=parseInt(f.series.yaxis.p2c(f.datapoint[1])+m.top+j.top)}if(f!=null){d.count=f.series.data.length;if(f.series.data.length>0){d.startend=f.series.data[0][f.series.data[0].length-1]+"_"+f.series.data[f.series.data.length-1][f.series.data[f.series.data.length-1].length-1]}}d.operationType="";if(d.start=="trendline"){d.type.trendline=false;n.depot[n.currentIndex].opDom.show(100);n.end=true;o="trendline";if(n.depot[n.currentIndex].start.x&&(typeof(n.depot[n.currentIndex].end)=="undefined"||!n.depot[n.currentIndex].end.x)){this._autoDrawThmbunail(n);n.depot[n.currentIndex].opDom.show(100);this._setTrendlineText(n.depot[n.currentIndex])}d.start=""}else{if(d.start=="rectangle"){this._getMouseUpPos(l,f);if(!l.depot[l.currentIndex].haveDrag){l.depot[l.currentIndex].start=l.depot[l.currentIndex].oldStart;l.depot[l.currentIndex].end=l.depot[l.currentIndex].oldEnd}if(!l.depot[l.currentIndex].start||typeof(l.depot[l.currentIndex].start.x)=="undefined"){this._autoDrawThmbunail(l)}var a=this._calculateRectanglePos(l.depot[l.currentIndex],t);var u=this._drawingAddDom(l,"rectangle","closeRectangle",s);u.css({left:a.x+a.w+j.left-15,top:a.y+5});l.depot[l.currentIndex].opDom=u;d.type.rectangle=false;o="rectangle"}else{if(d.start=="ellipse"){this._getMouseUpPos(i,f);if(!i.depot[i.currentIndex].start||typeof(i.depot[i.currentIndex].start.x)=="undefined"){this._autoDrawThmbunail(i)}var a=this._calculateRectanglePos(i.depot[i.currentIndex],t);var u=this._drawingAddDom(i,"ellipse","closeEllipse",s);this._drawingSetClosePos(u,a.x+a.w+j.left-15,a.y+a.h/2-3);i.depot[i.currentIndex].opDom=u;d.type.ellipse=false;o="ellipse"}else{if(d.start=="note"){d.type.note=false;o="note"}else{if(d.start=="levelline"){ll.currentIndex=-1;d.type.levelline=false;o="levelline";d.start=""}else{if(d.start=="fibonacci"){d.type.fibonacci=false;o="fibonacci";fi.end=true;if(fi.move.moving){fi.move.moving=false;r=true}if(fi.depot[fi.currentIndex].opDom.length<11){var u=this._drawingAddDom(fi,"fibonacci","closeFibonacci",s);fi.depot[fi.currentIndex].opDom.push(u)}if(typeof(fi.depot[fi.currentIndex].end.x)=="undefined"){this._autoDrawThmbunail(fi)}}}}}}}d.start=""}d.type.note=false;this._drawingClearAllCloseDom(d,l,"rectangle","closeRectangle",s);this._drawingClearAllCloseDom(d,i,"ellipse","closeEllipse",s);if(n.move.moving){n.move.moving=false;r=true}if(l.move.moving){l.move.moving=false;r=true}if(i.move.moving){i.move.moving=false;r=true}if(ll.move.moving){i.move.moving=false;r=true}if(d.abbDom!=null){d.abbDom.remove()}if(v||r&&o!=""){if(typeof(this.onDrawingUpdated)=="function"){this.onDrawingUpdated(o,this.convertToPrice(this.drawing[o].depot[this.drawing[o].currentIndex],true,true))}}return[o,r,v]},_drawingSetClosePos:function(d,a,c){if(d!=null){d.css({left:a,top:c})}},_drawingClearAllCloseDom:function(h,d,a,f,g){if(!h.type[a]&&d.count<=0&&d.depot.length>0){var e=g.find(".rtq-"+a+"-close");for(var c=0;c<e.length;c++){$(e[c]).unbind("."+f).remove()}d.depot.length=0}},_clearTrendLine:function(c,a){var d=c.drawing.trendline.depot;$(d[a].opDom).find("a").unbind(".tline");d[a].opDom.remove();if(typeof(c.beforeRemoveDrawing)=="function"){c.beforeRemoveDrawing("trendline",c.convertToPrice(c.drawing.trendline.depot[a],true))}delete c.drawing.trendline.depot[a];c.drawing.trendline.count--},_clearLevelline:function(c,a){var d=c.drawing.levelline.depot;$(d[a].opDom).find("a").unbind(".levelline");d[a].opDom.remove();if(typeof(c.beforeRemoveDrawing)=="function"){c.beforeRemoveDrawing("levelline",c.convertToPrice(c.drawing.levelline.depot[a],true))}delete c.drawing.levelline.depot[a];c.drawing.levelline.count--},_drawingAddDom:function(d,a,e,f){var g=f.find(".rtq-"+a+"-close[index='"+d.currentIndex+"']");if(g.length==0){g=$("<div index='"+d.currentIndex+"' class='rtq-"+a+"-close'>&nbsp;</div>");g.appendTo(f);var c=this;g.bind("click."+e,function(h){var i=$(h.target).parent();if(i.hasClass("rtq-"+a+"-close")){var j=parseInt(i.attr("index"));i.remove();if(a=="fibonacci"){f.find(".chart-fibonacci-index-"+j).remove()}if(typeof(c.beforeRemoveDrawing)=="function"){c.beforeRemoveDrawing(a,c.convertToPrice(c.drawing[a].depot[j],true))}delete c.drawing[a].depot[j];c.drawing[a].count--}});if(typeof(__isMobile)!="undefined"&&__isMobile===true){g.html("<img src='"+QS_ImgServer+(QS_Theme=="black"?"theme/black/btn_close.gif":"img/btn_close.gif")+"'/>")}else{g.hover(function(){var h=$(this);if(h.offset().top>f.offset().top){g.html("<img src='"+QS_ImgServer+(QS_Theme=="black"?"theme/black/btn_close.gif":"img/btn_close.gif")+"'/>")}},function(){g.html("&nbsp;")})}}return g},_getMouseUpPos:function(c,d){if(!c.func.movingDraw){c.depot[c.currentIndex].end={x:d.datapoint[0],y:d.series.yaxis.c2p(xy[1]),dIdx:d.datapoint[d.datapoint[0].length-1]}}if(c.func.dragReDraw&&!c.func.movingDraw){var a=c.depot[c.currentIndex];if(c.move.moving){this._calMovingPos(d,a,c,canvasY)}}c.depot[c.currentIndex]=this._calculateRectangleSE(c.depot[c.currentIndex])},_mouseOverLine:function(a,h){var f=Math.min(h.spos[0],h.epos[0]);var i=Math.max(h.spos[0],h.epos[0]);var e=Math.min(h.spos[1],h.epos[1]);var g=Math.max(h.spos[1],h.epos[1]);if(!(Math.round(a[0])>f-2&&Math.round(a[0])<i+2&&Math.round(a[1])>e-2&&Math.round(a[1])<g+2)){return false}k=(h.epos[1]-h.spos[1])/(h.epos[0]-h.spos[0]);b=h.spos[1]-k*h.spos[0];var d=k*a[0]+b;if(Math.abs(d-a[1])>3){return false}return true},_getResultItem:function(a,c){return{datapoint:this.series[a].data[c],dataIndex:c,series:this.series[a],seriesIndex:a}},_transDataIndex:function(d,a){if(d.series.data[a]==undefined){return a}var c=d.series.data[a][d.series.data[0].length-1];return c},_trendlineRelateMovingDraw:function(a,f,g,d,e){if(a.func.movingDraw){var c=a.depot[a.currentIndex];c.haveDrag=true;if(f>-e.left&&d!=null){if(a.move.moving){this._calMovingPos(d,c,a,g)}else{if(a.end){c.end={x:d.datapoint[0],y:d.series.yaxis.c2p(g),dIdx:d.datapoint[d.datapoint.length-1]}}else{c.start={x:d.datapoint[0],y:d.series.yaxis.c2p(g),dIdx:d.datapoint[d.datapoint.length-1]}}}}}},_calMovingPos:function(e,d,c,h){var f=e.datapoint[0]-c.move.cp[0],g=e.series.yaxis.c2p(h)-c.move.cp[1];var a=e.datapoint[e.datapoint.length-1]-c.move.cp[2];d.start={x:c.move.sp[0]+f,y:c.move.sp[1]+g,dIdx:c.move.sp[2]+a};d.end={x:c.move.ep[0]+f,y:c.move.ep[1]+g,dIdx:c.move.ep[2]+a}},_rectangleRelateMovingDraw:function(a,f,g,d,e){if(a.func.movingDraw){var c=a.depot[a.currentIndex];c.haveDrag=true;if(f>-e.left&&d!=null){if(a.move.moving){this._calMovingPos(d,c,a,g)}else{c.end={x:d.datapoint[0],y:d.series.yaxis.c2p(g),dIdx:d.datapoint[d.datapoint.length-1]}}}}},_fibonacciRelateMovingDraw:function(a,f,g,d,e){if(a.func.movingDraw){var c=a.depot[a.currentIndex];if(f>-e.left&&d!=null){if(a.move.moving){this._calMovingPos(d,c,a,g)}else{if(a.end){c.end={x:d.datapoint[0],y:d.series.yaxis.c2p(g),dIdx:d.datapoint[d.datapoint.length-1]}}else{c.start={x:d.datapoint[0],y:d.series.yaxis.c2p(g),dIdx:d.datapoint[d.datapoint.length-1]}}}}}},changeClosePos:function(a,c){this.changeRectangleClosePos(a,c);this.changeEllipseClosePos(a,c);this.changeNoteStartPos(a,c)},clearDrawing:function(a){this.removeAllTrendLine();this._clearRectangle(a);this._clearEllipse(a);this._clearNotes();this._clearAllLevelline();this._clearFibonacci(a)},removeAllTrendLine:function(){var c=this.drawing.trendline,d=null;for(var a=0;a<c.depot.length;a++){d=c.depot[a];if(!d){continue}$(d.opDom).find("a").unbind(".tline");if(d.opDom){d.opDom.remove()}delete c.depot[a]}c.count=0;c.depot.length=0},_clearRectangle:function(e){var f=this.drawing,a=f.rectangle;if(!f.type.rectangle&&a.depot.length>0){for(var c=0;c<a.depot.length;c++){if(typeof(a.depot[c])!="undefined"&&a.depot[c].opDom!=null){a.depot[c].opDom.find("a").unbind(".closeRectangle").remove()}}}a.depot.length=0;var d=e.find(".rtq-rectangle-close");for(var c=0;c<d.length;c++){$(d[c]).unbind(".closeRectangle").remove()}},_clearFibonacci:function(e){var f=this.drawing,a=f.fibonacci;a.depot.length=0;var d=e.find(".rtq-chart-fibonacci-tip");for(var c=0;c<d.length;c++){$(d[c]).remove()}var d=e.find(".rtq-fibonacci-close");for(var c=0;c<d.length;c++){$(d[c]).unbind(".closeFibonacci").remove()}},_clearEllipse:function(e){var f=this.drawing,c=f.ellipse;if(!f.type.ellipse&&c.depot.length>0){for(var a=0;a<c.depot.length;a++){if(typeof(c.depot[a])!="undefined"&&c.depot[a].opDom!=null){c.depot[a].opDom.find("a").unbind(".closeEllipse").remove()}}}c.depot.length=0;var d=e.find(".rtq-ellipse-close");for(var a=0;a<d.length;a++){$(d[a]).unbind(".closeEllipse").remove()}},_clearAllLevelline:function(){var d=this.drawing,c=d.levelline;if(!d.type.levelline&&c.depot.length>0){for(var a=0;a<c.depot.length;a++){if(typeof(c.depot[a])!="undefined"&&c.depot[a].opDom!=null){c.depot[a].opDom.unbind(".levelline").remove()}}}c.depot.length=0},_clearNotes:function(){var d=this.drawing,c=d.note;if(!d.type.note&&c.depot.length>0){for(var a=0;a<c.depot.length;a++){if(typeof(c.depot[a])!="undefined"&&c.depot[a].note!=null){c.depot[a].note.unBindEvent()}}}c.depot.length=0},changeRectangleClosePos:function(a,f){var h=this.drawing,c=h.rectangle,e=null,g=null;for(var d=0;d<c.depot.length;d++){g=c.depot[d];if(g!=undefined&&g!=null){e=this._calculateRectanglePos(g,a);this._drawingSetClosePos(g.opDom,e.x+e.w+f.left-15,e.y+5)}}},changeEllipseClosePos:function(a,f){var h=this.drawing,e=h.ellipse,d=null,g=null;for(var c=0;c<e.depot.length;c++){g=e.depot[c];if(g!=undefined&&g!=null){d=this._calculateRectanglePos(g,a);this._drawingSetClosePos(g.opDom,d.x+d.w+f.left-15,d.y+d.h/2-3)}}},changeNoteStartPos:function(h,d){var a=this.drawing,g=a.note,c=null,e=null;for(var f=0;f<g.depot.length;f++){e=g.depot[f];if(e!=undefined&&e!=null){var j=h.xaxis.p2c(e.x),l=h.yaxis.p2c(e.y);e.note.setPosition(j,l)}}},_calculateRectangle:function(e,a){var d=[],c={spos:[],epos:[]};c.spos=[a.xaxis.p2c(e.start.x),a.yaxis.p2c(e.start.y)];c.epos=[a.xaxis.p2c(e.end.x),a.yaxis.p2c(e.end.y)];var f={};if(c.spos[0]<c.epos[0]){if(c.epos[1]<c.spos[1]){f.x=c.spos[0],f.y=c.epos[1]}else{f.x=c.spos[0],f.y=c.spos[1]}}else{if(c.epos[1]<c.spos[1]){f.x=c.epos[0],f.y=c.epos[1]}else{f.x=c.epos[0],f.y=c.spos[1]}}f.w=Math.abs(c.epos[0]-c.spos[0]),f.h=Math.abs(c.epos[1]-c.spos[1]);return f},_calculateRectangleSE:function(d){var e={start:{x:0,y:0},end:{x:0,y:0}};e=$.extend({},e,d);if(d.start.x<d.end.x){if(d.start.y>d.end.y){}else{var f=e.start.y;e.start.y=e.end.y;e.end.y=f}}else{if(d.start.y>d.end.y){var f=d.start.x;d.start.x=d.end.x;d.end.x=f}else{var c=e.start.x;var a=e.start.y;e.start.x=e.end.x;e.start.y=e.end.y;e.end.x=c;e.end.y=a}}return e},_calculateRectanglePos:function(d,a){var e={};var c=[a.xaxis.p2c(d.start.x),a.yaxis.p2c(d.start.y),a.xaxis.p2c(d.end.x),a.yaxis.p2c(d.end.y)];e.x=c[0];e.y=c[1];e.w=Math.abs(c[0]-c[2]),e.h=Math.abs(c[1]-c[3]);return e},getLastDrawing:function(c){var a=null;if(this.drawing[c]&&this.drawing[c]["depot"].length){a=$.extend(true,{},this.drawing[c].depot[this.drawing[c].depot.length-1]);delete a.opDom}this.convertToPrice(a);return a},setDrawings:function(e){for(var c in e){if(this.drawing[c]){this.drawing[c].depot=e[c];this.drawing[c].count=e[c].length;if(c=="fibonacci"||c=="trendline"||c=="levelline"){var d=c=="fibonacci"?"_createFibaccLegend":c=="trendline"?"_createTrendLineLegend":"_creatLevelLineLegend";for(var a=0;a<this.drawing[c].depot.length;a++){this.convertToReturn(this.drawing[c].depot[a]);this.drawing[c].depot[a].opDom=this[d](a,this.target);if(c=="trendline"){this._setTrendlineText(this.drawing[c].depot[a])}}}else{for(var a=0;a<this.drawing[c].depot.length;a++){this.convertToReturn(this.drawing[c].depot[a])}}}}},convertToPrice:function(a,d,e){var f={};if(d){for(var c in a){if(c!="opDom"){f[c]=$.extend(true,{},a[c])}else{f[c]=a[c]}}}else{f=a}if(this.chartType=="return"){if(f.start){f.start.y=(100+f.start.y)*this.startPos/100}if(f.end){f.end.y=(100+f.end.y)*this.startPos/100}if(e){if(f.oldStart){f.oldStart.y=(100+f.oldStart.y)*this.startPos/100}if(f.oldEnd){f.oldEnd.y=(100+f.oldEnd.y)*this.startPos/100}}}else{if(this.chartType=="return10"){if(f.start){f.start.y=f.start.y*this.startPos/10000}if(f.end){f.end.y=f.end.y*this.startPos/10000}if(e){if(f.oldStart){f.oldStart.y=f.oldStart.y*this.startPos/10000}if(f.oldEnd){f.oldEnd.y=f.oldEnd.y*this.startPos/10000}}}}return f},convertToReturn:function(a){if(this.chartType=="return"){if(a.start){a.start.y=100*(a.start.y-this.startPos)/this.startPos}if(a.end){a.end.y=100*(a.end.y-this.startPos)/this.startPos}}else{if(this.chartType=="return10"){if(a.start){a.start.y=10000*a.start.y/this.startPos}if(a.end){a.end.y=10000*a.end.y/this.startPos}}}}};mstarINoteDataManager={saveNote:function(a){},removeNote:function(){},addNote:function(){}};mstar.noteDataManager=function(a){this.dao=$.extend(true,{secId:0,createTime:null,eventInfo:{text:"",status:"",h:"",w:""},updateTime:null,eventId:0},a||{});this.intervalObj=null;this.delay=1000};mstar.noteDataManager.prototype={saveNote:function(a){var c=this;clearTimeout(this.intervalObj);this.intervalObj=setTimeout(function(){c._updateNote(a)},this.delay)},_updateNote:function(a){var c=$.extend(true,this.dao,a.saveNote());DBHelper.updateNote(c.eventId,c.secId,$.toJSON(c.eventInfo),c.eventTime,function(d){})},removeNote:function(a){DBHelper.removeNote(this.dao.eventId,function(){})},addNote:function(){var a=this;DBHelper.addNote(this.dao.secId,$.toJSON(this.dao.eventInfo),this.dao.eventTime,function(d){var c=$.evalJSON(d);if(c.list&&c.list.length>0){a.dao=$.extend(true,a.dao,c.list[0])}})}};mstar.note=function(d,c,a){this.tar=d;this.dom=null;this.series=c;this.nx=-1;this.dataManager=a||mstarINoteDataManager;this.segmentDom={counter:null,title:null,text:null,bottom:null,middle:null,handle:null,counter:null};this.drag={drag:false,d:{x:0,y:0},off:{x:0,y:0}};this.clickPos={x:0,y:0};this.changeSize=false;this.isFocus=false;this.currentIndex=0;this.domBeforeHide={w:100,h:42,hide:false};this.changeSizeDelay=null;this.mouseoutDelay=null;this.mouseoverDelay=null;this.haveDrag=false;this.init()};mstar.note.prototype={init:function(){this.dom=$("<div class='qs-note-flot qs-note-flot-background' ><div class='qs-note-title'><a style='float:left' class='qs-note-abb'>NOTE</a><span class='qs-note-max-count'></span><a class='hideable qs-note-close' style='float:right'></a><a class='qs-note-minimize hideable' style='float:right'></a></div><div class='qs-note-middle hideable'><textarea class='qs-ui-txt'></textarea><div class='qs-note-pos-handle'>&nbsp;</div></div></div>");this.tar.append(this.dom);this.segmentDom.title=this.dom.find(".qs-note-title");this.segmentDom.abb=this.dom.find(".qs-note-abb");this.segmentDom.text=this.dom.find(".qs-ui-txt");this.segmentDom.middle=this.dom.find(".qs-note-middle");this.segmentDom.handle=this.dom.find(".qs-note-pos-handle");this.segmentDom.counter=this.dom.find(".qs-note-max-count");this._bindEvent()},addNote:function(){this.dataManager.addNote()},setDataManager:function(a){this.dataManager=a},setPosition:function(a,c){this.drag.d={x:a,y:c};this.dom.css({left:a+"px",top:c+"px"})},unBindEvent:function(){if(typeof(this)!="undefined"&&this!=null&&typeof(this.dom)!="undefined"&&this.dom!=null){this.segmentDom.text.unbind(".qs-note-flot-self");this.dom.unbind(".qs-note-flot-self");this.dom.remove()}},_bindEvent:function(){this._textChange();this._mouseDown();this._mouseClick();this._inputBlur();this._inputSelect();this._mouseOut();this._mouseOver()},_textChange:function(){var a=this;this.segmentDom.text.unbind("keydown.qs-note-flot").bind("keydown.qs-note-flot",function(c){if(a.isFocus){var d=this;setTimeout(function(){var e=d.value.length;if(e<=100){a.segmentDom.counter.show();a.segmentDom.counter.html((100-e)+" char left");a.segmentDom.abb.hide()}else{d.value=d.value.substr(0,100)}a.dataManager.saveNote(a)},200)}})},_mouseDown:function(){var a=this;this.dom.unbind("mousedown.qs-note-flot-self").bind("mousedown.qs-note-flot-self",function(c){var d=$(c.target);a.clickPos={x:a.dom.offset().left,y:a.dom.offset().top};a.haveDrag=false;if(d.hasClass("qs-note-title")||d.hasClass("qs-note-max-count")){a.drag.drag=true;a.drag.off.x=a.dom.position().left-c.pageX;a.drag.off.y=a.dom.position().top-c.pageY;a.segmentDom.title.css("cursor","move");a._mouseMove();a._mouseUp()}else{if(d.hasClass("qs-note-pos-handle")){a.changeSize=true;a._mouseMove();a._mouseUp()}}a.tar.find(".qs-note-flot").css("z-index",100);a.dom.css("z-index",101);c.stopPropagation()})},restoreNote:function(a){if(a.text){this.segmentDom.text.html(a.text)}if(a.h&&a.w){this._domReSize(a.w,a.h)}if(a.status&&a.status=="close"){this._minimizeNote()}},removeNote:function(){this.dataManager.removeNote()},saveNote:function(){var e={eventInfo:null};if(this.nx!=-1){var c=this.series.data[this.nx];var a=c[c.length-1]>100000?c[c.length-1]:RTQ_ChartUtil.toDateFromIndex(c[c.length-1]).getTime();e.eventTime=a}e.eventInfo={text:this.segmentDom.text.val(),status:this.dom.find(".qs-note-minimize:visible").length>0?"open":"close",h:this.dom.height(),w:this.dom.width()};return e},_minimizeNote:function(){this.segmentDom.abb.html("NOTE");this.domBeforeHide={w:this.dom.width(),h:this.dom.height(),hide:true};this.dom.find(".hideable").hide();this.dom.css({width:"auto",height:"auto"});this.segmentDom.abb.show();this.segmentDom.counter.hide();this.saveNote()},_mouseClick:function(){var a=this;this.dom.unbind("click.qs-note-flot-self").bind("click.qs-note-flot-self",function(c){var d=$(c.target);if(d.hasClass("qs-note-minimize")){a._minimizeNote()}else{if(d.hasClass("qs-note-abb")){if(a.domBeforeHide.hide){a.dom.find(".hideable").show();a.segmentDom.abb.hide();a.segmentDom.counter.show();a.segmentDom.counter.html(100-a.segmentDom.text.val().length+" char left");a.dom.css({width:a.domBeforeHide.w,height:a.domBeforeHide.h});a.domBeforeHide.hide=false;a.saveNote()}}else{if(d.hasClass("qs-note-close")){a.unBindEvent();a.removeNote()}}}})},_domReSize:function(c,a){this.dom.css({width:c,height:a});this.segmentDom.middle.css({height:a-12});this.segmentDom.text.css({height:a-12})},_mouseMove:function(){var e=this;var g=0,a=0,d=0,f=0,c=0;$(document.body).unbind("mousemove.qs-note-flot").bind("mousemove.qs-note-flot",function(h){var i=e.drag;if(i.drag){d=h.pageX+i.off.x,f=h.pageY+i.off.y;if((d)<0){d=0}if((f)<0){f=0}if((d+e.domBeforeHide.w)>e.tar.width()){d=e.tar.width()-e.domBeforeHide.w}if((f+e.domBeforeHide.h)>e.tar.height()){f=e.tar.height()-e.domBeforeHide.h}e.nx=Math.round(e.series.xaxis.c2p(d));e.dom.css({left:e.series.xaxis.p2c(e.nx)+"px",top:f+"px"})}else{if(e.changeSize){g=h.pageX-e.clickPos.x,a=h.pageY-e.clickPos.y;clearTimeout(e.changeSizeDelay);setTimeout(function(){if(g<90){g=90}if(g>400){g=400}if(a<26){a=26}if(a>180){a=180}e._domReSize(g,a)},10)}}})},_inputBlur:function(){var a=this;this.segmentDom.text.unbind("blur.qs-note-flot-self").bind("blur.qs-note-flot-self",function(){a.isFocus=false})},_inputSelect:function(){var a=this;this.segmentDom.text.unbind("focus.qs-note-flot-self").bind("focus.qs-note-flot-self",function(){a.isFocus=true})},_mouseUp:function(){var a=this;$(document.body).unbind("mouseup.qs-note-flot").one("mouseup.qs-note-flot",function(c){if(a.drag.drag){a.drag.drag=false}if(a.changeSize){a.changeSize=false;a.haveDrag=true;a.domBeforeHide.w=a.dom.width();a.domBeforeHide.h=a.dom.height()}a.dataManager.saveNote(a);$(document.body).unbind("mousemove.qs-note-flot")})},_mouseOut:function(){var a="",c=this;this.dom.bind("mouseleave.qs-note-flot-self",function(d){a=$(d.relatedTarget).attr("class");if(a.indexOf("qs-note")!=0&&!c.haveDrag&&!c.domBeforeHide.hide){clearTimeout(c.mouseoutDelay);clearTimeout(c.mouseoverDelay);c.mouseoutDelay=setTimeout(function(){if(c.dom.hasClass("qs-note-flot-background")&&c.segmentDom.text.val().length>0){c._titleHide(c)}},500)}if(c.haveDrag){c.haveDrag=false}})},_mouseOver:function(){var a=this;this.segmentDom.middle.unbind("mouseover.qs-note-flot-self").bind("mouseover.qs-note-flot-self",function(c){if(!a.dom.hasClass("qs-note-flot-background")&&!a.domBeforeHide.hide){clearTimeout(a.mouseoverDelay);clearTimeout(a.mouseoutDelay);a.mouseoverDelay=setTimeout(function(){a._titleShow(a)},500)}})},_titleShow:function(a){a.segmentDom.title.css("visibility","visible");a.segmentDom.handle.css("visibility","visible");a.segmentDom.text.removeClass("qs-note-text-input-blur");a.dom.css({top:a.dom.position().top-1,left:a.dom.position().left-1});a.dom.addClass("qs-note-flot-background")},_titleHide:function(a){a.dom.css({top:a.dom.position().top+1,left:a.dom.position().left+1});a.segmentDom.title.css("visibility","hidden");a.segmentDom.text.blur();a.segmentDom.text.addClass("qs-note-text-input-blur");a.dom.removeClass("qs-note-flot-background");a.segmentDom.handle.css("visibility","hidden")}};var RTQ_ChartUtil={formatDate:function(a){if(a==null){return null}return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},formatDateMDY:function(c,b){if(c==null){return null}var a=b;if(typeof(b)=="undefined"){a="-"}return((c.getMonth()+1)<=9?"0":"")+(c.getMonth()+1)+"-"+(c.getDate()<=9?"0":"")+c.getDate()+"-"+c.getFullYear()},formatDateToVBDate:function(a){if(a==null){return null}return(a.getMonth()+1)+"/"+a.getDate()+"/"+a.getFullYear()},convertToDate:function(a){if(a==null||a==""){return null}var g=a.split("-");if(g.length>1){var e=g[0],b=parseInt(g[1],10),c=parseInt(g[2],10);return new Date(e,b-1,c)}else{var e=parseInt(a.substr(0,4),10),b=parseInt(a.substr(4,2),10),c=parseInt(a.substr(6,2),10);return new Date(e,b-1,c)}},convertToVBDate:function(b){if(b==null||b==""){return null}var c=QS_DateFmt.Delcollator=="/"?"-":"/";var h=b.split(c);var g=h[2],a=parseInt(h[0],10),e=parseInt(h[1],10);return new Date(g,a-1,e)},compareDate:function(h,k){var g=QS_DateFmt.Delcollator=="/"?"-":"/";var l=h.split(g),c=k.split(g),d=l[2],e=parseInt(l[0],10),i=parseInt(l[1],10);var j=c[2],a=parseInt(c[0],10),b=parseInt(c[1],10);if(j==d&&a==e&&b==i){return true}return d<j?true:(d==j?(e<a?true:(e==a?(i<b?true:false):false)):false)},compareDateByday:function(a,c){if(!a||!c){return false}var b=new Date(a.getFullYear(),a.getMonth(),a.getDate());var d=new Date(c.getFullYear(),c.getMonth(),c.getDate());return d.getTime()==b.getTime()},isVbDate:function(f){var c=/^(\d{1,2})(\/)(\d{1,2})\2(\d{4})$/;if(QS_DateFmt.Delcollator=="/"){var c=/^(\d{1,2})(-)(\d{1,2})\2(\d{4})$/}var b=f.match(c);if(b==null){return false}var g,e,a;g=b[4];e=parseInt(b[1],10);a=parseInt(b[3],10);if((e<1)||(e>12)||(a<1)||(a>31)){return false}if(((e==4)||(e==6)||(e==9)||(e==11))&&(a>30)){return false}if((g%4)==0){if((e==2)&&(a>29)){return false}}else{if((e==2)&&(a>28)){return false}}return true},trimDate:function(a){return new Date(a.getFullYear(),a.getMonth(),a.getDate())},toDateIndex:function(a){if(a==null){return 0}var b=new Date(1900,0,1).getTime();var c=new Date(a.getFullYear(),a.getMonth(),a.getDate()).getTime();return Math.round((c-b)/86400000)},toDateFromIndex:function(a){return new Date(a*86400000+new Date(1900,0,1).getTime())},toDateFromIndexOrTick:function(b,a){if(a==0){return new Date(b)}else{return this.toDateFromIndex(b)}},formatPChartXLabel:function(a,d,e){if(a==null){return""}var c=parseInt(a,10),b;if(d==1||e){b=new Date(c);return b==null?"":QS_DateFmt.getTimeString(b)}else{if(d==2||d==0){b=new Date(c);return b==null?"":this.formatDateToWeekMMDD(b)}else{b=new Date(c*86400000+new Date(1900,0,1).getTime());return b==null?"":QS_DateFmt.getDateString(b)}}},formatDateToWeekMMDD:function(a){return QS_DateFmt.getWeekDay(a)+" "+QS_DateFmt.getMonthDate(a)},formatSChartXLabel:function(a,c){if(a==null){return""}var d=parseInt(a,10);var b=new Date(d*86400000+new Date(1900,0,1).getTime());if(c=="minute"){return b==null?"":QS_DateFmt.Mo[b.getMonth()]}else{if(c=="d"){return b==null?"":b.getFullYear()}else{return b==null?"":b.getFullYear().toString().substr(2,2)}}},formatLegendDate:function(a,d){if(a==null){return""}var c=parseInt(a,10),b;if(d!="d"&&d!="w"&&d!="m"){b=new Date(c);return(b==null)?"":QS_DateFmt.getDatetimeString(b)}else{b=new Date(c*86400000+new Date(1900,0,1).getTime());return(b==null)?" ":(d=="m"?QS_DateFmt.getYearMonth(b):QS_DateFmt.getDateString(b))}},formateNumber:function(b,a){return b==null||isNaN(b)?"--":QS_NumFmt.Fmt2(b,true,"",a)},formatMDYDate:function(a){return(a==null)?" ":QS_DateFmt.getDateString(a)}};var RTQ_chartCustomDataBox=function(a,b){this.option={inputClassName:"qs-ui-ipt",width:62,splitLabel:"to",hoverColor:"#ffff99",startDate:null,endDate:null,callback:null,bindEvent:true};this.container=typeof(a)=="String"?$(a):a;this.inputBoxes;this._timeOut=null;this._isFocus=[false,false];$.extend(this.option,b);this.init()};RTQ_chartCustomDataBox.prototype={init:function(){var a='<input type="text" class="'+this.option.inputClassName+'">';if(this.option.splitLabel){a+='<span class="rtc-ctrl-lb1">'+this.option.splitLabel+"</span>"}a+='<input type="text" class="'+this.option.inputClassName+'">';this.container.html(a);if(this.option.bindEvent){this.container.bind("mouseover.customBox",this,this.boxOnHover).bind("mouseout.customBox",this,this.boxOnOut);this.inputBoxes=$("input",this.container).bind("focus.customBox",this,this.boxOnFocus).bind("blur.customBox",this,this.boxLoseFocus).bind("keydown.customBox",this,this.boxOnKeydown).each(function(b){$(this).data("index.customBox",b)})}else{this.inputBoxes=$("input",this.container)}if(this.option.width){this.inputBoxes.css({width:this.option.width})}this._setDate()},boxOnHover:function(a){var b=a.data;b.inputBoxes.css({backgroundColor:b.option.hoverColor})},boxOnOut:function(a){var b=a.data;if(!b._isFocus[0]&&!b._isFocus[1]){b._checkDateChange()}},boxOnFocus:function(f){var j=f.data,c=$(f.target).data("index.customBox");if(j._timeOut!=null){clearTimeout(j._timeOut);j._timeOut=null}j._isFocus[c]=true;var a=j.option.startDate,i=j.option.endDate;if(RTQ_ChartUtil.isVbDate(j.inputBoxes[0]["value"])){a=RTQ_ChartUtil.convertToVBDate(j.inputBoxes[0]["value"])}if(RTQ_ChartUtil.isVbDate(j.inputBoxes[1]["value"])){i=RTQ_ChartUtil.convertToVBDate(j.inputBoxes[1]["value"])}var h=QS_DateFmt.Delcollator=="/"?"-":"/";var b=(a==null)?"":(a.getMonth()+1)+h+a.getDate()+h+a.getFullYear();var g=(i==null)?"":(i.getMonth()+1)+h+i.getDate()+h+i.getFullYear();j.inputBoxes[0]["value"]=b;j.inputBoxes[1]["value"]=g;if(document.all){var d=f.srcElement;var k=d.createTextRange();k.moveStart("character",d.value.length);k.collapse(true);k.select()}},boxLoseFocus:function(a){var c=a.data,b=$(a.target).data("index.customBox");c._isFocus[b]=false;c._timeOut=setTimeout(function(){if(!c._isFocus[0]&&!c._isFocus[1]){c._checkDateChange()}},200)},boxOnKeydown:function(a){if(a.keyCode==13){$(a.target).trigger("blur")}},_checkDateChange:function(){var b=this.inputBoxes[0]["value"],a=this.inputBoxes[1]["value"];if(RTQ_ChartUtil.isVbDate(b)&&RTQ_ChartUtil.isVbDate(a)&&RTQ_ChartUtil.compareDate(b,a)){var d=RTQ_ChartUtil.convertToVBDate(b),c=RTQ_ChartUtil.convertToVBDate(a);st=this.option.startDate,en=this.option.endDate;if(st.getFullYear()==d.getFullYear()&&st.getMonth()==d.getMonth()&&st.getDate()==d.getDate()&&en.getFullYear()==c.getFullYear()&&en.getMonth()==c.getMonth()&&en.getDate()==c.getDate()){this._rollbackColor()}else{this.option.startDate=d,this.option.endDate=c;this._setDate();if(typeof(this.option.callback)=="function"){this.option.callback(this.option.startDate,this.option.endDate)}}this.inputBoxes.css({backgroundColor:""})}else{this._rollbackColor()}},_rollbackColor:function(){if(!this._isFocus[0]&&!this._isFocus[1]){document.body.focus();this.inputBoxes.css({backgroundColor:""});if(document.activeElement.tagName.toUpperCase()!="INPUT"){this._setDate()}}},_setDate:function(){this.inputBoxes[0]["value"]=QS_DateFmt.getDateString(this.option.startDate);this.inputBoxes[1]["value"]=QS_DateFmt.getDateString(this.option.endDate)},setDate:function(b,a){if(b!=null&&a!=null){if(!RTQ_ChartUtil.compareDateByday(b,this.option.startDate)||!RTQ_ChartUtil.compareDateByday(a,this.option.endDate)){this.option.startDate=b;this.option.endDate=a;this._setDate()}}else{this.inputBoxes.val("")}},clear:function(){this.container.unbind(".customBox");this.inputBoxes.unbind(".customBox");this.container.remove();for(var a in this){if(!a||a=="clear"){continue}this[a]=null;delete this[a]}}};function indicatorCalculation(){}indicatorCalculation.prototype={filtrateCalculatedData:function(e,q,o,y,n,v,f){if(y==null||y.length<1){return{data:[],spos:null}}var t=[];var p=y[0].length,m=p>3?2:1;var s=y[0][y[0].length-1],g=y[y.length-1][y[y.length-1].length-1];var a=1;if(n=="i"){a=600000}else{if(n=="d"){a=1}else{if(n=="w"){a=7}else{if(n=="m"){a=30}}}}var w=0,r=(typeof(f)=="undefined"?null:f);if(o&&e<s){for(var l=e;l<s;l+=a){var x=[w,NaN,l];t.push(x);w++}}for(var d=0;d<y.length;d++){if(y[d][y[d].length-1]<e||y[d][y[d].length-1]>q){continue}if(v=="return"&&r==null&&!isNaN(y[d][m])){r=y[d][m]}var u=[];u.push(w);if(v=="return"&&r!=null){u.push(100*(y[d][1]-r)/r)}else{u.push(y[d][1])}for(var k=2;k<y[d].length;k++){u.push(y[d][k])}t.push(u);w++}return{data:t,spos:r}},EMA:function(g,p){if(typeof(g)=="undefined"||g.length==0||isNaN(p)){return null}var s=[];var r=g.length,h=2/(p+1),q=0,d=0,t=0;var f=true,a=0;for(var o=0;o<r;o++){if(f&&(g[o]==null||isNaN(g[o]))){s.push(NaN);a=o+1;continue}f=false;if((o-a)<p-1){s.push(NaN);if(g[o]!=null&&!isNaN(g[o])){d+=g[o],t++}continue}else{if((o-a)==p-1){if(g[o]!=null&&!isNaN(g[o])){d+=g[o],t++}s.push((d==0?NaN:(d/t)));if(!isNaN(s[o])){q=s[o]}}else{var e=(g[o]==null?NaN:g[o]);var l=q+(e-q)*h;s.push(l);if(!isNaN(s[o])){q=l}}}}return s},calculateSma:function(d,o,f){if(f==null||f<0||d==null||d.length<f){return null}var k=[];var h=d.length,e=0,l=0;for(var g=0;g<h;g++){if(d[g]!=null&&!isNaN(d[g][1])){e+=d[g][1];l++}if(g<f-1){k.push([g,NaN,d[g][d[g].length-1]])}else{var a=isNaN(d[g][1])||l<=0?NaN:(e/l);k.push([g,a,d[g][d[g].length-1]]);if(d[g-f+1]!=null&&!isNaN(d[g-f+1][1])){e-=d[g-f+1][1];l--}}}return k},calculateEma:function(g,u,p){if(p==null||p<0||g==null||g.length<p){return null}var s=[];var r=g.length,h=2/(p+1),q=0,d=0,t=0;var f=true,a=0;for(var o=0;o<r;o++){if(f&&(g[o]==null||isNaN(g[o][1]))){s.push([o,NaN,g[o][g[o].length-1]]);a=o+1;continue}f=false;if((o-a)<p-1){s.push([o,NaN,g[o][g[o].length-1]]);if(g[o]!=null&&!isNaN(g[o][1])){d+=g[o][1],t++}continue}else{if((o-a)==p-1){if(g[o]!=null&&!isNaN(g[o][1])){d+=g[o][1],t++}s.push([o,(d==0?NaN:(d/t)),g[o][g[o].length-1]]);if(!isNaN(s[o][1])){q=s[o][1]}}else{var e=(g[o]==null?NaN:g[o][1]);var l=q+(e-q)*h;s.push([o,l,g[o][g[o].length-1]]);if(!isNaN(s[o][1])){q=l}}}}return s},calculateBBands:function(g,v,l,e){if(l<0||g==null||g.length<l){return null}var s=[];var q=g.length;s[0]=[],s[1]=[];var k=0,t=0;for(var p=0;p<q;p++){if(p<l-1){s[0].push([p,NaN,NaN,g[p][g[p].length-1]]);s[1].push([p,NaN,NaN,g[p][g[p].length-1]]);if(g[p]!=null&&!isNaN(g[p][1])){k+=g[p][1],t++}continue}else{if(g[p]!=null&&!isNaN(g[p][1])){k+=g[p][1];t++}var d=t>0?(k/t):NaN;var u=0,f=0,h=0;for(var a=p;a>(p-l);a--){if(g[a]!=null&&!isNaN(g[a][1])){h++;f+=(Math.pow((g[a][1]-d),2))}}if(h>1){h=h-1}u=Math.sqrt(f/h);var o=d+e*u;var r=d-e*u;if(isNaN(g[p][1])){s[0].push([p,NaN,NaN,g[p][g[p].length-1]]);s[1].push([p,NaN,NaN,g[p][g[p].length-1]])}else{s[0].push([p,o,g[p][1],g[p][g[p].length-1]]);s[1].push([p,r,g[p][1],g[p][g[p].length-1]])}if(g[p-l+1]!=null&&!isNaN(g[p-l+1][1])){k-=g[p-l+1][1];t--}}}return s},calculateMACD:function(e,o,k,q,n){if(q<0||e==null||e.length<k){return[[],[],[]]}var l=[[],[],[]];var m=this.calculateEma(e,o,k);var p=this.calculateEma(e,o,q);var d=e.length;var a,g;for(var f=0;f<d;f++){a=p[f][1]-m[f][1];l[0][f]=[f,a,e[f][e[f].length-1]]}var h=this.calculateEma(l[0],o,n);for(j=0;j<d;j++){g=l[0][j][1]-h[j][1];l[2][j]=[j,g,e[j][e[j].length-1]]}l[1]=h;return l},calculateRSI:function(w,l,f){if(f<0||w==null||w.length<f){return null}var s=[],q=w.length;var u=0,d=0,h=0,a=NaN,o=NaN,g=0,t,r,p=NaN;for(var e=0;e<q;e++){if(e<=f){if(e>0){g=isNaN(w[e-1][1])||isNaN(w[e][1])?0:(w[e][1]-w[e-1][1]);if(g>0){u+=g}else{d-=g}}if(e==f){a=t=u/f;o=r=d/f;p=r==0?100:(100-(100/(1+t/r)))}s[e]=[e,p,w[e][w[e].length-1]]}else{if(isNaN(w[e][1])){s[e]=[e,NaN,w[e][w[e].length-1]];continue}g=isNaN(w[e-1][1])||isNaN(w[e][1])?0:(w[e][1]-w[e-1][1]);var v=g<0?-g:0,k=g>0?g:0;t=(a*(f-1)+k)/f;r=(o*(f-1)+v)/f;p=r==0?100:(100-(100/(1+t/r)));s[e]=[e,p,w[e][w[e].length-1]];a=t;o=r}}return s},_calculateStochastic:function(f,u,g,w,s){if(g<0||f==null||f.length<g){return[[],[]]}var r=[[],[]];var p=f.length;for(var n=0;n<p;n++){if(n<(g-1)){r[0][n]=[n,NaN,f[n][f[n].length-1]]}else{var v=0;iMin=1000000;for(j=n;j>n-g;j--){if(f[j][2]>v){v=f[j][2]}if(f[j][3]<iMin){iMin=f[j][3]}}var e=(v<=iMin?NaN:100*(f[n][1]-iMin)/(v-iMin));r[0][n]=[n,e,f[n][f[n].length-1]]}}var t=r[0],l=t.length,o=0,a=0;for(var q=0;q<l;q++){if(q<(w-1)){r[1][q]=[q,NaN,t[q][2]];if(!isNaN(t[q][1])){o+=t[q][1];a++}}else{if(!isNaN(t[q][1])){o+=t[q][1];a++}r[1][q]=[q,(a>0?o/a:NaN),t[q][2]];if(!isNaN(t[q-w+1][1])){o-=t[q-w+1][1];a--}}if(isNaN(t[q][1])){r[1][q]=[q,NaN,t[q][2]]}}return r},calculateSlowStochastic:function(g,e,a,f){return this._calculateStochastic(g,e,a,f,"slow")},calculateFastStochastic:function(g,e,a,f){return this._calculateStochastic(g,e,a,f,"fast")},calculateROC:function(k,a,d){if(d<0||k==null||k.length<d){return null}aCache=[];var h=k.length;var g,f;for(var e=0;e<h;e++){if(e<d){aCache.push([e,NaN,k[e][k[e].length-1]])}else{g=(k[e-d]==null?NaN:k[e-d][1]);f=NaN;if(!isNaN(g)){f=100*(k[e][1]-g)/g}aCache[e]=[e,f,k[e][k[e].length-1]]}}return aCache},calculateWillR:function(a,m,e){if(e<0||a==null||a.length<e){return null}var k=[];var g=a.length;var o=0,h=1000000,l;for(var d=0;d<g;d++){if(d<e){if(a[d]!=null){if(!isNaN(a[d][2])&&a[d][2]>o){o=a[d][2]}if(!isNaN(a[d][3])&&a[d][3]<h){h=a[d][3]}if(d==e-1){l=100*(a[d][1]-o)/(o-h);k[d]=[d,l,a[d][a[d].length-1]]}else{k[d]=[d,NaN,a[d][a[d].length-1]]}}}else{o=0,h=1000000;for(var f=d;f>d-e;f--){if(!isNaN(a[f][2])&&a[f][2]>o){o=a[f][2]}if(!isNaN(a[f][3])&&a[f][3]<h){h=a[f][3]}}l=100*(a[d][1]-o)/(o-h);k[d]=[d,l,a[d][a[d].length-1]]}}return k},calculatePSAR:function(y,n,e,f){if(y==null||y.length<2){return}var m=[];var w=y.length;var q,h,t=e,l,p=0,v=1000000;var x=[,];m[0]=[0,NaN,NaN,y[0][y[0].length-1]];var d=false;for(var k=2;k<=w;k++){if(k>=2&&!d){if(isNaN(y[k-1][2])||isNaN(y[k-1][3])||isNaN(y[k-1][1])){m[k-1]=[k-1,NaN,y[k-1][1],y[k-1][y[k-1].length-1]];continue}d=true;var s=y[k-2][2]>y[k-1][2]?y[k-2][2]:y[k-1][2];var u=y[k-2][3]<y[k-1][3]?y[k-2][3]:y[k-1][3];if(y[k][1]>=y[k-1][1]){q=0;l=u;h=s;m[k-1]=[k-1,l,y[k-1][1],y[k][y[k].length-1]];x[0]=x[1]=0}else{q=1;l=s;h=u;m[k-1]=[k-1,l,y[k-1][1],y[k-1][y[k-1].length]];x[0]=x[1]=0}}var g=(isNaN(l)||isNaN(h))?NaN:(l+t*(h-l));if(k==w){m[k-1]=[k-1,g,y[1-1][1],y[k-1][y[k-1].length-1]];if(isNaN(y[k-1][1])){m[k-1]=[k,NaN,NaN,y[k-1][y[k-1].length-1]]}break}if(isNaN(y[k][1])||isNaN(y[k][2])||isNaN(y[k][3])){m[k-1]=[k,NaN,NaN,y[k][y[k].length-1]];continue}if(x[0]==x[1]){var o,r;if(x[1]==0){if(k>1&&!isNaN(y[k-1][3])&&!isNaN(y[k-2][3])){o=(y[k-1][3]<y[k-2][3]?y[k-1][3]:y[k-2][3]);if(g>o){g=o}}}else{if(k>1&&!isNaN(y[k-1][2])&&!isNaN(y[k-2][2])){r=(y[k-1][2]>y[k-2][2]?y[k-1][2]:y[k-2][2]);if(g<r){g=r}}}}else{g=h}m[k-1]=[k-1,g,y[k-1][1],y[k-1][y[k-1].length-1]];if(x[1]==1){if(y[k][3]<h){h=y[k][3];if(t+0.02<=f){t=t+0.02}}}else{if(y[k][2]>h){h=y[k][2];if(t+0.02<=f){t=t+0.02}}}if((x[1]==0&&g>y[k][3])||(x[1]==1&&g<y[k][2])){t=e;if(q==0){q=1}else{q=0}}l=g;x[0]=x[1];x[1]=q}return m},calculateDmi:function(E,r,h){if(E==null||!E.length){return[[],[],[]]}var q=[],B=[],o=dm2=0,x=14,f=2/(x+1),e=t2=0,z=0,D=s2=s3=0,A=[],u=[],d=[],w=0,a=di2=0,l=[],m=0,v=[],C=0;o[0]=dm2[0]=z[0]=0,B[0]=0;var y=[],t=[],s=[];y[0]=t[0]=s[0]=[0,NaN,E[0][E[0].length-1]];for(var g=1;g<E.length;g++){y[g]=[g,NaN,E[g][E[g].length-1]];t[g]=[g,NaN,E[g][E[g].length-1]];s[g]=[g,NaN,E[g][E[g].length-1]];e=E[g][2]-E[g-1][2];t2=E[g-1][3]-E[g][3];if(e>t2){if(e>0){o=e}else{o=0}dm2=0}else{if(e<t2){if(t2>0){dm2=t2}else{dm2=0}o=0}else{o=dm2=0}}z=Math.max(Math.abs(E[g][2]-E[g][3]),Math.max(Math.abs(E[g][2]-E[g-1][1]),Math.abs(E[g][3]-E[g-1][1])));if(isNaN(o)){o=0}if(isNaN(dm2)){dm2=0}if(isNaN(z)){z=0}if(g<x){D+=o;s2+=dm2;s3+=z}if(g==(x-1)){A[g]=D/x;u[g]=s2/x;d[g]=s3/x;y[g][1]=100*A[g]/d[g];t[g][1]=100*u[g]/d[g]}if(g>=x){A[g]=o*f+(1-f)*A[g-1];u[g]=dm2*f+(1-f)*u[g-1];d[g]=z*f+(1-f)*d[g-1];a=A[g]/d[g];di2=u[g]/d[g];l[g]=100*Math.abs(a-di2)/(a+di2);y[g][1]=a*100;t[g][1]=di2*100}if(g>=x&&g<2*x){if(!isNaN(l[g])){m+=l[g]}}if(g==(2*x-1)){v[g]=m/x;s[g][1]=v[g]}if(g>=2*x&&!isNaN(l[g])){v[g]=l[g]*f+(1-f)*(isNaN(v[g-1])?0:v[g-1]);s[g][1]=v[g]}if(isNaN(E[g][1])){y[g][1]=NaN;t[g][1]=NaN;s[g][1]=NaN}}return[y,t,s]},calculatePriceChannel:function(g,r,m){if(isNaN(m)||m<2||m>250||g==null||g.length<m){return[[],[]]}var o=[],l=[],d=g[0][2],a=g[0][3],p=imin=0;o.push([0,NaN,NaN,g[0][g[0].length-1]]);l.push([0,NaN,NaN,g[0][g[0].length-1]]);for(var q=1;q<g.length;q++){if(d<=g[q][2]){d=g[q][2];p=q}if(a>=g[q][3]){a=g[q][3];imin=q}if((q-m)==p){d=0;var f=p+1,e=p+m+1;for(var h=f;h<e;h++){if(d<=g[h][2]){d=g[h][2];p=h}}}if((q-m)==imin){var f=imin+2,e=imin+m+1;a=g[f-1][3];imin=f-1;for(var h=f;h<e;h++){if(a>=g[h][3]){a=g[h][3];imin=h}}}if(q>m-2){o.push([q,d,g[q][1],g[q][g[q].length-1]]);l.push([q,a,g[q][1],g[q][g[q].length-1]])}else{o.push([q,NaN,NaN,g[q][g[q].length-1]]);l.push([q,NaN,NaN,g[q][g[q].length-1]])}if(isNaN(g[q][1])&&typeof(o[q])!="undefined"&&typeof(l[q])!="undefined"){o[q]=[q,NaN,NaN,g[q][g[q].length-1]];l[q]=[q,NaN,NaN,g[q][g[q].length-1]]}}return[o,l]},calculateMAEnvelope:function(k,u,p,e){if(isNaN(p)||isNaN(e)||p<0||p>250||k==null||k.length<p){return[[],[]]}var q=[],o=[],s=[],v=0,r=0,g=0,l=0,h=0,f=null,t=null;for(var a=0;a<k.length;a++){f=k[a][1];t=k[a][1];if(!isNaN(k[a][1])){v+=k[a][1];r++}if(a<p){if(a==(p-1)){s=[a,v/p,k[a][k[a].length-1]];g=r>0?v/r:NaN;l=g*(100+e)/100;h=g*(100-e)/100}else{s=[a,NaN,k[a][k[a].length-1]];l=h=NaN}}else{if(!isNaN(k[a-p][1])){v-=k[a-p][1];r--}g=r>0?v/r:NaN;l=g*(100+e)/100;h=g*(100-e)/100}if(isNaN(l)){f=NaN}if(isNaN(h)){t=NaN}if(f=="NaN"){f=NaN}if(t=="NaN"){t=NaN}q.push([a,l,f,k[a][k[a].length-1]]);o.push([a,h,t,k[a][k[a].length-1]])}return[q,o]},calculateMomentum:function(g,a,d){if(isNaN(d)||d<1||d>199||g==null||g.length<d){return[]}var f=[];for(var e=0;e<g.length;e++){f.push((e<d?[e,NaN,g[e][g[e].length-1]]:[e,(g[e][1]-g[e-d][1]),g[e][g[e].length-1]]))}return f},calculateUlt:function(h,u,o){if(h==null){return[]}var s=[],v=[],t=[],w=0,q=[],l=0,f=0,r=0,m=0,e=0,g=0,p=0;for(var a=0;a<h.length;a++){w=h[a];if(a==0){v[a]=w[1]-w[3];t[a]=w[2]-w[3]}else{g=w[1]-Math.min(w[3],h[a-1][1]);p=Math.max(w[2],h[a-1][1])-Math.min(w[3],h[a-1][1]);if(isNaN(g)){v[a]=v[a-1]}else{v[a]=g}if(isNaN(p)){t[a]=t[a-1]}else{t[a]=p}}if(isNaN(v[a])){v[a]=0}if(isNaN(t[a])){t[a]=0}if(a<28){f+=v[a];r+=t[a];if(a==(l+6)){q[l]=[];q[l][0]=[f,r]}if(a==(l+13)){q[l][1]=[f,r]}if(a==(l+27)){q[l][2]=[f,r]}}if(a>=27){if(l>0){m=q[l-1];q[l]=[];q[l][0]=[m[0][0]-v[a-28]+v[a-21],m[0][1]-t[a-28]+t[a-21]];q[l][1]=[m[1][0]-v[a-28]+v[a-14],m[1][1]-t[a-28]+t[a-14]];q[l][2]=[m[2][0]-v[a-28]+v[a],m[2][1]-t[a-28]+t[a]]}e=100*(4*q[l][0][0]/q[l][0][1]+2*q[l][1][0]/q[l][1][1]+q[l][2][0]/q[l][2][1])/7;s.push([a,e,h[a][h[a].length-1]]);l++}else{s.push([a,NaN,h[a][h[a].length-1]])}if(isNaN(h[a][1])&&typeof(s[a][1])!="undefined"){s[a][1]=NaN}}return s},calculateMFI:function(e,q,p,g){if(!q){return[]}if(isNaN(g)||g<1||g>99){return[]}var m=e.length;var l=[],o=[],d=0,k=0,a=[],f;for(var h=0;h<m;h++){if(isNaN(q[h][1])){q[h][1]=0}f=[h,NaN,e[h][e[h].length-1]];if(e[h][1]==0){o[h]=0}else{l[h]=(e[h][1]+e[h][2]+e[h][3])/3;if(h>0){if(isNaN(l[h])){o[h-1]=0}else{o[h-1]=l[h]>l[h-1]?1:(l[h]==l[h-1]?0:-1)}if(o[h-1]>0){d+=l[h]*q[h][1]}else{if(o[h-1]<0){k+=l[h]*q[h][1]}}if(h>=g){if(h>g){if(o[h-g-1]>0){d-=l[h-g]*q[h-g][1]}else{if(o[h-g-1]<0){k-=l[h-g]*q[h-g][1]}}}if(!isNaN(e[h][1])){f[1]=100*d/(d+k)}}}}a.push(f)}return a},calculateVolumeAcc:function(a,l,k,e){var g=a.length;var h=[],f=[];if(!l){return f}for(var d=0;d<g;d++){if(isNaN(l[d][1])){l[d][1]=0}if(a[d][1]==undefined||a[d][1]==null||isNaN(a[d][1])||a[d][1]==0){h[d]=NaN}else{h[d]=l[d][1]*(a[d][1]-(a[d][2]+a[d][3])/2)}f.push([d,h[d],a[d][a[d].length-1]])}return f},calculateObv:function(a,l,k,e){var h=a.length;var d=[],g=[];for(var f=0;f<h;f++){if(isNaN(l[f][1])){l[f][1]=0}if(f==0){d[f]=l[0][1]}else{if(a[f][1]==undefined||a[f][1]==null||isNaN(a[f][1])||a[f][1]==0){d[f]=NaN}else{if(f>0&&isNaN(a[f-1][1])){d[f]=l[f][1]}else{if(a[f][1]>a[f-1][1]){d[f]=d[f-1]+l[f][1]}else{if(a[f][1]==a[f-1][1]){d[f]=d[f-1]}else{if(a[f][1]<a[f-1][1]){d[f]=d[f-1]-l[f][1]}}}}}}g.push([f,d[f],a[f][a[f].length-1]])}return g},calculateUpDownRatio:function(g,t,s,p,l){if(isNaN(l)||l<1||l>99||isNaN(p)||p<1||p>99){return[]}var r=g.length;var q=[],f=[],h=sdown=0,k=[];for(var o=1,a=0;o<r;o++,a++){if(isNaN(t[o][1])){t[o][1]=0}if(g[o][1]==undefined||g[o][1]==null||isNaN(g[o][1])||g[o][1]==0){f[o-1]=0}else{if(g[o][1]>g[o-1][1]){f[o-1]=1}else{if(g[o][1]<g[o-1][1]){f[o-1]=-1}else{if(g[o][1]==g[o-1][1]){f[o-1]=2}else{f[o-1]=0}}}}if(f[a]==1){h+=t[a+1][1]}else{if(f[a]==-1){sdown+=t[a+1][1]}else{if(f[a]==2){sdown+=t[a+1][1]/2;h+=t[a+1][1]/2}}}if(a<p-1){k[a]=-1;continue}if(a>=p){if(f[a-p]==1){h-=t[a-p+1][1]}else{if(f[a-p]==-1){sdown-=t[a-p+1][1]}else{if(f[a-p]==2){sdown-=t[a-p+1][1]/2;h-=t[a-p+1][1]/2}}}}k[a]=[h,sdown]}var d=p+l,u=0,e=[];q.push([0,NaN,g[0][g[0].length-1]]);for(var o=0;o<k.length;o++){if(k[o]==-1){q.push([o+1,NaN,g[o][g[o].length-1]]);continue}if(k[o][1]<1e-08){e[o]=0}else{e[o]=k[o][0]/k[o][1]}u+=e[o];if(o<d-2){q.push([o+1,NaN,g[o][g[o].length-1]])}else{if(o>d-2){u-=e[o-l]}if(isNaN(g[o][1])){q.push([o+1,NaN,g[o+1][g[o+1].length-1]])}else{q.push([o+1,u/5,g[o+1][g[o+1].length-1]])}}}return q},calculateVolPlus:function(a,l,k,e){if(isNaN(e)||l==null||l.length<e){return[]}var g=[],h=[],d=0;for(var f=0;f<l.length;f++){if(isNaN(l[f][1])){l[f][1]=0}d+=l[f][1];if(f<e){if(f==(e-1)){h=[f,d/e,a[f][a[f].length-1]]}else{h=[f,NaN,a[f][a[f].length-1]]}}else{d-=l[f-e][1];h=[f,d/e,a[f][a[f].length-1]]}g.push(h)}return g},calculateVolByPrice:function(h,s,r,m){if(h==null||s==null){return[]}var p=h.length,q=[],o=[],a=Number.MAX_VALUE,e=Number.MIN_VALUE;for(var l=0;l<p;l++){if(!isNaN(h[l][1])){e=Math.max(e,h[l][1]);a=Math.min(a,h[l][1])}}var f=(e-a)/14;for(var l=0;l<14;l++){if(l==0){o.push([a,(a+f),0])}else{o.push([o[l-1][1],(o[l-1][1]+f),0])}}var t=0;for(var l=0;l<h.length;l++){if(isNaN(s[l][1])){s[l][1]=0}t=h[l][1];if(t<o[0][1]){o[0][2]+=s[l][1]}else{if(t<o[1][1]){o[1][2]+=s[l][1]}else{if(t<o[2][1]){o[2][2]+=s[l][1]}else{if(t<o[3][1]){o[3][2]+=s[l][1]}else{if(t<o[4][1]){o[4][2]+=s[l][1]}else{if(t<o[5][1]){o[5][2]+=s[l][1]}else{if(t<o[6][1]){o[6][2]+=s[l][1]}else{if(t<o[7][1]){o[7][2]+=s[l][1]}else{if(t<o[8][1]){o[8][2]+=s[l][1]}else{if(t<o[9][1]){o[9][2]+=s[l][1]}else{if(t<o[10][1]){o[10][2]+=s[l][1]}else{if(t<o[11][1]){o[11][2]+=s[l][1]}else{if(t<o[12][1]){o[12][2]+=s[l][1]}else{if(t<o[13][1]){o[13][2]+=s[l][1]}}}}}}}}}}}}}}}var k=o[0][2];for(var l=1;l<14;l++){k=Math.max(k,o[l][2])}var g=[o,[a,e],k];return g},calculateDividendYield:function(g,h,r){var s=h.length,q=g.length,o=[],m={},l={},e=0,f;for(var k=0;k<s;k++){if(h[k].Type!=1){continue}f=RTQ_ChartUtil.toDateFromIndex(h[k].DateIndex);e=f.getFullYear();m[e+""]=parseFloat(h[k].Desc);if(!l[e+""]){l[e+""]=1}else{l[e+""]++}}var p=0,n,a=!isNaN(r);if(a){n=100*m[e+""]*l[e+""]}for(var k=0;k<q;k++){var d=[k,NaN,g[k][g[k].length-1]];if(!isNaN(g[k][1])){if(!a){p=RTQ_ChartUtil.toDateFromIndex(g[k][g[k].length-1]).getFullYear();n=100*m[p+""]*l[p+""]}d[1]=n/g[k][1]}o.push(d)}return o},calculateFVolatility:function(f,n){if(!f||!f.length){return[]}var m,e,a,h=0,d=[],g=2/(21+1);for(var l=0;l<f.length;l++){d[l]=[f[l][0],NaN,f[l][f[l].length-1]];if(f[l].length<4||isNaN(f[l][1])||isNaN(f[l][2])||isNaN(f[l][3])){continue}e=f[l][3],a=f[l][2];if(l>0){if(f[l-1][1]<f[l][3]){e=f[l-1][1]}if(f[l-1][1]>f[l][2]){a=f[l-1][1]}}m=(a-e)/e;if(l<21){h+=m}else{if(l==21){d[l][1]=h/21}else{d[l][1]=g*d[l-1][1]+(1-g)*m}}}return d},calculateVolatility:function(f,m,d,g){if(!f||f.length==0){return[]}var a=[];var l=[],h=0;for(var k=0;k<f.length;k++){l.push(f[k][2]-f[k][3])}var e=this.EMA(l,d);for(var k=0;k<f.length;k++){if(k<(d+g-1)){a.push([k,NaN,f[k][f[k].length-1]])}else{h=(e[k]/e[k-g]-1)*100;a.push([k,h,f[k][f[k].length-1]])}}return a},calculateMass:function(g,n){if(!g||!g.length){return[]}var l=[],m=NaN,k=0;var f=[];for(var h=0;h<g.length;h++){f.push(g[h][2]-g[h][3])}var d=this.EMA(f,9);var e=this.EMA(d,9);var o=0,a=[];for(var h=0;h<e.length;h++){if(h<16){l.push([h,NaN,g[h][g[h].length-1]]);continue}a[h]=d[h]/e[h];if(!isNaN(a[h])){o+=a[h]}if(h<40){l.push([h,NaN,g[h][g[h].length-1]]);continue}if(h>40){if(!isNaN(a[h-25])){o-=a[h-25]}}l.push([h,o,g[h][g[h].length-1]])}return l},calculateAccDis:function(k,d,a){if(!k||!k.length||d.lenght==0){return[]}var g=[],h=NaN,f=0;for(var e=0;e<k.length;e++){f=(2*k[e][1]-k[e][2]-k[e][3])*d[e][1]/(k[e][2]-k[e][3])+(isNaN(h)?0:h);g[e]=[e,f,k[e][k[e].length-1]];if(!isNaN(f)){h=f}}return g},calculateWMA:function(g,n,d){if(!g||!g.length){return[]}if(typeof(d)=="undefined"||d<1){d=15}var k=d*(d+1)/2,l=[],a=0,f=0,h;for(var m=0;m<g.length;m++){a=0;if(m<d-1||isNaN(g[m][1])){l[m]=[m,NaN,g[m][g[m].length-1]]}else{h=k;f=1;for(var e=m-d+1;e<=m;e++,f++){if(isNaN(g[e][1])){h-=f}else{a+=g[e][1]*f}}l[m]=[m,a/h,g[m][g[m].length-1]]}}return l},calculateKeltner:function(m,r,d,k,q){if(!m||!m.length){return[]}var p=[],h=[],s=[],l=[],g=[],o=[],f=[];for(var n=0;n<m.length;n++){l.push(m[n][1])}h=this.calculateAtr(m,0,q);s=this.EMA(l,d);for(var n=0;n<m.length;n++){if(isNaN(s[n])||isNaN(h[n][1])){g.push([n,NaN,NaN,m[n][m[n].length-1]]);o.push([n,NaN,NaN,m[n][m[n].length-1]]);f.push([n,NaN,NaN,m[n][m[n].length-1]])}else{g.push([n,s[n]+2*h[n][1],m[n][1],m[n][m[n].length-1]]);o.push([n,s[n],m[n][1],m[n][m[n].length-1]]);f.push([n,s[n]-2*h[n][1],m[n][1],m[n][m[n].length-1]])}}return[g,o,f]},calculateAtr:function(f,n,e){if(!f||!f.length){return[]}if(typeof(e)=="undefined"){e=14}var k=[],g=0,o=0,m=0,l=b=c=0,d=0;for(var h=0;h<f.length;h++){l=f[h][2]-f[h][3];if(h>0){b=Math.abs(f[h][2]-f[h-1][1]);c=Math.abs(f[h][3]-f[h-1][1])}if(h<e-1){if(h==0&&!isNaN(l)){g++;o+=l}else{if(!isNaN(l)&&!isNaN(b)&&!isNaN(c)){g++;o+=Math.max(Math.max(l,b),c)}}k.push([h,NaN,f[h][f[h].length-1]])}else{if(h==e-1){if(!isNaN(l)&&!isNaN(b)&&!isNaN(c)){g++;o+=Math.max(Math.max(l,b),c)}d=o/g;k.push([h,d,f[h][f[h].length-1]])}else{if(!isNaN(l)&&!isNaN(b)&&!isNaN(c)){d=(d*(e-1)+Math.max(Math.max(l,b),c))/e;k.push([h,d,f[h][f[h].length-1]])}else{k.push([h,NaN,f[h][f[h].length-1]])}}}}return k},calculateForceIndex:function(k,d,a,e){if(!k||!k.length||d.lenght==0){return[]}var h=[],g=[];for(var f=0;f<k.length;f++){if(isNaN(k[f][1])||isNaN(d[f][1])||f==0){g.push(NaN)}else{g.push((k[f][1]-k[f-1][1])*d[f][1])}}g=this.EMA(g,e);for(var f=0;f<g.length;f++){h.push([f,g[f],k[f][k[f].length-1]])}return h}};var techIndicatorCal=new indicatorCalculation();if(typeof(PULL_Path)=="undefined"){PULL_Path="//pullqs.morningstar.com/pullservice/pull/"}var RTQ_ChartDataManager=function(a){this.dataUrls={intraday:"quote.jsp?",historical:"getStockHistoricalData.jsp?",fundamental:"getFundamentalData.jsp?",minutelyIntraday:"getMinutelyIntradayData.jsp?",exportDataToExcel:"exportChartDataToExcel.jsp?",fundHistorical:"getFundChartData.jsp?",pullDelayedData:PULL_Path+"getPullDelayedChartData.jsp?",forex:"getForexHistoricalData.jsp?",drawings:"drawmanager.jsp?"};this.crossDomain=false;this.saveDrawings=false;this.dataDomain="";this.option={cachedLastDays:5,needUpdateIntradyData:false,maximumOfCachedSymblos:30};this._fundamentNameMap={HS0A2:"PE",HS0A5:"PS",HS0A0:"PB",HS0A1:"PC",HS987:"FairValue",STA0C:"SInterest",ST263:"REPS",HS793:"MReturnIndex"};this._fundamentCodeMap={PE:"HS0A2",PS:"HS0A5",PB:"HS0A0",PC:"HS0A1",FairValue:"HS987",Earnings:"QS001",SInterest:"STA0C",REPS:"ST263",MReturnIndex:"HS793"};this.quoteDataMap={};this.registeredCharts={};this.registeredSymbols={};this._currentDate=new Date();this.dates={1:new Date(this._currentDate.getFullYear(),this._currentDate.getMonth(),this._currentDate.getDate()-6),5:new Date(this._currentDate.getFullYear(),this._currentDate.getMonth()-1,this._currentDate.getDate()-2),10:new Date(this._currentDate.getFullYear(),this._currentDate.getMonth()-3,this._currentDate.getDate()-10),d:new Date(this._currentDate.getFullYear()-10,0,1),w:new Date(this._currentDate.getFullYear()-20,0,1),m:new Date(1970,0,1),lastTradeDate:new Date()};this._numberOfCachedSymbol=0;this._hasPopupSessionExpMsg=false;this._cacheMinuteIntradayData={};this._openDelayedPullDataRequest=false;this.sixTelekMap={"238:10:IBOVESPA":true,"237:10:MERVAL":true,"390:10:CO-IGBC":true,"390:10:COLCAP":true,"398:10 E-ISBVL":true};this.XIsubUSExchange=[41,11,9,30,29,33,22,25,56,50,10];this.STsubUSExchange=[25,22,10];this.charts={};this.currencyForUKExchange="GBX"};RTQ_ChartDataManager.prototype={openDelayedPullData:function(){var a=this;this.pullInterval=setInterval(function(){var g=[],b,c=[];for(var e in a.quoteDataMap){var f=a.quoteDataMap[e];if(f.dataType=="D"&&(f.type==1||f.type==10)){b=f.exch+":"+f.type+":"+f.ticker;if(a.sixTelekMap&&a.sixTelekMap[b]){c.push(b)}else{g.push(b)}}}if(g.length){$.getJSON(a.dataUrls.pullDelayedData+"tickers="+g.join("}")+"&sixtelek=0&_t="+new Date().getTime()+"&cb=?",function(h){if(typeof(h)=="undefined"||h.errorcode){return}a.onPullDataArrived(h)})}if(c.length){$.getJSON(a.dataUrls.pullDelayedData+"tickers="+c.join("}")+"&sixtelek=1&_t="+new Date().getTime()+"&cb=?",function(h){if(typeof(h)=="undefined"||h.errorcode){return}a.onPullDataArrived(h)})}},15000)},onPullDataArrived:function(e){var c=e.items,l,b;if(typeof(c)=="undefined"||c==null){return}for(var h=0;h<c.length;h++){var g=c[h].service;if(g=="34"||g=="17"||g=="14"||g=="19"||g=="1"){g="126"}var o=this._getTickerArray(c[h].symbol);l=g+":"+o[1];if(!gData||!gData[l]){continue}b=this.quoteDataMap[gData[l]["performanceId"]];if(!c[h].fields||!c[h].fields.length||!b){continue}var f={},k;for(var n=0;n<c[h].fields.length;n++){var a=c[h].fields[n];if(a.name=="Time"){f.Time={value:parseInt(a.value),type:"i"}}else{if(a.name=="LastPrice"){f.LastPrice={value:parseFloat(a.value),type:"f"}}else{if(a.name=="Volume"){f.Volume={value:parseFloat(a.value),type:"i"}}else{if(a.name=="TradeDate"){f.TradeDate={value:a.value,type:"s"}}else{if(a.name=="Date"){k=RTQ_ChartUtil.convertToDate(a.value)}}}}}}var m=b.lastTradeDate;if(RTQ_ChartUtil.compareDateByday(k,m)||(typeof(m)!="undefined"&&typeof(k)!="undefined"&&k.getTime()>m.getTime())){this.updateData(l,f)}}},stopPull:function(){if(this.pullInterval){clearInterval(this.pullInterval)}},registerSymbol:function(e){if((e.type==1||e.type==10)&&(!e.performanceId||!e.tenforeTicker||!e.tenforeCode)){return false}var a=this._getSecurityType(e.tenforeCode,e.type,e.mType);var c=e.performanceId;if(a==8){c=e.secId}if(!this.quoteDataMap[c]){this.quoteDataMap[c]=new quoteData(e.performanceId);this.quoteDataMap[c].ticker=e.tenforeTicker||e.ticker;this.quoteDataMap[c].mTicker=e.ticker;this.quoteDataMap[c].clientTicker=e.clientTicker;this.quoteDataMap[c].subExch=e.tenforeCode;this.quoteDataMap[c].exch=e.gkey?e.gkey.split(":")[0]:e.tenforeCode;this.quoteDataMap[c].type=e.type;this.quoteDataMap[c].country=e.country;this.quoteDataMap[c].mType=e.mType;this.quoteDataMap[c].performanceId=e.performanceId;this.quoteDataMap[c].secId=e.secId;if(e.gkey){this.quoteDataMap[c].gkey=e.gkey}if(a==1||a==10||a==2){this.quoteDataMap[c].dataType=this._getIntradayType(this.quoteDataMap[e.performanceId].exch,e.type,this.quoteDataMap[c].ticker)}else{this.quoteDataMap[c].dataType="D"}if(a==8){this.quoteDataMap[c].InitialDate=e.InitialDate;this.quoteDataMap[c].IMA_RDate=e.IMA_RDate;this.quoteDataMap[c].MStar_RDate=e.MStar_RDate}this.registeredSymbols[c]=1;this._numberOfCachedSymbol++;if((a==1||a==10||a==2)&&this.option.needUpdateIntradyData){var b=this;setTimeout(function(){b.getIntradayData([{symbol:e.performanceId,days:5,datapoints:{p:"price",v:true}}],1,null,null,null)},1000)}}else{this.registeredSymbols[c]++}},unregisterSymbol:function(a){if(this.registeredSymbols[a]){this.registeredSymbols[a]--;if(this.registeredSymbols[a]<1){delete this.registeredCharts[a]}if(this._numberOfCachedSymbol>this.option.maximumOfCachedSymblos){for(var b in this.quoteDataMap){if(this.registeredSymbols[a]<1){delete this.quoteDataMap[a];delete this.registeredSymbols[a];this._numberOfCachedSymbol--}}}}},subscribeChart:function(a){this.charts[a.id]=a},unsubscribeChart:function(a){delete this.charts[a.id]},registerChart:function(c,a){if(!this.registeredCharts[c]){this.registeredCharts[c]=[a]}else{var e=this.registeredCharts[c];var f=true;for(var b=0;b<e.length;b++){if(e[b]==a){f=false;break}}if(f){this.registeredCharts[c].push(a)}}},unregisterChart:function(c,a){if(!this.registeredCharts[c]){return}else{var e=this.registeredCharts[c];for(var b=0;b<e.length;b++){if(e[b]==a){e.splice(b,1);break}}}},removeAllDrawings:function(){for(var a in this.quoteDataMap){this.quoteDataMap[a].removeAllDrawings()}},updateData:function(h,e){var g=null,b,a=null;if(typeof(gData)=="object"&&gData!=null&&gData[h]!=null){var c=gData[h];b=gData[h]["performanceId"];if(this.quoteDataMap[b]){a=this.quoteDataMap[b].intradayData[1];g=e.Time?Math.floor(e.Time.value/60):(gData[h]["TradeTime"]!=null?Math.floor(gData[h]["TradeTime"]/60):(gData[h]["Time"]!=null?Math.floor(gData[h]["Time"]/60):null))}}else{for(var f in this.quoteDataMap){if(this.quoteDataMap[f].gkey==h){a=this.quoteDataMap[f].intradayData[1];b=f;g=e.Time.value;break}}}if(a==null){return}if(e.LastPrice!=null&&g!=null){this._cacheIntradayDatapoint(e.LastPrice.value,g,a.cachedPriceData,a,b,"p")}if(e.Volume!=null&&g!=null){this._cacheIntradayDatapoint(e.Volume.value,g,a.cachedVolumData,a,b,"v")}if(e.TradeDate!=null&&g!=null){if(GB_ChartDataManager){GB_ChartDataManager._refreshChartLastTradeDate(b,RTQ_ChartUtil.convertToDate(e.TradeDate.value),null,g)}}},_cacheIntradayDatapoint:function(h,b,f,o,k,n){if(b<o.openTime||b>o.closeTime){return}var g=this.crossDomain?$.getJSON:$.get;var i=this.crossDomain?"&jsoncallback=?":"";if(f!=null&&f.length>0){var c=f[f.length-1];if(c!=null&&c[1]>=o.openTime&&c[1]!=b){var a=o.openTime;var e=b-a,m=c[1]-a;if(o!=null&&o.data.length){if(typeof(o.isUp)=="undefined"){o.isUp=0}if(n=="p"){o.isUp=m<=0?0:(f[f.length-1][0]>o.data[0].price[m-1][1]?1:0);o.data[0].price[m]=[m,f[f.length-1][0],o.highPriceByMinitue,o.lowPriceByMinitue,f[0][0],o.isUp,f[f.length-1][1]];o.cachedPriceData=[];o.lowPriceByMinitue=NaN;o.highPriceByMinitue=NaN;this._updateDailyTTM(k,"p",o.data[0].price[m]);this._refreshChart(k,"p")}else{if(n=="v"){o.data[0].accVolume[m]=[m,this._fiterAccvolume(f),o.isUp,f[f.length-1][1]];o.cachedVolumData=[];this._updateDailyTTM(k,"v",o.data[0].accVolume[m]);this._refreshChart(k,"v")}}}}}if(n=="p"){if(o.cachedPriceData==null){o.cachedPriceData=[]}var l=o.cachedPriceData.length;if(l>0&&o.cachedPriceData[l-1][0]==h&&o.cachedPriceData[l-1][1]==b){return false}o.cachedPriceData.push([h,b]);if(!o.lowPriceByMinitue||isNaN(o.lowPriceByMinitue)||o.lowPriceByMinitue>h){o.lowPriceByMinitue=h}if(!o.highPriceByMinitue||isNaN(o.highPriceByMinitue)||o.highPriceByMinitue<h){o.highPriceByMinitue=h}}else{if(n=="v"){if(o.cachedVolumData==null){o.cachedVolumData=[]}var l=o.cachedVolumData.length;if(l>0&&o.cachedVolumData[l-1][0]==h&&o.cachedVolumData[l-1][1]==b){return false}o.cachedVolumData.push([h,b])}}},_fiterAccvolume:function(e){var b=0,c=0;for(var a=0;a<e.length;a++){if(e[a][0]>b){c=a;b=e[a][0]}}return e.length>0?e[c][0]:NaN},_updateDailyTTM:function(f,k,c){var b=this.quoteDataMap[f];if(!b){return}var g=b.dailyData.ttm,e=b.dailyData;if(!g){return}var h=e.priceData.length;var a=b.type==1&&(b.exch==151||b.exch=="152")&&GB_ChartDataManager.currencyForUKExchange=="GBP";var i=a?0.01:1;if(k=="p"){if(!isNaN(c[2])&&c[2]*i>g.price[1]){g.price[1]=c[2]*i;if(e.ready){e.priceData[h-1][2]=c[2]}}if(!isNaN(c[3])&&c[3]*i<g.price[2]){g.price[2]=c[3]*i;if(e.ready){e.priceData[h-1][3]=c[3]*i}}if(!isNaN(c[1])){g.price[0]=c[1]*i;if(e.ready){e.priceData[h-1][1]=c[1]*i}}}else{if(k=="v"){if(c[1]>0){g.vol=c[1];if(e.ready){e.volumeData[e.volumeData.length-1][1]=c[1]/1000000}}}}},_refreshChart:function(c,a){var e=this.registeredCharts[c];if(!e||!e.length){return}var f;for(var b=0;b<e.length;b++){f=(typeof(push)!="undefined"&&typeof(push.proxy)=="object")?push.proxy.getChart(e[b]):this.charts[e[b]];if(typeof(f)=="object"&&typeof(f.refreshIntradayChart)=="function"){f.refreshIntradayChart(a)}}},_isSameDay:function(a,b){return(a.getFullYear()==b.getFullYear()&&a.getMonth()==b.getMonth()&&a.getDate()==b.getDate())},_getDataExch:function(a){if(a.type==10){return $.inArray(parseInt(a.subExch,10),this.XIsubUSExchange)>-1?a.subExch:a.exch}else{if(a.type==1){var b=parseInt(a.subExch,10);if(b==511){return 22}else{return $.inArray(parseInt(a.subExch,10),this.STsubUSExchange)>-1?a.subExch:a.exch}}else{return a.exch}}},_refreshChartLastTradeDate:function(h,n,a,c){var b=this.quoteDataMap[h];if(b&&n){if(!b.lastTradeDate){b.lastTradeDate=n}else{if(!this._isSameDay(b.lastTradeDate,n)&&b.lastTradeDate.getTime()<n.getTime()){b.lastTradeDate=n}}var m=b.intradayData[1]&&typeof(b.intradayData[1].openTime)!="undefined"?b.intradayData[1].openTime:1440;var k=b.intradayData[1]&&typeof(b.intradayData[1].closeTime)!="undefined"?b.intradayData[1].closeTime:0;if(!b.refreshing&&b.intradayData&&typeof(b.intradayData.lastTradeDate)!="undefined"&&typeof(b.lastTradeDate)!="undefined"&&!this._isSameDay(b.lastTradeDate,b.intradayData.lastTradeDate)&&c>=m&&c<k&&b.lastTradeDate.getTime()>b.intradayData.lastTradeDate.getTime()){var l=this;b.refreshing=true;setTimeout(function(){var i=l.crossDomain?"&jsoncallback=?":"";var p=l.dataDomain+l.dataUrls.intraday+"ty="+b.dataType+"&exch="+l._getDataExch(b)+"&ticker="+b.ticker+(b.exch=="126"&&b.type==10?("_"+b.subExch):"")+"&stype="+b.type+"&days="+l.option.cachedLastDays+"&_t="+new Date().getTime()+i;var o=l.crossDomain?$.getJSON:$.get;o(p,function(u){var s=l.crossDomain?u:$.evalJSON(u);var r=s==null?null:s.data;if(l._checkData(r)){if($.inArray(parseInt(s.exchangeId,10),l.XIsubUSExchange)>-1&&s.security==10){s.exchangeId="126"}var q=(s.exchangeId==126&&s.security==10)?l._getTickerArray(s.symbol)[0]:s.symbol;var t=l._getQuoteDataByExchAndTicker(s.exchangeId,q,s.security);if(t!=null){t.saveIntradayData(r,1);l._refreshChart(h,"p");t.refreshing=false}}b.refreshing=false})},60000)}}var g=this.registeredCharts[h];if(!g||!g.length){return}var f;for(var e=0;e<g.length;e++){f=(typeof(push)!="undefined"&&typeof(push.proxy)=="object")?push.proxy.getChart(g[e]):this.charts[g[e]];if(f&&typeof(f.refreshLastTradeDate)=="function"&&n!=null){f.refreshLastTradeDate(a,n)}}},_getIntradayType:function(c,a,b){var e="D";if(typeof(QS_Permission)!="undefined"&&QS_Permission.getSubcodes(a,c,b,"R",false).length>0){e="R"}return e},_getSecurityType:function(c,a,b){var e=a;if(a==8){if(c==127&&(typeof(b)=="string"&&b.toUpperCase()=="ST"||b.toUpperCase()=="FC")){e=1}}return e},_checkDataReady:function(f,l){var e=[],k=[],c=[],b,a,h=false;for(var g=0;g<f.length;g++){b=f[g].datapoints,a=f[g].symbol;if((b.p||b.v||b.isD||b.isS)&&(!this.quoteDataMap[a]||!this.quoteDataMap[a].getDataByType(l).ready)){k.push(a)}if((b.postTax)&&(!this.quoteDataMap[a]||!this.quoteDataMap[a].getDataByType(l).pTaxReady)){e.push(a)}if(b.e&&(!this.quoteDataMap[a]||!this.quoteDataMap[a].earningsData.ready)){c.push(a)}}h=!(k.length||e.length||c.length);return{ready:h,pSymbols:k,pTaxSymbols:e,eSymbols:c}},_checkDividendDataReady:function(b){var c=true;for(var a=0;a<b.length;a++){if(!this.quoteDataMap[b[a]]||!this.quoteDataMap[b[a]].dividendAndSplitData.ready){c=false}}return c},_checkFundamentDataReady:function(c,h,a){var g={ready:true,fields:[]},f,b;for(var e=0;e<h.length;e++){f=this.quoteDataMap[c],b=f.getDataByType(a);if(!f||!b||!b.fundamentalData[h[e]]||!b.fundamentalData[h[e]].length){g.ready=false;g.fields.push(this._fundamentCodeMap[h[e]])}}return g},_getQuoteDataByExchAndTicker:function(f,a,c){var e={};for(var b in this.quoteDataMap){e=this.quoteDataMap[b];if((c==10||e.exch==f)&&e.ticker==a){return e}if(e.ticker==a&&c==1){if((e.exch==511&&f==22)||e.subExch==f){return e}}}return null},_getIntradayDataBySymbols:function(g,i,e,n,s){var u=[],b;for(var f=0;f<g.length;f++){b=this.quoteDataMap[g[f].symbol];u[f]={symbol:g[f].symbol};if(b!=null){var v=g[f].datapoints;for(var l in v){if((l=="p"||l=="postTax")&&v[l]){if(l=="postTax"){u[f].price={data:[],pos:null}}else{u[f].price=b.intradayData[e].getPriceData(g[f].datapoints[l],g[f].days,n,s,i);if(u[f].price!=null){u[f].price.lastTradeDate=b.intradayData.lastTradeDate||b.lastTradeDate}}}else{if(l=="v"&&v[l]){u[f].volume=b.intradayData[e].getVolumeData(g[f].days,n,s,i)}else{if(l=="indicators"){var a=g[f].datapoints[l];u[f].indicators={};var h,m,c;for(var t=0;t<a.length;t++){h=a[t].name,m=a[t].p,c=a[t].vtype;if(h=="EMA"||h=="SMA"){if(!u[f].indicators[h]){u[f].indicators[h]={}}u[f].indicators[h][m[0]]=b.getIndicatorDataSegment(h,e,m,n,s,g[f].days,c,u[f].price,i)}else{if(h=="VBP"){var p,r;if(!u[f].price){p=b.intradayData[e].getPriceData(g[f].datapoints[l],g[f].days,n,s,i).data}else{p=u[f].price.data}if(!u[f].volume){r=b.intradayData[e].getVolumeData(g[f].days,n,s,i).data}else{r=u[f].volume.data}u[f].indicators[h]={data:techIndicatorCal.calculateVolByPrice(p,r,i,1),spos:null}}else{u[f].indicators[h]=b.getIndicatorDataSegment(h,e,m,n,s,g[f].days,c,u[f].price,i)}}}}}}}}}return u},_getHistoricalDataBySymbols:function(f,l,s,w){var z=[],b,t,p=s,v=w;for(var h=0;h<f.length;h++){z[h]={symbol:f[h].symbol};var m=f[h].dx?f[h].dx:1;b=this.quoteDataMap[f[h].symbol];if(b==null){continue}t=b.getDataByType(l);if(t==null){continue}for(var A in f[h].datapoints){if(A=="p"||A=="postTax"){if(h==0){z[h].price=t.getDataSegment(p,v,false,A,m,f[h].datapoints[A]);if(z[h].price.data!=null&&z[h].price.data.length>0){p=z[h].price.data[0][z[h].price.data[0].length-1];v=z[h].price.data[z[h].price.data.length-1][z[h].price.data[z[h].price.data.length-1].length-1]}}else{z[h].price=t.getDataSegment(p,v,true,A,m,f[h].datapoints[A],z[0].price.data)}}else{if(A=="v"){z[h].volume=t.getDataSegment(p,v,true,"v",m,"price")}else{if(A=="e"){z[h].earningsData=b.earningsData.getDataSegment(p,v,false,"p",m,"price")}else{if(A=="ds"){var n=f[h].datapoints[A].isD,y=f[h].datapoints[A].isS;z[h].dividendAndSplit=b.dividendAndSplitData.getDividendAndSplitDataSegment(p,v,"p",n,y)}else{if(A=="indicators"){var a=f[h].datapoints[A];z[h].indicators={};var g,r,c;for(var x=0;x<a.length;x++){g=a[x].name,r=a[x].p,c=a[x].vtype;if(g=="EMA"||g=="SMA"){if(!z[h].indicators[g]){z[h].indicators[g]={}}z[h].indicators[g][r[0]]=b.getIndicatorDataSegment(g,l,r,p,v,null,c)}else{if(g=="RDividend"){z[h].indicators[g]=b.getRollDividend(l,p,v)}else{if(g=="VBP"){var u,e;if(!z[h].price){u=t.getDataSegment(p,v,false,"p",m,f[h].datapoints[A]).data}else{u=z[h].price.data}if(!z[h].volume){e=t.getDataSegment(p,v,true,"v",m,"price").data}else{e=z[h].volume.data}z[h].indicators[g]={data:techIndicatorCal.calculateVolByPrice(u,e,l,1),spos:null}}else{z[h].indicators[g]=b.getIndicatorDataSegment(g,l,r,p,v,null,c)}}}}}}}}}}}return z},getChartNoteData:function(c,b,e,a){if(typeof(a)!="undefined"){DBHelper.loadNotesByDate(e,c,b,function(f){a($.evalJSON(f))})}},_getFundamentalDataBySymbols:function(k,g,a,l){var f={symbol:k.symbol},e,m=k.fields;e=this.quoteDataMap[k.symbol];if(e==null){return rD}d=e.getDataByType(g);if(d==null){return rD}for(var h=0;h<m.length;h++){if(d.fundamentalData[m[h]]){var b=m[h]=="MReturnIndex"?"return":"price";var c=null;if(m[h]=="MReturnIndex"){c=d.getDataSegment(a,l,false,"p",1,"price").data;if(a<c[0][c[0].length-1]){a=c[0][c[0].length-1]}if(l>c[c.length-1][c[c.length-1].length-1]){l=c[c.length-1][c[c.length-1].length-1]}}f[m[h]]=d.getDataSegment(a,l,true,m[h],1,b,c)}}return f},_checkData:function(a){if(a=="-2"){if(push&&push.proxy&&Util&&Util.confirm&&!this._hasPopupSessionExpMsg){Util.confirm(TEXT.WSSaveTimeout,function(c){this._hasPopupSessionExpMsg=true;if(c){window.location="logout.jsp?tmpid="+QS_UserTID}},{title:"Timeout"})}return false}else{return true}},_getIntraydaySourceFrequency:function(k,h,e,b){var a=k==null||isNaN(k)?null:RTQ_ChartUtil.toDateFromIndex(k);var c=h==null||isNaN(h)?null:RTQ_ChartUtil.toDateFromIndex(h);var g=this.dates[e],i=NaN;if(b<=5||(a>=this.dates[1])||a==null){i=1}else{if(a>=this.dates[5]&&(e==5||e==15)){i=5}else{if(a>=this.dates[10]&&e>=10){i=10}else{i=NaN}}}if((k==null||h==null)&&e==1440){i=10}return i},_processMinutelyIntradayData:function(K,H,n,S){var O=[];if(n&&n.length){for(var Q=0;Q<n.length;Q++){O[Q]={symbol:K[Q].symbol,price:{data:[],spos:null}};if(Q==0){O[Q].volume={data:[],spos:null}}var z,r,t,f,F=K[Q].datapoints.p?K[Q].datapoints.p:"price",T=null;var m=F.split("_");var B=m[0];var G=m.length>1;var R=0,g=570;for(var w=n[Q].data.length-1;w>=0;w--){var V=n[Q].data[w];z=V.security=="20"?V.bidPrice:V.lastPrice;r=V.volume;fdata=V.fillFlag;t=RTQ_ChartUtil.convertToDate(V.date);T=V.yesterdayClosePrice;g=V.startTime;f=V.timeInterval;var l=Math.floor((V.endTime-V.startTime)/H)+1;var U,a=t.getTime()+g*60000,N=f*60000,o=0,D=0,C=0;var I=G?10000:100,y=G?10000:0;var s=z.length,u=r.length;for(var x=0;x<l;x++){var e=[R];U=a+x*N;if(x<s&&z[x].length){if(T==null||isNaN(T)||T<=0){if(!isNaN(z[x][1])){T=z[x][1]}}o=z[x][1]>D?1:0;if(!isNaN(z[x][1])&&z[x][1]>0){D=z[x][1]}z[x][0]=z[x][0]>0?z[x][0]:NaN;z[x][1]=z[x][1]>0?z[x][1]:NaN;z[x][2]=z[x][2]>0?z[x][2]:NaN;z[x][3]=z[x][3]>0?z[x][3]:NaN;if((B=="return"||B=="return4")&&T>0){e.push(y+I*(z[x][0]-T)/T);if(B=="return4"){e.push(y+I*(z[x][1]-T)/T);e.push(y+I*(z[x][2]-T)/T);e.push(y+I*(z[x][3]-T)/T)}else{e.push(z[x][1]);e.push(z[x][2]);e.push(z[x][3])}}else{e=e.concat(z[x])}e.push(o);if(fdata&&fdata.length>x){e.push(fdata[x])}e.push(U)}else{e=[R,NaN,NaN,NaN,NaN,0,1,U]}O[Q].price.data.push(e);if(Q==0){if(x<u&&r[x]>0){O[Q].volume.data.push([R,(r[x]-C)/1000000,o,U]);if(!isNaN(r[x])&&r[x]>0){C=r[x]}}else{O[Q].volume.data.push([R,0,1,U])}}R++}if(B=="return"||B=="return4"){O[Q].price.spos=T}}}}if(K[0].datapoints.indicators&&K[0].datapoints.indicators.length){var b=K[0].datapoints.indicators;O[0].indicators={};var E,M,v,L=S.quoteDataMap[K[0].symbol];var p=O[0].price.data,c=O[0].volume.data,J=[];for(var x=0;x<b.length;x++){E=b[x].name,M=b[x].p,v=b[x].vtype;if(E=="EMA"||E=="SMA"){if(!O[0].indicators[E]){O[0].indicators[E]={}}O[0].indicators[E][M[0]]={data:L._calculateIndicator(E,p,c,J,"i",M)[0],spos:O[0].price.spos}}else{if(E=="RDividend"){O[0].indicators[E]={data:[],spos:null}}else{var V=L._calculateIndicator(E,p,c,J,"i",M);var A=[];if(V&&V.length>1){for(var P=0;P<V.length;P++){A.push({data:V[P],spos:O[0].price.spos})}}else{if(V&&V.length==1){A={data:V[0],spos:O[0].price.spos}}}O[0].indicators[E]=A}}}}if(typeof(K[0].datapoints.p)=="undefined"&&O.length){delete O[0].price}if(typeof(K[0].datapoints.postTax)!="undefined"&&O.length){O[0].price={data:[],pos:null}}if(typeof(K[0].datapoints.v)=="undefined"&&O.length){delete O[0].volume}return O},_getHistoricalMintelyData:function(m,p,h,o,g){var f=[],k="D";var r=this.crossDomain?$.getJSON:$.get;var c=this.crossDomain?"&jsoncallback=?":"";for(var e=0;e<m.length;e++){var n=this.quoteDataMap[m[e].symbol];if(n!=null){f.push((this._getDataExch(n)+":"+n.ticker+(n.exch=="126"&&n.type==10?("_"+n.subExch):"")+":"+n.type+":"+n.dataType))}if(e==0&&n!=null){k=n.dataType||"D"}}var q=RTQ_ChartUtil.formatDate(RTQ_ChartUtil.toDateFromIndex(h));var u=RTQ_ChartUtil.formatDate(RTQ_ChartUtil.toDateFromIndex(o));var s=h+"_"+o+"_"+p+"_"+f.join("|");var b=h+"_"+o+"_"+p+"_"+f[0];if(this._cacheMinuteIntradayData.key==s||(this._cacheMinuteIntradayData.mainkey==b&&m.length==0)){var l;if(m.length==0){l=this._processMinutelyIntradayData(m,p,[this._cacheMinuteIntradayData.data[0]],this)}else{l=this._processMinutelyIntradayData(m,p,this._cacheMinuteIntradayData.data,this)}if(typeof(g)=="function"){g(l)}}else{if(f.length){var t=this;var a=this.dataDomain+this.dataUrls.minutelyIntraday+"tickers="+f.join("|")+"&st="+q+"&ed="+u+"&f="+p+"&ty="+k+c+"&_t="+new Date().getTime();r(a,function(w){var i=t.crossDomain?w:$.evalJSON(w);t._cacheMinuteIntradayData.data=i.tickers;t._cacheMinuteIntradayData.key=s;t._cacheMinuteIntradayData.mainkey=b;var v=t._processMinutelyIntradayData(m,p,i.tickers,t);if(typeof(g)=="function"){g(v)}})}else{if(typeof(g)=="function"){g({})}}}},getHistoricalData:function(r,k,o,t,n){var C=this.crossDomain?$.getJSON:$.get;var e=this.crossDomain?"&jsoncallback=?":"";if(k=="d"||k=="w"||k=="m"){var H=this;var I=this._checkDataReady(r,k);if(I.ready){var F=H._getHistoricalDataBySymbols(r,k,o,t);if(typeof(n)=="function"){n(F)}}else{if(I.pSymbols.length>0){var w=[],y=[],v=[];for(var f=0;f<I.pSymbols.length;f++){var p=this.quoteDataMap[I.pSymbols[f]];var D=this._getSecurityType(p.subExch,p.type,p.mType);if((p.mType=="FE"&&D==10)||(D==8&&p.mType!="FE")){y.push(p.secId+(p.country?("_"+p.country):""))}else{if(D==20){v.push(I.pSymbols[f])}else{w.push(I.pSymbols[f]+(p.country?("_"+p.country):""))}}}var B=RTQ_ChartUtil.formatDate(this.dates[k]),z=RTQ_ChartUtil.formatDate(this.dates.lastTradeDate);if(w.length){var a=w.join(",");var u=this._checkDividendDataReady(I.pSymbols);var x=u?0:1;var b=this.dataDomain+this.dataUrls.historical+"symbols="+a+"&f="+k+"&isV=1&isD="+x+"&isS="+x+"&st="+B+"&ed="+z+e+"&_t="+new Date().getTime();C(b,function(N){var M=H.crossDomain?N:$.evalJSON(N);var K=M==null?null:M.Data;if(H._checkData(K)){var h,L;for(var O=0;O<K.length;O++){h=K[O].Symbol;L=H.quoteDataMap[h];if(L!=null){L.saveTimeSeriesData(K[O],k)}}var J=H._checkDataReady(r,k);if(J.ready){var P=H._getHistoricalDataBySymbols(r,k,o,t);if(typeof(n)=="function"){n(P)}}}})}if(y.length){var s=y.join(",");var b=this.dataDomain+this.dataUrls.fundHistorical+"symbols="+s+"&f="+k+"&st="+B+"&ed="+z+"&dp=1,1578"+e+"&_t="+new Date().getTime();C(b,function(O){var N=H.crossDomain?O:$.evalJSON(O);var L=N==null?null:N.Data;if(H._checkData(L)){var J,M;for(var P=0;P<L.length;P++){J=L[P].Symbol;if(H.quoteDataMap[J]){M=H.quoteDataMap[J]}else{for(var K in H.quoteDataMap){if(H.quoteDataMap[K].secId==J){M=H.quoteDataMap[K]}}}if(M!=null){M.saveFundData(L[P],k)}}var h=H._checkDataReady(r,k);if(h.ready){var Q=H._getHistoricalDataBySymbols(r,k,o,t);if(typeof(n)=="function"){n(Q)}}}})}if(v.length>0){var a=v.join(",");var b=this.dataDomain+this.dataUrls.forex+"symbols="+a+"&f="+k+"&type=2121&st="+B+"&ed="+z+e+"&_t="+new Date().getTime();C(b,function(N){var M=H.crossDomain?N:$.evalJSON(N);var K=M==null?null:M.Data;if(H._checkData(K)){var h,L;for(var O=0;O<K.length;O++){h=K[O].Symbol;L=H.quoteDataMap[h];if(L!=null){L.saveTimeSeriesData(K[O],k,20)}}var J=H._checkDataReady(r,k);if(J.ready){var P=H._getHistoricalDataBySymbols(r,k,o,t);if(typeof(n)=="function"){n(P)}}}})}}if(I.eSymbols.length>0){var m=RTQ_ChartUtil.formatDate(this.dates.m),q=RTQ_ChartUtil.formatDate(this.dates.lastTradeDate);var A=this._fundamentCodeMap.Earnings;var G=this.quoteDataMap[I.eSymbols[0]];var E=G!=null?G.country:null;var b=this.dataDomain+this.dataUrls.fundamental+"symbols="+I.eSymbols[0]+"&fields="+A+"&f=d&st="+m+"&ed="+q+"&country="+E+e+"&_t="+new Date().getTime();C(b,function(N){var M=H.crossDomain?N:$.evalJSON(N);var h=M==null?null:M.data;if(H._checkData(h)||h==null){if(h==null){var K=H.quoteDataMap[I.eSymbols[0]];if(K){K.earningsData.ready=true}}if(h!=null&&h.length){var i=h[0].symbol,P=h[0].field;var L=H.quoteDataMap[i];L.saveEarningsData(P[0])}var J=H._checkDataReady(r,k);if(J.ready){var O=H._getHistoricalDataBySymbols(r,k,o,t);if(typeof(n)=="function"){n(O)}}}})}if(I.pTaxSymbols.length>0){var B=RTQ_ChartUtil.formatDate(this.dates[k]),z=RTQ_ChartUtil.formatDate(this.dates.lastTradeDate);var c=[];for(var g=0;g<I.pTaxSymbols.length;g++){if(this.quoteDataMap[I.pTaxSymbols[g]]){c.push(this.quoteDataMap[I.pTaxSymbols[g]].secId)}else{c.push(I.pTaxSymbols)}}var l=c.join(",");var b=this.dataDomain+this.dataUrls.fundHistorical+"symbols="+l+"&f="+k+"&st="+B+"&ed="+z+"&dp=15&aj=1"+e+"&_t="+new Date().getTime();C(b,function(O){var N=H.crossDomain?O:$.evalJSON(O);var L=N==null?null:N.Data;if(H._checkData(L)){var J,M;for(var P=0;P<L.length;P++){J=L[P].Symbol;if(H.quoteDataMap[J]){M=H.quoteDataMap[J]}else{for(var K in H.quoteDataMap){if(H.quoteDataMap[K].secId==J&&H.quoteDataMap[K].type!=10){M=H.quoteDataMap[K]}}}if(M!=null){M.saveFundData(L[P],k)}}var h=H._checkDataReady(r,k);if(h.ready){var Q=H._getHistoricalDataBySymbols(r,k,o,t);if(typeof(n)=="function"){n(Q)}}}})}}}else{this._getHistoricalMintelyData(r,k,o,t,n)}},_getTickerArray:function(c){var f=c.split("_"),e=[];if(f.length>3){e.push(f.shift(),"",f.pop());e[1]=f.join("_")}else{e=f}return e},getIntradayData:function(r,m,o,t,n){var z=this.crossDomain?$.getJSON:$.get;var g=this.crossDomain?"&jsoncallback=?":"";var C=this,u=[],p="D",w="";for(var f=0;f<r.length;f++){u.push(r[f].symbol);if(f==0){var s=this.quoteDataMap[r[f].symbol];if(s&&s!=null&&typeof(s.dataType)!="undefined"){p=s.dataType;w=s.type}}}var c=r&&r.length?r[0].days:null;var e=this._getIntraydaySourceFrequency(o,t,m,c);if(isNaN(e)){this._getHistoricalMintelyData(r,m,o,t,n)}else{var D=this._checkDataReady(r,e);if(D.pSymbols.length==0){var A=this._getIntradayDataBySymbols(r,m,e,o,t);if(typeof(n)=="function"){n(A)}}else{if(e==1&&w!="20"){for(var l=0;l<D.pSymbols.length;l++){var s=this.quoteDataMap[D.pSymbols[l]];if(!s){continue}var y=this._getSecurityType(s.subExch,s.type,s.mType);if(y==8&&s.mType!="FE"){s.intradayData[e].ready=true;var B=C._checkDataReady(r,e);if(B.ready){var A=C._getIntradayDataBySymbols(r,m,e,o,t);if(typeof(n)=="function"){n(A)}}continue}var b=this.dataDomain+this.dataUrls.intraday+"ty="+s.dataType+"&exch="+this._getDataExch(s)+"&ticker="+s.ticker+(s.exch=="126"&&s.type==10?("_"+s.subExch):"")+"&stype="+s.type+"&days="+this.option.cachedLastDays+g+"&_t="+new Date().getTime();z(b,function(I){var G=C.crossDomain?I:$.evalJSON(I);var E=G==null?null:G.data;if(C._checkData(E)){if($.inArray(parseInt(G.exchangeId,10),C.XIsubUSExchange)>-1&&G.security==10){G.exchangeId="126"}var h=(G.exchangeId==126&&G.security==10)?C._getTickerArray(G.symbol)[0]:G.symbol;var H=C._getQuoteDataByExchAndTicker(G.exchangeId,h,G.security);if(H!=null){H.saveIntradayData(E,1);var F=C._checkDataReady(r,e);if(F.pSymbols.length==0){var i=C._getIntradayDataBySymbols(r,m,e,o,t);if(typeof(n)=="function"){n(i)}}}}})}}else{var q=RTQ_ChartUtil.formatDate(this.dates[e]),x=RTQ_ChartUtil.formatDate(this.dates.lastTradeDate);var a=[];for(var k=0;k<D.pSymbols.length;k++){var v=this.quoteDataMap[D.pSymbols[k]];var y=this._getSecurityType(v.subExch,v.type,v.mType);if(y==8&&v.mType!="FE"){v.intradayData[e].ready=true;continue}if(v!=null){a.push((this._getDataExch(v)+":"+v.ticker+(v.exch=="126"&&v.type==10?("_"+v.subExch):"")+":"+v.type+":"+v.dataType))}}if(a.length){var b=this.dataDomain+this.dataUrls.minutelyIntraday+"tickers="+a.join("|")+"&st="+q+"&ed="+x+"&f="+e+"&ty="+p+g+"&_t="+new Date().getTime();z(b,function(H){var G=C.crossDomain?H:$.evalJSON(H);var E=G==null?null:G.tickers;if(C._checkData(E)){for(var I=0;I<E.length;I++){var h=E[I].security==10?C._getTickerArray(E[I].symbol)[0]:E[I].symbol;var F=C._getQuoteDataByExchAndTicker(E[I].exchangeId,h,E[I].security);if(F!=null){F.saveIntradayData(E[I].data,e);var i=C._checkDataReady(r,e);if(i.pSymbols.length==0){var J=C._getIntradayDataBySymbols(r,m,e,o,t);if(typeof(n)=="function"){n(J)}}}}}})}else{var B=C._checkDataReady(r,e);if(B.pSymbols.length==0){var A=C._getIntradayDataBySymbols(r,m,e,o,t);if(typeof(n)=="function"){n(A)}}}}}}},getFundamentalData:function(l,e,g,n,f){var s=this.crossDomain?$.getJSON:$.get;var b=this.crossDomain?"&jsoncallback=?":"";var v=this,u=l.symbol,o=l.fields,q;if(e!="d"&&e!="w"&&e!="m"){if(typeof(f)=="function"){var k={};for(var c=0;c<o.length;c++){k[o[c]]={data:[],spos:null}}f(k)}return}var w=this._checkFundamentDataReady(u,o,e);if(w.ready){var t=v._getFundamentalDataBySymbols(l,e,g,n);if(typeof(f)=="function"){f(t)}}else{q=w.fields.join(",");var m=this.quoteDataMap[u],h=m!=null?m.country:null;var r=RTQ_ChartUtil.formatDate(this.dates[e]),p=RTQ_ChartUtil.formatDate(this.dates.lastTradeDate);var a=this.dataDomain+this.dataUrls.fundamental+"symbols="+u+"&fields="+q+"&f="+e+"&st="+r+"&ed="+p+"&country="+h+b+"&_t="+new Date().getTime();s(a,function(E){var D=v.crossDomain?E:$.evalJSON(E);var B=D==null?null:D.data;if(typeof(B)!="undefined"&&B!=null&&v._checkData(B)){var y,C,I,z;for(var F=0;F<B.length;F++){y=B[F].symbol,I=B[F].field;C=v.quoteDataMap[y];if(C!=null){for(var G=0;G<I.length;G++){z=v._fundamentNameMap[I[G].name];C.saveFundamentalData(I[G],e,z)}}}var x=v._checkFundamentDataReady(u,o,e);if(x.ready){var H=v._getFundamentalDataBySymbols(l,e,g,n);if(typeof(f)=="function"){f(H)}}}else{if(typeof(f)=="function"){var A={};for(var F=0;F<o.length;F++){A[o[F]]={data:[],spos:null}}f(A)}}})}},getValuationData:function(e,c,a,h,g){if(c!="d"&&c!="w"&&c!="m"){if(typeof(g)=="function"){g({Valuation:{data:[],spos:null}})}return}var i=function(o,l){var m=[],n;if(o&&l&&o.length&l.length){for(var k=0;k<o.length;k++){n=typeof(l[k])=="undefined"||typeof(o[k])=="undefined"?NaN:l[k][1]/o[k][1];m.push([k,n,o[k][2]])}}return m};var b=null,f=null;this.getFundamentalData({symbol:e,fields:["FairValue"]},c,a,h,function(l){b=l.FairValue.data;if(b&&f){var k=i(b,f);if(typeof(g)=="function"){g({data:k,spos:null})}}});this.getHistoricalData([{symbol:e,datapoints:{p:"price"}}],c,a,h,function(k){f=k[0]["price"].data;if(b&&f){var l=i(b,f);if(typeof(g)=="function"){g({data:l,spos:null})}}})},exportDataToExcel:function(g,m,a,e,h,c){var l=this.dataUrls.exportDataToExcel;if(m==1||m==4||m==5){var b=[];for(var k=0;k<g.length;k++){f=this.quoteDataMap[g[k]];if(f!=null){b.push(f.clientTicker||f.mTicker)}}l+="symbols="+g.join(",")+"&st="+a+"&ed="+e+"&f="+h+"&dty="+m+"&tickers="+encodeURIComponent(b.join(",").replace("/",""))}else{if(m==0||m==2||m==3){var f=null,n=[];for(var k=0;k<g.length;k++){f=this.quoteDataMap[g[k]];if(f!=null){n.push(f.exch+":"+f.ticker+(f.exch=="126"&&f.type==10?("_"+f.subExch):"")+":"+f.type+":"+f.dataType)}}if(m==0){l+="symbols="+n.join("|")+"&days="+c+"&dty="+m}else{l+="symbols="+n.join("|")+"&f="+h+"&st="+a+"&ed="+e+"&dty="+m}}}window.open(l+"&_t="+new Date().getTime())},_buildFundDataUrl:function(c,b,h,g){var k="",f="",e="";var a=this.quoteDataMap[c];if(a==null||a.type!=8){return""}var l=new Date();e=typeof(h)!="undefined"?g:l.getFullYear()+"-"+(l.getMonth()+1)+"-"+l.getDate();if(b=="d"){f=typeof(h)!="undefined"?h:(l.getFullYear()-1)+"-"+(l.getMonth()+1)+"-"+l.getDate()}else{if(b=="m"){f=typeof(h)!="undefined"?h:(l.getFullYear()-20)+"-"+(l.getMonth()+1)+"-"+l.getDate()}}k+=a.secId+":"+a.performanceId+":CU$$$$$USD:1:1:"+a.mType+":"+a.InitialDate+":"+a.IMA_RDate+":"+a.MStar_RDate;var i="http://globalquote.morningstar.com/globalcomponent/GetFundInteractiveData.ashx?chart=quote";i+="&w=955&h=266&lan=en-US&reg=USA&tc=CU$$$$$USD&p=true&d=true&r=false&win=3&period=custom&";i+="range="+f+"|"+e+"&cfg=scal:0|GF:7&ma=&ids="+k+"&format=json";return encodeURIComponent(i)},setData:function(a,g,e,f,b){if(typeof(this.quoteDataMap[a])=="undefined"){this.quoteDataMap[a]=new quoteData(a)}var c=null;if(e=="events"){if(f=="DividendAndSplits"){c=this.quoteDataMap[a].dividendAndSplitData}else{if(f=="Earnings"){c=this.quoteDataMap[a].earningsData}else{this.quoteDataMap[a][f]=new timeSeriesData("d");c=this.quoteDataMap[a][f]}}c.priceData=b}else{if(e=="intraday"){c=this.quoteDataMap[a].intradayData[g];c.data=b;c.frequency=g}else{if(e=="historical"){if(g=="d"){c=this.quoteDataMap[a].dailyData}else{if(g=="w"){c=this.quoteDataMap[a].weeklyData}else{if(g=="m"){c=this.quoteDataMap[a].monthlyData}}}c.frequency=g;if(f=="price"){c.priceData=b}else{if(f=="volume"){c.volumeData=b}else{c.fundamentalData[f]=b}}c.startIndex=b[0][b[0].length-1];c.endIndex=b[b.length-1][b[b.length-1].length-1]}}}if(c!=null){c.symbol=a;c.ready=true}},removeData:function(a){if(typeof(this.quoteDataMap[a])!="undefined"){delete this.quoteDataMap[a]}}};function intrayData(a){this.data=[];this.symbol;this.exch;this.ticker;this.openTime=570;this.closeTime=960;this.cachedPriceData=[];this.cachedVolumData=[];this.ready=false;this.frequency=a}intrayData.prototype={_getIndexs:function(f,g,a,b){if((typeof(g)=="undefined"||g==null)&&a!=null&&b!=null){var k=0,e=0,c=f.length-1,l=true;for(var h=0;h<f.length;h++){k=RTQ_ChartUtil.toDateIndex(f[h].date);if(k<=b&&l){c=h;l=false}if(a<=k){e=h}else{break}}}else{e=g<1?0:g>f.length?(f.length-1):(g-1);c=0}return[e,c]},getPriceData:function(y,F,e,w,a){if(this.data.length<1){return{data:[],spos:null}}var E=[],k=null;if(a==1440){var m=0;var b=e==null?-1:e,B=w==null?100000000:w,u;for(var q=this.data.length-1;q>=0;q--){u=RTQ_ChartUtil.toDateIndex(this.data[q].date);if(u<b||u>B){continue}E.push([m,this.data[q]&&this.data[q].closePrice>0?this.data[q].closePrice:this.data[q].price[this.data[q].price.length-1][1],u]);m++}}else{var H=0,A,M,J;var I=y.split("_");var y=I[0];var v=I.length>1;var z=Math.round(a/this.frequency);var D=this._getIndexs(this.data,F,e,w);for(var q=D[0];q>=D[1];q--){A=this.data[q];M=A.date==null?0:A.date.getTime();J=A.price.length;if(k==null){k=A.yestClosePrice}var t,L,C,p,r=v?10000:100,K=v?10000:0;var x,n;for(var m=0;m<J;m+=z){x=A.price[m][6];n=A.price[m][5];if(m>0&&z>0){t=A.price[m-z+1][4],C=A.price[m][1],p=A.price[m-z+1][2],L=A.price[m-z+1][3];for(var g=m-z+2;g<=m;g++){if(p<A.price[g][2]){p=A.price[g][2]}if(L>A.price[g][3]){L=A.price[g][3]}if(x==1&&A.price[g][6]==0){x=0}}n=A.price[m][1]>=A.price[m-z][1]?1:0}else{if(m==0){t=A.price[m][4],C=A.price[m][1],p=A.price[m][2],L=A.price[m][3]}}var G=[];if((k==null||isNaN(k)||k<=0)&&A.price[m]!=null&&!isNaN(A.price[m][1])&&A.price[m][1]>0){k=A.price[m][1]}G.push(m/z+H);if((y=="return"||y=="return4")&&k>0){if(y=="return"){G.push(K+r*(C-k)/k);G.push(p),G.push(L),G.push(t)}else{G.push(K+r*(C-k)/k);G.push(K+r*(p-k)/k),G.push(K+r*(L-k)/k),G.push(K+r*(t-k)/k)}}else{G.push(C),G.push(p),G.push(L),G.push(t)}G.push(n);G.push(x);G.push(M+A.price[m][A.price[m].length-1]*60000);E.push(G)}H+=(Math.floor(J/z)+(J%z==0?0:1))}}return{data:E,spos:k}},getVolumeData:function(h,s,k,n){if(this.data.length<1){return{data:[],spos:null}}var p=[],c=[];var a=0,b,r,o,l=0;var q=Math.round(n/this.frequency);var e=this._getIndexs(this.data,h,s,k);for(var m=e[0];m>=e[1];m--){b=this.data[m];var r=b.date==null?0:b.date.getTime();o=b.accVolume.length;l=0;for(var g=0;g<o;g+=q){p.push([g/q+a,b.accVolume[g][1]==0?NaN:(b.accVolume[g][1]-l)/1000000,b.accVolume[g][2],r+b.accVolume[g][3]*60000]);if(!isNaN(b.accVolume[g][1])){l=b.accVolume[g][1]}}a+=(Math.floor(o/q)+(o%q==0?0:1))}return{data:p,spos:null}}};function timeSeriesData(a){this.startIndex=0;this.endIndex=0;this.exch="";this.ticker="";this.symbol="";this.frequency=a;this.priceData=[];this.volumeData=[];this.fairValueData=[];this.fundamentalData={PE:[],PB:[],PC:[],PS:[],FairValue:[],REPS:[],SInterest:[],MReturnIndex:[]};this.ready=false}timeSeriesData.prototype={getDividendAndSplitDataSegment:function(n,k,c,h,m){var b=h?1:-1;var l=m?2:-1;var e,i=(c=="p")?this.priceData:this.volumeData;if(i!=null&&i.length>1){e=[]}else{return null}var a=this.startIndex,f=this.endIndex;for(var g=0;g<i.length;g++){if(i[g].DateIndex<n||i[g].DateIndex>k){continue}if(i[g].Type==b||i[g].Type==l){e.push(i[g])}}return e},getDataSegment:function(s,v,F,t,o,E,G){var a=this.frequency;var B,w=null;if(t=="p"){w=this.priceData}else{if(t=="postTax"){w=this.postTaxReturn}else{if(t=="v"){w=this.volumeData}else{if(t=="f"){w=this.fairValueData}else{if(this.fundamentalData[t]!=undefined){w=this.fundamentalData[t]}}}}}if(w!=null&&w.length>1){B=[]}else{return{data:null,spos:null,freq:a}}var c=s,C=v;var A=w[0][w[0].length-1],r=w[w.length-1][w[w.length-1].length-1];if(c==null){c=A}if(C==null){C=r}var u=E.split("_");var E=u[0];var p=(u.length>1&&u[1]=="k");var n=1;if(a=="d"||a=="minute"){n=1}else{if(a=="w"){n=7}else{if(a=="m"){n=30}}}var q=0,x=null,y=p?10000:100,b=p?10000:0;if(F&&c<A){for(var m=c;m<A;m+=n){var z;if(G!=null){n=G[q+1][G[q+1].length-1]-G[q][G[q].length-1]}if(t=="p"){z=[q,NaN,NaN,NaN,NaN,NaN,m]}else{z=[q,NaN,m]}B.push(z);q++}}for(var k=0;k<w.length;k+=o){if(w[k][w[k].length-1]<c||w[k][w[k].length-1]>C){continue}if((E=="return"||E=="return4")&&x==null&&!isNaN(w[k][1])){x=w[k][1]}var D=[];D.push(q);if((E=="return"||E=="return4")&&x!=null){D.push(b+y*(w[k][1]-x)/x)}else{D.push(w[k][1])}for(var l=2;l<w[k].length;l++){if(E=="return4"&&x!=null&&l<5){D.push(b+y*(w[k][l]-x)/x)}else{D.push(w[k][l])}}B.push(D);q++}if(F&&C>r){for(var e=r;e<C;e+=n){var f;if(t=="p"){f=[q,NaN,NaN,NaN,NaN,NaN,e+n]}else{f=[q,NaN,e+n]}B.push(f);q++}}return{data:B,spos:x,freq:a}}};function quoteData(a){this.symbol=a;this.intradayData={1:new intrayData(1),5:new intrayData(5),10:new intrayData(10)};this.drawings={};this.dailyData=new timeSeriesData("d");this.weeklyData=new timeSeriesData("w");this.monthlyData=new timeSeriesData("m");this.dividendAndSplitData=new timeSeriesData("d");this.earningsData=new timeSeriesData("d");this.indicatorData={SMAV:{},SMA:{},EMA:{},BBands:{},MACD:{},RSI:{},SStochastic:{},FStochastic:{},ROC:{},WillR:{},PSAR:{},PChannel:{},MAE:{},ULT:{},Momentum:{},DMI:{},UDRatio:{},OBV:{},VAcc:{},VPlus:{},MFI:{},DYield:{},FVolatility:{},WMA:{},AccDis:{},Mass:{},Volatility:{},ForceIndex:{},ATR:{},Keltner:{},PrevClose:{}}}quoteData.prototype={getDataByType:function(a){if(!isNaN(a)){return this.intradayData[a]}else{if(a=="d"){return this.dailyData}else{if(a=="w"){return this.weeklyData}else{if(a=="m"){return this.monthlyData}else{if(a=="s"){return this.dividendAndSplitData}else{return null}}}}}},getRollDividend:function(h,b,m){var t=this.getDataByType(h);var e=this.getDataByType("s");if(t==null){return[]}var c=t.getDataSegment(b,m,true,"p",1,"price").data;var q=e.getDividendAndSplitDataSegment(b,m,"p",true,false);var r=[];if(q==null||q.length<1||c==null||c.length<1){return{data:[],spos:null}}var f=0,o,n=parseFloat(q[0].Desc);for(var g=0;g<c.length;g++){var u=[];var l=c[0][c[0].length-1];if(g>0){l=c[g-1][c[g-1].length-1]}var p=c[g][c[g].length-1];var a=false,s;for(j=f;j<q.length;j++){s=q[j].DateIndex;if(s<=p&&s>l){u.push(c[g][0]);n=parseFloat(q[j].Desc);u.push(n);f=j;a=true;break}}if(a){u.push(p)}else{u.push(c[g][0]);u.push(n);u.push(p)}r.push(u)}return{data:r,spos:null}},getIndicatorDataSegment:function(t,l,s,b,k,y,e,g,h){if(!this.indicatorData[t]||!s){return{data:[],spos:null}}var x=this.indicatorData[t],m=b,u=k;var v=l+"_"+(!isNaN(l)?(h+"_"):"")+(s&&s.length?s.join("_"):"");var q=null;if(!isNaN(l)||typeof(x[v])=="undefined"||x[v]==null){var r=this.getDataByType(l),c,p,o,n=true;if(r==null){return{data:[],spos:null}}if(!isNaN(l)){if(typeof(g)=="undefined"||g==null||g.spos!=null){var f=r.getPriceData("price",y,b,k,h);c=f.data,q=f.spos}else{c=g.data,q=g.spos}if(c.length>0){m=c[0][c[0].length-1];u=c[c.length-1][c[c.length-1].length-1]}if(t=="SMAV"||t=="UDRatio"||t=="OBV"||t=="MFI"||t=="VAcc"||t=="VPlus"||t=="VBP"||t=="AccDis"||t=="ForceIndex"){p=r.getVolumeData(y,b,k,h).data}n=false}else{c=r.priceData;p=r.volumeData}if(t=="DYield"){o=this.dividendAndSplitData.priceData}if(t=="PrevClose"){x[v]=this._getPrevCloseData(c)}else{x[v]=this._calculateIndicator(t,c,p,o,l,s)}}var a=[];if(t=="PrevClose"){return{data:x[v],spos:null}}if(x[v]&&x[v].length){for(var w=0;w<x[v].length;w++){a.push(techIndicatorCal.filtrateCalculatedData(m,u,n,x[v][w],l,e,q))}return a.length>1?a:a[0]}return{data:[],spos:null}},_getPrevCloseData:function(f){var a=[];if(this.intradayData&&this.intradayData[1]&&this.intradayData[1].data&&this.intradayData[1].data.length){var e=typeof(f)=="undefined"?this.intradayData[1].data[0].price:f;var c=this.intradayData[1].data[0].yestClosePrice;if(typeof(c)!="undefined"&&c!=0){for(var b=0;b<e.length;b++){var g=[e[b][0],c,e[b][e[b].length-1]];a.push(g)}}}return a},_calculateIndicator:function(f,a,e,b,h,c){var g;switch(f){case"SMA":g=[techIndicatorCal.calculateSma(a,h,c[0])];break;case"EMA":g=[techIndicatorCal.calculateEma(a,h,c[0])];break;case"BBands":g=techIndicatorCal.calculateBBands(a,h,c[0],c[1]);break;case"MACD":g=techIndicatorCal.calculateMACD(a,h,c[0],c[1],c[2]);break;case"RSI":g=[techIndicatorCal.calculateRSI(a,h,c[0])];break;case"ROC":g=[techIndicatorCal.calculateROC(a,h,c[0])];break;case"SStochastic":g=techIndicatorCal.calculateSlowStochastic(a,h,c[0],c[1]);break;case"FStochastic":g=techIndicatorCal.calculateFastStochastic(a,h,c[0],c[1]);break;case"PSAR":g=[techIndicatorCal.calculatePSAR(a,h,c[0],c[1])];break;case"WillR":g=[techIndicatorCal.calculateWillR(a,h,c[0])];break;case"SMAV":g=[techIndicatorCal.calculateSma(e,h,c[0])];break;case"DMI":g=techIndicatorCal.calculateDmi(a,h,c[0]);break;case"PChannel":g=techIndicatorCal.calculatePriceChannel(a,h,c[0]);break;case"MAE":g=techIndicatorCal.calculateMAEnvelope(a,h,c[0],c[1]);break;case"Momentum":g=[techIndicatorCal.calculateMomentum(a,h,c[0])];break;case"ULT":g=[techIndicatorCal.calculateUlt(a,h,c[0],c[1])];break;case"MFI":g=[techIndicatorCal.calculateMFI(a,e,h,c[0])];break;case"VAcc":g=[techIndicatorCal.calculateVolumeAcc(a,e,h,c[0])];break;case"UDRatio":g=[techIndicatorCal.calculateUpDownRatio(a,e,h,c[0],c[1])];break;case"OBV":g=[techIndicatorCal.calculateObv(a,e,h,c[0])];break;case"VPlus":g=[techIndicatorCal.calculateVolPlus(a,e,h,c[0])];break;case"VBP":g=[techIndicatorCal.calculateVolByPrice(a,e,h,c[0])];break;case"DYield":g=[techIndicatorCal.calculateDividendYield(a,b,h)];break;case"FVolatility":g=[techIndicatorCal.calculateFVolatility(a,h)];break;case"WMA":g=[techIndicatorCal.calculateWMA(a,h,c[0])];break;case"AccDis":g=[techIndicatorCal.calculateAccDis(a,e,h)];break;case"Mass":g=[techIndicatorCal.calculateMass(a,h)];break;case"Volatility":g=[techIndicatorCal.calculateVolatility(a,h,c[0],c[1])];break;case"ForceIndex":g=[techIndicatorCal.calculateForceIndex(a,e,h,c[0])];break;case"ATR":g=[techIndicatorCal.calculateAtr(a,h)];break;case"Keltner":g=techIndicatorCal.calculateKeltner(a,h,c[0],c[1],c[2]);break;default:break}return g},_addTTMdata:function(a){if(a.ready&&a.ttm&&a.ttm.dateIndex&&a.priceData&&a.priceData.length&&a.ttm.dateIndex>a.endIndex){var c=a.ttm.price,b=a.priceData.length;lastp=a.priceData[a.priceData.length-1][1];var e=c[0]>lastp?1:0;a.priceData.push([b,c[0],c[1],c[2],c[3],e,a.ttm.dateIndex]);a.volumeData.push([b,a.ttm.vol/1000000,e,a.ttm.dateIndex]);a.endIndex=a.ttm.dateIndex}},saveTimeSeriesData:function(q,f,r){var l=q.Index,c=q.Price,k=q.Volume,o=q.DividendSplit;var b=this.getDataByType(f);if(b==null||!l){b.ready=true;return}b.ready=false;b.priceData=[];b.volumeData=[];b.startIndex=l[0];var n=0;if(l.length>4&&c[0].length<2&&l[1]-l[0]>l[2]-l[1]){n=1;b.startIndex=l[1]}b.endIndex=l[l.length-1];var a=1;var g=this.type==1&&(this.exch==151||this.exch=="152")&&GB_ChartDataManager.currencyForUKExchange=="GBX";for(var e=n;e<c.length;e++){var t=[];if(l[e]<=0){continue}t.push(e-n);if(c[e]&&c[e].length==1){t=t.concat([c[e][0],NaN,NaN,NaN])}else{if(!c[e]||c[e].length<4){t=t.concat([NaN,NaN,NaN,NaN])}else{if(g){for(var h=0;h<c[e].length;h++){t.push(c[e][h]*100)}}else{t=t.concat(c[e])}}}if(e>0){a=c[e][0]>=c[e-1][0]?1:0}else{a=1}t.push(a);t.push(l[e]);b.priceData.push(t);if(r!=20&&k!=null&&e<k.length){b.volumeData.push([e-n,k[e]==0?NaN:k[e]/1000000,a,l[e]])}}b.ready=true;var p=0,m,u=this.dividendAndSplitData;if(u.startIndex!=null){p=u.startIndex}u.ready=!q.hasDS?false:true;if(o!=null&&o.length){for(var e=0;e<o.length;e++){m=parseInt(o[e].D,10);if(e==0){if(p!=0&&m>=p){break}else{u.startIndex=m;u.priceData=[]}}if(e==o.length-1){u.endIndex=m}u.priceData.push({DateIndex:m,Desc:o[e].V,Type:o[e].T})}u.ready=true}this._addTTMdata(b)},saveFundData:function(g,m){var h=this.getDataByType(m);if(g==null||!g.Index){h.ready=true;return}var c=g.Index,l=g["1"],b=g["1578"],f=g["15"];h.startIndex=c[0],h.endIndex=c[c.length-1];if(l&&l.length){h.priceData=[];for(var k=0;k<c.length;k++){if(c[k]<0){continue}h.priceData.push([k,l[k],c[k]])}h.ready=true}if(f&&f.length){h.postTaxReturn=[];for(var k=0;k<c.length;k++){if(c[k]<0){continue}h.postTaxReturn.push([k,f[k],c[k]])}h.pTaxReady=true}if(b&&b.length){var a=0,e=this.dividendAndSplitData;if(e.startIndex!=null){a=e.startIndex}for(var k=0;k<b.length;k++){dIndex=parseInt(b[k].D,10);if(k==0){if(a!=0&&dIndex>=a){break}else{e.startIndex=dIndex;e.priceData=[]}}if(k==b.length-1){e.endIndex=dIndex}e.priceData.push({DateIndex:dIndex,Desc:b[k].V,Type:1})}}},saveFundamentalData:function(f,k,e){var c=f.date,l=f.value;var g=this.getDataByType(k);if(g==null||!g.fundamentalData[e]){return}g.fundamentalData[e]=[];var b=0;for(var h=b;h<l.length;h++){var a=[];if(c[h]<=0){continue}a.push(h-b);a.push(l[h]);a.push(c[h]);g.fundamentalData[e].push(a)}},saveEarningsData:function(g){var f=g.date,a=g.value;this.earningsData.ready=true;var c=this.earningsData;for(var b=0;b<a.length;b++){var e=[];if(f[b]<=0){continue}e.push(b);e.push(a[b]);if(b>3){e.push(a[b]>=a[b-4]?1:0)}else{e.push(1)}e.push(f[b]);c.priceData.push(e)}},saveIntradayData:function(z,m){if(!$.isArray(z)||z==null||!z.length){this.intradayData[m].ready=true;return}var s=typeof(z[0].timeInterval)=="undefined"?1:z[0].timeInterval;if(this.intradayData[s]==null){this.intradayData[s]=new intrayData(s)}this.intradayData[s].openTime=z[0].startTime;this.intradayData[s].closeTime=z[0].endTime;this.intradayData[s].exch=z[0].exchangeId;this.intradayData[s].ticker=z[0].symbol.toUpperCase();this.intradayData[s].data=[];this.intradayData[s].ready=false;var g,w,t,u,y;var x=Math.floor((z[0].endTime-z[0].startTime)/s)+1,a=this.intradayData[s].openTime;var n=NaN,A=0,p=100000000,r=NaN,C,e;var b=(this.type==1&&(this.exch==151||this.exch=="152")&&GB_ChartDataManager.currencyForUKExchange=="GBP")?0.01:1;for(var k=0;k<z.length;k++){g=z[k].security=="20"?z[k].bidPrice:z[k].lastPrice;if(m==1&&z[k].security=="20"&&k>=5){continue}w=z[k].volume;var B={};B.date=RTQ_ChartUtil.convertToDate(z[k].date);B.yestClosePrice=z[k].yesterdayClosePrice*b;if(z[k].closePrice){B.closePrice=parseFloat(z[k].closePrice)*b}B.accVolume=[];B.price=[];t=g.length,u=w.length,temp=B.yestClosePrice,isup=0,y=z[k].fillFlag;if(m==1&&k==0&&g&&g.length){n=g[0][3],C=RTQ_ChartUtil.toDateIndex(B.date)}var q=0;for(var f=0;f<x;f++){if(f<t&&g[f].length){isup=g[f][0]*b>temp?1:0;temp=g[f][0]*b;q=typeof(y)=="undefined"?0:y[f];B.price[f]=[f,g[f][0]*b,g[f][1]*b,g[f][2]*b,g[f][3]*b,isup,q,a+f*s];if(m==1&&k==0){if(!isNaN(g[f][0])){r=g[f][0]}if(g[f][1]>A){A=g[f][1]}if(g[f][2]<p){p=g[f][2]}}}else{B.price[f]=[f,NaN,NaN,NaN,NaN,0,1,a+f*s]}if(f<u&&w[f]>0){B.accVolume[f]=[f,w[f],isup,a+f*s];if(k==0&&w[f]>0){e=w[f]}}else{B.accVolume[f]=[f,NaN,0,a+f*s]}}if(m==1&&k==0){this.dailyData.ttm={dateIndex:C,price:[r*b,A*b,p*b,n*b],vol:e}}this.intradayData[s].data.push(B)}this._addTTMdata(this.dailyData);this.intradayData[s].ready=true;if(s==1&&this.intradayData[s].data.length&&this.intradayData[s].data[0].date){this.intradayData.lastTradeDate=this.intradayData[s].data[0].date;if(GB_ChartDataManager){GB_ChartDataManager._refreshChartLastTradeDate(this.symbol,this.intradayData[s].data[0].date,this.intradayData[s].data[this.intradayData[s].data.length-1].date)}}},removeDrawing:function(b,h){var c=false,g;if(this.drawings[b]){for(var e=0;e<this.drawings[b].length;e++){var k=this.drawings[b][e];if(b=="levelline"){if(k.start.y==h.start.y){g=this.drawings[b][e].id;this.drawings[b].splice(e,1);c=true;break}}else{if(k.start.dIdx==h.start.dIdx&&k.end.dIdx==h.end.dIdx&&k.start.y==h.start.y&&k.end.y==h.end.y){g=this.drawings[b][e].id;this.drawings[b].splice(e,1);c=true;break}}}}if(GB_ChartDataManager.saveDrawings&&c){var f=GB_ChartDataManager.dataUrls.drawings;var a={action:"removedraw",drawid:g,_t:new Date().getTime()};$.post(f,a,function(i){})}},removeAllDrawings:function(){var b=GB_ChartDataManager.dataUrls.drawings;if(GB_ChartDataManager.saveDrawings){for(var c in this.drawings){for(var a=0;a<this.drawings[c].length;a++){var e={action:"removedraw",drawid:this.drawings[c][a].id,_t:new Date().getTime()};$.post(b,e,function(f){})}}}this.drawings={}},saveLastDrawing:function(c,b){if(!this.drawings[c]){this.drawings[c]=[]}b.drawType=c;this.drawings[c].push(b);if(GB_ChartDataManager.saveDrawings){var a=GB_ChartDataManager.dataUrls.drawings;delete b.oldStart,delete b.oldEnd;var e=$.toJSON(b);var g={action:"insertdraw",pid:this.symbol,saveinfo:e,_t:new Date().getTime()};var f=this;$.post(a,g,function(i){var h=$.evalJSON(i);if(h.secId==f.symbol){b.id=h.list[0].eventId}})}},updateDrawing:function(c,k){if(c!="levelline"&&(!k.oldStart||!k.oldEnd)){return}var a=false,h;if(this.drawings[c]){for(var e=0;e<this.drawings[c].length;e++){var l=this.drawings[c][e];if(c=="levelline"){if(l.start&&k.oldStart&&Math.abs(l.start.y-k.oldStart.y)<0.0001){this.drawings[c][e].start=$.extend(true,{},k.start);h=this.drawings[c][e].id;a=true;break}}else{if(l.start.dIdx==k.oldStart.dIdx&&l.end.dIdx==k.oldEnd.dIdx&&Math.abs(l.start.y-k.oldStart.y)<0.0001&&Math.abs(l.end.y-k.oldEnd.y)<0.0001){this.drawings[c][e].start=$.extend(true,{},k.start);this.drawings[c][e].end=$.extend(true,{},k.end);h=this.drawings[c][e].id;a=true;break}}}}if(GB_ChartDataManager.saveDrawings&&a){var g=GB_ChartDataManager.dataUrls.drawings;infoObj={drawType:k.drawType,start:k.start,end:k.end};var f=$.toJSON(infoObj);var b={action:"updatedraw",pid:this.symbol,drawid:h,saveinfo:f,_t:new Date().getTime()};$.post(g,b,function(i){})}},getDrawings:function(e,a){if(GB_ChartDataManager.saveDrawings){if(this.drawingReady){if(typeof(a)=="function"){a(this._getDrawings(e))}}else{var b=GB_ChartDataManager.dataUrls.drawings+"action=loaddraw&pid="+this.symbol+"&_t="+new Date().getTime();var c=this;$.get(b,function(g){var f=$.evalJSON(g);if(f.secId==c.symbol&&f.list&&f.list.length){c.drawingReady=true;c._storeDrawings(f.list);if(typeof(a)=="function"){a(c._getDrawings(e))}}})}}else{if(typeof(a)=="function"){a(this._getDrawings(e))}}},_storeDrawings:function(c){for(var a=0;a<c.length;a++){var b=$.evalJSON(c[a].eventInfo);if(!this.drawings[b.drawType]){this.drawings[b.drawType]=[]}b.id=c[a].eventId;this.drawings[b.drawType].push(b)}},_getDrawings:function(f){var a={};var l=f[0][f[0].length-1],c=f[f.length-1][f[f.length-1].length-1];for(var h in this.drawings){if(this.drawings[h].length){a[h]=[];for(var g=0;g<this.drawings[h].length;g++){if(h=="levelline"){a[h].push($.extend(true,{},this.drawings[h][g]))}else{if(this.drawings[h][g].start.dIdx>=l&&this.drawings[h][g].end.dIdx<=c){var e=$.extend(true,{},this.drawings[h][g]);var b=false;for(var k=0;k<f.length;k++){if(f[k][f[k].length-1]==e.start.dIdx){e.start.x=f[k][0];b=true}else{if(f[k][f[k].length-1]==e.end.dIdx&&b){e.end.x=f[k][0];a[h].push(e);break}}}}}}}}return a}};var GB_ChartDataManager=new RTQ_ChartDataManager({});var QSLGIN=QS_Lang.Chart,QSLGFD=QS_Lang.Chart,QSLGTXT=QS_Lang.Chart;if(typeof(version)=="undefined"){if(typeof QS_SERVER_DOMAIN!="undefined"&&typeof QS_PUSH_DOMAIN!="undefined"){version={rtq:"//"+QS_SERVER_DOMAIN,domain:"//"+QS_SERVER_DOMAIN,push:"//"+QS_PUSH_DOMAIN}}}var QS_baseChart={tickerColors:typeof(QS_Style)!="undefined"?QS_Style.chart.tickerColors:["#728fb2","#9b0033","#e96610","#f1ad02","#9faa00","#006065","#809aba","#e1b2c1","#e2e5b2","#293f6f","#fbe6b3","#f2a370","#b2cfd0","#bec5d4","#c5cc66","#f8d1b7","#c36685","#c9cbcb",],protocol:typeof(QS_PROTOCOL)=="undefined"?(window.location.protocol+"//"):QS_PROTOCOL,drawingData:[{val:"trendline",txt:QSLGTXT.trendline},{val:"rectangle",txt:QSLGTXT.rectangle},{val:"ellipse",txt:QSLGTXT.ellipse},{val:"note",txt:QSLGTXT.note},{val:"levelline",txt:QSLGTXT.levelline},{val:"fibonacci",txt:QSLGTXT.fibonacciretracementlevels}],attachMouseScoll:function(){var a=this;if(this.UIConfig.MouseWheel){this.outObj.bind("click.rtqChart",function(b){a.scrollAble=true}).bind("mouseout.rtqChart",function(b){if(a.scrollAble&&!Util.contains(a.outObj[0],b.relatedTarget)){a.scrollAble=false}});this.outObj.mousewheel(function(c,b){if(!a.scrollAble){return false}c.preventDefault();if(b>0){a.wheelNum++}else{a.wheelNum--}if(a.mouseWheeTimeout){clearTimeout(a.mouseWheeTimeout)}a.mouseWheeTimeout=setTimeout(function(){a.scrollChart(b>0);a.wheelNum=0},200)})}},attachZoomIn:function(){var a=this,b=this._contains;if(this.UIConfig.ZoomIn){b.pChartContainer.bind("mousedown.rtqChart",this,this._zoomInStart).bind("click.rtqChart",this,this._zoomOutChart).bind("selectstart",function(){return false})}},_zoomInStart:function(a){var c=a.data;if(c.isDrawing){return false}if(c.selectionMode.zoomIn){if(RTQ_ChartUtil.compareDateByday(c.startDate,c.endDate)){if(c._frequencyIndexMap[c.frequency]<1){var b=c.chartData.DataList;if(!b.length||!b[0].data||b[0].data.length<3){return false}c.zoomInMode=1}else{return false}}else{c.zoomInMode=0}c._elements.zoomMask.show();c._zoomInSize={};c._zoomInSize.s=c._getX(a)-c.chartOffset.left;c._elements.zoomMask.css({left:c._zoomInSize.s+"px"});$(document).bind("mousemove.rtqChart",c,c._zoomInMove);$(document).bind("mouseup.rtqChart",c,c._zoomInStop)}else{if(c.selectionMode.pan){c._clearZoomIn();c._panSize={},c._panTimeout=null;c._panSize.s=c._getX(a)-c.chartOffset.left;c._contains.pChartContainer.addClass("rtc-chart-move");$(document).bind("mousemove.rtqChart",c,c._panMove);$(document).bind("mouseup.rtqChart",c,c._panStop)}}},_zoomInMove:function(a){var c=a.data;if(c.isDrawing){return}c._zoomInSize.e=c._getX(a)-c.chartOffset.left;var b=c._zoomInSize.e-c._zoomInSize.s;if(b<0){c._elements.zoomMask.css({width:(b*(-1))+"px",left:(c._zoomInSize.s+b)+"px"})}else{c._elements.zoomMask.css({width:b+"px"})}},_zoomInStop:function(a){var b=a.data;$(document).unbind("mousemove.rtqChart",b._zoomInMove);$(document).unbind("mouseup.rtqChart",b._zoomInStop);b._elements.zoomMask.css({width:0,left:0});if(!b._zoomInSize.e||!b._zoomInSize.s||Math.abs(b._zoomInSize.e-b._zoomInSize.s)<5){return}b._zoomInChart(b._zoomInSize)},_panMove:function(a){if(a.data.isDrawing){return false}var d=a.data,b=d._getX(a)-d.chartOffset.left;d._panSize.e=b<0?0:b>d.chartWidth?d.chartWidth:b;var c=d._panSize.e-d._panSize.s;if(Math.abs(c)<10){return false}if(d._panTimeout){clearTimeout(d._panTimeout)}d._panTimeout=setTimeout(function(){d._moveChart(c)},50)},_panStop:function(a){var b=a.data;b._contains.pChartContainer.removeClass("rtc-chart-move");$(document).unbind("mousemove.rtqChart",b._panMove);$(document).unbind("mouseup.rtqChart",b._panStop)},_getX:function(a){var b=a.data;if(a.pageX){return a.pageX}else{return a.clientX+document.body.scrollLeft-document.body.clientLeft}},_moveChart:function(l){if(this.isDrawing){return false}if(!this.pChartReady){return}var c=this.chartWidth-55,o=this.chartData.DataList[0].data,n=this.chartData.MiniChartData[0],b,a,g,f;var k=o.length,j;var m=Math.abs(Math.floor(k*l/c));if(m>0){if(this._frequencyIndexMap[this.frequency]<1){j=o[m][o[m].length-1]-o[0][o[0].length-1]}else{j=(o[m][o[m].length-1]-o[0][o[0].length-1])*86400000}}else{if(RTQ_ChartUtil.compareDateByday(this.startDate,this.endDate)){j=86400000}else{return}}if(j<86400000){j=86400000}if(l>0){var h=RTQ_ChartUtil.toDateFromIndex(n[0][n[0].length-1]).getTime();if(this.startDate.getTime()==h){return false}b=new Date(this.startDate.getTime()-j);a=new Date(this.endDate.getTime()-j);var l=0;if(b.getDay()==0){l=2;b=new Date(this.startDate.getTime()-(j+l*86400000))}else{if(b.getDay()==6){l=1;b=new Date(this.startDate.getTime()-(j+l*86400000))}}if(a.getDay()==0){a=new Date(this.endDate.getTime()-(j+2*86400000))}else{if(a.getDay()==6){a=new Date(this.endDate.getTime()-(j+86400000))}}if(b.getTime()<h){b=new Date(h)}this.startDate=b,this.endDate=a;this.changeRange(11)}else{if(!RTQ_ChartUtil.compareDateByday(this.endDate,this.latestTradeDate)){b=new Date(this.startDate.getTime()+j);a=new Date(this.endDate.getTime()+j);var l=0;if(b.getDay()==0){l=1;b=new Date(this.startDate.getTime()+(j+l*86400000))}else{if(b.getDay()==6){l=2;b=new Date(this.startDate.getTime()+(j+l*86400000))}}if(a.getDay()==0){a=new Date(this.endDate.getTime()+(j+86400000))}else{if(a.getDay()==6){a=new Date(this.endDate.getTime()+(j+2*86400000))}}if((a.getTime()-this.latestTradeDate.getTime())>0){a=this.latestTradeDate}this.startDate=b,this.endDate=a;this.changeRange(11)}}this._panSize.s=this._panSize.e},_zoomInChart:function(q){var h=this.chartWidth-55,f=this.chartData.DataList[0].data,b,g,a,t;var n=f.length;b=q.s>q.e?q.e:q.s,g=q.s<q.e?q.e:q.s;if(this.yaxisAlign=="left"){b=b-55,g=g-55}if(b<0){b=0}if(g>h){g=h}var r=Math.floor(n*b/h),j=Math.floor(n*g/h),p=n-j;if(r<0){r=0}if(j>=n){j=n-1}if(n<1){return false}if(this.zoomInMode==0){var k=f[r][f[r].length-1],m=f[j][f[j].length-1];a=this._frequencyIndexMap[this.frequency]<1?new Date(k):RTQ_ChartUtil.toDateFromIndex(k);t=this._frequencyIndexMap[this.frequency]<1?new Date(m):RTQ_ChartUtil.toDateFromIndex(m);if(!RTQ_ChartUtil.compareDateByday(a,this.startDate)||!RTQ_ChartUtil.compareDateByday(t,this.endDate)){if(this.zoomStack){this.zoomStack.push({s:this.startDate,e:this.endDate})}this.startDate=a;this.endDate=t;this.changeRange(11)}}else{if(this.zoomInMode==1){var f=this.chartData;this._zoomInData(r,j,f.DataList);if(this.zoomStack){this.zoomStack.push({s:this.startDate,e:this.endDate})}this.drawPChart();if(f.VolList&&f.VolList.length){this._zoomInData(r,j,f.VolList);if(this.showVolume){this.drawVChart()}}var l=this.iChartData;for(var c in this.iChartData){if(this.iChartData[c]&&this.iChartData[c].length){this._zoomInData(r,j,this.iChartData[c]);this.drawIChart(c)}}if(this.zoomIndexRange==null){this.zoomIndexRange={s:r,e:j}}else{this.zoomIndexRange.s+=r,this.zoomIndexRange.e-=p}}}},_zoomInData:function(a,d,b){if(!b||!b.length){return}for(var c=0;c<b.length;c++){if(b[c].name=="VBP"){b.splice(c,1);c--;continue}this._zoomInDataItem(a,d,b[c])}},_zoomInDataItem:function(a,c,b){var d=b.data.length;b.data.splice(0,a);b.data.splice(c-a,d-c);for(var e=0;e<b.data.length;e++){b.data[e][0]=e}},_clearZoomIn:function(){if(this.zoomStack){this.zoomStack=[]}this.zoomInMode=-1;this.zoomIndexRange=null},_changeZoomInIndex:function(b,a){if(!this.zoomIndexRange){return}var c=this._frequencyMap[b]/this._frequencyMap[a];if(!isNaN(c)){this.zoomIndexRange.s=Math.ceil(this.zoomIndexRange.s*c);this.zoomIndexRange.e=Math.ceil(this.zoomIndexRange.e*c)}},_zoomOutChart:function(a){var c=a.data;if(c.selectionMode.zoomOut&&c.zoomStack&&c.zoomStack.length){var b=c.zoomStack.pop();c.startDate=b.s,c.endDate=b.e;c.changeRange(11)}},_resetZoomChart:function(){var a=this;if(a.selectionMode.reset&&a.zoomStack&&a.zoomStack.length){var b=a.zoomStack[0];a._clearZoomIn();a.startDate=b.s,a.endDate=b.e;a.changeRange(11)}},_zoomChart:function(d,b,c){this._clearZoomIn();if(b){if(this.startDate.getTime()>this.sDates[d].getTime()){this.startDate=new Date(this.startDate.getFullYear(),this.startDate.getMonth(),this.startDate.getDate()-Math.abs(this.wheelNum)*c);this.changeRange(11)}}else{if(this.startDate.getTime()<this.endDate.getTime()){var a=new Date(this.startDate.getFullYear(),this.startDate.getMonth(),this.startDate.getDate()+Math.abs(this.wheelNum)*c);if(a.getTime()>this.endDate.getTime()){this.startDate=this.endDate}else{this.startDate=a}this.changeRange(11)}}},scrollChart:function(a){if(this._frequencyIndexMap[this.frequency]==-4){this._zoomChart("lMin",a,1)}else{if(this._frequencyIndexMap[this.frequency]>=-3&&this._frequencyIndexMap[this.frequency]<1){this._zoomChart("lMin",a,2)}else{if(this._frequencyIndexMap[this.frequency]==1){this._zoomChart("d",a,20)}else{if(this._frequencyIndexMap[this.frequency]==2){this._zoomChart("w",a,42)}else{if(this._frequencyIndexMap[this.frequency]==3){this._zoomChart("m",a,120)}}}}}},_createIndicatorInputWin:function(c){c.append('<div class="rtc-win qs-chart-indicator-prompt" style="display:none"><div class="rtc-win-wrap" ><div class="rtc-win-title qs-chart-indicator-prompt-title"><strong class = "qs-ind-title"></strong> <a class="qs-chart-indicator-prompt-close"></a></div> <div class="rtc-win-content"></div><div class="rtc-win-action"><a href="javascript:void(0)" class="qs-ui-btn ok qs-ind-draw">&nbsp;'+QSLGTXT.draw+'&nbsp;</a><a href="javascript:void(0)" class="qs-ui-btn qs-ind-cancel">'+QSLGTXT.cancel+'</a> <a href="javascript:void(0)" class="qs-ui-btn qs-ind-remove">'+QSLGTXT.remove+"</a> </div> </div> </div>");var a=this._elements,b=this;a.indicatorWinElm=c.find(".rtc-win");a.indicatorWinElm.find(".qs-ind-draw").unbind("click").bind("click",function(){if(b.ichartSiwtchIndicatorWin.flag){b.preSwitchIChart()}b._drawIndicator(b._selectedIndicatorName)});a.indicatorWinElm.find(".qs-ind-cancel").unbind("click").bind("click",function(){b.cancelIndicator()});a.indicatorWinElm.find(".qs-ind-remove").unbind("click").bind("click",function(){b.removeIndicatorClicked()});a.indicatorWinElm.find(".qs-chart-indicator-prompt-close").unbind("click").bind("click",function(){b.cancelIndicator()})},_createDateInputBoxes:function(){var a=this.uiComponents,f=this.UIConfig,c=this._elements,g=this,h="#FEFEFE";var e=true,b=72;if(f.chartCtrl=="rtqPanel"){e=false}a.customDateB=new RTQ_chartCustomDataBox(c.$customDate,{startDate:g.startDate,endDate:g.endDate,width:b,splitLabel:"-",hoverColor:h,callback:function(j,k){g.startDate=j,g.endDate=k;g._clearZoomIn();g.changeRange(11)},bindEvent:e});if(!e){var d=c.$customDate.find(".qs-ui-ipt");a.customDateB.inputBoxes.attr("readOnly","true");d.each(function(j){$(this).data("cal.Index",j)});QSCAL.register(d[0],function(j){if(j.getTime()>g.endDate.getTime()){g.startDate=g.endDate;g.endDate=j;d.eq(1).val(RTQ_ChartUtil.formatMDYDate(g.endDate))}else{g.startDate=j}d.eq(0).val(RTQ_ChartUtil.formatMDYDate(g.startDate));g._clearZoomIn();g.changeRange(11)});QSCAL.register(d[1],function(j){if(j.getTime()<g.startDate.getTime()){g.endDate=g.startDate;g.startDate=j;d.eq(0).val(RTQ_ChartUtil.formatMDYDate(g.startDate))}else{g.endDate=j}d.eq(1).val(RTQ_ChartUtil.formatMDYDate(g.endDate));g._clearZoomIn();g.changeRange(11)});d.focus(function(j){var l=$(j.target),k=l.data("cal.Index");if($.browser.msie){document.body.focus()}if(k==0){QSCAL.show(l,g.startDate)}else{QSCAL.show(l,g.endDate)}})}},_createIChartRightMenu:function(){var h=0;if(typeof(this.indicatorPanelData)!="undefined"&&this.indicatorPanelData.length){for(var f=1;f<this.indicatorPanelData.length;f++){var d=this.indicatorPanelData[f],b=[];for(var c=0;c<d.length;c++){if(this.indicatorsData[d[c].val]&&this.indicatorsData[d[c].val].type==1){b.push($.extend(true,{},d[c],{idx:h+1}))}}this.ichartMenuL1Data[h++]=b}}if(typeof(this.fundamentalPanelData)!="undefined"&&this.fundamentalPanelData.length){for(var f=0;f<this.fundamentalPanelData.length;f++){var d=this.fundamentalPanelData[f],b=[];for(var c=0;c<d.length;c++){if(d[c].val!="FairValue"){b.push($.extend(true,{},d[c],{idx:h+1}))}}this.ichartMenuL1Data[h++]=b}}var c=0;for(var f=0;f<this.miniChartRightMenuData.length;f++){if(this.miniChartRightMenuData[f].hasSubMenu&&c<this.ichartMenuL1Data.length){this.miniChartRightMenuData[f].subMenu=this.ichartMenuL1Data[c];c++}}if(typeof(Util.CascadeMenu)=="function"){var g=this,e=this.uiComponents,a=this._elements;e.miniChartRightMenu.menu=new Util.CascadeMenu((this.__winObj&&this.__winObj.toolPanel?this.__winObj.toolPanel:this.outObj),{display:false,autoHide:true,isTraceMouse:true,fixedDirection:false},this.miniChartRightMenuData,{onClick:function(k){var j=k.data.idx;g._onIchartMenuItemClicked(j,k)}})}},_getCommonConfig:function(){var c={autoTitle:this.autoTitle,pWidth:this.chartWidth,pHeight:this.pChartHeight,chartStyle:this.chartStyle,chartCursor:this.chartCursor,scaleType:this.scaleType,lock:this.lock,showNotes:this.showNotes,yaxisAlign:this.yaxisAlign,isShowTimeSlider:this.isShowTimeSlider};var a={},d={},e=this.indicatorsData;for(var b in e){if(e[b].show){if(b=="SMA"||b=="SMAV"||b=="EMA"){a[b]={show:true,num:typeof(e[b].num)=="object"?$.extend(true,[],e[b].num):e[b].num}}else{a[b]={show:e[b].show,parameter:$.extend(true,[],e[b].parameter)}}}}for(var b in this.valuations){if(this.valuations[b].show){d[b]={show:true}}}c.indicatorsData=a;c.valuations=d;return c},_createRightMenu:function(d){var b=this,c=this.uiComponents,a=this._elements;this.uiComponents.rightMenu=new Util.CascadeMenu((this.__winObj&&this.__winObj.toolPanel?this.__winObj.toolPanel:this.outObj),{display:false,autoHide:true,isTraceMouse:true,fixedDirection:false},this.rightMenuData,{onClick:function(l){if(l!=null){if(l.parent!=null&&l.parent.data.catekey=="zoom"){var g=b.frequency,e="";b.frequency=l.data.val;if(l.data.val!=b.frequency){if(b.zoomInMode==1){if(b._frequencyIndexMap[b.frequency]>0){b._clearZoomIn()}else{b._changeZoomInIndex(g,b.frequency)}}}var f=parseInt(l.parent.data.val,10);if(b.zoomRange!=f){if(c.ddlZoom!=null){c.ddlZoom.setTextValue("",f)}b.uiComponents.rightMenu.changeUIState(g,b.zoomRange,false);b.uiComponents.rightMenu.changeUIState(f,"zoom",true);e=b.zoomListData[b._zoomIndexMap[f]].txt+" | "+b._frequencyTxtMap[b.frequency];a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(e);b.changeRange(f);b._clearZoomIn()}else{if(c.ddlFrequency!=null){c.ddlFrequency.setTextValue("",b.frequency)}if(c.tabZoomMenu!=null){c.tabZoomMenu.changeUIState(b.frequency,b.zoomRange,true);e=b.zoomListData[b._zoomIndexMap[f]].txt+" | "+b._frequencyTxtMap[b.frequency];a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(e)}b.drawChartSegment()}}else{var h=l.parent==null?null:l.parent.data.val;var k=l.data.val,j=l.checked?true:false;b._onMenuItemCallback(h,k,j);if(h=="zoom"&&k==11){if(b.__winObj&&b.__winObj.settingPN){b.__winObj.settingPN.show()}}}}b.uiComponents.rightMenu.hide()}});d.unbind("contextmenu").bind("contextmenu",function(f){b.uiComponents.rightMenu.show(f);b._elements.crosshairLegendWin.hide();b._elements.lineXElm.hide();b._elements.lineYElm.hide();f.preventDefault()})},_createTabMenu:function(){var a=this.uiComponents,h=this,e=this._elements;var b=$(".rtc-tab",this.outObj);a.tabMenu=new Util.TabMenu(b[0],this.tabList,{onActive:function(j){var l=j.index,k=h.tabMap[l];a.ddlChartType.selectItemByValue(k)}},{width:80,isExcuteCallbackAtInit:false});for(var f=0;f<this.chartTypeMenuData.length;f++){var g=this.chartTypeMenuData[f];if(g.length>0){var c=a.tabMenu.getTabById(f);var d=f;(function(){var j=d;a.chartTypeMenu[j]=new Util.CascadeMenu(b,{display:false,isTraceMouse:false,autoHide:true},g,{onClick:function(m){var k=m.data;var l=k.val;if(a.ddlChartType!=null){a.ddlChartType.selectItemByValue(l)}a.chartTypeMenu[j].hide()}});c.menu.hover(function(k){var l=$(this).position();a.chartTypeMenu[j].setPosition(l.left,l.top+23);a.chartTypeMenu[j].show()},function(k){a.chartTypeMenu[j].hide()})})()}}a.tabZoomMenu=new Util.CascadeMenu(e.tabmenuZoomEl,{display:false,isTraceMouse:false,autoHide:false,fixedDirection:true},this.zoomListData,{onClick:function(o){var j=o.data,m=j.val,k=h.frequency,l;if(o.parent!=null&&m!=h.frequency){if(h.zoomInMode==1){if(h._frequencyIndexMap[m]>0){h._clearZoomIn()}else{h._changeZoomInIndex(h.frequency,m)}}h.frequency=m}var n=parseInt(o.parent==null?o.data.val:o.parent.data.val);if(h.zoomRange!=n){if(a.ddlZoom!=null){a.ddlZoom.setTextValue("",n)}a.tabZoomMenu.changeUIState(k,h.zoomRange,false);a.tabZoomMenu.changeUIState(n,null,true);if(a.rightMenu!=null){a.rightMenu.changeUIState(k,h.zoomRange,false);a.rightMenu.changeUIState(n,"zoom",true)}l=h.zoomListData[h._zoomIndexMap[n]].txt+" | "+h._frequencyTxtMap[h.frequency];e.tabmenuZoomEl.find(".rtq-ddl-ipt").html(l);h._clearZoomIn();h.changeRange(n)}else{if(o.parent!=null){if(a.ddlFrequency!=null){a.ddlFrequency.setTextValue("",h.frequency)}if(a.rightMenu!=null){a.rightMenu.changeUIState(h.frequency,h.zoomRange,true)}l=h.zoomListData[h._zoomIndexMap[n]].txt+" | "+h._frequencyTxtMap[h.frequency];e.tabmenuZoomEl.find(".rtq-ddl-ipt").html(l);h.drawChartSegment()}}a.tabZoomMenu.hide()}});e.tabmenuZoomEl.hover(function(j){a.tabZoomMenu.show()},function(j){a.tabZoomMenu.hide()})},menuButtonClicked:function(b){var a=$(b),e=a.attr("catkey"),c=a.attr("value"),d=a.hasClass("rtq-chkbox_off");this._onMenuItemCallback(e,c,d)},_onMenuItemCallback:function(a,d,h){var c=this.uiComponents,g=this._elements;if(a=="chartType"&&c.ddlChartType!=null){c.ddlChartType.selectItemByValue(d);return false}else{if(a=="frequency"&&c.ddlFrequency!=null){c.ddlFrequency.selectItemByValue(d);return false}else{if(a=="cursorType"&&c.ddlCursorType!=null){c.ddlCursorType.selectItemByValue(d);return false}else{if(a=="zoom"){c.ddlZoom.selectItemByValue(d);return false}else{if(a=="scale"){this.ratioScaleSelected(d);return false}else{if(a=="yaxis"){this.ratioYaxisSelected(d);return false}else{if(a=="selectionmode"){this.ratioSelectionModeSelected(d);return false}else{if(a=="draw"){var e=g.$drawBlock.find("[value='"+d+"']").hasClass("draw-row-select");g.$drawBlock.find(".draw-row-select").removeClass("draw-row-select");if(!e){g.$drawBlock.find("[value='"+d+"']").addClass("draw-row-select");for(var f=0;f<this.drawingData.length;f++){if(d==this.drawingData[f].val){this.beginDrawing(d);break}}}else{this.cancelDrawing(d)}}else{if(a=="event"){if(c.rightMenu!=null){c.rightMenu.changeUIState(d,null,h)}if(h){g.eventULElm.find("a[value='"+d+"']").removeClass("rtq-chkbox_off")}else{g.eventULElm.find("a[value='"+d+"']").addClass("rtq-chkbox_off")}this.events[d]=h;if(this.zoomRange>2){this.getPChartData()}}else{if(a=="indicator"){this.showIndicatorWin(d)}else{if(a=="indexs"){if(this.compairTickers.length>=this.tickerMaxNum&&h){if(this.hasConfirmBox){Util.message(TEXT?TEXT.ChartCTickersOverstep:"The maximum compair tickers are reached.")}return false}this.indexsMap[d].show=h;g.indexsULElm.find("a[value='"+d+"']").toggleClass("rtq-chkbox_off");if(this.indexsMap[d].show){this.addCompairTickers(d)}else{this.removeCompairTicker(d)}}else{if(a=="relateSec"){if(this.compairTickers.length>=this.tickerMaxNum&&h){if(this.hasConfirmBox){Util.message(TEXT?TEXT.ChartCTickersOverstep:"The maximum compair tickers are reached.")}return false}g.relatedSecULElm.find("a[value='"+d+"']").toggleClass("rtq-chkbox_off");if(h){this.addCompairTickers(d)}else{this.removeCompairTicker(d)}}else{if(a=="valuation"||a=="mainl1-fundamental"||a=="mainl1-valuation"){g.valuationULElm.find("a[value='"+d+"']").toggleClass("rtq-chkbox_off");if(this.valuations[d]){var b=false;if(!this.valuations[d].show){this.addValuations(d);b=true}else{this.removeValuations(d)}this.changeRightMenuClass(2,d,b)}}else{if(a.indexOf("mainl2-")==0){this.showIndicatorWin(d)}}}}}}}}}}}}}}},getIChartsHeight:function(){var a=0;if(typeof(this.indicatorsData)!="undefined"){for(var b in this.indicatorsData){if(this.indicatorsData[b].show&&this.indicatorsData[b].type==1){a+=this.iChartHeight}}}if(typeof(this.valuations)!="undefined"){for(var b in this.valuations){if(this.valuations[b].show&&b!="FairValue"){a+=this.iChartHeight}}}return a},setSize:function(b,c){var a=this._contains;this._setSizeParas(b,c);this.outObj.css({width:this.chartWidth+"px",height:this.outHeight+"px"});if(a.pChartContainer){a.pChartContainer.css({width:this.chartWidth+"px",height:this.pChartHeight+"px","float":"left"})}if(a.vChartContainer){a.vChartContainer.css({width:this.chartWidth+"px",height:this.vChartHeight+"px","float":"left"})}if(a.mChartContainer){a.mChartContainer.css({width:this.chartWidth+"px",height:this.miniChartHeight,"float":"left"})}if(this._elements.zoomMask!=null){this._elements.zoomMask.css({height:this.pChartHeight+"px"})}this.outObj.find(".rtc-chart-container").find(".rtc-chart").css({width:this.chartWidth+"px"})},changeOutSize:function(b,c){this.outHeight=c;var d=b<this.minW?this.minW:b;this.setSize(d,c);if(typeof(this.pFlot)!="undefined"&&this.pFlot!=null){this.pFlot.changeOutSize(this.chartWidth,this.pChartHeight)}if(typeof(this.vFlot)!="undefined"&&this.vFlot!=null&&this.showVolume){this.vFlot.changeOutSize(this.chartWidth,this.vChartHeight)}if(typeof(this.mFlot)!="undefined"&&this.mFlot!=null&&this.isShowTimeSlider){this.mFlot.changeOutSize(this.chartWidth,this.miniChartHeight);if(this.sliderObj!=null){this.sliderObj.changeOutSize(this.chartWidth,this.miniChartHeight)}}for(var a in this.iFlots){if(this.iFlots[a]!=null&&((this.valuations&&this.valuations[a]&&this.valuations[a].show)||(this.indicatorsData[a]&&this.indicatorsData[a].show))){this.iFlots[a].changeOutSize(this.chartWidth,this.iChartHeight-20)}}},zoomSelected:function(b,a){this._clearZoomIn();this.changeRange(parseInt(a));this.uiComponents.ddlZoom.setTextValue("",a);return false},frequencySelected:function(e,d){var a=this._elements,b=this.uiComponents;if(this.frequency!=d){if(b.rightMenu!=null){b.rightMenu.changeUIState(d,this.zoomRange,true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(d,this.zoomRange,true);var c=this.zoomListData[this._zoomIndexMap[this.zoomRange]].txt+" | "+this._frequencyTxtMap[d];a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(c)}this.setFrequency(d)}},cursorTypeSelected:function(f,e){var c=this,a=this._elements,d=this._contains,b=this.uiComponents;this.setCursorType(parseInt(e,10));if(b.rightMenu!=null){b.rightMenu.changeUIState(this.chartCursor,"cursorType",true)}if(this.chartCursor==3){d.pChartContainer.unbind("plothover")}else{a.crosshairLegendWin.hide();a.lineXElm.hide(),a.lineYElm.hide();d.pChartContainer.unbind("plothover");d.pChartContainer.bind("plothover",function(j,g,h){c.buildLegend(h,g,false,false)})}},chartTypeSelected:function(g,e){var a=this._elements,b=this.uiComponents;if(this.chartStyle!=e){if(b.rightMenu!=null){b.rightMenu.changeUIState(e,"chartType",true)}if(this.UIConfig.chartCtrl=="rtqPanel"&&b.tabMenu!=null){var c=this.tabIndexMap[e];b.tabMenu.changeTabByIndex(c,false);if(b.chartTypeMenu[c]!=null){var d=b.tabMenu.getTabById(c).menu.position();b.chartTypeMenu[c].setPosition(d.left,d.top+23);for(var f=0;f<b.chartTypeMenu.length;f++){if(typeof(b.chartTypeMenu[f])!="undefined"){b.chartTypeMenu[f].changeUIState(this.chartStyle,null,false)}}b.chartTypeMenu[c].changeUIState(e,null,true)}else{for(var f=0;f<b.chartTypeMenu.length;f++){if(typeof(b.chartTypeMenu[f])!="undefined"){b.chartTypeMenu[f].changeUIState(this.chartStyle,null,false)}}}}this.setChartType(e)}},scaleTypeSelected:function(b,a){if(this.scaleType!=a){this.scaleType=a;this.drawPChart()}},ratioScaleSelected:function(c){var a=this._elements,b=this.uiComponents;if(c=="1"){a.$ratioScale.find("[value='1']").removeClass("rtq-ratio-off");a.$ratioScale.find("[value='0']").addClass("rtq-ratio-off")}else{if(c=="0"){a.$ratioScale.find("[value='0']").removeClass("rtq-ratio-off");a.$ratioScale.find("[value='1']").addClass("rtq-ratio-off")}}this.switchScaleType(c)},ratioYaxisSelected:function(c){var a=this._elements,b=this.uiComponents;if(c=="right"){a.$yaxisAlign.find("[value='right']").removeClass("rtq-ratio-off");a.$yaxisAlign.find("[value='left']").addClass("rtq-ratio-off");a.xLabelElm.css({right:0,left:""})}else{if(c=="left"){a.$yaxisAlign.find("[value='left']").removeClass("rtq-ratio-off");a.$yaxisAlign.find("[value='right']").addClass("rtq-ratio-off");a.xLabelElm.css({left:0,right:""})}}this.setYaxisAlign(c)},ratioSelectionModeSelected:function(c){var a=this._elements,b=this.uiComponents;if(c=="pan"){a.$selectionMode.find("a").addClass("rtq-ratio-off");this.setSelectionMode(c);a.$selectionMode.find("[value='pan']").removeClass("rtq-ratio-off")}else{if(c=="zoomin"){a.$selectionMode.find("a").addClass("rtq-ratio-off");this.setSelectionMode(c);a.$selectionMode.find("[value='zoomin']").removeClass("rtq-ratio-off")}else{if(c=="reset"){this.resetZoom()}}}},showIndicatorWin:function(h){var d=this._elements;this._selectedIndicatorName=h;if(this.indicatorsData[h]==null||this.indicatorUI[h]==null){return}if(h=="SMAV"&&!this.indicatorsData.Volume.show&&!this.indicatorsData.VPlus.show){return}var b=this.indicatorUI[h],a=b.parameter;if(typeof(a)=="undefined"||a.length==0){if(this.indicatorsData[h].show){this.removeIndicatorClicked()}else{this._drawIndicator(h)}}else{d.indicatorWinElm.find(".qs-ind-title").html(b.title);var f,j="",c=b.defaultValue,g=this.indicatorsData[h],k=d.indicatorWinElm.find(".qs-ind-remove");for(var e=0;e<a.length;e++){if(h=="EMA"||h=="SMA"){f=g.num[e]==null?(c[e]==null?"":c[e]):(g.num[e]==null?"":g.num[e])}else{if(h=="SMAV"){f=g.num==null?(c[e]==null?"":c[e]):(g.num==null?"":g.num)}else{f=(g.parameter[e]==null?(c[e]==null?"":c[e]):(g.parameter[e]==null?"":g.parameter[e]))}}j+="<dl><dt>"+a[e]+'</dt><dd><input type="text" class="qs-ui-ipt p'+e+'" value="'+f+'" /></dd></dl>'}d.indicatorWinElm.find(".rtc-win-content").html(j);d.indicatorWinElm.show();if(this.indicatorsData[h].show){k.show()}else{k.hide()}}},_drawIndicator:function(b){var a=this._elements;a.indicatorWinElm.hide();var c=this.addIndicators(b);if(c){a.indicatorULElm.find("a[value='"+b+"']").removeClass("rtq-chkbox_off");this.changeRightMenuClass(0,b,true);if(b=="Volume"){a.indicatorULElm.find("a[value='VPlus']").addClass("rtq-chkbox_off")}else{if(b=="VPlus"){a.indicatorULElm.find("a[value='Volume']").addClass("rtq-chkbox_off");a.indicatorULElm.find("a[value='SMAV']").removeClass("rtq-chkbox_off")}}}},cancelIndicator:function(){this._elements.indicatorWinElm.hide();this._elements.indicatorWinElm.find(".qs-ind-title").html("");this._elements.indicatorWinElm.find(".rtc-win-content").html("")},_setIndicatorParas:function(b){var d,l,k=false,f=this._elements;var a=this.indicatorsData[b];var c=false;if(arguments.length<=1||typeof(arguments[1])=="undefined"){c=true}if(a!=null){if(b=="SMA"||b=="EMA"){for(var e=0;e<a.num.length;e++){sP=c?f.indicatorWinElm.find("input.p"+e).val():arguments[e+1];iP=parseFloat(sP);if(!isNaN(iP)){a.num[e]=iP;k=true}else{a.num[e]=null}}}else{if(b=="SMAV"){var h=parseFloat(c?f.indicatorWinElm.find("input.p0").val():arguments[1]);if(!isNaN(h)&&h>0){if(a&&a.num!=h){a.num=h;k=true}}}else{for(var g=0;g<a.parameter.length;g++){sP=c?f.indicatorWinElm.find("input.p"+g).val():arguments[g+1];iP=parseFloat(sP);if(!isNaN(iP)){a.parameter[g]=iP}else{a.parameter[g]=this.indicatorUI[b].defaultValue[g]}k=true}if(a.parameter.length==0){k=true}}}}return k},addIndicators:function(a){var b=a,c=true;if(b=="SMA"||b=="EMA"){c=this._setIndicatorParas(b,arguments[1],arguments[2],arguments[3]);this.indicatorsData[b].show=true;if(c){this.getPChartData()}}else{if(b=="Keltner"||b=="PrevClose"){c=this._setIndicatorParas(b);this.indicatorsData[b].show=true;if(c){this.getPChartData()}}else{if(b=="SMAV"){c=this.indicatorsData[b].show=this._setIndicatorParas(b,arguments[1]);if(c){this.getVChartData()}}else{if(b=="BBands"||b=="PSAR"||b=="MAE"||b=="VBP"){c=this._setIndicatorParas(b,arguments[1],arguments[2]);this.indicatorsData[b].show=true;if(c){this.getPChartData()}}else{if(b=="PChannel"||b=="WMA"){c=this._setIndicatorParas(b,arguments[1]);this.indicatorsData[b].show=true;if(c){this.getPChartData()}}else{if(b=="Volume"||b=="VPlus"){this.indicatorsData[b].show=true;if(b=="Volume"){this.indicatorsData.VPlus.show=false}else{this.indicatorsData.Volume.show=false;this.indicatorsData.SMAV.show=true;this.indicatorsData.SMAV.num=50}this.switchVolumeChart(true);if(b=="VPlus"){this.changeRightMenuClass(2,b,true);this.changeRightMenuClass(2,"Volume",false);this.changeRightMenuClass(2,"SMAV",true)}else{this.changeRightMenuClass(2,b,true);this.changeRightMenuClass(2,"VPlus",false)}this.getVChartData();c=true}else{if(this.iFlots.hasOwnProperty(b)){if(b=="MACD"){c=this._setIndicatorParas(b,arguments[1],arguments[2],arguments[3])}else{if(b=="RSI"||b=="ROC"||b=="WillR"||b=="MFI"||b=="Momentum"||b=="ForceIndex"){c=this._setIndicatorParas(b,arguments[1])}else{if(b=="ULT"||b=="DMI"||b=="OBV"||b=="VAcc"||b=="AccDis"||b=="Mass"||b=="ATR"){c=this._setIndicatorParas(b)}else{if(b=="SStochastic"||b=="FStochastic"||b=="UDRatio"||b=="Volatility"){c=this._setIndicatorParas(b,arguments[1],arguments[2])}}}}if(c){if(this.UIConfig.autoHeight&&!this.indicatorsData[b].show){this.outHeight+=this.iChartHeight}this.indicatorsData[b].show=true;this.setSize(this.chartWidth,this.outHeight);if(this.pFlot!=null){this.pFlot.resizeCanvas(this.chartWidth,this.pChartHeight)}if(this.vFlot!=null&&this.showVolume){this.vFlot.resizeCanvas(this.chartWidth,this.vChartHeight)}this.drawPChart();if(this.showVolume){this.drawVChart()}this.getIChartData(b)}}}}}}}}if(typeof(this.afterAddIndicators)=="function"){this.afterAddIndicators({indicatorName:b,paras:arguments})}return c},removeIndicators:function(c){var b=false;if(c=="SMAV"){this.indicatorsData.SMAV.num=null;this.indicatorsData[c].show=false;this.getVChartData();b=true}else{if(c=="SMA"||c=="EMA"){var d=null,e=false;b=true;if(arguments.length>1&&typeof(arguments[1])!="undefined"&&arguments[1]!=null){d=parseInt(arguments[1],10)}for(a=0;a<this.indicatorsData[c]["num"].length;a++){if(d!=null){if(this.indicatorsData[c].num[a]==d){this.indicatorsData[c].num[a]=null;this._removeDataRowFromDataList(c,a);e=true}if(this.indicatorsData[c].num[a]!=null){b=false;e=true}}else{this.indicatorsData[c].num[a]=null;this._removeDataRowFromDataList(c,a);e=true}}if(b){this.indicatorsData[c].show=false}if(e){this.drawPChart()}}else{if(c=="PSAR"||c=="BBands"||c=="PChannel"||c=="MAE"||c=="VBP"||c=="WMA"||c=="Keltner"||c=="PrevClose"){for(var a=0;a<this.indicatorsData[c].parameter.length;a++){this.indicatorsData[c].parameter[a]=null}this._removeDataRowFromDataList(c);this.drawPChart();this.indicatorsData[c].show=false;b=true}else{if(c=="Volume"||c=="VPlus"){this.indicatorsData[c].show=false;this.switchVolumeChart(false);if(c=="Volume"){this.changeRightMenuClass(2,c,false)}else{this.changeRightMenuClass(2,c,false)}this.indicatorsData.SMAV.show=false,this.indicatorsData.SMAV.num=null;b=true}else{if(this.indicatorsData[c]){this.removeIChart(c);b=true}}}}}if(typeof(this.afterRemoveIndicators)=="function"){this.afterRemoveIndicators({indicatorName:c,paras:arguments})}return b},_convertToEventData:function(c,g){var n,m=this.chartData;m.eventDataList=[],m.eventInfoList={};for(var h in c){n=c[h];if(!n){continue}var f=0,a=0;for(i=0;i<n.length;i++){var b=h=="earnings"?n[i][n[i].length-1]:n[i].DateIndex;var l=g[0][g[0].length-1];for(var e=f;e<g.length;e++){if(e>0){l=g[e-1][g[e-1].length-1]}if(b<=g[e][g[e].length-1]&&b>=l){a=g[e][0];if(typeof(m.eventDataList[a])=="undefined"){m.eventDataList[a]=[a]}if(typeof(m.eventInfoList[a])=="undefined"){m.eventInfoList[a]=[]}if(h=="earnings"){m.eventDataList[a].push(n[i][2]==0?3:4);m.eventInfoList[a].push({name:"Earnings:",type:n[i][2]==0?3:4,val:n[i][1],dIndex:b})}else{if(h=="ds"){m.eventDataList[a].push(n[i].Type);m.eventInfoList[a].push({name:(n[i].Type==1?"Dividend:":"Splits:"),val:n[i].Desc,type:n[i].Type,dIndex:b})}}f=e;break}}}}},setLineColors:function(a){if(typeof(a)=="object"&&a.length){this.tickerColors=a}},setFillColors:function(a,b){this.fillColors[a]=b},setColors:function(a,b){this.colors[a]=b},setYaxisAlign:function(a){this.yaxisAlign=a;this.freshAllCharts(a)},switchShowLastLabel:function(a){this.isShowLastLabel=a},setCursorType:function(a){this.chartCursor=a;if(this.pFlot!=null){this.pFlot.setOption({imageHighlight:(a==0)})}this.mouseOutChart()},setChartType:function(b){if(this.chartStyle!=b){var a=this.chartStyle;this.chartStyle=b;if(this.compairTickers.length||b=="postTax"||a=="postTax"||b=="growth10"||a=="growth10"||b=="growth"||a=="growth"||b=="dEffect"||a=="dEffect"){this.getPChartData()}else{this.drawPChart()}if(typeof(this.afterChartTypeChanged)=="function"){this.afterChartTypeChanged({chartType:this.chartStyle})}}},setFrequency:function(a){if(this.frequency!=a&&typeof(this._frequencyIndexMap[a])!="undefined"){if(this._frequencyIndexMap[self.frequency]>0){this._clearZoomIn()}else{this._changeZoomInIndex(this.frequency,a)}this.frequency=a;this.drawChartSegment()}},switchScaleType:function(b){var a=parseInt(b,10);if(a!=0&&a!=1){return false}if(this.scaleType!=a){this.scaleType=a;this.drawPChart()}},switchIIV:function(a){this.showIIVTicker=(a==1||a==true);this.getPChartData()},setSelectionMode:function(a){if(a=="pan"){this.selectionMode.pan=true,this.selectionMode.zoomIn=false,this.selectionMode.reset=false}else{if(a=="zoomin"){this.selectionMode.pan=false,this.selectionMode.zoomIn=true,this.selectionMode.reset=false}}},resetZoom:function(){this.selectionMode.reset=true;this._resetZoomChart()},switchEvents:function(c,a){var d=(a==1);if(this.events[c]!=d){this.events[c]=d;if(this.zoomRange>2){this.getPChartData()}if(typeof(this.eventsChanged)=="function"){this.eventsChanged({eventName:c,show:d})}}},addCompairTickers:function(a){this.validateCompairTicker(a)},removeMainTicker:function(a){if(a&&this.compairTickers.length){var c=this.compairTickers[0];this.compairTickers.splice(0,1);this.acceptTicker(c)}else{GB_ChartDataManager.unregisterSymbol(self.mainTicker);GB_ChartDataManager.unregisterChart(self.mainTicker,self.id);this.bacthUnscribeTickers([this.mainTicker]);delete this.tickerInfos[this.mainTicker];if(this.pFlot!=null){this.pFlot.clear(),this.pFlot=null}if(this.vFlot!=null){this.vFlot.clear(),this.vFlot=null}if(this.mFlot!=null){this.mFlot.clear(),this.mFlot=null}for(var b in this.iFlots){if(this.iFlots.hasOwnProperty(b)&&this.iFlots[b]!=null){if(this.iChartContainers[b]!=null){this.iChartContainers[b].find(".lengend").unbind("click").unbind("hover").unbind("contextmenu")}this.iFlots[b].clear(),this.iFlots[b]=null}}this.mainTicker="";if(this._elements.legendElm){this._elements.legendElm.html("")}if(this._elements.volLegendElm){this._elements.volLegendElm.html("")}}},removeCompairTicker:function(c){if(this.compairTickers==null||this.compairTickers.length<1){return}var b=c;if(c.split(":").length==2){b=this.getPidByExchAndTicker(c)}for(var a=0;a<this.compairTickers.length;a++){if(b==this.compairTickers[a]){if(typeof(this.afterRemoveTickers)=="function"){this.afterRemoveTickers({symbol:this.tickerInfos[b]})}GB_ChartDataManager.unregisterSymbol(this.compairTickers[a]);this.bacthUnscribeTickers([this.compairTickers[a]]);delete this.tickerInfos[this.compairTickers[a]];this.compairTickers.splice(a,1);if(this.compairTickers.length){this._removeDataRowFromDataList(b);this.drawPChart()}else{this.getPChartData()}break}}},changeDatePeriod:function(a,b){this.startDate=RTQ_ChartUtil.convertToDate(a);this.endDate=RTQ_ChartUtil.convertToDate(b);this.changeRange(11);if(typeof(this.datePeriodChanged)=="function"){this.datePeriodChanged({zoomRange:this.zoomRange,startDate:a,endDate:b})}this._clearZoomIn()},changeRange:function(f,b){if(this.mainTicker==null||this.mainTicker==""){return}if(f!=11){this._clearZoomIn()}var a=this.uiComponents;if(a.rightMenu!=null){a.rightMenu.changeUIState(this.frequency,this.zoomRange,false)}if(a.tabZoomMenu!=null){a.tabZoomMenu.changeUIState(this.frequency,this.zoomRange,false)}this.zoomRange=f;if(f!=11){this.endDate=this.latestTradeDate}var g=this.endDate.getFullYear(),e=this.endDate.getMonth(),c=this.endDate.getDate();if(f==1){this.startDate=this.endDate}else{if(f==2){this.startDate=new Date(g,e,c-5)}else{if(f==0){this.startDate=new Date(g,e,c-3)}else{if(f==13){this.startDate=new Date(g,e,c-15)}else{if(f==3){this.startDate=new Date(g,e-1,c)}else{if(f==14){this.startDate=new Date(g,e-2,c)}else{if(f==4){this.startDate=new Date(g,e-3,c)}else{if(f==5){this.startDate=new Date(g,0,1)}else{if(f==6){this.startDate=new Date(g-1,e,c)}else{if(f==7){this.startDate=new Date(g-3,e,c)}else{if(f==8){this.startDate=new Date(g-5,e,c)}else{if(f==9){this.startDate=new Date(g-10,e,c)}else{if(f==10){this.startDate=new Date(1970,0,1)}else{if(f==11){if(a.ddlZoom!=null){a.ddlZoom.setTextValue("Custom","11")}}}}}}}}}}}}}}}if(typeof(b)!="undefined"&&this._frequencyIndexMap[b]!=null){this.frequency=b;this.customizeFreq=true}else{this.customizeFreq=false}this.changeFrequencyStyle(f);this.drawChartSegment();if(typeof(this.datePeriodChanged)=="function"){this.datePeriodChanged({zoomRange:this.zoomRange,startDate:RTQ_ChartUtil.formatDate(this.startDate),endDate:RTQ_ChartUtil.formatDate(this.endDate)})}},setDefaultFrequencies:function(a){$.extend(true,this.defaultFrequencyMap,a)},beginDrawing:function(a){if(this.pFlot!=null){this.pFlot.beginDrawing(a);this.isDrawing=true}},cancelDrawing:function(a){if(this.pFlot!=null){this.pFlot.cancelDrawing(a);this.isDrawing=false}},drawChartSegment:function(){this.chartData.fairValueData=null;var a=this;this.getPChartData(function(){for(var b in a.indicatorsData){if(a.indicatorsData[b].type==1&&a.indicatorsData[b].show){a.getIChartData(b)}}if(typeof(a.valuations)!="undefined"){for(var b in a.valuations){if((a.valuations[b]&&a.valuations[b].show)){a.getIChartData(b)}}}})},_getDataBySymbol:function(a,b){for(var c=0;c<a.length;c++){if(a[c].symbol==b){return a[c]}}return null},_getClientTicker:function(a){return(this.tickerInfos[a].clientTicker||this.tickerInfos[a].ticker)},pChartDataReady:function(x,m){this.chartData.eventDataList=[],this.chartData.eventInfoList={};var z=this.chartData;var c=this._getDataBySymbol(x,this.mainTicker),C,t=0;if(typeof(c.price.lastTradeDate)!="undefined"&&c.price.lastTradeDate!=this.latestTradeDate){this.refreshLastTradeDate(null,c.price.lastTradeDate)}z.DataList=[];if(c){if(c.price){var A=this._getClientTicker(this.mainTicker);z.DataList.push({data:c.price.data,startPos:c.price.spos,colorIndex:0,color:this.tickerColors[0],name:this.mainTicker,legend:A,freq:c.price.freq,type:"mt"});t++;if((this.zoomRange<=2||this.zoomRange>9)&&c.price.data!=null&&c.price.data.length){var b;if(this._frequencyIndexMap[this.frequency]>0){b=RTQ_ChartUtil.toDateFromIndex(c.price.data[0][c.price.data[0].length-1])}else{var y=new Date(c.price.data[0][c.price.data[0].length-1]);b=new Date(y.getFullYear(),y.getMonth(),y.getDate())}if(this.startDate!=b){this.startDate=b;if(this.uiComponents.customDateB!=null){this.uiComponents.customDateB.setDate(this.startDate,this.endDate)}}}}}if(this.showIIVTicker){var s=this._getDataBySymbol(x,this.iivTicker);if(s&&s.price){A=this._frequencyIndexMap[this.frequency]>0?QSLGTXT.nav:QSLGTXT.inav;if(this.UIConfig.IIVLegend=="ticker"){A=this._getClientTicker(this.iivTicker)+"("+(this._frequencyIndexMap[this.frequency]>0?QSLGTXT.nav:QSLGTXT.inav)+")"}z.DataList.push({data:s.price.data,startPos:s.price.spos,colorIndex:t,color:this.tickerColors[t],name:"_iiv",legend:A,type:"iv"});t++}}if(this.compairTickers.length){for(var g=0;g<this.compairTickers.length;g++){C=this._getDataBySymbol(x,this.compairTickers[g]);if(C&&C.price){A=this._getClientTicker(this.compairTickers[g]);z.DataList.push({data:C.price.data,startPos:C.price.spos,colorIndex:t,color:this.tickerColors[t],name:this.compairTickers[g],legend:A,type:"ct"});t++}}}var u={},w=false;if(this.events.earnings){if(c.earningsData){u.earnings=c.earningsData.data,w=true}}if(this.events.dividend||this.events.splits){if(c.dividendAndSplit){u.ds=c.dividendAndSplit,w=true}}if(w){this._convertToEventData(u,c.price.data)}if(c!=null&&c.indicators){if(c.indicators.SMA){var A=this.indicatorsData.SMA.num.length,q,v;for(var f=0;f<A;f++){v=this.indicatorsData.SMA.num[f];if(v!=null&&c.indicators.SMA[v]){z.DataList.push({data:c.indicators.SMA[v].data,startPos:c.indicators.SMA[v].spos,colorIndex:t,color:this.tickerColors[t],legend:QSLGIN.sma_lg+"("+v+")",name:"SMA",sq:f,num:v});t++}}}if(c.indicators.EMA){var A=this.indicatorsData.EMA.num.length,q,v;for(var e=0;e<A;e++){v=this.indicatorsData.EMA.num[e];if(v!=null&&c.indicators.EMA[v]){z.DataList.push({data:c.indicators.EMA[v].data,startPos:c.indicators.EMA[v].spos,colorIndex:t,color:this.tickerColors[t],legend:QSLGIN.ema_lg+"("+v+")",name:"EMA",sq:e,num:v});t++}}}if(c.indicators.WMA){var h=QSLGIN.wma_lg+"("+this.indicatorsData.WMA.parameter[0]+")";z.DataList.push({data:c.indicators.WMA.data,startPos:c.indicators.WMA.spos,colorIndex:t,color:this.tickerColors[t],legend:h,name:"WMA"});t++}if(c.indicators.Keltner){var p=QSLGIN.keltner_lg+"("+this.indicatorsData.Keltner.parameter[0]+","+this.indicatorsData.Keltner.parameter[1]+","+this.indicatorsData.Keltner.parameter[2]+")";var n=c.indicators.Keltner[0],r=c.indicators.Keltner[2],a=c.indicators.Keltner[1];z.DataList.push({data:n.data,startPos:c.indicators.Keltner,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"U",name:"Keltner",sq:0});z.DataList.push({data:r.data,startPos:c.indicators.Keltner,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"L",name:"Keltner",sq:1});t++;z.DataList.push({data:a.data,startPos:c.indicators.Keltner,colorIndex:t,color:this.tickerColors[t],pre:QSLGIN.ema_lg+"("+this.indicatorsData.Keltner.parameter[0]+")("+QSLGIN.keltner_lg+")",legend:QSLGIN.keltner_lg,name:"Keltner",sq:2});t++}if(c.indicators.BBands){var p=QSLGIN.bbands_lg+"("+this.indicatorsData.BBands.parameter[0]+","+this.indicatorsData.BBands.parameter[1]+")";var n=c.indicators.BBands[0],r=c.indicators.BBands[1];z.DataList.push({data:n.data,startPos:n.spos,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"U",name:"BBands",sq:0});z.DataList.push({data:r.data,startPos:r.spos,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"L",name:"BBands",sq:1});t++}if(c.indicators.PSAR){var h=QSLGIN.psar_lg+"("+this.indicatorsData.PSAR.parameter[0]+","+this.indicatorsData.PSAR.parameter[1]+")";z.DataList.push({data:c.indicators.PSAR.data,startPos:c.indicators.PSAR.spos,colorIndex:t,color:this.tickerColors[t],legend:h,name:"PSAR"});t++}if(c.indicators.PChannel){var p=QSLGIN.pchannel_lg+"("+this.indicatorsData.PChannel.parameter[0]+")";var n=c.indicators.PChannel[0],r=c.indicators.PChannel[1];z.DataList.push({data:n.data,startPos:n.spos,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"U",name:"PChannel",sq:0});z.DataList.push({data:r.data,startPos:r.spos,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"L",name:"PChannel",sq:1});t++}if(c.indicators.MAE){var p=QSLGIN.mae_lg+"("+this.indicatorsData.MAE.parameter[0]+","+this.indicatorsData.MAE.parameter[1]+"%)";var n=c.indicators.MAE[0],r=c.indicators.MAE[1];z.DataList.push({data:n.data,startPos:n.spos,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"U",name:"MAE",sq:0});z.DataList.push({data:r.data,startPos:r.spos,colorIndex:t,color:this.tickerColors[t],pre:p,legend:"L",name:"MAE",sq:1});t++}if(c.indicators.PrevClose){z.DataList.push({data:c.indicators.PrevClose.data,startPos:c.indicators.PrevClose.spos,colorIndex:18,color:this.tickerColors[18],legend:QSLGIN.prevclose_lg,name:"PrevClose"})}if(!this.compairTickers.length&&c.indicators.VBP){var h="VBP";z.DataList.push({data:c.indicators.VBP.data,startPos:null,colorIndex:17,color:this.tickerColors[17],legend:h,name:"VBP",sq:0});t++}if(this.chartData.fairValueData!=null&&this.valuations.FairValue.show&&this.zoomRange>2&&!this.compairTickers.length){if(this.chartData.DataList.length&&this.chartData.DataList[0].freq==this.chartData.fairValueData.freq){this.chartData.DataList.push({data:this.chartData.fairValueData.data,startPos:this.chartData.fairValueData.spos,colorIndex:15,color:this.tickerColors[15],legend:QSLGFD.fairvalue_name,name:"FairValue"})}}}var o=false;if(this.chartStyle=="dEffect"){if(this.zoomRange>2&&this._frequencyIndexMap[this.frequency]>0){this.getIChartData("MReturnIndex")}else{this.chartData.DataList.push($.extend(true,{},this.chartData.DataList[0]));this.chartData.DataList[1].legend=this.chartData.DataList[1].legend+"(w/o Div.)";this.chartData.DataList[1].name="MReturnIndex";o=true}}else{o=true}if(o){if(this.zoomInMode==1&&this.zoomIndexRange){this._zoomInData(this.zoomIndexRange.s,this.zoomIndexRange.e,this.chartData.DataList)}this.drawPChart()}if(c&&c.volume){this.chartData.VolList=[];c.volume.name="volume";this.chartData.VolList.push({data:c.volume.data,name:"volume",startPos:null,legend:QSLGIN.volume_lg});if(c.indicators&&c.indicators.SMAV){var B=QSLGIN.smav_lg+"("+this.indicatorsData.SMAV.num+")";this.chartData.VolList.push({data:c.indicators.SMAV.data,startPos:null,name:"SMAV",legend:B})}if(this.zoomInMode==1&&this.zoomIndexRange){this._zoomInData(this.zoomIndexRange.s,this.zoomIndexRange.e,this.chartData.VolList)}if(this.showVolume){this.drawVChart()}}if(typeof(m)=="function"){m()}if(typeof(this.hideLoading)=="function"){this.hideLoading()}if(typeof(this.afterChartOnReady)=="function"){this.afterChartOnReady()}if(x.length>0&&this.showNotes){this._loadChartNote(this.mainTicker)}},_loadDrawings:function(c,a){var b=GB_ChartDataManager.quoteDataMap[this.mainTicker];b.getDrawings(c,a)},_loadChartNote:function(d){var b=this;b._contains.pChartContainer.find(".qs-note-flot").remove();var c=this.startDate.getTime(),a=this.endDate.getTime();if(c==a){a=c+(24*60*60*1000)}GB_ChartDataManager.getChartNoteData(c,a,d,function(e){b.pFlot.renderNote(e)})},iChartDataReady:function(d){var a=null,c=this.chartData;if(d.length){a=d[0].indicators}else{a=d}for(var b in a){if(b=="FairValue"){c.fairValueData=a[b];c.fairValueData.freq=this.frequency;if(!this.compairTickers.length&&this.zoomRange>2&&c.DataList!=null&&c.DataList.length&&c.DataList[0].freq==c.fairValueData.freq){c.DataList.push({data:c.fairValueData.data,startPos:c.fairValueData.spos,colorIndex:15,color:this.tickerColors[11],legend:QSLGFD.fairvalue_name,name:"FairValue"});this.drawPChart()}}else{if(b=="MReturnIndex"){c.mReturnIndexData=a[b];c.mReturnIndexData.freq=this.frequency;if(c.DataList.length&&c.DataList[0].freq==c.mReturnIndexData.freq){if(this.zoomInMode==1&&this.zoomIndexRange){this._zoomInDataItem(this.zoomIndexRange.s,this.zoomIndexRange.e,c.mReturnIndexData)}c.DataList.push({data:c.mReturnIndexData.data,startPos:c.mReturnIndexData.spos,colorIndex:0,color:this.tickerColors[0],legend:this._getClientTicker(this.mainTicker)+"(w/o Div.)",name:"MReturnIndex"});this.drawPChart()}}else{this.iChartData[b]=a[b]&&a[b].length?a[b]:[a[b]];if(this.zoomInMode==1&&this.zoomIndexRange){this._zoomInData(this.zoomIndexRange.s,this.zoomIndexRange.e,this.iChartData[b])}this.drawIChart(b)}}}},drawIChart:function(b){var m=this.chartData,j=this,h=this._contains,a=this._elements,f=this.uiComponents;if((this.indicatorsData[b]&&this.indicatorsData[b].show)||(this.valuations&&this.valuations[b]&&this.valuations[b].show)){var l=this.iFlots[b];if(l==null){var k=this.getChartOption("indicatorLines");this.iChartContainers[b]=$('<div class="rtc-chart-container" name='+b+'><div class="legend" >'+b+'</div><div class="rtc-chart rtc-chart-mini"></div></div>');var e=this.iChartContainers[b].find(".rtc-chart");if((this.UIConfig.Chart&&this.UIConfig.Chart.showTimeSlider)||this.UIConfig.chartCtrl=="rtqPanel"){h.mChartContainer.parent().before(this.iChartContainers[b])}else{this.outObj.append(this.iChartContainers[b])}this.iChartContainers[b].find(".legend").bind("click",function(n){if($(n.target).hasClass("rtc-legend-remove")){j.iChartLegendOnclick($(this).parent().attr("name"))}}).hover(function(n){$(this).find(".rtc-legend-remove").removeClass("rtc-remove-hide")},function(n){$(this).find(".rtc-legend-remove").addClass("rtc-remove-hide")});e.css({width:this.chartWidth+"px",height:"60px"});l=this.iFlots[b]=new mstar.flot(e,k);if(this.UIConfig.RightMenu){this.iChartContainers[b].bind("contextmenu",function(n){var p=0,o=$(this).attr("name");f.miniChartRightMenu.menu.show(n);f.miniChartRightMenu.owner=o;n.preventDefault()})}}else{this.iChartContainers[b].attr("name",b);this.iChartContainers[b].show();this.iChartContainers[b].find(".rtc-chart").css({width:this.chartWidth+"px"}).show()}if(this.iChartData[b]&&this.iChartData[b].length){this.iChartContainers[b].attr("name",b);l.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks}});if(b=="WillR"){l.setOption({yaxis:{ticks:[-50,-100],min:-100,max:0}})}else{l.setOption({yaxis:{ticks:null,min:null,max:null}})}var d=this.iChartData[b];var c=[];for(var g=0;g<d.length;g++){c[g]=d[g]==null?null:d[g].data;if(g==2&&b=="MACD"){c[g]=this.getChartData((d[g]==null?null:d[g].data),"bars",1,null)}}l.setOption({yaxis:{align:this.yaxisAlign}});l.init(c);this.buildIChartLegend(-1)}}},_drawAllICharts:function(){for(var a in this.indicatorsData){if(this.indicatorsData[a].type==1&&this.indicatorsData[a].show){this.drawIChart(a)}}if(typeof(this.valuations)!="undefined"){for(var a in this.valuations){if((a!="FairValue"&&this.valuations[a]&&this.valuations[a].show)){this.drawIChart(a)}}}},freshAllCharts:function(){this.drawPChart();if(typeof(this.drawVChart)=="function"&&this.showVolume){this.drawVChart()}this._drawAllICharts()},getMiniTickSize:function(){if(this.miniChartFrequency=="minute"){return 23}else{if(this.miniChartFrequency=="d"){return 54}else{if(this.miniChartFrequency=="w"){return 10}else{if(this.miniChartFrequency=="m"){return 10}else{return 10}}}}},tickFormat:function(c){var b=this.chartData,a="";if(b.DataList!=null&&b.DataList[0].data!=null&&c<b.DataList[0].data.length&&b.DataList[0].data[c]!=null&&b.DataList[0].data[c].length){a=RTQ_ChartUtil.formatPChartXLabel(b.DataList[0].data[c][b.DataList[0].data[c].length-1],this.zoomRange,this._isIntradayTimSyle)}return a},getChartOption:function(a){var c=this.chartData,b=this;if(a=="priceLine"){return{xaxis:{mode:null,tickSize:this.ticksize,showLabel:true,labelWidth:60,labelHeight:12,ticks:this.Ticks,tickFormatter:function(d){return b.tickFormat(d)}},yaxis:{labelWidth:this.yLabelWidth,labelHeight:12,align:this.yaxisAlign,showLastLabel:this.isShowLastLabel,labelFormatter:function(d){return QS_NumFmt.Fmt2(d,true," ",b.precision||2)}},grid:{hoverable:true,clickable:true,color:this.colors.lableFontColor,tickColor:this.colors.gridColor,_borderColor:this.colors.borderColor},colors:this.tickerColors,candleStick:{upColor:typeof(QS_Style)!="undefined"&&QS_Style.greenFontColor?QS_Style.greenFontColor:"#008000",downColor:typeof(QS_Style)!="undefined"&&QS_Style.redFontColor?QS_Style.redFontColor:"#ff0000"},showGridLines:this.showGridLines}}else{if(a=="indicatorLines"){return{xaxis:{mode:null,tickSize:this.ticksize,showLabel:false,ticks:this.Ticks,tickFormatter:null},lines:{lineWidth:1,lineType:"line"},yaxis:{labelWidth:this.yLabelWidth,labelHeight:12,align:this.yaxisAlign,showLastLabel:this.isShowLastLabel,labelFormatter:function(d){return QS_NumFmt.Fmt2(d,true," ",b.precision||2)}},grid:{color:this.colors.lableFontColor,tickColor:this.colors.gridColor,_borderColor:this.colors.borderColor},colors:this.tickerColors,showGridLines:this.showGridLines}}else{if(a=="volumeBar"){return{xaxis:{mode:null,tickSize:this.ticksize,showLabel:false,ticks:this.Ticks,tickFormatter:null},yaxis:{labelWidth:this.yLabelWidth,labelHeight:12,min:0,align:this.yaxisAlign,showLastLabel:this.isShowLastLabel,labelFormatter:function(d){return QS_NumFmt.Fmt(Math.round(d*1000000),true)}},bars:{show:false,barWidth:1.5,lineWidth:0,fillColor:this.fillColors.vChart,isColorBar:true,upColor:typeof(QS_Style)!="undefined"&&QS_Style.greenFontColor?QS_Style.greenFontColor:"#008000",downColor:typeof(QS_Style)!="undefined"&&QS_Style.redFontColor?QS_Style.redFontColor:"#ff0000"},grid:{color:this.colors.lableFontColor,tickColor:this.colors.gridColor,_borderColor:this.colors.borderColor},colors:this.tickerColors,showGridLines:this.showGridLines}}else{if(a=="miniChart"){return{xaxis:{mode:null,tickSize:this.getMiniTickSize(),showLabel:true,tickFormatter:function(d){if(c.MiniChartData.length&&c.MiniChartData[0]!=null&&c.MiniChartData[0].length>d&&c.MiniChartData[0][d].length){return RTQ_ChartUtil.formatSChartXLabel(c.MiniChartData[0][d][c.MiniChartData[0][d].length-1],b.miniChartFrequency)}},labelWidth:50,labelHeight:8,posStyle:"inner"},yaxis:{labelWidth:0,labelHeight:12,showLabel:0,autoscaleMargin:0.02,ticks:[],align:this.yaxisAlign},lines:{fill:true,noLine:true,fillColor:this.fillColors.sChart,a:1},colors:this.tickerColors,grid:{borderWidth:0,color:this.colors.lableFontColor,tickColor:this.colors.gridColor,_borderColor:this.colors.borderColor},showGridLines:this.showGridLines}}}}}},sliderChartDataReady:function(e){var a=this._getDataBySymbol(e,this.mainTicker);var b=this.chartData;b.MiniChartData=a==null||!a.price?null:[a.price.data];if(b.MiniChartData&&b.MiniChartData.length){var c=b.MiniChartData[0];if(c&&c.length&&c[0]&&c[0].length){this.slider_StartDate=RTQ_ChartUtil.toDateFromIndex(c[0][c[0].length-1])}}if(this.miniChartFrequency=="minute"&&b.MiniChartData&&b.MiniChartData.length){this.rangSize=b.MiniChartData[0].length-1}else{this.rangSize=512}if(this.sliderObj==null){this._createSlider()}else{this.sliderObj.options.max=this.rangSize}this.setSliderHandleValues();this.drawSliderChart()},getChartData:function(g,a,f,b,e){var c=false,d=null;if(a=="line"){return{data:g,lines:{show:true,lineType:"line"},yaxis:f,color:b,lineW:e}}else{if(a=="mountain"){return{data:g,lines:{show:true,fill:true,fillColor:this.fillColors.pChart,a:0.7},yaxis:f,color:b,lineW:e}}else{if(a=="arealine"){return{data:g,lines:{show:true,fill:true,fillColor:this.fillColors.pChart,a:0.7},yaxis:f,color:b,lineW:e}}else{if(a=="points"){return{data:g,points:{show:true},yaxis:f,color:b}}else{if(a=="bars"){return{data:g,bars:{show:true},yaxis:f,color:b}}else{if(a=="candle"){return{data:g,candleStick:{show:true},yaxis:f}}else{if(a=="ohlc"){return{data:g,OLHC:{show:true,olhcType:"ohlc"},yaxis:f,color:b}}else{if(a=="hlc"){return{data:g,OLHC:{show:true,olhcType:"hlc"},yaxis:f,color:b}}else{if(a=="img"){return{data:g,imagePoints:{show:true},yaxis:f}}else{if(a=="VBPBar"){return{data:g,volumeByPrice:{show:true}}}else{return{data:g,lines:{show:true},yaxis:f,lineW:e}}}}}}}}}}}},getTicks:function(c,j){if(c==null||c.length<1){return null}this.xLabelAlign="left";var l=c.length,m,h,a=0,n=1;if(!isNaN(this._frequencyMap[j])){m=(c[l-1][c[l-1].length-1]-c[0][c[0].length-1])/86400000;h=new Date(c[0][c[0].length-1]);n=Math.round(c.length/(m*0.7))}else{a=1;m=c[l-1][c[l-1].length-1]-c[0][c[0].length-1];h=RTQ_ChartUtil.toDateFromIndex(c[0][c[0].length-1])}var o="d",g=1;var e=[];if(m<8){o="d",e.push([0,QS_DateFmt.getMonthDate(h)]);this.xLabelAlign="center"}else{if(m<=31){o="avg",e.push([0,QS_DateFmt.getMonthDate(h)]);this.xLabelAlign="center"}else{if(m<=61){o="w",e.push([0,QS_DateFmt.getMonthDate(h)])}else{if(m<=240){o="m",e.push([0,(h.getMonth()==0?h.getFullYear():QS_DateFmt.Mo[h.getMonth()])]);this.xLabelAlign="center"}else{if(m<=730){o="q";e.push([0,(h.getMonth()==0?h.getFullYear():QS_DateFmt.Mo[h.getMonth()])])}else{if(m<=2920){o="y",e.push([0,h.getFullYear()]);this.xLabelAlign="center"}else{o="5y",e.push([0,h.getFullYear()])}}}}}}var b=j=="w"?5:1;for(var k=1;k<l;k+=g){var p=RTQ_ChartUtil.toDateFromIndexOrTick(c[k][c[k].length-1],a);if(o=="d"||o=="avg"){if(h.getDate()!=p.getDate()){h=RTQ_ChartUtil.toDateFromIndexOrTick(c[k][c[k].length-1],a);e.push([k,QS_DateFmt.getMonthDate(h)])}}else{if(o=="w"){if(h.getDate()!=p.getDate()&&p.getDay()==b){h=RTQ_ChartUtil.toDateFromIndexOrTick(c[k][c[k].length-1],a);e.push([k,QS_DateFmt.getMonthDate(h)])}}else{if(o=="m"){if(h.getMonth()!=p.getMonth()){h=RTQ_ChartUtil.toDateFromIndexOrTick(c[k][c[k].length-1],a);e.push([k,(h.getMonth()==0?h.getFullYear():QS_DateFmt.Mo[h.getMonth()])])}}else{if(o=="q"){if(((p.getMonth()+1)%3==1)&&(h.getMonth()!=p.getMonth())){h=RTQ_ChartUtil.toDateFromIndexOrTick(c[k][c[k].length-1],a);e.push([k,(h.getMonth()==0?h.getFullYear():QS_DateFmt.Mo[h.getMonth()])])}}else{if(o=="y"){if(h.getFullYear()!=p.getFullYear()){h=RTQ_ChartUtil.toDateFromIndexOrTick(c[k][c[k].length-1],a);e.push([k,h.getFullYear()])}}else{if((h.getFullYear()!=p.getFullYear())&&(p.getFullYear()%5==0)){h=RTQ_ChartUtil.toDateFromIndexOrTick(c[k][c[k].length-1],a);e.push([k,h.getFullYear()])}}}}}}}return e},getSliderStartDate:function(){if(this.miniChartFrequency=="minute"){return this.sDates.lMin}else{if(this.miniChartFrequency=="d"){return this.sDates.d}else{if(this.miniChartFrequency=="w"){return this.sDates.w}else{if(this.miniChartFrequency=="m"){return this.sDates.m}else{return new Date(1900,0,1)}}}}},toDate:function(g){var a=this.chartData.MiniChartData;if(g==0){return this.slider_StartDate}else{var j;if(this.miniChartFrequency=="m"){var e=this.slider_EndDate.getMonth()-this.slider_StartDate.getMonth()+1;var f=this.slider_EndDate.getFullYear()-this.slider_StartDate.getFullYear();j=this.rangSize/(f*12+e);var h=(this.rangSize-g)/(12*j);var m=Math.floor(h);var n=Math.round((h-m)*12);curDate=new Date(this.slider_EndDate.getFullYear()-m,this.slider_EndDate.getMonth()-n,1);return curDate}else{if(this.miniChartFrequency=="d"||this.miniChartFrequency=="w"){var d=this.slider_EndDate.getTime()-this.slider_StartDate.getTime();if(d==0){return trimDate(this.latestTradeDate)}j=d*(this.rangSize-g)/this.rangSize;curDate=new Date(this.slider_EndDate.getTime()-j);return curDate}else{if(this.miniChartFrequency=="minute"){var b=Math.ceil(g);var k=(a[0][1]?a[0][1].length:a[0][0].length)-1;var c=b>=this.rangSize?a[0][this.rangSize][k]:a[0][b][k];return RTQ_ChartUtil.toDateFromIndex(c)}}}}},toPos:function(e){if(e==null){return 0}var n=this.chartData.MiniChartData;var j=0;if(this.miniChartFrequency=="m"){var p=this.slider_EndDate.getFullYear()-e.getFullYear();var n=this.slider_EndDate.getMonth()-e.getMonth();var l=p*12+n;var g=this.slider_EndDate.getMonth()-this.slider_StartDate.getMonth()+1;var h=this.slider_EndDate.getFullYear()-this.slider_StartDate.getFullYear();j=Math.round(this.rangSize-this.rangSize*l/(h*12+g))}else{if(this.miniChartFrequency=="d"||this.miniChartFrequency=="w"){var f=this.slider_EndDate.getTime()-this.slider_StartDate.getTime();var m=this.slider_EndDate.getTime()-e.getTime();if(f==0){return 0}j=Math.ceil(this.rangSize-this.rangSize*m/f)}else{if(this.miniChartFrequency=="minute"&&n!=null&&n.length&&n[0]&&n[0].length){var b=n[0],k=(n[0][1]?n[0][1].length:n[0][0].length)-1;var c=RTQ_ChartUtil.toDateIndex(e),a=false;for(var o=0;o<b.length;o++){if(b[o][k]>=c){j=o,a=true;break}}if(!a&&j==0){j=b.length-1}}}}if(j>this.rangSize){return this.rangSize}else{if(j<0){return 0}else{return j}}},setSliderHandleValues:function(){if(this.sliderObj!=null){var a=this.toPos(this.startDate),b=this.toPos(this.endDate);if(a==b){a--}this.sliderObj.setOption({values:[a,b]})}if(this.uiComponents.customDateB!=null){this.uiComponents.customDateB.setDate(this.startDate,this.endDate)}},_createSlider:function(){var a=this;if(this._contains.mChartContainer==null||this._contains.mChartContainer.length<1){return}var c=this.toPos(this.startDate);var b=this.toPos(this.endDate);if(this.sliderObj==null){this.sliderObj=new Util.Silder(this._contains.mChartContainer[0],{min:0,max:this.rangSize,values:[c,b]});this.sliderObj.onchange=function(d){a.onSliderRangeChanging(d)};this.sliderObj.onchanged=function(d){a.onSliderRangeChanged(d)}}},onSliderRangeChanging:function(f){if(this.isDrawing){return false}var b=this.uiComponents,a=this._elements;if(this.zoomRange!=11){if(b.rightMenu!=null){b.rightMenu.changeUIState(this.frequency,this.zoomRange,false);b.rightMenu.changeUIState(this.zoomRange,"zoom",false);b.rightMenu.changeUIState(11,"zoom",true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(this.frequency,this.zoomRange,false);b.tabZoomMenu.changeUIState(this.zoomRange,null,false);b.tabZoomMenu.changeUIState(11,null,true);a.tabmenuZoomEl.find(".rtq-ddl-ipt").html("Custom | "+this._frequencyTxtMap[this.frequency])}this.zoomRange=11;if(b.ddlZoom){b.ddlZoom.setTextValue("Custom","11")}}var c=this.toDate(f[0]);var d=this.toDate(f[1]);if(b.customDateB!=null){b.customDateB.setDate(c,d)}if(this._elements.legendElm!=null){this._elements.legendElm.find(".legend-date").html(RTQ_ChartUtil.formatMDYDate(c)+" - "+RTQ_ChartUtil.formatMDYDate(d))}},onSliderRangeChanged:function(d){var a=this.toDate(d[0]);var c=this.toDate(d[1]);this.startDate=a,this.endDate=c;this._clearZoomIn();this.zoomRange=11;var g=this.calculateFrequency(this.startDate);this.changeFrequency(g);this.drawChartSegment();if(typeof(this.datePeriodChanged)=="function"){this.datePeriodChanged({zoomRange:this.zoomRange,startDate:RTQ_ChartUtil.formatDate(a),endDate:RTQ_ChartUtil.formatDate(c)})}var b=this.miniChartFrequency;if(d[0]==0){b=this._upMiniFrequency()}else{if(this._frequencyIndexMap[g]<=0){b="minute"}else{if(this._frequencyIndexMap[g]>0&&this._frequencyIndexMap[g]<this._frequencyIndexMap[this.miniChartFrequency]){b=this._frequencyIndexMap[g]<1?"minute":g=="w"?"m":g}}}if(this.noHistoricalData||!this.requencyMenuCfg.history){b="minute"}else{if(!this.requencyMenuCfg.intraday&&this.requencyMenuCfg.history&&b=="minute"){b="d"}}if(this.miniChartFrequency!=b){this.miniChartFrequency=b;this.getSilderChartData()}},_getDateRangeString:function(){var a=this.chartData.DataList;if(!a||!a.length||!a[0]||!a[0].data||!a[0].data.length){return""}if(RTQ_ChartUtil.compareDateByday(this.startDate,this.endDate)&&this._frequencyIndexMap[this.frequency]<1){var b=a[0].data[0][a[0].data[0].length-1],c=a[0].data[a[0].data.length-1][a[0].data[a[0].data.length-1].length-1];if(this.UIConfig.onedayDateRangeFormat==0){return QS_DateFmt.getDateString(new Date(b))+"("+QS_DateFmt.getTimeString(new Date(b))+"-"+QS_DateFmt.getTimeString(new Date(c))+")"+this.timezone}else{return RTQ_ChartUtil.formatLegendDate(b,this.frequency)+" - "+RTQ_ChartUtil.formatLegendDate(c,this.frequency)+" "+this.timezone}}else{return RTQ_ChartUtil.formatMDYDate(this.startDate)+" - "+RTQ_ChartUtil.formatMDYDate(this.endDate)}},buildLegend:function(c,z,n,j){var h=this._elements,x=this.chartData;if(this.isDrawing){h.crosshairLegendWin.hide();h.lineXElm.hide();h.lineYElm.hide();return false}var e="";if(this.frequency=="w"){e=QSLGTXT.week+"&nbsp;"+QSLGTXT.of+"&nbsp;"}else{if(this.frequency=="m"){e=""}}if((this.chartCursor==3||!this.pChartReady)&&!n){return false}var a="",l="",k,o="",y=(n||c==null||c.dataIndex==null)?-1:c.dataIndex;var t;if(this.chartCursor==0||n){if(this.UIConfig.showDateRangeInLengend==1){if(y>0){l=(c==null)?"--":e+RTQ_ChartUtil.formatLegendDate(c.datapoint[c.datapoint.length-1],this.frequency);a='<div class="legend-date">'+l+"</div>"}else{if(this.legendInfo.showDateRangeString){a='<div class="legend-date">'+this._getDateRangeString()+"</div>"}}}if(this.showVolume){o=" "+QSLGTXT.cvolume+":"+this.getVolInfo(y)}}else{l=(y<0||c.datapoint==null)?"":e+RTQ_ChartUtil.formatLegendDate(c.datapoint[c.datapoint.length-1],this.frequency)}if(!n&&typeof(this.chartMouseoverCallback)=="function"&&this.chartCursor==0){this.chartMouseoverCallback(y,x.DataList,x.VolList,this.startDate,this.endDate);if(!n&&c!=null&&this.zoomRange>2&&(this.events.dividend||this.events.splits||this.events.earnings)){this.buildEventLegend(c,false)}if(!n&&c!=null&&c.dataIndex!=null){this.buildIChartLegend(c.dataIndex)}return}else{if(n&&typeof(this.chartMouseoutCallback)=="function"){this.chartMouseoutCallback(-1,x.DataList,x.VolList,this.startDate,this.endDate);return}}if(this.chartCursor==1&&!n){a+=this.createLegendCrosshairRow(-1,null,null,null,l)}if(x.DataList&&x.DataList.length&&x.DataList.length>0){var C=(this.compairTickers.length>0&&this.chartStyle!="growth10"&&this.chartStyle!="growth"&&this.chartStyle!="dEffect")?true:false;var q=x.DataList.length,p,u,B,m,A,s;for(var g=0;g<q;g++){if(x.DataList[g].name=="PrevClose"){continue}A=x.DataList[g].legend;if(n){p=x.DataList[g].data&&x.DataList[g].data.length?x.DataList[g].data[x.DataList[g].data.length-1]:null;B=g;if((x.DataList[g].name=="BBands"||x.DataList[g].name=="PChannel"||x.DataList[g].name=="MAE"||x.DataList[g].name=="Keltner")&&x.DataList[g].sq==0){continue}if(x.DataList[g].name=="BBands"||x.DataList[g].name=="PChannel"||x.DataList[g].name=="MAE"||x.DataList[g].name=="Keltner"){A=x.DataList[g].pre}if(j){u=p==null||!p.length?"--":this.getReturnValue(p[1],C,x.DataList[g])}else{u=""}s="name="+x.DataList[g].name+" seq="+g;if(typeof(x.DataList[g].sq)!="undefined"){s+=" sq="+x.DataList[g].sq}if(typeof(x.DataList[g].num)!="undefined"){s+=" num="+x.DataList[g].num}}else{if(x.DataList[g].name=="VBP"){continue}p=x.DataList[g].data&&x.DataList[g].data.length&&y<x.DataList[g].data.length?x.DataList[g].data[y]:null;if((x.DataList[g].name=="BBands"||x.DataList[g].name=="PChannel"||x.DataList[g].name=="MAE"||x.DataList[g].name=="Keltner")&&x.DataList[g].sq==0){m=p==null?"--":this.getPriceValue(p[1],C,x.DataList[g].startPos);continue}if(g==0){B=0;var b=C;t=p==null?"--":this.getPriceValue(p[1],b,x.DataList[g].startPos);if(this.chartCursor==0){if(this.chartStyle=="growth"||this.chartStyle=="growth10"||this.chartStyle=="dEffect"||this.chartStyle=="postTax"){u=p==null||p.length<3?"--":this.getPriceValue(p[1],b,x.DataList[g].startPos)}else{if(this.legendInfo.OHLC&&!this.legendInfo.onlyIncludeLast){u=p==null||p.length<5?"--":(" "+QSLGTXT.shortopen+":"+this.getPriceValue(p[4],b,x.DataList[g].startPos)+" "+QSLGTXT.shorthigh+":"+this.getPriceValue(p[2],b,x.DataList[g].startPos)+" "+QSLGTXT.shortlow+":"+this.getPriceValue(p[3],b,x.DataList[g].startPos)+" "+QSLGTXT.shortclose+":"+(this.getPriceValue(p[1],b,x.DataList[g].startPos)))}else{u=p==null||p.length<2?"--":this.getPriceValue(p[1],b,x.DataList[g].startPos)}}if(this.legendInfo.Volume){u+=o}}else{if(this.chartStyle=="growth"||this.chartStyle=="growth10"||this.chartStyle=="dEffect"||this.chartStyle=="postTax"){B=1;u=[(p==null?"--":this.getPriceValue(p[1],b,x.DataList[g].startPos)),this.legendInfo.Volume?this.getVolInfo(y):""]}else{if(this.legendInfo.OHLC){u=p==null||p.length<5?["--","--","--","--",this.getVolInfo(y)]:[this.getPriceValue(p[4],b,x.DataList[g].startPos),this.getPriceValue(p[2],b,x.DataList[g].startPos),this.getPriceValue(p[1],b,x.DataList[g].startPos),this.getPriceValue(p[3],b,x.DataList[g].startPos),this.getVolInfo(y)]}else{B=-2;u=p==null||p.length<2?["--"]:[this.getPriceValue(p[1],b,x.DataList[g].startPos)]}}}}else{B=2;u=p==null?"--":this.getPriceValue(p[1],b,x.DataList[g].startPos);if(x.DataList[g].name=="BBands"||x.DataList[g].name=="PChannel"||x.DataList[g].name=="MAE"){u="U:"+m+" L:"+u;A=x.DataList[g].pre}if(x.DataList[g].name=="Keltner"){if(x.DataList[g].legend!="U"&&x.DataList[g].legend!="L"){A=x.DataList[g].pre}else{u="U:"+m+" L:"+u;A=x.DataList[g].pre}}}}if(this.chartCursor==0||n){a+=this.createLegendSpan(B,A,u,x.DataList[g].colorIndex,s,x.DataList[g].type)}else{a+=this.createLegendCrosshairRow(B,A,u,x.DataList[g].colorIndex,l)}}}var r="",w,v,f=this.legendInfo.onlyIncludeLast?130:180;if(this.chartCursor==0||n){r=this.buildEventLegend(c,false);if(r!=""){h.crosshairLegendElm.html(this.createLegendCrosshairRow(-1,null,null,null,l)+r);w=z.pageX-this.chartOffset.left,v=z.pageY-this.chartOffset.top;if(w+f>this.chartWidth){w=w-f}h.crosshairLegendWin.css({left:w+2,top:v+2}).show()}else{h.crosshairLegendWin.hide()}if(h.legendElm!=null){h.legendElm.html(a)}}else{if(this.chartCursor==1){a+=this.buildEventLegend(c,true);w=z.pageX-this.chartOffset.left,v=z.pageY-this.chartOffset.top;h.lineXElm.css({top:v});h.lineYElm.css({left:w});if(c!=null){h.xLabelElm.html(QS_NumFmt.Fmt2(c.y,true," ",this.precision||2))}h.lineXElm.show(),h.lineYElm.show();if(w+f>this.chartWidth){w=w-f}h.crosshairLegendWin.css({left:w+4,top:v+4}).show();h.crosshairLegendElm.html(a)}else{if(this.chartCursor==4){if(y>-1&&typeof(c.py)!="undefined"&&c.py!=null){h.lineXElm.css({top:c.py+"px",border:0}).show(),h.lineYElm.hide();h.xLabelElm.html(t).show()}else{h.xLabelElm.hide()}}}}if(!n&&c!=null&&c.dataIndex!=null){if(typeof(this.buildVolLegend)!="undefined"){this.buildVolLegend(c.dataIndex)}this.buildIChartLegend(c.dataIndex)}else{if(n){if(typeof(this.buildVolLegend)!="undefined"){this.buildVolLegend(-1)}this.buildIChartLegend(-1)}}},formatIndicatorNum:function(d,a,c,b){if(d==null||d.length<=a){return"--"}else{if(d[a]==null||d[a].data==null||d[a].data.length<=c){return"--"}else{return(d[a].data[c]==null||d[a].data[c].length<=1?"--":QS_NumFmt.Fmt2(d[a].data[c][1],true," ",b))}}},buildSingleIChartLegend:function(c,g,d,e){var f="";var a=c=="FVolatility"?3:2;for(var b=0;b<d.length;b++){f+='<span class="rtc-lg-icn'+b+'" style ="color:'+this.tickerColors[b]+'">';f+=d[b]+(e==-1?"":(":"+this.formatIndicatorNum(g,b,e,a)))+"</span>&nbsp;&nbsp;"}f+='<span class="rtc-legend-remove rtc-remove-hide rtc-legend-right"></span>';if(this.iChartContainers[c]){this.iChartContainers[c].find(".legend").html(f)}},buildEventLegend:function(l,j){str="";if(l==null||this.chartData.eventInfoList==null){return str}var c=l.dataIndex,a=!j;var h=[],k=false,f="",e;if((this.events.dividend||this.events.splits||this.events.earnings)&&typeof(this.chartData.eventInfoList[c])!="undefined"){var b=this.chartData.eventInfoList[c];if(b.length<1){return""}for(var g=b.length-1;g>=0;g--){e=this.frequency=="w"||this.frequency=="m"?(" | "+RTQ_ChartUtil.formatMDYDate(RTQ_ChartUtil.toDateFromIndex(b[g]["dIndex"]))):"";f=b[g].type==1?"rtc-lg-dividend":(b[g].type==2?"rtc-lg-splits":(b[g].type==3?"rtc-lg-earnings-down":"rtc-lg-earnings-up"));str+='<div class="rtc-legend-row'+(a?"-top1":"")+'"><strong class="'+f+'">'+b[g].name+"</strong><span>"+b[g].val+e+"</span></div>";a=false}}return str},buildIChartLegend:function(c){var b,d;for(var a in this.iChartContainers){if((this.indicatorsData[a]&&this.indicatorsData[a].show)||(this.valuations&&this.valuations[a]&&this.valuations[a].show)){if(a=="MACD"){b=this.indicatorsData.MACD;d=[QSLGIN.macd_lg+"("+b.parameter[0]+","+b.parameter[1]+")",QSLGIN.ema_lg+"("+b.parameter[2]+")",QSLGIN.macd_lg1]}else{if(a=="RSI"){d=[QSLGIN.rsi_lg+"("+this.indicatorsData.RSI.parameter[0]+")"]}else{if(a=="ROC"){d=[QSLGIN.roc_lg+"("+this.indicatorsData.ROC.parameter[0]+")"]}else{if(a=="WillR"){d=[QSLGIN.willr_lg+"("+this.indicatorsData.WillR.parameter[0]+")"]}else{if(a=="SStochastic"){b=this.indicatorsData.SStochastic;d=[QSLGIN.sstochastic_lg+": %K("+b.parameter[0]+")","%D("+b.parameter[1]+")"]}else{if(a=="FStochastic"){b=this.indicatorsData.FStochastic;d=[QSLGIN.fstochastic_lg+": %K("+b.parameter[0]+")","%D("+b.parameter[1]+")"]}else{if(a=="DMI"){d=[QSLGIN.dmi_lg,QSLGIN.dmi_lg1,QSLGIN.dmi_lg2]}else{if(a=="ULT"){d=[QSLGIN.ult_lg]}else{if(a=="Momentum"){d=[QSLGIN.momentum_lg+"("+this.indicatorsData.Momentum.parameter[0]+")"]}else{if(a=="VAcc"){d=[QSLGIN.vacc_lg]}else{if(a=="MFI"){d=[QSLGIN.mfi_lg+"("+this.indicatorsData.MFI.parameter[0]+")"]}else{if(a=="UDRatio"){d=[QSLGIN.udratio_lg+"("+this.indicatorsData.UDRatio.parameter[0]+","+this.indicatorsData.UDRatio.parameter[1]+")"]}else{if(a=="OBV"){d=[QSLGIN.obv_lg]}else{if(a=="FVolatility"){d=[QSLGIN.fvolatility_lg]}else{if(a=="AccDis"){d=[QSLGIN.accdis_lg]}else{if(a=="Mass"){d=[QSLGIN.mass_lg]}else{if(a=="Volatility"){d=[QSLGIN.volatility_lg+"("+this.indicatorsData.Volatility.parameter[0]+","+this.indicatorsData.Volatility.parameter[1]+")"]}else{if(a=="VPlus"||a=="Volume"){d=[this.indicatorUI[this.uiComponents.miniChartRightMenu.owner].title];a=this.uiComponents.miniChartRightMenu.owner}else{if(a=="ForceIndex"){d=[QSLGIN.forceindex_lg+"("+this.indicatorsData.ForceIndex.parameter[0]+")"]}else{if(a=="ATR"){d=[QSLGIN.atr_lg]}else{if(a=="Keltner"){d=[QSLGIN.keltner_lg+"("+this.indicatorsData.Keltner.parameter[0]+","+this.indicatorsData.Keltner.parameter[1]+","+this.indicatorsData.Keltner.parameter[2]+")"]}else{d=[this.valuations[a].name+" "]}}}}}}}}}}}}}}}}}}}}}this.buildSingleIChartLegend(a,this.iChartData[a],d,c)}}},getVolInfo:function(b){var c=this.chartData;var a=(!c.VolList||!c.VolList.length||!c.VolList[0].data||b>c.VolList[0].data.length||c.VolList[0].data[b]==null)?NaN:c.VolList[0].data[b][1];return QS_NumFmt.Fmt(a*1000000,true)},getPriceValue:function(b,a,d){var c=(a)?(d*(100+b)/100):b;return QS_NumFmt.Fmt2(c,true," ",this.precision||2)},getReturnValue:function(c,a,k){var j="",f="",b=k.startPos;if(b==null){b=(k!=null&&k.data&&k.data.length)?k.data[0][1]:NaN}if(isNaN(c)&&k.data.length){for(var g=k.data.length-1;g>=0;g--){if(k.data[g]&&!isNaN(k.data[g][1])){c=k.data[g][1];break}}}if(isNaN(b)){f="--"}else{var h=a?(b*c/100):(c-b);j=(h>0)?"green":"red";var e=a?c:100*h/b;f=isNaN(e)?"--":QS_NumFmt.Fmt2(h,true," ",this.precision||2)+"|"+QS_NumFmt.Fmt2(e,true," ",this.precision||2)+QSLGTXT.percent}return"<span style='color:"+j+"'>"+f+"</span>"},mouseOutChart:function(){var a=this._elements;var b=this.UIConfig.chartCtrl=="default"?true:false;if(this.chartCursor==1){a.crosshairLegendWin.hide();a.lineXElm.hide();a.lineYElm.hide()}this.buildLegend(null,null,true,b)},clearHighlight:function(){if(this.pFlot!=null){this.pFlot.clearHighlights()}},chartMouseOut:function(){var a=this;if(this.mainTicker==""||this.mainTicker==null){return false}this.timeout=setTimeout(function(){a.clearHighlight();a.mouseOutChart()},100)},createLegendSpan:function(b,c,h,g,a,k){var e=g==-1?this.fillColors.vChart:this.tickerColors[g],d=h==""?"":":"+h,f="";var j=k=="undefined"?"":k;if(b==0){f='<div data-type = "'+j+'" class = "rtc-main-legend rtc-legend-bold rtc-lg-icn'+g+'" style="color:'+e+'">'+c+d+"</div>"}else{f='<div class="rtc-legend"  '+a+'><span data-type = "'+j+'" class = "rtc-lg-icn'+g+'" style="color:'+e+'">';f+=c+d+'</span><span class="rtc-legend-remove rtc-remove-hide"></span></div>'}return f},createLegendCrosshairRow:function(a,b,e,d,j){var c="";var f=a<2?"rtc-legend-row-top":"rtc-legend-row";var h="rtc-lg-icn"+d;if(a>=2){c+='<div class="rtc-legend-row" ><strong class="'+h+'">'+b+":</strong><span>"+e+"</span></div>"}else{if(a==0){if(this.legendInfo.onlyIncludeLast){c+='<div class="'+f+'"><strong class="'+h+'">'+b+"</strong><span>"+QSLGTXT.close+":"+e[2]+"</span></div>";if(this.showVolume){c+='<div class="rtc-legend-row-top" ><span>&nbsp;&nbsp;'+QSLGTXT.cvolume+":</span><span>"+e[4]+"</span></div>"}}else{c+='<div class="'+f+'"><strong class="'+h+'">'+b+"</strong></div>";c+='<div  class="rtc-legend-table"><table cellpadding="0" cellspacing="0">';c+='<tr><td><span class="left">'+QSLGTXT.open+':</span><span class="right">'+e[0]+'</span></td><td class="td-mid">&nbsp;</td>';c+='<td><span class="left">'+QSLGTXT.high+':</span><span class="right">'+e[1]+"</span></td></tr>";c+='<tr><td><span class="left">'+QSLGTXT.close+':</span><span class="right">'+e[2]+'</span></td><td class="td-mid">&nbsp;</td>';c+='<td><span class="left">'+QSLGTXT.low+':</span><span class="right">'+e[3]+"</span></td></tr>";if(this.showVolume){c+='<tr><td style="border-bottom:0" colspan="3"><span class="left">'+QSLGTXT.cvolume+':</span><span class="right">'+e[4]+"</span></td></tr>"}}c+="</table></div>"}else{if(a==-2){c+='<div class="'+f+'"><strong class="'+h+'">'+b+"</strong></div>";c+='<div  class="rtc-legend-table"><table cellpadding="0" cellspacing="0">';c+="<tr><td>";c+='<span class="left">'+QSLGTXT.nav+':</span><span class="right">'+e[0]+"</span></td></tr></table></div>"}else{if(a==1){var g=this.chartStyle=="growth"||this.chartStyle=="dEffect"?QSLGTXT.pergrowth:QSLGTXT.price;if(this.chartStyle=="growth10"){g=QSLGTXT.tenkgrowth}else{if(this.chartStyle=="postTax"){g=QSLGTXT.posttaxreturn}}c+='<div class="'+f+'"><strong class="'+h+'">'+b+"</strong></div>";c+='<div  class="rtc-legend-table"><table cellpadding="0" cellspacing="0"><tr><td><span class="left">';c+=g+':</span><span class="right">'+e[0]+"</span></td></tr>";if(e[1]&&e[1]!=""){c+='<tr><td style="border-bottom:0"><span class="left">'+QSLGTXT.cvolume+':</span><span class="right">'+e[1]+"</span></td></tr>"}c+="</table></div>"}else{if(a==-1){c+='<div class="rtc-legend-row-date"><strong>'+j+"</strong></div>"}}}}}return c},legendOnClick:function(c){var f=c.attr("name"),d=c.attr("seq"),e=c.attr("sq"),g=c.attr("num");var a=this._elements;if(f!="MReturnIndex"){c.remove()}var b=false;if(f=="SMA"||f=="EMA"){b=this.removeIndicators(f,g)}else{if(f=="BBands"||f=="PSAR"||f=="PChannel"||f=="MAE"||f=="VBP"||f=="WMA"||f=="Keltner"){b=this.removeIndicators(f)}else{if(f=="SMAV"){b=this.removeIndicators(f)}else{if(f=="FairValue"){this.removeValuations(f);a.valuationULElm.find("a[value='"+f+"']").addClass("rtq-chkbox_off");this.changeRightMenuClass(2,f,false)}else{if(f=="_iiv"){this.switchIIV(false);if(typeof(this.afterSwitchIIV)=="function"){this.afterSwitchIIV({showIIVTicker:this.showIIVTicker})}if(this.uiComponents.chkIIV!=null){this.uiComponents.chkIIV.btns.showIIV.inverse()}}else{this.removeCompairTicker(f);if(this.indexsMap&&this.indexsMap[f]){this.indexsMap[f].show=false;a.indexsULElm.find("a[value='"+f+"']").addClass("rtq-chkbox_off")}if(a.relatedSecULElm){a.relatedSecULElm.find("a[value='"+f+"']").addClass("rtq-chkbox_off")}}}}}}if(b){a.indicatorULElm.find("a[value='"+f+"']").addClass("rtq-chkbox_off");this.changeRightMenuClass(2,f,false);this.changeRightMenuClass(2,"SMAV",false)}if(this.UIConfig.chartCtrl=="default"&&f=="SMA"&&a.m1!=null){e==0?a.m1.val(""):e==1?a.m2.val(""):a.m3.val("")}},iChartLegendOnclick:function(c){var a=this._elements;var b=this.removeIChart(c);if(b!=null){if(b=="indicator"){a.indicatorULElm.find("a[value='"+c+"']").addClass("rtq-chkbox_off");this.changeRightMenuClass(2,c,false);if(typeof(this.afterRemoveIndicators)=="function"){this.afterRemoveIndicators({indicatorName:c,paras:null})}}else{if(b=="fundamental"){a.valuationULElm.find("a[value='"+c+"']").addClass("rtq-chkbox_off");this.changeRightMenuClass(2,c,false);if(typeof(this.afterRemoveValuationCallback)=="function"){this.afterRemoveValuationCallback({name:c})}}}}},removeIChart:function(a){var b=null;if(this.iChartContainers[a]){this.iChartContainers[a].hide();if(this.UIConfig.autoHeight){this.outHeight-=this.iChartHeight}}if(this.indicatorsData.hasOwnProperty(a)){if(this.indicatorsData[a].show){this.indicatorsData[a].show=false;b="indicator"}}else{this.valuations[a].show=false;b="fundamental"}this.iChartData[a]=[];this.changeOutSize(this.chartWidth,this.outHeight);return b},_removeDataRowFromDataList:function(b,c){if(!this.chartData.DataList.length){return}for(var a=0;a<this.chartData.DataList.length;a++){if(this.chartData.DataList[a].name==b){if((this.chartData.DataList[a].sq==c)||typeof(c)=="undefined"){this.chartData.DataList.splice(a,1);a--}}}},changeRightMenuClass:function(a,b,d){var c=this.uiComponents;if(c.rightMenu!=null){c.rightMenu.changeItemClass(b,null,"rtq-menu-on",d)}if(typeof(c.miniChartRightMenu.menu)!="undefined"&&c.miniChartRightMenu.menu!=null){c.miniChartRightMenu.menu.changeItemClass(b,null,"rtq-menu-on",d)}},removeIndicatorClicked:function(b){var a=this._elements;var d=this._selectedIndicatorName;a.indicatorWinElm.hide();var c=this.removeIndicators(d);if(c){a.indicatorULElm.find("a[value='"+d+"']").addClass("rtq-chkbox_off");if(this.UIConfig.RightMenu){this.changeRightMenuClass(0,d,false)}if(d=="Volume"){a.indicatorULElm.find("a[value='VPlus']").addClass("rtq-chkbox_off");a.indicatorULElm.find("a[value='SMAV']").addClass("rtq-chkbox_off")}else{if(d=="VPlus"){a.indicatorULElm.find("a[value='Volume']").addClass("rtq-chkbox_off");a.indicatorULElm.find("a[value='SMAV']").addClass("rtq-chkbox_off")}}}},checkCompairTicker:function(b){if(b.toUpperCase()==this.mainTicker.toUpperCase()){return true}for(var a=0;a<this.compairTickers.length;a++){if(this.compairTickers[a].toUpperCase()==b.toUpperCase()){return true}}return false},bacthUnscribeTickers:function(a){if(typeof(this.tValidation)=="object"&&typeof(gIdMap)=="object"){this.tValidation.unSubscribe(a)}else{}},_getIChartType:function(a){if(this.valuations&&typeof(this.valuations[a])!="undefined"){return"va"}else{if(this.indicatorsData&&typeof(this.indicatorsData[a])!="undefined"){return"in"}}return"button"},preSwitchIChart:function(){var a=this.ichartSiwtchIndicatorWin;var f=this.switchIChart(a.oldName,a.newName);var d=this._getIChartType(a.oldName),e=this._getIChartType(a.newName);a.data.el.addClass("rtq-menu-on");if(f){this.changeRightMenuClass(2,a.oldName,false);this.changeRightMenuClass(2,a.newName,true);var c=d=="in"?this._elements.indicatorULElm:this._elements.valuationULElm;var b=e=="in"?this._elements.indicatorULElm:this._elements.valuationULElm;c.find("a[value='"+a.oldName+"']").addClass("rtq-chkbox_off");b.find("a[value='"+a.newName+"']").removeClass("rtq-chkbox_off")}a.flag=false},switchIChart:function(f,c){var a=this._getIChartType(f),e=this._getIChartType(c);var d=this.iChartContainers[c];this.iChartContainers[c]=this.iChartContainers[f];this.iChartContainers[f]=d;if(typeof(this.iChartContainers[f])!="undefined"&&this.iChartContainers[f]!=null){this.iChartContainers[f].attr("name",f)}var b=this.iFlots[c];this.iFlots[c]=this.iFlots[f];this.iFlots[f]=b;if(a=="in"){this.indicatorsData[f].show=false}else{if(a=="va"){this.valuations[f].show=false}}if(e=="in"){}else{if(e=="va"){this.addValuations(c)}}return true},_onIchartMenuItemClicked:function(d,g){var f=this.uiComponents.miniChartRightMenu.owner,c=g.data.val;var a=this._getIChartType(f),e=this._getIChartType(c);if(c=="edit"&&e=="button"){if(a=="in"&&this.indicatorsData[f].show){if(this.indicatorUI[f].parameter.length>0){this.showIndicatorWin(f)}}}else{if(a!="button"||e!="button"){if(e=="in"&&this.indicatorsData[c].show){if(this.indicatorUI[c].parameter.length>0){this.showIndicatorWin(c)}else{return false}}if(e=="va"&&this.valuations[c].show){return false}}}var b=false;if(e=="in"){this.ichartSiwtchIndicatorWin={flag:true,oldName:f,newName:c,data:g};if(this.indicatorUI[c].parameter.length==0){this.preSwitchIChart()}this.showIndicatorWin(c)}else{if(e=="va"){this.ichartSiwtchIndicatorWin={flag:true,oldName:f,newName:c,data:g};this.preSwitchIChart()}}if(this.uiComponents.miniChartRightMenu.menu!=null){this.uiComponents.miniChartRightMenu.menu.hide()}},_getSecurityType:function(c,a,b){var d=a;if(a==8){if(c==127&&(typeof(b)=="string"&&b.toUpperCase()=="ST")||b.toUpperCase()=="FC"){d=1}}return d},acceptTicker:function(a){if(a!=null&&a!=""){this.validateMainTicker(a)}},checkTickerInfo:function(b,a){if(b==""){return false}var c=this.dataUrl.getTickerInfoURL+"symbol="+b;$.getJSON(c+"&cb=?",a)},validateSavedTickers:function(b){if(typeof(this.tValidation)=="object"&&typeof(gIdMap)!="undefined"&&typeof(gData)!="undefined"){var c=this;this.tValidation.checkTickers(b,function(f){var d,j,g=[];c.compairTickers=[];if(f&&f.length>0){for(var e=0;e<f.length;e++){j=gData[f[e]]["mType"];d=gData[f[e]]["type"]==8?gData[f[e]]["secId"]:gData[f[e]]["performanceId"];var h=gData[f[e]];h.gkey=f[e];GB_ChartDataManager.registerSymbol(h);if(!c.tickerInfos[d]){c.tickerInfos[d]={exch:gData[f[e]]["exch"],ticker:gData[f[e]]["ticker"],clientTicker:gData[f[e]]["clientTicker"],gkey:f[e],mType:j}}if(e==0){c.mainTicker=d;GB_ChartDataManager.registerChart(d,c.id);if(c.sType!=j){c._securityTypeChanged(c.sType,j);c._toggleFundamentalItem(c.sType,j)}c._filterFrequencyMenuData(gData[f[e]],true);c.noHistoricalData=gData[f[e]]["noPID"];c.sType=j;if(j=="FE"){c.iivTicker=d+"IIV";if(gIdMap[c.iivTicker]){GB_ChartDataManager.registerSymbol(gData[gIdMap[c.iivTicker]]);c.tickerInfos[c.iivTicker]={exch:gData[gIdMap[c.iivTicker]]["exch"],ticker:gData[gIdMap[c.iivTicker]]["ticker"],clientTicker:gData[gIdMap[c.iivTicker]]["clientTicker"],gkey:gData[gIdMap[c.iivTicker]]["gkey"]};if(c._elements.iivContainer){c._elements.iivContainer.show()}}else{c.iivTicker=""}}else{if(c._elements.iivContainer){c._elements.iivContainer.hide()}}}else{c.compairTickers.push(d);g.push(c.tickerInfos[d])}}c.initComponent();if(typeof(c.afterAcceptTickers)=="function"){c.afterAcceptTickers({mainTicker:c.tickerInfos[c.mainTicker]})}if(typeof(c.afterAddTickers)=="function"&&g.length){c.afterAddTickers({symbol:g})}}})}else{for(var a=0;a<b.length;a++){if(a!=0&&this.tickerInfos[b[a]]){GB_ChartDataManager.registerSymbol(this.tickerInfos[b[a]])}}this.mainTicker="";var c=this;this.checkTickerInfo(b[0],function(e){c.onMainTickerChanged(e)})}},_filterFrequencyMenuData:function(b,c){var a={};if(c){a=$.extend(a,this.defaultFrequencyMenuCfg)}if(!b.tenforeTicker||(typeof(mockExchangeCode)!="undefined"&&b.tenforeCode==mockExchangeCode)){a.intraday=false}if((!b.secId&&!b.performanceId)||b.noPID){a.history=false}if(b.type=="FO"){a.intraday=false}this.reBindFrequencyMenuData(a,c)},reBindFrequencyMenuData:function(e,c){var a=$.extend({intraday:true,history:true,customer:true},e);var f=false;for(var b in this.requencyMenuCfg){if(this.requencyMenuCfg[b]!==a[b]){f=true}}if(!f&&typeof(c)=="undefined"){return}this.requencyMenuCfg=a;if(!this.requencyMenuCfg.intraday&&this.requencyMenuCfg.history){if(this.miniChartFrequency=="minute"){this.miniChartFrequency="d"}if(this.zoomRange<3||this.zoomRange==13){this.zoomRange=3}if(this._frequencyIndexMap[this.frequency]<1){this.frequency="d"}}else{if(this.requencyMenuCfg.intraday&&!this.requencyMenuCfg.history){if(this.miniChartFrequency=="d"||this.miniChartFrequency=="w"){this.miniChartFrequency="minute"}if(this.zoomRange>4&&this.zoomRange!=13&&this.zoomRange!=14){this.zoomRange=1}if(this._frequencyIndexMap[this.frequency]>0){this.frequency="minute"}}}var d=this._getZoomListData(a.intraday,a.history,a.customer);if(this.uiComponents.tabZoomMenu!=null){this.uiComponents.tabZoomMenu.reBind(d)}if(this.uiComponents.ddlZoom!=null){this.uiComponents.ddlZoom.rebindData(d)}if(this.uiComponents.rightMenu!=null){this.uiComponents.rightMenu.reBindSecondLevelMenu("zoom",d,1)}if(this.uiComponents.ddlZoom!=null){this.uiComponents.ddlZoom.setTextValue(null,this.zoomRange)}if(typeof(this.afterZoomMenuRebind)=="function"){this.afterZoomMenuRebind(d)}},_getZoomListData:function(a,d,c){var b=[];if(a&&!d){this.sMinuteFreMenuData.splice(4,1);this.lMinuteFreMenuData.splice(2,2)}if(a){b=b.concat([{txt:"1 "+QSLGTXT.shortday,val:"1",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.intradayFreMenuData},{txt:"5 "+QSLGTXT.shortday,val:"2",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.intradayFreMenuData},{txt:"15 "+QSLGTXT.shortday,val:"13",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.sMinuteFreMenuData}])}if(a||d){b=b.concat([{txt:"1 "+QSLGTXT.shortmonth,val:"3",type:"ratio",catekey:"zoom",selectable:false,subMenu:(a?this.sMinuteFreMenuData:this.dailyFreMenuData)},{txt:"2 "+QSLGTXT.shortmonth,val:"14",type:"ratio",catekey:"zoom",selectable:false,subMenu:(a?this.lMinuteFreMenuData:this.dailyFreMenuData)},{txt:"3 "+QSLGTXT.shortmonth,val:"4",type:"ratio",catekey:"zoom",selectable:false,subMenu:(a?this.lMinuteFreMenuData:this.dailyFreMenuData)}])}if(d){b=b.concat([{txt:QSLGTXT.ytd,val:"5",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"1 "+QSLGTXT.shortyear,val:"6",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"3 "+QSLGTXT.shortyear,val:"7",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"5 "+QSLGTXT.shortyear,val:"8",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"10 "+QSLGTXT.shortyear,val:"9",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:QSLGTXT.max,val:"10",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.monthlyFreMenuData}])}if(c){b=b.concat([{txt:QSLGTXT.custom,val:"11",type:"ratio"}])}return b},validateMainTicker:function(a){if(typeof(this.tValidation)=="object"&&typeof(gIdMap)!="undefined"&&typeof(gData)!="undefined"){var b=this;this.tValidation.checkTickers(a,function(f){if(typeof(b.hideLoading)=="function"&&typeof(f)!="undefined"&&f.length==0){b.hideLoading()}if(f&&f.length>0){var d=b._getSecurityType(gData[f[0]]["tenforeCode"],gData[f[0]]["type"],gData[f[0]]["mType"]);var h=gData[f[0]]["mType"];var j=d==8?gData[f[0]]["secId"]:gData[f[0]]["performanceId"];if(($.inArray(parseInt(d),b.securityType)==-1&&$.inArray(h,b.securityType)==-1)||b.mainTicker==j){return}if(b.mainTicker!=""){GB_ChartDataManager.unregisterSymbol(b.mainTicker);GB_ChartDataManager.unregisterChart(b.mainTicker,b.id);b.bacthUnscribeTickers([b.mainTicker]);delete b.tickerInfos[b.mainTicker]}b.mainTicker=j;b.tickerInfos[b.mainTicker]={exch:gData[f[0]]["exch"],ticker:gData[f[0]]["ticker"],clientTicker:gData[f[0]]["clientTicker"],gkey:f[0],mType:h};var g=gData[f[0]],c=false;g.gkey=f[0];for(var e=0;e<b.compairTickers.length;e++){if(b.mainTicker==b.compairTickers[e]){b.compairTickers.splice(e,1);c=true;break}}if(!c){GB_ChartDataManager.registerSymbol(g)}if(b.sType!=h){b._securityTypeChanged(b.sType,h);b._toggleFundamentalItem(b.sType,h)}b._filterFrequencyMenuData(gData[f[0]],true);b.noHistoricalData=gData[f[0]]["noPID"];b.sType=h;if(h=="FE"){b.iivTicker=j+"IIV";if(gIdMap[b.iivTicker]){GB_ChartDataManager.registerSymbol(gData[gIdMap[b.iivTicker]]);b.tickerInfos[b.iivTicker]={exch:gData[gIdMap[b.iivTicker]]["exch"],ticker:gData[gIdMap[b.iivTicker]]["ticker"],clientTicker:gData[gIdMap[b.iivTicker]]["clientTicker"],gkey:gData[gIdMap[b.iivTicker]]["gkey"]}}else{b.iivTicker=""}if(b._elements.iivContainer){b._elements.iivContainer.show()}}else{if(b._elements.iivContainer){b._elements.iivContainer.hide()}}GB_ChartDataManager.registerChart(b.mainTicker,b.id);b.initComponent();if(typeof(b.afterAcceptTickers)=="function"){b.afterAcceptTickers({mainTicker:b.tickerInfos[b.mainTicker]})}}})}else{var b=this;this.checkTickerInfo(a,function(c){b.onMainTickerChanged(c)})}},validateCompairTicker:function(a){var b=this;if(typeof(this.tValidation)=="object"&&typeof(gIdMap)!="undefined"&&typeof(gData)!="undefined"){this.tValidation.checkTickers(a,function(e){if(typeof(b.hideLoading)=="function"&&typeof(e)!="undefined"&&e.length==0){b.hideLoading()}if(e&&e.length>0){var h=false,c,f=[];for(var d=0;d<e.length;d++){var j=b._getSecurityType(gData[e[d]]["tenforeCode"],gData[e[d]]["type"],gData[e[d]]["mType"]);c=j==8?gData[e[d]]["secId"]:gData[e[d]]["performanceId"];if(!c||c==""||b.checkCompairTicker(c)){continue}if(b.compairTickers.length>=b.tickerMaxNum){if(b.hasConfirmBox){Util.message(TEXT?TEXT.ChartCTickersOverstep:"The maximum compair tickers are reached.")}break}b.compairTickers.push(c);b.tickerInfos[c]={exch:gData[e[d]]["exch"],ticker:gData[e[d]]["ticker"],clientTicker:gData[e[d]]["clientTicker"],gkey:e[d]};f.push(b.tickerInfos[c]);h=true;var g=gData[e[d]];g.gkey=e[d];GB_ChartDataManager.registerSymbol(g)}if(h){b.getPChartData()}if(typeof(b.afterAddTickers)=="function"){b.afterAddTickers({symbol:f})}}else{if(b.indexsMap&&b.indexsMap[a]){b.indexsMap[a].show=false}if(b._elements.indexsULElm){b._elements.indexsULElm.find("a[value='"+a+"']").addClass("rtq-chkbox_off")}if(b._elements.relatedSecULElm){b._elements.relatedSecULElm.find("a[value='"+a+"']").addClass("rtq-chkbox_off")}setTimeout(function(){Util.message(TEXT?TEXT.ChartCTickersNoEntitled:"You are not entitled to access this security.")},10)}})}else{this.checkTickerInfo(a,function(c){b.onCompareTickerAdded(c)})}},onMainTickerChanged:function(b){if(b==null||b.Records==null||!b.Records.length){return}var d=b.Records,a=d[0].TenforeInfo;var j=a!=null&&a.length>1?a[1]:"";var g=a!=null&&a.length>2?a[2]:this._securityTypeMap[d[0].Type];var h=this._getSecurityType(j,g,d[0].Type);var f=h==8?d[0].SID:d[0].PID;if(f!=""&&f!=this.mainTicker){if(this.mainTicker!=""){GB_ChartDataManager.unregisterChart(this.mainTicker,this.id);GB_ChartDataManager.unregisterSymbol(this.mainTicker);this.bacthUnscribeTickers([this.mainTicker]);delete this.tickerInfos[this.mainTicker]}this.mainTicker=f;this.tickerInfos[this.mainTicker]={};this.storeTickerInfo(this.tickerInfos[this.mainTicker],d[0]);var c=false;if(this.sType!=d[0].Type){this._securityTypeChanged(this.sType,d[0].Type)}this.sType=d[0].Type;for(var e=0;e<this.compairTickers.length;e++){if(this.mainTicker==this.compairTickers[e]){this.compairTickers.splice(e,1);c=true;break}}if(!c){GB_ChartDataManager.registerSymbol(this.tickerInfos[this.mainTicker]);if(this.sType=="FE"){this.iivTicker=this.mainTicker+"IIV";if(this.tickerInfos[this.iivTicker]){GB_ChartDataManager.registerSymbol(this.tickerInfos[this.iivTicker]);if(this._elements.iivContainer){this._elements.iivContainer.show()}}else{this.iivTicker="";if(this._elements.iivContainer){this._elements.iivContainer.hide()}}}else{if(this._elements.iivContainer){this._elements.iivContainer.hide()}}}GB_ChartDataManager.registerChart(this.mainTicker,this.id);this.initComponent()}if(typeof(this.afterAcceptTickers)=="function"){this.afterAcceptTickers({mainTicker:this.tickerInfos[this.mainTicker]})}},onCompareTickerAdded:function(c){if(c==null||c.Records==null||c.Records.length==0){return}var m=c.Records;var j=false;var d=[],e=[];for(var f=0;f<m.length;f++){var b=m[f];var a=b.TenforeInfo;var h=a!=null&&a.length>1?a[1]:"";var l=a!=null&&a.length>2?a[2]:this._securityTypeMap[m[f].Type];var k=this._getSecurityType(h,l,m[f].Type);var g=k==8?b.SID:b.PID;if(g==""||this.checkCompairTicker(g)){if(g==""&&this.hasConfirmBox){Util.message('We could not find the security["{'+b.Ticker+'}"] you are looking for. Please try again.')}continue}else{if(this.compairTickers.length>=this.tickerMaxNum){if(this.hasConfirmBox){Util.message(TEXT?TEXT.ChartCTickersOverstep:"The maximum compair tickers are reached.")}break}this.compairTickers.push(g);this.tickerInfos[g]={};this.storeTickerInfo(this.tickerInfos[g],m[f]);GB_ChartDataManager.registerSymbol(this.tickerInfos[g]);j=true;d.push(this.tickerInfos[g]);if(this.indexsMap&&this.indexsMap[g]&&this.indexsMap[g].show){this._elements.indexsULElm.find("a[value='"+g+"']").removeClass("rtq-chkbox_off")}}}if(typeof(this.afterAddTickers)=="function"){this.afterAddTickers({symbol:d})}if(j){this.getPChartData()}},_toggleFundamentalItem:function(a,d){if(d=="FE"||d=="XI"||d=="FC"){if(a!="FE"&&a!="XI"&&a!="FC"){if(this._contains.$settingPanel!=null){this._contains.$settingPanel.find(".rtq-groupbox-group").eq(6).hide()}for(var c in this.iChartContainers){if(this.valuations.hasOwnProperty(c)){this.iChartLegendOnclick(c)}}if(this.valuations&&this.valuations.FairValue&&this.valuations.FairValue.show){this.removeValuations("FairValue")}var b=[];for(var e=0;e<this.rightMenuData.length;e++){if(this.rightMenuData[e].val!="mainl1-fundamental"&&this.rightMenuData[e].val!="mainl1-valuation"){b.push(this.rightMenuData[e])}}if(this.uiComponents.rightMenu!=null){this.uiComponents.rightMenu.reBind(b)}b=[];for(var e=0;e<this.miniChartRightMenuData.length;e++){if(this.miniChartRightMenuData[e].val!="minil1-fundamental"&&this.miniChartRightMenuData[e].val!="minil1-valuation"){b.push(this.miniChartRightMenuData[e])}}if(this.uiComponents.miniChartRightMenu.menu!=null){this.uiComponents.miniChartRightMenu.menu.reBind(b)}}}else{if(this._contains.$settingPanel!=null){this._contains.$settingPanel.find(".rtq-groupbox-group").eq(6).show()}if(this.uiComponents.rightMenu!=null){this.uiComponents.rightMenu.reBind(this.rightMenuData)}}},_securityTypeChanged:function(b,e){if((b=="ST"||b=="FC")&&e=="FE"){var d=false;for(var c=0;c<this.chartTypeListData.length;c++){if(this.chartTypeListData[c].val=="postTax"){d=true;break}}if(!d){this.chartTypeListData.push({txt:QSLGTXT.posttaxreturn,type:"ratio",val:"postTax"});if(this.chartTypeMenuData.length>=4){this.chartTypeMenuData[3].push({txt:QSLGTXT.posttaxreturn,type:"ratio",val:"postTax"})}this._rebindTypeList()}}else{if(b=="FE"&&(e=="ST"||e=="FC")){var d=false;for(var c=0;c<this.chartTypeListData.length;c++){if(this.chartTypeListData[c].val=="postTax"){d=true;this.chartTypeListData.splice(c,1);break}}if(d){if(this.chartStyle=="postTax"){this.chartStyle="mountain"}if(this.chartTypeMenuData.length>=4){for(var a=0;a<this.chartTypeMenuData[3].length;a++){if(this.chartTypeMenuData[3][a].val=="postTax"){this.chartTypeMenuData[3].splice(a,1);break}}}this._rebindTypeList()}}}},_rebindTypeList:function(){if(this.uiComponents.ddlChartType!=null){this.uiComponents.ddlChartType.rebindData(this.chartTypeListData)}if(this.uiComponents.rightMenu!=null){this.uiComponents.rightMenu.reBindSecondLevelMenu("chartType",this.chartTypeListData,1)}if(this.uiComponents.chartTypeMenu[3]!=null){this.uiComponents.chartTypeMenu[3].reBind(this.chartTypeMenuData[3],true)}},onChangeTitle:function(c,b,d){if(d||!c){this._title="Chart"}else{this._title=c}var a="";if(typeof this.tickerInfos[this.mainTicker]!="undefined"){a=this._getClientTicker(this.mainTicker)}if(typeof(this.setTitle)=="function"){this.setTitle(this._title,a)}},clear:function(){this.chartData.DataList=null;this.bacthUnscribeTickers([this.mainTicker]);if(this.compairTickers.length>0){this.bacthUnscribeTickers(this.compairTickers)}if(typeof(GB_ChartDataManager)=="object"){GB_ChartDataManager.unregisterSymbol(this.mainTicker);for(var a=0;a<this.compairTickers.length;a++){GB_ChartDataManager.unregisterSymbol(this.compairTickers[a])}if(typeof(this.id)!="undefined"){GB_ChartDataManager.unregisterChart(this.id)}GB_ChartDataManager.unsubscribeChart(this)}if(this.sliderObj!=null){this.sliderObj.onchange=null;this.sliderObj.onchanged=null;this.sliderObj.clear()}this._contains.pChartContainer.unbind("plothover").unbind("mouseover").unbind("mouseout").unbind("drawEnd").unbind("contextmenu");if(this.pFlot!=null){this.pFlot.clear()}if(this.vFlot!=null){this.vFlot.clear()}if(this.mFlot!=null){this.mFlot.clear()}for(var b in this.iFlots){if(this.iFlots.hasOwnProperty(b)&&this.iFlots[b]!=null){if(this.iChartContainers[b]!=null){this.iChartContainers[b].find(".lengend").unbind("click").unbind("hover").unbind("contextmenu")}this.iFlots[b].clear()}}if(typeof(GB_qsAutoCompleteBox)=="object"){GB_qsAutoCompleteBox.unSubscription(this.autoBoxID)}this._contains.pChartContainer.html(""),this._contains.pChartContainer=null;if(this._contains.vChartContainer!=null){this._contains.vChartContainer.html(""),this._contains.vChartContainer=null}if(this._contains.mChartContainer!=null){this._contains.mChartContainer.html(""),this._contains.mChartContainer=null}if(typeof(QSCAL)!="undefined"){var c=this._elements.$customDate.find(".qs-ui-ipt");QSCAL.unregister(c[0]);QSCAL.unregister(c[1])}var e=this.uiComponents;if(e.rightMenu!=null){e.rightMenu.clear()}if(e.miniChartRightMenu){for(var b in e.miniChartRightMenu){if(typeof(e.miniChartRightMenu[b].menu.clear)=="function"){e.miniChartRightMenu[b].menu.clear()}}}if(e.tabMenu&&typeof(e.tabMenu.clear)=="function"){e.tabMenu.clear()}if(e.funTabMenu&&typeof(e.funTabMenu.clear)=="function"){e.funTabMenu.clear()}if(e.indTabMenu&&typeof(e.indTabMenu.clear)=="function"){e.indTabMenu.clear()}if(typeof(e.customDateB)!="undefined"){e.customDateB.clear()}if(e.ddlFrequency&&typeof(e.ddlFrequency.clear)=="function"){e.ddlFrequency.clear()}if(e.ddlZoom&&typeof(e.ddlZoom.clear)=="function"){e.ddlZoom.clear()}if(e.ddlChartType&&typeof(e.ddlChartType.clear)=="function"){e.ddlChartType.clear()}if(e.ddlCursorType&&typeof(e.ddlCursorType.clear)=="function"){e.ddlCursorType.clear()}if(e.tabZoomMenu&&typeof(e.tabZoomMenu.clear)=="function"){e.tabZoomMenu.clear()}if(e.chartTypeMenu.length){for(var a=0;a<e.chartTypeMenu.length;a++){if(e.chartTypeMenu[a]&&typeof(e.chartTypeMenu[a].clear)=="function"){e.chartTypeMenu[a].clear()}}}if(e.chkIIV&&typeof(e.chkIIV.clear)=="function"){e.chkIIV.clear()}if(e.chkLock&&typeof(e.chkLock.clear)=="function"){e.chkLock.clear()}if(this._contains.$settingPanel!=null){this._contains.$settingPanel.find(".rtc-menu-trigger").unbind()}if(e.indexScrollPN&&typeof(e.indexScrollPN.clear)=="function"){e.indexScrollPN.clear()}for(var b in this._elements){if(this._elements[b]){this._elements[b].unbind();this._elements[b]=null}}if(e.settingGroup&&typeof(e.settingGroup.clear)=="function"){e.settingGroup.clear()}this._contains.$settingPanel.html(""),this._contains.$settingPanel=null;for(var d in this){if(!d||d=="clear"){continue}this[d]=null;delete this[d]}},storeTickerInfo:function(j,f){var a=f.TenforeInfo;var g=a!=null&&a.length>2?a[2]:this._securityTypeMap[f.Type];j.tenforeCode=a!=null&&a.length>1?a[1]:"";j.tenforeTicker=a!=null&&a.length>1?a[0]:"";j.mType=f.Type;j.type=g;j.performanceId=f.PID;j.secId=f.SID;j.exch=f.Exch;j.clientTicker=f.clientTicker||f.Ticker;j.ticker=f.Ticker;j.country=f.Region;j.currency=f.Currency;j.companyId=f.CFID;j.ISIN=f.ISIN;j.Name=f.Name;j.noPID=(f.SID==""||f.SID==null)&&(f.PID==""||f.PID==null);var h=((g==1||g==8||g==10)&&j.tenforeCode<126&&$.inArray(parseInt(j.tenforeCode,10),GB_ChartDataManager.XIsubUSExchange)<0)?"126":(a!=null?a[1]:"9999");j.gkey=h+":"+(a!=null?a[0]:f.Ticker);if(f.Type=="FE"){if(f.EtfData!=null&&f.EtfData.IIV&&f.EtfData.IIV.TenforeInfo!=null){var c=f.EtfData.IIV;var b=f.PID+"IIV";var e=h+":"+c.TenforeInfo[0];this.tickerInfos[b]={};this.tickerInfos[b]["gkey"]=e;this.tickerInfos[b]["tenforeCode"]=h;this.tickerInfos[b]["tenforeTicker"]=c.TenforeInfo[0];this.tickerInfos[b]["type"]=10;this.tickerInfos[b]["mType"]="FE";this.tickerInfos[b]["exch"]=c.Exch;this.tickerInfos[b]["ticker"]=c.Ticker;this.tickerInfos[b]["clientTicker"]=c.clientTicker||c.Ticker;this.tickerInfos[b]["country"]=c.Region;this.tickerInfos[b]["performanceId"]=b;this.tickerInfos[b]["secId"]=f.SID}}}};if(typeof(push)!="undefined"&&typeof(push.proxy)!="undefined"){GB_ChartDataManager.option.needUpdateIntradyData=true}var RTChartComponent=function(c,b,a){this._title="Chart";this.timezone="";this.securityType=[1,10,2,"FE"];this.autoTitle=true;this.defaultFrequencyMenuCfg={intraday:true,history:true,customer:true};this.requencyMenuCfg={intraday:true,history:true,customer:true};this.dataUrl={getTickerInfoURL:(typeof(version)!="undefined"&&version.domain)?(version.domain+"getids.jsp?"):"//quotespeed.morningstar.com/getids.jsp?",relatiedSecURL:"//financials.morningstar.com/competitors/top5competitors.action?out=1"};this.region=(b==null?"USA":b);this.lan=(a==null?"en_US":a);this.cur="USD";this.latestTradeDate=new Date();this.tickerMaxNum=7;this.sDates={iMin:null,sMin:null,lMin:null,d:null,w:null,m:null};this.fillColors=typeof(QS_Style)=="undefined"?{pChart:"#c9d2dd",vChart:"#2f4880",sChart:"#d9dfeb"}:QS_Style.chart.fillColors;this.colors={borderColor:null,gridColor:typeof(QS_Style)=="undefined"?"#dddddd":QS_Style.flot.grid.tickColor,lableFontColor:typeof(QS_Style)=="undefined"?"#545454":QS_Style.flot.grid.color};this.objName;this.chartWidth=760;this.outHeight=0;this.pChartHeight=300;this.vChartHeight=60;this.miniChartHeight=26;this.wheelNum=0;this.minW=300;this.minH=160;this.iChartHeight=80;this.xLabelAlign="left";this.yLabelWidth=50;this.showGridLines=true;this.autoBoxID;this.outObj;this.sType="ST";this.mainTicker=c;this.iivTicker="";this.compairTickers=[];this.tickerInfos={};this.mainTickerInfo={type:"1",tenforeTicker:""};this.compairTickerInfo=[];this.iivTickerInfo={};this.events={dividend:false,splits:false,earnings:false};this.zoomRange=1;this.chartStyle="mountain";this.showVolume=true;this.frequency="minute";this.chartCursor=1;this.scaleType=0;this.ticksize=5;this.Ticks=null;this.endDate=new Date();this.startDate=this.endDate;this.ichartSiwtchIndicatorWin={flag:false,oldName:"",newName:"",data:null,ulelm:null};this.isShowTimeSlider=true;this.showLegend=true;this.pChartReady=false;this.sliderObj=null;this.slider_EndDate=this.latestTradeDate;this.slider_StartDate=new Date(this.slider_EndDate.getFullYear()-2,this.slider_EndDate.getMonth(),this.slider_EndDate.getDate());this.rangSize=512;this.miniChartFrequency="minute";this.chartData={DataList:[],VolList:[],eventDataList:null,eventInfoList:null,MiniChartData:[],fairValueData:null,mReturnIndexData:null};this.iChartData={MACD:[],RSI:[],ROC:[],WillR:[],SStochastic:[],FStochastic:[],Momentum:[],ULT:[],DMI:[],MFI:[],ULT:[],OBV:[],VAcc:[],UDRatio:[],PE:[],PS:[],PB:[],PC:[],RDividend:[],DYield:[],REPS:[],SInterest:[],FVolatility:[],WMA:[],AccDis:[],Mass:[],Volatility:[],ForceIndex:[],ATR:[]};this.UIConfig={pCtrl1:{showCompair:true,showTimeRange:true,showFrequency:true,showZoom:true},pCtrl2:{showChartType:true,showSMV:true,showEvent:true,showIndicator:true,showCursorType:true},vCtrl:{showSMVV:true,showHideLink:true},Chart:{showPChart:true,showVChart:true,showLegend:true,showTimeSlider:true},RightMenu:true,CustomUI:false,chartCtrl:"default",settingPanel:null,fairValue:true,autoHeight:false,indicator:{},valuations:{},events:{},drawing:{},MouseWheel:true,ZoomIn:true,panel:{showWindow:true,showNote:true},IIVLegend:"ticker",onedayDateRangeFormat:1,showDateRangeInLengend:1,customFrequency:0,autoHideVolume:false};this.pFlot=null;this.vFlot=null;this.mFlot=null;this.iFlots={MACD:null,RSI:null,ROC:null,WillR:null,SStochastic:null,FStochastic:null,Momentum:null,ULT:null,DMI:null,MFI:null,ULT:null,OBV:null,VAcc:null,UDRatio:null,PE:null,PS:null,PB:null,PC:null,RDividend:null,DYield:null,REPS:null,SInterest:null,FVolatility:null,WMA:null,AccDis:null,Mass:null,Volatility:null,ForceIndex:null,ATR:null};this._isIntradayTimSyle=true;this._selectedIndicatorName="";this.isDrawing=false;this.lock=false;this.showNotes=false;this._indexScrollResized=false;this.timeout=null;this.mouseWheeTimeout=null;this.scrollAble=false;this.simpleMenu=false;this.chartOffset={left:0,top:0};this.hasConfirmBox=(typeof(Util)!="undefined"&&typeof(Util.confirm)!="undefined")?true:false;this.yaxisAlign="right";this.isShowLastLabel=true;this.showIIVTicker=false;this.selectionMode={pan:true,zoomIn:false,zoomOut:false};this.zoomStack=[];this.legendInfo={OHLC:true,Volume:true,onlyIncludeLast:false,showDateRangeString:true};this.uiComponents={settingGroup:null,ddlFrequency:null,ddlZoom:null,ddlChartType:null,ddlCursorType:null,customDateB:null,tabMenu:null,chartTypeMenu:[],tabZoomMenu:null,rightMenu:null,indexScrollPN:null,miniChartRightMenu:{}};this._contains={pChartContainer:null,vChartContainer:null,mChartContainer:null,toolContainer:null,$settingPanel:null};this.iChartContainers={};this._elements={legendElm:null,volLegendElm:null,crosshairLegendElm:null,crosshairLegendWin:null,lineXElm:null,lineYElm:null,xLabelElm:null,addCompairBtElm:null,indicatorWinElm:null,eventULElm:null,valuationULElm:null,indexsULElm:null,relatedSecULElm:null,indicatorULElm:null,m1:null,m2:null,m3:null,mv:null,volSwitchLink:null,chkLock:null,growthMenu:null,oscIndicatorMenu:null,tabmenuZoomEl:null,$ddlZoom:null,$ddlFrequency:null,$ddlChartType:null,$ddlCursorType:null,$customDate:null,$ratioScale:null,$drawBlock:null,$yaxisAlign:null,iivContainer:null,zoomMask:null};this.indicatorUI={SMA:{title:QSLGIN.sma_t,parameter:[QSLGIN.sma_p1,QSLGIN.sma_p2,QSLGIN.sma_p3],defaultValue:[10,50,]},EMA:{title:QSLGIN.ema_t,parameter:[QSLGIN.ema_p1,QSLGIN.ema_p2,QSLGIN.ema_p3],defaultValue:[10,,]},SMAV:{title:QSLGIN.smav_t,parameter:[QSLGIN.smav_p1],defaultValue:[50]},BBands:{title:QSLGIN.bbands_t,parameter:[QSLGIN.bbands_p1,QSLGIN.bbands_p2],defaultValue:[20,2]},PSAR:{title:QSLGIN.psar_t,parameter:[QSLGIN.psar_p1,QSLGIN.psar_p2],defaultValue:[0.02,0.2]},MACD:{title:QSLGIN.macd_t,parameter:[QSLGIN.macd_p1,QSLGIN.macd_p2,QSLGIN.macd_p3],defaultValue:[26,12,9]},RSI:{title:QSLGIN.rsi_t,parameter:[QSLGIN.rsi_p1],defaultValue:[14]},ROC:{title:QSLGIN.roc_t,parameter:[QSLGIN.roc_p1],defaultValue:[12]},WillR:{title:QSLGIN.willr_t,parameter:[QSLGIN.willr_p1],defaultValue:[14]},SStochastic:{title:QSLGIN.sstochastic_t,parameter:[QSLGIN.sstochastic_p1,QSLGIN.sstochastic_p2],defaultValue:[15,5]},FStochastic:{title:QSLGIN.fstochastic_t,parameter:[QSLGIN.fstochastic_p1,QSLGIN.fstochastic_p2],defaultValue:[5,3]},PChannel:{title:QSLGIN.pchannel_t,parameter:[QSLGIN.pchannel_name],defaultValue:[14]},MAE:{title:QSLGIN.mae_t,parameter:[QSLGIN.mae_p1,QSLGIN.mae_p2],defaultValue:[14,2]},Momentum:{title:QSLGIN.momentum_t,parameter:[QSLGIN.momentum_p1],defaultValue:[2]},ULT:{title:QSLGIN.ult_t,parameter:[],defaultValue:[]},DMI:{title:QSLGIN.dmi_t,parameter:[],defaultValue:[]},MFI:{title:QSLGIN.mfi_t,parameter:[QSLGIN.mfi_p1],defaultValue:[14]},OBV:{title:QSLGIN.obv_t,parameter:[],defaultValue:[]},VAcc:{title:QSLGIN.vacc_t,parameter:[],defaultValue:[]},UDRatio:{title:QSLGIN.udratio_t,parameter:[QSLGIN.udratio_p1,QSLGIN.udratio_p2],defaultValue:[7,5]},VBP:{title:QSLGIN.vbp_t,parameter:[],defaultValue:[]},Volume:{title:QSLGIN.volume_t,parameter:[],defaultValue:[]},VPlus:{title:QSLGIN.vplus_t,parameter:[],defaultValue:[]},FVolatility:{title:QSLGIN.fvolatility_t,parameter:[],defaultValue:[]},WMA:{title:QSLGIN.wma_t,parameter:[QSLGIN.wma_p1],defaultValue:[15]},AccDis:{title:QSLGIN.accdis_t,parameter:[],defaultValue:[]},Mass:{title:QSLGIN.mass_t,parameter:[],defaultValue:[]},Volatility:{title:QSLGIN.volatility_t,parameter:[QSLGIN.volatility_p1,QSLGIN.volatility_p2],defaultValue:[10,10]},ForceIndex:{title:QSLGIN.forceindex_t,parameter:[QSLGIN.forceindex_p1],defaultValue:[13]},ATR:{title:QSLGIN.atr_t,parameter:[],defaultValue:[]},Keltner:{title:QSLGIN.keltner_t,parameter:[QSLGIN.keltner_p1,QSLGIN.keltner_p2,QSLGIN.keltner_p3],defaultValue:[10,2,20]},PrevClose:{title:QSLGIN.prevclose_t,parameter:[],defaultValue:[]}};this.indicatorsData={SMA:{show:false,num:[null,null,null],colorIndex:[0,0,0],type:0},SMAV:{show:false,num:null,colorIndex:0,type:0},EMA:{show:false,num:[null,null,null],colorIndex:[0,0,0],type:0},BBands:{show:false,parameter:[10,2],colorIndex:0,type:0},PSAR:{show:false,parameter:[0.02,0.2],colorIndex:0,type:0},MACD:{show:false,parameter:[26,12,9],type:1,mty:1},RSI:{show:false,parameter:[14],type:1,mty:2},ROC:{show:false,parameter:[12],type:1,mty:1},WillR:{show:false,parameter:[14],type:1,mty:2},SStochastic:{show:false,parameter:[15,5],type:1,mty:2},FStochastic:{show:false,parameter:[5,3],type:1,mty:2},PChannel:{show:false,parameter:[14],type:0},MAE:{show:false,parameter:[14,2],type:0},Momentum:{show:false,parameter:[2],type:1,mty:1},ULT:{show:false,parameter:[],type:1,mty:2},DMI:{show:false,parameter:[],type:1,mty:1},MFI:{show:false,parameter:[14],type:1,mty:0},OBV:{show:false,parameter:[],type:1,mty:0},VAcc:{show:false,parameter:[],type:1,mty:0},UDRatio:{show:false,parameter:[7,5],type:1,mty:0},VBP:{show:false,parameter:[],type:0},Volume:{show:true,parameter:[],type:0,mty:5},VPlus:{show:false,parameter:[],type:0,mty:5},FVolatility:{show:false,parameter:[],type:1},WMA:{show:false,parameter:[15],type:0,mty:0},AccDis:{show:false,parameter:[],type:1,mty:1},Mass:{show:false,parameter:[],type:1,mty:2},Volatility:{show:false,parameter:[10,10],type:1,mty:2},ForceIndex:{show:false,parameter:[13],type:1,mty:1},ATR:{show:false,parameter:[],type:1,mty:1},Keltner:{show:false,parameter:[10,2,20],type:0,mty:2},PrevClose:{show:false,parameter:[],type:0}},this._securityTypeMap={ST:1,FE:1,XI:10,FO:8,FC:1};this._zoomIndexMap={1:0,2:1,13:2,3:3,14:4,4:5,5:6,6:7,7:8,8:9,9:10,10:11,11:12};this._frequencyIndexMap={minute:-4,minute5:-3,minute10:-2,minute15:-1,minute30:0,d:1,w:2,m:3};this._frequencyTxtMap={minute:"1 "+QSLGTXT.shortminute,minute5:"5 "+QSLGTXT.shortminute,minute10:"10 "+QSLGTXT.shortminute,minute15:"15 "+QSLGTXT.shortminute,minute30:"30 "+QSLGTXT.shortminute,d:QSLGTXT.daily,w:QSLGTXT.weekly,m:QSLGTXT.monthly};this._frequencyMap={minute:1,minute5:5,minute10:10,minute15:15,minute30:30,d:"d",w:"w",m:"m"};this.tabMap=["mountain","ohlc","candle","growth"];this.tabIndexMap={mountain:0,dot:0,ab:0,line:0,ohlc:1,hlc:1,candle:2,growth:3,growth10:3,dEffect:3};this.mapValuationName={HS0A2:"PE",HS0A5:"PS",HS0A0:"PB",HS0A1:"PC",HS987:"FairValue",ST263:"REPS",STA0C:"SInterest"};this.indexsMap={"0P00001G7J":{show:false,name:"IXUS:SPX",txt:"S&P 500"},"0P00001FJG":{show:false,name:"IXUS:$INDU",txt:"DJ Industrial Avg."},"0P00001G7B":{show:false,name:"IXUS:COMP",txt:"NASDAQ Composite"},"0P00001GJH":{show:false,name:"IXUS:$MSTAR",txt:"U.S. Market"},"0P00001GJW":{show:false,name:"IXUS:$MVAL",txt:"U.S. Value"},"0P00001GJT":{show:false,name:"IXUS:$MSVL",txt:"Small Value"},"0P00001GJS":{show:false,name:"IXUS:$MMVL",txt:"Mid Value"},"0P00001GJR":{show:false,name:"IXUS:$MLVL",txt:"Large Value"},"0P00001GJV":{show:false,name:"IXUS:$MCOR",txt:"U.S. Core"},"0P00001GJQ":{show:false,name:"IXUS:$MSCR",txt:"Small Core"},"0P00001GJP":{show:false,name:"IXUS:$MMCR",txt:"Mid Core"},"0P00001GJO":{show:false,name:"IXUS:$MLCR",txt:"Large Core"},"0P00001GJU":{show:false,name:"IXUS:$MGRO",txt:"U.S. Growth"},"0P00001GJN":{show:false,name:"IXUS:$MSGR",txt:"Small Growth"},"0P00001GJM":{show:false,name:"IXUS:$MMGR",txt:"Mid Growth"},"0P00001GJL":{show:false,name:"IXUS:$MLGR",txt:"Large Growth"},"0P00001GJK":{show:false,name:"IXUS:$MSCP",txt:"U.S. Small Cap"},"0P00001GJJ":{show:false,name:"IXUS:$MMCP",txt:"U.S. Mid Cap"},"0P00001GJI":{show:false,name:"IXUS:$MLCP",txt:"U.S. Large Cap"},"0P00001N2X":{show:false,name:"IXUS:$MDL",txt:"Dividend Leaders"},"0P000083OS":{show:false,name:"IXUS:$MWMF",txt:"Wide Moat Focus 20"},"0P000083OP":{show:false,name:"IXUS:$MWMO",txt:"Wide Moat 100"},"0P00001MJQ":{show:false,name:"IXUS:$INFOS",txt:"Information Sup. Sector"},"0P00001MJS":{show:false,name:"IXUS:$MFGRS",txt:"Manufacturing Sup. Sector"},"0P00001MJR":{show:false,name:"IXUS:$SRVCS",txt:"Service Sup. Sector"},"0P00001G7I":{show:false,name:"IXUS:MID",txt:"S&P MidCap 400"},"0P00001IS1":{show:false,name:"XLON:UKX",txt:"FTSE 100 (GBR)"},"0P00006NNM":{show:false,name:"XSHG:$000001",txt:"Shanghai SE Composite (CHN)"},"0P00008IVF":{show:false,name:"XTSE:OSPTX",txt:"S&P/TSX Composite (CAN)"}};this.valuations={PE:{show:false,code:"HS0A2",colorIndex:0,name:QSLGFD.pe_name,mty:4},PS:{show:false,code:"HS0A5",colorIndex:0,name:QSLGFD.ps_name,mty:4},PB:{show:false,code:"HS0A0",colorIndex:0,name:QSLGFD.pb_name,mty:4},PC:{show:false,code:"HS0A1",colorIndex:0,name:QSLGFD.pc_name,mty:4},FairValue:{show:false,code:"HS987",colorIndex:0,name:QSLGFD.fairvalue_name},RDividend:{show:false,code:"",colorIndex:0,name:QSLGFD.rdividend_name,mty:3},DYield:{show:false,code:"",colorIndex:0,name:QSLGFD.dyield_name,mty:3},REPS:{show:false,code:"ST263",colorIndex:0,name:QSLGFD.reps_name,mty:3},SInterest:{show:false,code:"STA0C",colorIndex:0,name:QSLGFD.sinterest_name,mty:3}};this.intradayFreMenuData=[{txt:"1 "+QSLGTXT.shortminute,val:"minute",type:"ratio"},{txt:"5 "+QSLGTXT.shortminute,val:"minute5",type:"ratio"},{txt:"10 "+QSLGTXT.shortminute,val:"minute10",type:"ratio"},{txt:"15 "+QSLGTXT.shortminute,val:"minute15",type:"ratio"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30",type:"ratio"}];this.sMinuteFreMenuData=[{txt:"5 "+QSLGTXT.shortminute,val:"minute5",type:"ratio"},{txt:"10 "+QSLGTXT.shortminute,val:"minute10",type:"ratio"},{txt:"15 "+QSLGTXT.shortminute,val:"minute15",type:"ratio"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30",type:"ratio"},{txt:QSLGTXT.daily,val:"d",type:"ratio"}];this.lMinuteFreMenuData=[{txt:"10 "+QSLGTXT.shortminute,val:"minute10",type:"ratio"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30",type:"ratio"},{txt:QSLGTXT.daily,val:"d",type:"ratio"},{txt:QSLGTXT.weekly,val:"w",type:"ratio"}];this.dailyFreMenuData=[{txt:QSLGTXT.daily,val:"d",type:"ratio"},{txt:QSLGTXT.weekly,val:"w",type:"ratio"},{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.weeklyFreMenuData=[{txt:QSLGTXT.weekly,val:"w",type:"ratio"},{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.monthlyFreMenuData=[{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.eventsData=[{txt:QSLGTXT.dividend,val:"dividend",name:"dividends",type:"checkbox",checked:false},{txt:QSLGTXT.splits,val:"splits",name:"splits",type:"checkbox",checked:false},{txt:QSLGTXT.earnings,val:"earnings",name:"earnings",type:"checkbox",checked:false}];this.zoomListData=[{txt:"1 "+QSLGTXT.shortday,val:"1",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.intradayFreMenuData},{txt:"5 "+QSLGTXT.shortday,val:"2",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.intradayFreMenuData},{txt:"15 "+QSLGTXT.shortday,val:"13",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.sMinuteFreMenuData},{txt:"1 "+QSLGTXT.shortmonth,val:"3",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.sMinuteFreMenuData},{txt:"2 "+QSLGTXT.shortmonth,val:"14",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.lMinuteFreMenuData},{txt:"3 "+QSLGTXT.shortmonth,val:"4",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.lMinuteFreMenuData},{txt:QSLGTXT.ytd,val:"5",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"1 "+QSLGTXT.shortyear,val:"6",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"3 "+QSLGTXT.shortyear,val:"7",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"5 "+QSLGTXT.shortyear,val:"8",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"10 "+QSLGTXT.shortyear,val:"9",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:QSLGTXT.max,val:"10",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.monthlyFreMenuData},{txt:QSLGTXT.custom,val:"11",type:"ratio"}];this.frequencyListData=[{txt:"1 "+QSLGTXT.shortminute,val:"minute"},{txt:"5 "+QSLGTXT.shortminute,val:"minute5"},{txt:"10 "+QSLGTXT.shortminute,val:"minute10"},{txt:"15 "+QSLGTXT.shortminute,val:"minute15"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30"},{txt:QSLGTXT.daily,val:"d"},{txt:QSLGTXT.weekly,val:"w"},{txt:QSLGTXT.monthly,val:"m"}];this.cursorTypeListData=[{txt:QSLGTXT.trackball,val:"0",type:"ratio"},{txt:QSLGTXT.crosshair,val:"1",type:"ratio"},{txt:QSLGTXT.off,val:"3",type:"ratio"}];this.chartTypeListData=[{txt:QSLGTXT.mountain,val:"mountain",type:"ratio"},{txt:QSLGTXT.line,val:"line",type:"ratio"},{txt:QSLGTXT.dot,val:"dot",type:"ratio"},{txt:QSLGTXT.abovebelow,val:"ab",type:"ratio"},{txt:QSLGTXT.ohlc,val:"ohlc",type:"ratio"},{txt:QSLGTXT.hlc,val:"hlc",type:"ratio"},{txt:QSLGTXT.candlestick,val:"candle",type:"ratio"},{txt:QSLGTXT.pergrowth,val:"growth",type:"ratio"},{txt:QSLGTXT.tenkgrowth,val:"growth10",type:"ratio"},{txt:QSLGTXT.dividendeffect,val:"dEffect",type:"ratio"}];this.scaleTypeListData=[{txt:QSLGTXT.linear,val:"0"},{txt:QSLGTXT.logarithmic,val:"1"}];this.yaxisAlignListData=[{txt:QSLGTXT.left,val:"left"},{txt:QSLGTXT.right,val:"right"}];this.selectionModeListData=[{txt:QSLGTXT.pan,val:"pan"},{txt:QSLGTXT.zoomin,val:"zoomin"},{txt:QSLGTXT.reset,val:"reset"}];this.tabList=[{txt:QSLGTXT.line,id:0,closable:false},{txt:QSLGTXT.bar,id:1,closable:false},{txt:QSLGTXT.candlestick,id:2,closable:false},{txt:QSLGTXT.growth,id:3,closable:false}];this.chartTypeMenuData=[[{txt:QSLGTXT.mountain,type:"ratio",val:"mountain"},{txt:QSLGTXT.line,type:"ratio",val:"line"},{txt:QSLGTXT.dot,type:"ratio",val:"dot"},{txt:QSLGTXT.abovebelow,type:"ratio",val:"ab"}],[{txt:QSLGTXT.ohlc,type:"ratio",val:"ohlc"},{txt:QSLGTXT.hlc,type:"ratio",val:"hlc"}],[],[{txt:QSLGTXT.pergrowth,type:"ratio",val:"growth"},{txt:QSLGTXT.tenkgrowth,type:"ratio",val:"growth10"},{txt:QSLGTXT.dividendeffect,type:"ratio",val:"dEffect"}]];this.settingGroupList=[{name:QSLGTXT.display,id:1},{name:QSLGTXT.window,id:7},{name:QSLGTXT.compare,id:2,closable:false},{name:QSLGTXT.drawingandnotes,id:3},{name:QSLGTXT.indicators,id:4},{name:QSLGTXT.events,id:5},{name:QSLGTXT.fundamental,id:6}];this.indicatorTabList=[{txt:QSLGTXT.popular,id:0,closable:false},{txt:QSLGTXT.cvolume,id:1,closable:false},{txt:QSLGTXT.pricetrends,id:2,closable:false},{txt:QSLGTXT.oscillator,id:3,closable:false}];this.indicatorPanelData=[[{txt:QSLGIN.bbands_name,val:"BBands",type:""},{txt:QSLGIN.macd_name,val:"MACD",type:""},{txt:QSLGIN.psar_name,val:"PSAR",type:""},{txt:QSLGIN.prevclose_name,val:"PrevClose",type:""},{txt:QSLGIN.roc_name,val:"ROC",type:""},{txt:QSLGIN.rsi_name,val:"RSI",type:""},{txt:QSLGIN.sma_name,val:"SMA",type:""},{txt:QSLGIN.sstochastic_name,val:"SStochastic",type:""},{txt:QSLGIN.fstochastic_name,val:"FStochastic",type:""},{txt:QSLGIN.willr_name,val:"WillR",type:""}],[{txt:QSLGIN.mfi_name,val:"MFI",type:""},{txt:QSLGIN.obv_name,val:"OBV",type:""},{txt:QSLGIN.udratio_name,val:"UDRatio",type:""},{txt:QSLGIN.volume_name,val:"Volume",type:""},{txt:QSLGIN.vplus_name,val:"VPlus",type:""},{txt:QSLGIN.vacc_name,val:"VAcc",type:""},{txt:QSLGIN.vbp_name,val:"VBP",type:""},{txt:QSLGIN.smav_name,val:"SMAV",type:""},{txt:QSLGIN.accdis_name,val:"AccDis",type:""}],[{txt:QSLGIN.bbands_name,val:"BBands",type:""},{txt:QSLGIN.dmi_name,val:"DMI",type:""},{txt:QSLGIN.ema_name,val:"EMA",type:""},{txt:QSLGIN.mae_name,val:"MAE",type:""},{txt:QSLGIN.macd_name,val:"MACD",type:""},{txt:QSLGIN.momentum_name,val:"Momentum",type:""},{txt:QSLGIN.psar_name,val:"PSAR",type:""},{txt:QSLGIN.pchannel_name,val:"PChannel",type:""},{txt:QSLGIN.prevclose_name,val:"PrevClose",type:""},{txt:QSLGIN.roc_name,val:"ROC",type:""},{txt:QSLGIN.sma_name,val:"SMA",type:""},{txt:QSLGIN.wma_name,val:"WMA",type:""},{txt:QSLGIN.forceindex_name,val:"ForceIndex",type:""},{txt:QSLGIN.atr_name,val:"ATR",type:""}],[{txt:QSLGIN.rsi_name,val:"RSI",type:""},{txt:QSLGIN.sstochastic_name,val:"SStochastic",type:""},{txt:QSLGIN.fstochastic_name,val:"FStochastic",type:""},{txt:QSLGIN.ult_name,val:"ULT",type:""},{txt:QSLGIN.willr_name,val:"WillR",type:""},{txt:QSLGIN.mass_name,val:"Mass",type:""},{txt:QSLGIN.volatility_name,val:"Volatility",type:""},{txt:QSLGIN.keltner_name,val:"Keltner",type:""}]];this.fundamentalTabList=[{txt:QSLGTXT.fundamental,id:0,closable:false},{txt:QSLGTXT.valuation,id:1,closable:false}];this.fundamentalPanelData=[[{txt:QSLGFD.rdividend_name,val:"RDividend"},{txt:QSLGFD.dyield_name,val:"DYield"},{txt:QSLGFD.reps_name,val:"REPS"},{txt:QSLGFD.sinterest_name,val:"SInterest"}],[{txt:QSLGFD.pe_name,val:"PE"},{txt:QSLGFD.ps_name,val:"PS"},{txt:QSLGFD.pb_name,val:"PB"},{txt:QSLGFD.pc_name,val:"PC"},{txt:QSLGFD.fairvalue_name,val:"FairValue"}]];this.ichartMenuData=[[{txt:QSLGTXT.cvolume,val:"Volume"},{txt:QSLGIN.vplus_name,val:"VPlus"}]];this.indicatorL2Data=[{txt:QSLGTXT.cvolume,val:"mainl2-volume",selectable:false,subMenu:this.indicatorPanelData[1]},{txt:QSLGTXT.pricetrends,selectable:false,val:"mainl2-pricetrend",subMenu:this.indicatorPanelData[2]},{txt:QSLGTXT.oscillator,val:"mainl2-oscillator",selectable:false,subMenu:this.indicatorPanelData[3]}];this.ichartMenuL1Data=[[],[],[],[],[]];this.miniChartRightMenuData=[{txt:"<b>"+QSLGTXT.indicators+"</b>",val:"mini-indicator",selectable:false},{txt:"&nbsp;&nbsp;"+QSLGTXT.cvolume,val:"minil1-volume",selectable:false,hasSubMenu:true},{txt:"&nbsp;&nbsp;"+QSLGTXT.pricetrends,val:"minil1-pricetrend",selectable:false,hasSubMenu:true},{txt:"&nbsp;&nbsp;"+QSLGTXT.oscillator,val:"minil1-oscillator",selectable:false,hasSubMenu:true},{txt:QSLGTXT.fundamental,val:"minil1-fundamental",selectable:false,hasSubMenu:true},{txt:QSLGTXT.valuation,val:"minil1-valuation",selectable:false,hasSubMenu:true},{type:"separator",val:"s2"},{txt:QSLGTXT.edit,val:"edit"}];this.rightMenuData=[{txt:QSLGTXT.charttype,val:"chartType",type:"",selectable:false,subMenu:this.chartTypeListData},{txt:QSLGTXT.chartcursor,val:"cursorType",type:"",selectable:false,subMenu:this.cursorTypeListData},{txt:QSLGTXT.zoom,val:"zoom",type:"",selectable:false,subMenu:this.zoomListData},{txt:QSLGTXT.events,type:"",val:"event",selectable:false,subMenu:this.eventsData},{txt:QSLGTXT.indicators,val:"indicator",selectable:false,subMenu:this.indicatorL2Data},{txt:QSLGTXT.fundamental,val:"mainl1-fundamental",selectable:false,subMenu:this.fundamentalPanelData[0]},{txt:QSLGTXT.valuation,val:"mainl1-valuation",selectable:false,subMenu:this.fundamentalPanelData[1]}];this.defaultFrequencyMap={}};RTChartComponent.prototype=$.extend({},QS_baseChart,{initUIConfig:function(a){$.extend(this.UIConfig,a);this._checkPermission();if(this.UIConfig.settingPanel!=null){this._contains.$settingPanel=$(this.UIConfig.settingPanel)}},Init:function(c,a,b){if(typeof(this.id)=="undefined"){this.id=c;if(typeof(GB_ChartDataManager)=="object"){GB_ChartDataManager.subscribeChart(this)}}this.outObj=$("#"+c).addClass("rtc-chart-out");this.autoBoxID=c+"_autoBox";this.createChartUI();this._initConfig(b);this._createUiComponents();var d=[];if(typeof(this.mainTicker)!="undefined"&&this.mainTicker!=null&&this.mainTicker!=""){d.push(this.mainTicker)}if(this.compairTickers&&this.compairTickers.length>0){d=d.concat(this.compairTickers)}if(d.length>0){this.validateSavedTickers(d)}},_checkPermission:function(){var b=this.UIConfig;for(var a=0;a<this.indicatorPanelData.length;a++){var d=this.indicatorPanelData[a];for(var c=0;c<d.length;c++){if(typeof(b.indicator[d[c].val])!="undefined"&&!b.indicator[d[c].val]){d.splice(c,1);c--}}}for(var a=0;a<this.fundamentalPanelData.length;a++){var d=this.fundamentalPanelData[a];for(var c=0;c<d.length;c++){if(typeof(b.valuations[d[c].val])!="undefined"&&!b.valuations[d[c].val]){delete this.valuations[d[c].val];d.splice(c,1);c--}}}for(var a=0;a<this.drawingData.length;a++){if(typeof(b.drawing[this.drawingData[a].val])!="undefined"&&!b.drawing[this.drawingData[a].val]){drawingData.splice(a,1);a--}}for(var a=0;a<this.eventsData.length;a++){if(typeof(b.events[this.eventsData[a].val])!="undefined"&&!b.events[this.eventsData[a].val]){this.eventsData.splice(a,1);a--}}},_initConfig:function(e){if(e==null||e==""){return}if(e.simpleMenu){this.simpleMenu=true;this.rightMenuData.splice(4,3)}if(e.chartStyle!=null){this.chartStyle=e.chartStyle=="lines"?"mountain":e.chartStyle;var b=false;for(var a=0;a<this.chartTypeListData.length;a++){if(this.chartTypeListData[a].val==this.chartStyle){b=true;break}}if(!b){this.chartStyle="mountain"}}if(e.autoTitle!=null){this.autoTitle=e.autoTitle}if(e.title){this._title=e.title}if(e.requencyMenuCfg){this.requencyMenuCfg=e.requencyMenuCfg}if(e.mTicker!=null){this.mainTicker=e.mTicker}if(e.cTickers!=null){this.compairTickers=e.cTickers}if(e.pWidth!=null){this.chartWidth=e.pWidth}if(e.pHeight!=null){this.pChartHeight=e.pHeight}if(e.zRange!=null){this.zoomRange=e.zRange}if(e.startDate!=null){this.startDate=RTQ_ChartUtil.convertToDate(e.startDate)}if(e.endDate!=null){this.endDate=RTQ_ChartUtil.convertToDate(e.endDate)}if(e.region!=null){this.region=e.region}if(e.lan!=null){this.lan=e.lan}if(e.cur!=null){this.cur=e.cur}if(e.frequency!=null){this.frequency=e.frequency}if(e.slider_StartDate!=null){this.slider_StartDate=RTQ_ChartUtil.convertToDate(e.slider_StartDate)}if(e.miniChartFrequency!=null){this.miniChartFrequency=e.miniChartFrequency}if(e.isD!=null){this.events.dividend=e.isD}if(e.isS!=null){this.events.splits=e.isS}if(e.isEarnings){this.events.earnings=e.isEarnings}if(e.events!=null){$.extend(true,this.events,e.events)}if(e.showVolume!=null){this.showVolume=e.showVolume}if(e.tickerInfos){this.tickerInfos=e.tickerInfos}if(e.chartCursor!=null){this.chartCursor=e.chartCursor}if(e.lock!=null){this.lock=e.lock}if(e.showNotes!=null){this.showNotes=e.showNotes}if(e.showIIVTicker!=null){this.showIIVTicker=e.showIIVTicker}if(e.yaxisAlign!=null){this.yaxisAlign=e.yaxisAlign}if(e.isShowTimeSlider!=null){this.isShowTimeSlider=e.isShowTimeSlider}if(e.showLegend!=null){this.showLegend=e.showLegend}if(e.simpleTick!=null){this.simpleTick=e.simpleTick}if(e.yLabelWidth!=null){this.yLabelWidth=e.yLabelWidth}if(e.indicatorsData){$.extend(true,this.indicatorsData,e.indicatorsData);for(var c in this.indicatorsData){if(this.indicatorsData[c].hasOwnProperty("oFlot")){delete this.indicatorsData[c]["oFlot"]}}}if(e.indicatorVisiable!=null){for(var c in e.indicatorVisiable){if(e.indicatorVisiable[c]){this.indicatorsData[c].show=true}}}if(e.valuations){$.extend(true,this.valuations,e.valuations)}if(e.scaleType){this.scaleType=e.scaleType}if(e.ticksize){this.ticksize=e.ticksize}if(e.Ticks){this.Ticks=e.Ticks}if(!e.smvV&&!this.indicatorsData.SMAV){this.indicatorsData.SMAV={show:false,num:null,colorIndex:0,type:0}}else{if(!this.indicatorsData.SMAV){this.indicatorsData.SMAV={show:true,num:e.smvV,colorIndex:0,type:0}}}if((!e.smvP||!e.smvP.length)&&!this.indicatorsData.SMA){this.indicatorsData.SMA={show:false,num:[null,null,null],startPos:[null,null,null],colorIndex:[0,0,0],type:0}}else{if(e.smvP&&e.smvP.length){this.indicatorsData.SMA={show:true,num:[e.smvP[0]?e.smvP[0]:null,e.smvP[1]?e.smvP[1]:null,e.smvP[2]?e.smvP[2]:null],colorIndex:[0,0,0],type:0}}}if(this.indicatorsData.EMA.length){var d={show:false,num:[null,null,null],colorIndex:[0,0,0],type:0};for(var a=0;a<this.indicatorsData.EMA.length;a++){d.num[a]=this.indicatorsData.EMA[a].num;d.colorIndex[a]=this.indicatorsData.EMA[a].colorIndex}this.indicatorsData.EMA=d}if(this.UIConfig.chartCtrl=="default"){}if(e.width!=null){this.chartWidth=(e.width>this.minW)?e.width:this.minW}if(e.height!=null){if(this.UIConfig.chartCtrl=="rtqPanel"){this.outHeight=e.height-26}else{this.outHeight=e.height}this._setSizeParas(this.chartWidth,this.outHeight);if(this.showVolume){this._elements.volLegendElm.show()}else{if(this._elements.volLegendElm!=null){this._elements.volLegendElm.hide()}}}this.outObj.css({width:this.chartWidth+"px",height:this.outHeight+"px"});this._contains.pChartContainer.css({width:this.chartWidth+"px",height:this.pChartHeight+"px"});if(this._elements.zoomMask!=null){this._elements.zoomMask.css({height:this.pChartHeight+"px"})}if(this._contains.vChartContainer!=null){this._contains.vChartContainer.css({width:this.chartWidth+"px",height:this.vChartHeight+"px"})}if(this._contains.mChartContainer!=null){this._contains.mChartContainer.css({width:this.chartWidth+"px",height:this.miniChartHeight+"px"})}},saveConfig:function(){var e={title:this._title,autoTitle:this.autoTitle,mTicker:this.mainTicker,cTickers:this.compairTickers,pWidth:this.chartWidth,pHeight:this.pChartHeight,vHeight:this.vChartHeight,mHeight:this.miniChartHeight,events:this.events,zRange:this.zoomRange,startDate:RTQ_ChartUtil.formatDate(this.startDate),endDate:RTQ_ChartUtil.formatDate(this.endDate),region:this.region,lan:this.lan,cur:this.cur,frequency:this.frequency,slider_StartDate:RTQ_ChartUtil.formatDate(this.slider_StartDate),miniChartFrequency:this.miniChartFrequency,chartStyle:this.chartStyle,showVolume:this.showVolume,tickerInfos:this.tickerInfos,chartCursor:this.chartCursor,scaleType:this.scaleType,yaxisAlign:this.yaxisAlign,ticksize:this.ticksize,Ticks:this.Ticks,lock:this.lock,showNotes:this.showNotes,showIIVTicker:this.showIIVTicker,isShowTimeSlider:this.isShowTimeSlider,requencyMenuCfg:this.requencyMenuCfg};var a={},d={},c=this.indicatorsData;for(var b in c){if(c[b].show||(!c[b].show&&b=="Volume")){if(b=="SMA"||b=="SMAV"||b=="EMA"){a[b]={show:true,num:typeof(c[b].num)=="object"?$.extend(true,[],c[b].num):c[b].num}}else{a[b]={show:c[b].show,parameter:$.extend(true,[],c[b].parameter)}}}}for(var b in this.valuations){if(this.valuations[b].show){d[b]={show:true}}}e.indicatorsData=a;e.valuations=d;return e},_initUiComponentsStatus:function(){var a=this._elements,e=this.uiComponents;if(e.ddlZoom!=null){e.ddlZoom.setDisable(false)}if(e.ddlChartType!=null){e.ddlChartType.setDisable(false)}if(e.ddlCursorType!=null){e.ddlCursorType.setDisable(false)}if(e.ddlFrequency!=null){e.ddlFrequency.setDisable(false)}if(e.settingPlugin!=null){e.settingPlugin.setName(this.autoTitle,this.autoTitle?"":this._title)}if(e.rightMenu!=null){if(this.events.dividend){e.rightMenu.changeUIState("dividend",null,true)}if(this.events.splits){e.rightMenu.changeUIState("splits",null,true)}if(this.events.earnings){e.rightMenu.changeUIState("earnings",null,true)}e.rightMenu.changeUIState(this.chartStyle,null,true);e.rightMenu.changeUIState(this.chartCursor,null,true)}if(this.UIConfig.chartCtrl=="default"&&a.volSwitchLink!=null&&typeof(a.volSwitchLink)!="undefined"){a.volSwitchLink.html((this.showVolume?QSLGTXT.hide:QSLGTXT.show))}if(this.chartCursor!="1"&&this.chartCursor!=1){a.lineXElm.hide();a.lineYElm.hide()}if(this.isShowTimeSlider&&e.chkLock!=null){e.chkLock.btns.showTimeSlider.select()}if(this.showNotes&&e.chkLock!=null){e.chkLock.btns.showNotes.select()}if(this.lock==true&&e.chkLock!=null){e.chkLock.btns.lock.select()}if(this.showIIVTicker&&e.chkIIV!=null){e.chkIIV.btns.showIIV.select()}if(this.yaxisAlign=="right"){if(a.$yaxisAlign){a.$yaxisAlign.find("[value='left']").addClass("rtq-ratio-off");a.$yaxisAlign.find("[value='right']").removeClass("rtq-ratio-off")}a.xLabelElm.css({right:0,left:""})}else{if(a.$yaxisAlign){a.$yaxisAlign.find("[value='right']").addClass("rtq-ratio-off");a.$yaxisAlign.find("[value='left']").removeClass("rtq-ratio-off")}a.xLabelElm.css({left:0,right:""})}if(e.ddlZoom!=null){e.ddlZoom.setTextValue(null,this.zoomRange)}if(e.ddlFrequency!=null){e.ddlFrequency.setTextValue(null,this.frequency)}if(e.ddlCursorType!=null){e.ddlCursorType.setTextValue(null,this.chartCursor)}if(e.ddlChartType!=null){e.ddlChartType.setTextValue(null,this.chartStyle)}if(this.scaleType==1&&a.$ratioScale!=null){a.$ratioScale.find("[value='0']").addClass("rtq-ratio-off");a.$ratioScale.find("[value='1']").removeClass("rtq-ratio-off")}if(e.tabMenu!=null){var b=this.tabIndexMap[this.chartStyle];e.tabMenu.changeTabByIndex(b,false)}for(var c=0;c<this.chartTypeMenuData.length;c++){if(e.chartTypeMenu[c]!=null&&this.tabIndexMap[this.chartStyle]==c){e.chartTypeMenu[c].changeUIState(this.chartStyle,null,true)}}var f=(this.UIConfig.chartCtrl=="default")?this.outObj:a.eventULElm;if(this.events.dividend){f.find("a[value='dividend']").removeClass("rtq-chkbox_off")}if(this.events.splits){f.find("a[value='splits']").removeClass("rtq-chkbox_off")}if(this.events.earnings){f.find("a[value='earnings']").removeClass("rtq-chkbox_off")}for(var d in this.indicatorsData){if(this.indicatorsData.hasOwnProperty(d)){if(this.indicatorsData[d].show){a.indicatorULElm.find("a[value='"+d+"']").removeClass("rtq-chkbox_off");if(this.UIConfig.RightMenu){if(d=="Volume"){this.changeRightMenuClass(2,d,this.showVolume);continue}this.changeRightMenuClass(2,d,true)}}}}for(var d in this.valuations){if(this.valuations[d].show){a.valuationULElm.find("a[value='"+d+"']").removeClass("rtq-chkbox_off");if(this.UIConfig.RightMenu&&this.valuations[d].hasOwnProperty("mty")){this.changeRightMenuClass(2,d,true)}else{if(d=="FairValue"){this.changeRightMenuClass(2,d,true)}}}}for(var c=0;c<this.compairTickers.length;c++){if(this.indexsMap[this.compairTickers[c]]){this.indexsMap[this.compairTickers[c]].show=true;a.indexsULElm.find("a[value='"+this.compairTickers[c]+"']").removeClass("rtq-chkbox_off")}}},createChartUI:function(){var s=this,j=this.UIConfig,f=this._elements,r=this._contains,t=this.uiComponents;t.ddlChartType=t.ddlFrequency=t.ddlZoom=t.ddlCursorType=null;if(!j.CustomUI){this.outObj.html("")}if(j.chartCtrl=="default"&&j.pCtrl1&&j.pCtrl1!=null){var h=$('<div class="rtc-ctrl1"></div>');if(j.pCtrl1.showCompair){h.append('<span class="rtc-ctrl-lb1B" style="padding-left: 5px">'+QSLGTXT.compare+'</span><input id ="'+this.autoBoxID+'" class="qs-ui-ipt" type="text" style="width: 90px;" value="" /><a href="javascript:void(0)" class="qs-ui-btn go qs-compare-button">ADD</a>')}if(j.pCtrl1.showTimeRange){h.append('<div class="rtc-ctrl-sect customRange"></div> ')}if(j.pCtrl1.showFrequency){h.append('<div class="rtc-ctrl-sect ddlFrequency"></div>')}if(j.pCtrl1.showZoom){h.append('<div class="rtc-ctrl-sect ddlZoom"></div>')}f.addCompairBtElm=h.find(".qs-compare-button");this.outObj.append(h);h=null}if(j.chartCtrl=="default"&&j.pCtrl2&&j.pCtrl2!=null){this.outObj.addClass("qs-default-chart");var a=$('<div class="rtc-ctrl2"></div>');if(j.pCtrl2.showChartType){a.append('<div class="rtc-ctrl-sect ddlChartType" style="padding-left: 0"> </div>')}if(j.pCtrl2.showSMV){var p='<div class="rtc-ctrl-sect"><span class="rtc-ctrl-lb2B">'+QSLGTXT.movavg+"</span>";for(var e=0;e<3;e++){p+='<input type="text" style="width: 40px;" class="qs-ui-ipt qs-mov'+(e+1)+'" />'}a.append(p)}if(j.pCtrl2.showEvent){var q='<div class="rtc-ctrl-sect"><li class="rtc-pmdd1" style="height: 26px">';q+='<a class="rtc-pmddh1" href="javascript:void(0)">'+QSLGTXT.events+'</a><ul class = "qs-event-list">';for(var g in this.eventsData){var k=this.eventsData[g];q+='<li><a href="javascript:void(0)" class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off" ';q+=' value="'+k.val+'" catkey="event">'+k.txt+"</a></li>"}q+="</ul></li></div>";a.append(q)}if(j.pCtrl2.showIndicator){var m='<div class="rtc-ctrl-sect"> <li class="rtc-pmdd1 rtc-menu-trigger" style="height: 26px;width:120px">';m+='<a class="rtc-pmddh1" href="javascript:void(0)">'+QSLGTXT.indicators+'</a><ul class="qs-indicator-list">';for(var g=0;g<this.indicatorPanelData[0].length;g++){var c=this.indicatorPanelData[0][g];m+='<li><a href="javascript:void(0)" class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off" ';m+='value = "'+c.val+'" catkey="indicator" >'+c.txt+"</a></li>"}m+="</ul></li></div>"}a.append(m);this.outObj.append(a);a=null}if(j.chartCtrl=="rtqPanel"){this.outObj.append('<div class="rtc-ul-tab clearfix"><div class="rtc-tab-zoom"><div class="rtq-ddl" style="z-index: 2000; width: 115px;"><div val="1" style="width: 111px;" class="rtq-ddl-ipt"></div></div></div><div class="rtc-tab"></div></div>');f.tabmenuZoomEl=this.outObj.find(".rtc-tab-zoom .rtq-ddl")}if(j.Chart&&j.Chart!=null&&!j.CustomUI){var n=$('<div class="rtc-chart-container rtc-price-chart"></div>').appendTo(this.outObj);if(j.Chart.showPChart){if(j.Chart.showLegend){f.legendElm=$('<div class="rtc-legend-txt"></div>').appendTo(n)}else{f.legendElm=null}r.pChartContainer=$('<div class="rtc-chart rtc-chart-main"></div>').appendTo(n);f.crosshairLegendWin=$('<div class="rtc-legend-win" style="display:none;"><div class="rtc-legend-win-wrap"></div></div>').appendTo(r.pChartContainer);f.crosshairLegendElm=f.crosshairLegendWin.find(".rtc-legend-win-wrap");f.lineXElm=$('<div class="rtc-line-x"><span></span></div>').appendTo(r.pChartContainer);f.lineYElm=$('<div class="rtc-line-y"></div>').appendTo(r.pChartContainer);f.xLabelElm=f.lineXElm.find(":first-child");if(j.ZoomIn){f.zoomMask=$('<div style="display:none" class="chart-zoom-mask"></div>').appendTo(r.pChartContainer)}}}if(j.chartCtrl=="default"&&j.vCtrl&&j.vCtrl!=null){var b=$('<div class="rtc-ctrl2"><div class="rtc-ctrl-sect"><span class="rtc-ctrl-lb2B">'+QSLGTXT.cvolume+" ("+QSLGTXT.shortmillion+")</span></div></div>");if(j.vCtrl.showSMVV){b.append(' <div class="rtc-ctrl-sect"><span class="rtc-ctrl-lb2B">'+QSLGTXT.movavg+'</span><input style="width: 40px;" class="qs-ui-ipt qs-mov-vol" type="text" /></div>')}if(j.vCtrl.showHideLink){b.append('<div class="rtc-ctrl-sect" style="float: right;"><a href="javascript:void(0)" class="rtc-ctrl-lb2B volLink">'+QSLGTXT.hide+"</a></div>")}this.outObj.append(b);f.volSwitchLink=this.outObj.find(".volLink").unbind("click").bind("click",function(){s.toggleVolumeChartVision();return false});b=null}if(j.Chart.showVChart){var d=$('<div class="rtc-chart-container"></div>').appendTo(this.outObj);f.volLegendElm=$('<div class="volLegend"></div>').appendTo(d);r.vChartContainer=$('<div class="rtc-chart  rtc-chart-mini"></div>').appendTo(d)}else{this.showVolume=false}if(j.Chart.showTimeSlider){var l=$('<div class="rtc-chart-container"></div>').appendTo(this.outObj);r.mChartContainer=$('<div class="rtc-chart"></div>').appendTo(l)}else{this.isShowTimeSlider=false}if(j.chartCtrl=="rtqPanel"){this._createSettingPanelUI()}else{f.indicatorULElm=this.outObj.find(".qs-indicator-list");if(j.pCtrl2&&j.pCtrl2.showSMV){f.m1=this.outObj.find(".qs-mov1").val(QSLGTXT.line+" 1").css({color:"#666"});f.m2=this.outObj.find(".qs-mov2").val(QSLGTXT.line+" 2").css({color:"#666"});f.m3=this.outObj.find(".qs-mov3").val(QSLGTXT.line+" 3").css({color:"#666"});f.m1.unbind("keydown").bind("keydown",function(i){var o=(window.event)?i.keyCode:i.which?i.which:i.charCode;if(o==13){s.addSMA()}});f.m2.unbind("keydown").bind("keydown",function(i){var o=(window.event)?i.keyCode:i.which?i.which:i.charCode;if(o==13){s.addSMA()}});f.m3.unbind("keydown").bind("keydown",function(i){var o=(window.event)?i.keyCode:i.which?i.which:i.charCode;if(o==13){s.addSMA()}});f.m1.click(function(){s.clearBox(this)});f.m2.click(function(){s.clearBox(this)});f.m3.click(function(){s.clearBox(this)})}if(j.vCtrl&&j.vCtrl.showSMVV){f.mv=this.outObj.find(".qs-mov-vol").val(QSLGTXT.line+" 1").css({color:"#666"});f.mv.unbind("keydown").bind("keydown",function(i){var o=(window.event)?i.keyCode:i.which?i.which:i.charCode;if(o==13){s.addIndicators("SMAV",f.mv.attr("value"))}});f.mv.click(function(){s.clearBox(this)})}f.$customDate=this.outObj.find(".customRange");f.eventULElm=this.outObj.find(".qs-event-list");f.valuationULElm=this.outObj.find(".qs-valuation-list");f.indexsULElm=this.outObj.find(".qs-index-list");f.relatedSecULElm=this.outObj.find(".qs-relative-list");f.tabmenuZoomEl=this.outObj.find(".rtc-tab-zoom .rtq-ddl")}if(typeof(this.afterCreateUI)=="function"){this.afterCreateUI()}},_createSettingPanelUI:function(){var j=this._elements,v=this._contains,y=this.uiComponents,x=this;v.$settingPanel.html("");if(!this.UIConfig.panel.showWindow){this.settingGroupList.splice(1,1)}if(!this.UIConfig.panel.showNote){this.drawingData.splice(3,1)}var r=new Util.GroupBox(v.$settingPanel,this.settingGroupList,{width:180,groupBoxHeight:310,autoHeight:true});var t=r.getGroup(1).bd,l="";l+='<div class="clearfix block-row-top"><h4>'+QSLGTXT.charttype+'</h4><div class="ddlChartType"></div></div>';l+='<div class="clearfix block-row"><h4>'+QSLGTXT.verticalscale+'</h4><div class="ratioScale"></div></div>';l+='<div class="clearfix block-row"><h4>'+QSLGTXT.yaxis+'</h4><div class="ratioYaxis"></div></div>';l+='<div class="clearfix block-row"><h4>'+QSLGTXT.selectionmode+'</h4><div class="ratioSelectionMode"></div></div>';l+='<div class="clearfix block-row"><h4>'+QSLGTXT.range+'</h4><div class = "customRange clearfix" ></div></div>';l+='<div class="clearfix block-row"><div class="set-block"><h4>'+QSLGTXT.zoom+'</h4><div class="ddlZoom"></div></div>';l+='<div class="set-block set-right"><h4>'+QSLGTXT.frequency+'</h4><div class="ddlFrequency"></div></div></div>';l+='<div class="clearfix block-row"><div class="set-block"><h4>'+QSLGTXT.chartcursor+'</h4><div class="ddlCursorType"></div></div></div>';l+='<div class="clearfix block-row"><div class="set-block"><div class="iivTicker"></div></div></div>';t.append(l);j.$customDate=t.find(".customRange");j.$ratioScale=t.find(".ratioScale");j.$yaxisAlign=t.find(".ratioYaxis");j.$selectionMode=t.find(".ratioSelectionMode");var n="",g;for(var h=0;h<this.scaleTypeListData.length;h++){g=h==0?"rtq-ratio-left ":"rtq-ratio-off";n+='<a href="javascript:void(0)" catkey="scale" class="rtc-menu-trigger rtq-ratio '+g+' " ';n+='value="'+this.scaleTypeListData[h].val+'">'+this.scaleTypeListData[h].txt+"</a>"}j.$ratioScale.html(n);n="";for(var h=0;h<this.yaxisAlignListData.length;h++){n+='<a href="javascript:void(0)" catkey="yaxis" class="rtc-menu-trigger rtq-ratio '+(h==0?"rtq-ratio-left ":"rtq-ratio-off")+' " ';n+='value="'+this.yaxisAlignListData[h].val+'">'+this.yaxisAlignListData[h].txt+"</a>"}j.$yaxisAlign.html(n);n="";for(var h=0;h<this.selectionModeListData.length;h++){n+='<a href="javascript:void(0)" catkey="selectionmode" class="rtc-menu-trigger rtq-ratio rtq-menu-selectmode '+(h==0?"rtq-ratio-left ":"rtq-ratio-off")+" "+(this.selectionModeListData[h].val!="reset"?" ":"rtq-ratio-chart-reset")+'" ';n+='value="'+this.selectionModeListData[h].val+'">'+this.selectionModeListData[h].txt+"</a>"}j.$selectionMode.html(n);j.iivContainer=t.find(".iivTicker");y.chkIIV=new Util.ButtonGroup(j.iivContainer,[{txt:QSLGTXT.inav+"/"+QSLGTXT.nav,val:"showIIV"}],{onClick:function(i,o){if(i=="showIIV"){x.switchIIV(o.isSelected)}}},{type:"checkbox",vertical:true});var u=r.getGroup(2).bd;u.append('<div class="clearfix block-row-top"><h4>'+QSLGTXT.compare+'</h4><div class="clearfix" style="position:relative"><input  id ="'+this.autoBoxID+'" class="qs-ui-ipt" type="text" style="width: 132px;" value="" /><a href="javascript:void(0)" class="qs-ui-btn go qs-compare-button">'+QSLGTXT.add+"</a><div></div>");u.append('<div class="clearfix block-row"><h4>'+QSLGTXT.relatedindexes+'</h4><div class="relatedIndexs" style="height:80px"></div></div>');u.append('<div class="clearfix block-row"><h4>'+QSLGTXT.relatedsecurities+'</h4><div class="relatedSecuities"></div></div>');j.addCompairBtElm=u.find(".qs-compare-button");var m="";for(var k in this.indexsMap){m+='<div class="check-row"><a href="javascript:void(0)" class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off" ';m+='value="'+k+'" name="'+this.indexsMap[k].name+'" catkey="indexs" >'+this.indexsMap[k].txt+"</a></div>"}j.indexsULElm=u.find(".relatedIndexs").html(m);y.indexScrollPN=new Util.ScrollPanel(j.indexsULElm,{showX:false});r.getGroup(2).hd.bind("click.chart",function(i){if(y.indexScrollPN!=null&&!x._indexScrollResized){y.indexScrollPN.reSize(null,80);x._indexScrollResized=true}});j.relatedSecULElm=u.find(".relatedSecuities");var u=r.getGroup(3).bd;var a="<div class='clearfix block-row-top'><h4></h4>";for(var h=0;h<this.drawingData.length;h++){a+="<div  catkey='draw' class='rtc-menu-trigger draw-row' value="+this.drawingData[h].val+">";a+="<a href='javascript:void(0)'>"+this.drawingData[h].txt+"</a></div>"}a+="</div>";u.append(a);j.$drawBlock=u.find(".block-row-top");var q=r.getGroup(4).bd.addClass("rtq-chart-group-indi");y.indTabMenu=new Util.TabMenu(q[0],this.indicatorTabList,{onActive:function(i){}},{width:80,isExcuteCallbackAtInit:false,autoFixtoText:false,vertical:true});var n="",b=y.indTabMenu.tabs.length;for(var h=0;h<b;h++){n="";for(var k=0;k<this.indicatorPanelData[h].length;k++){var c=this.indicatorPanelData[h][k];n+='<div class="check-row"><a href="javascript:void(0)" class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off" ';n+=' value="'+c.val+'" catkey="indicator" >'+c.txt+"</a></div>"}y.indTabMenu.tabs[h].panel.append(n)}j.indicatorULElm=q.find(".rtq-tab-panels");q.css({position:"relative"});var p=r.getGroup(5).bd;var e="<div clearfix block-row-top><h4></h4><div class='event'>";for(var h=0;h<this.eventsData.length;h++){var w=this.eventsData[h];e+="<div class='check-row'><a class='rtc-menu-trigger rtq-chkbox rtq-chkbox_off' ";e+="value='"+w.val+"' name='"+w.name+"' catkey='event' href='javascript:void(0)'>"+w.txt+"</a></div>"}e+="</div></div>";p.append(e);j.eventULElm=p.find(".event");var s=r.getGroup(6).bd.addClass("rtq-chart-group-fund");y.funTabMenu=new Util.TabMenu(s[0],this.fundamentalTabList,{onActive:function(i){}},{width:80,isExcuteCallbackAtInit:false,autoFixtoText:false,vertical:true});n="";for(var h=0;h<y.funTabMenu.tabs.length;h++){n="";for(var k=0;k<this.fundamentalPanelData[h].length;k++){var d=this.fundamentalPanelData[h][k];n+='<div class="check-row"><a href="javascript:void(0)" class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off"';n+=' value="'+d.val+'" catkey="valuation" >'+d.txt+"</a></div>"}y.funTabMenu.tabs[h].panel.append(n)}j.valuationULElm=s.find(".rtq-tab-panels");if(this.UIConfig.panel.showWindow){var f=r.getGroup(7).bd;y.settingPlugin=new SettingPlugin(f,{className:"rtq-setting-plugin-black",width:170,showLockCheckable:false,showHideCheckable:false},{onChangeTitle:function(i,o,z){x.autoTitle=z;x.onChangeTitle(i,o,z)}});f.append('<div class="clearfix block-row"><div class="set-block"><div class="lock"></div></div></div>');y.chkLock=new Util.ButtonGroup(f.find(".lock"),[{txt:QSLGTXT.showtimerangeslider,val:"showTimeSlider"},{txt:QSLGTXT.lockondoubleclick,val:"lock"},{txt:QSLGTXT.shownotes,val:"showNotes"}],{onClick:function(i,o){if(i=="showTimeSlider"){x.isShowTimeSlider=o.isSelected;if(x.isShowTimeSlider){v.mChartContainer.show()}else{v.mChartContainer.hide()}x.changeOutSize(x.chartWidth,x.outHeight)}else{if(i=="lock"){x.lock=o.isSelected}else{if(i=="showNotes"){x.showNotes=o.isSelected;if(x.showNotes){x._loadChartNote(x.mainTicker)}else{x._contains.pChartContainer.find(".qs-note-flot").remove()}}}}}},{type:"checkbox",vertical:true});y.chkLock.btns.lock.el[0].title="This function allows you to prevent the window from updating when you double-click a security in the watchlist."}},_createUiComponents:function(){var a=this.uiComponents,g=this.UIConfig,f=this._contains,b=this._elements,h=this;var e,d="";if(g.chartCtrl=="rtqPanel"){e=f.$settingPanel;d="rtq-ddl-black",hcolor="#727272"}else{e=this.outObj}if(g.pCtrl1&&g.pCtrl1.showZoom&&a.ddlZoom==null){a.ddlZoom=new Util.DropDownList(e.find(".ddlZoom")[0],function(j,i){h.zoomSelected(j,i)},h.zoomListData,{triggerByClick:false,width:76,disable:true,actionAtInit:false,className:d})}if(g.pCtrl1&&g.pCtrl1.showFrequency&&a.ddlFrequency==null){a.ddlFrequency=new Util.DropDownList(e.find(".ddlFrequency")[0],function(j,i){h.frequencySelected(j,i)},h.frequencyListData,{triggerByClick:false,width:76,disable:true,actionAtInit:false,className:d})}if(g.chartCtrl=="rtqPanel"&&g.pCtrl2&&g.pCtrl2.showCursorType&&a.ddlCursorType==null){var c=g.chartCtrl=="default"?75:165;a.ddlCursorType=new Util.DropDownList(e.find(".ddlCursorType")[0],function(j,i){h.cursorTypeSelected(j,i)},h.cursorTypeListData,{triggerByClick:false,width:c,disable:true,actionAtInit:false,className:d})}if(g.pCtrl2&&g.pCtrl2.showChartType&&a.ddlChartType==null){var c=g.chartCtrl=="default"?105:165;a.ddlChartType=new Util.DropDownList(e.find(".ddlChartType")[0],function(j,i){h.chartTypeSelected(j,i)},h.chartTypeListData,{triggerByClick:false,width:c,disable:true,actionAtInit:false,className:d})}this._createIndicatorInputWin(this.outObj);if(g.chartCtrl=="rtqPanel"){this._createTabMenu()}if(g.RightMenu){this._createRightMenu(f.pChartContainer);this._createIChartRightMenu()}if(g.pCtrl1&&g.pCtrl1.showTimeRange){this._createDateInputBoxes()}},autoCPCallback:function(a){this.acceptTicker(a)},requestRelateSec:function(){var f=this.tickerInfos[this.mainTicker];var g=f.ticker,a=f.gkey;var e=typeof(gData)=="undefined"||!gData[a]?f.country:gData[a]["country"];var c=this.dataUrl.relatiedSecURL+"&t="+g+"&region="+e;var d=this;var b=$.getJSON(c+"&callback=?",function(h){d.buildRelatedSec(h)});if(b&&b.fail){b.fail(function(){d.buildRelatedSec({})})}},buildRelatedSec:function(d){if(d==null||!d.length){if(this._elements.relatedSecULElm){this._elements.relatedSecULElm.html("")}return}var c="",b=this;for(var a=0;a<d.length;a++){if(d[a].PID==this.mainTicker){continue}c+='<div class="check-row"><a catkey="relateSec" name="'+d[a].Name+'" value="'+d[a].PID+'"';c+=' class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off" href="javascript:void(0)">'+d[a].Name+"</a></div>"}this._elements.relatedSecULElm.html(c).find(".rtc-menu-trigger").click(function(){b.menuButtonClicked(this)});if(this.compairTickers.length){for(var a=0;a<this.compairTickers.length;a++){this._elements.relatedSecULElm.find("a[value='"+this.compairTickers[a]+"']").removeClass("rtq-chkbox_off")}}},initComponent:function(){var a=this;this._attachUIEvents();if(this.UIConfig.chartCtrl=="rtqPanel"){this.requestRelateSec()}this._initUiComponentsStatus();this.chartData.DataList=this.chartData.VolList=this.chartData.eventDataList=null;for(var b in this.iChartData){this.iChartData[b]=[]}this.initStartDate();if(typeof(this.setTitle)=="function"){var c=this._getClientTicker(this.mainTicker);this.setTitle(this._title,c)}this.changeRange(this.zoomRange);setTimeout(function(){a.getSilderChartData()},200)},_attachUIEvents:function(){var a=this._elements,b=this,c=this._contains;if(a.legendElm!=null){a.legendElm.unbind().bind("mouseover.rtqChart",function(f){var h=$(f.target);if(f.target.tagName.toUpperCase()=="SPAN"||h.hasClass("rtc-legend")){var g=h.closest(".rtc-legend");if(g.attr("name")!="MReturnIndex"){g.find(".rtc-legend-remove").removeClass("rtc-remove-hide")}}}).bind("mouseout.rtqChart",function(f){a.legendElm.find(".rtc-legend-remove").toggleClass("rtc-remove-hide",true)}).bind("click.rtqChart",function(f){var g=$(f.target),o=g.data("type");if(f.target.tagName.toUpperCase()=="SPAN"&&g.hasClass("rtc-legend-remove")){var j=$(f.target).closest(".rtc-legend");b.legendOnClick(j)}else{if(o=="ct"){var k=g.parent(),l=k.attr("name"),m=b.tickerInfos[l].gkey;var n=b.tickerInfos[l].type||gData[m]["type"];if($.inArray(parseInt(n,10),b.securityType)==-1&&$.inArray(stype,b.securityType)==-1){return}a.legendElm.find(".rtc-legend-bold").removeClass("rtc-legend-bold");g.addClass("rtc-legend-bold");if(k&&l){var p=b.mainTicker;for(var h=0;h<b.compairTickers.length;h++){if(b.compairTickers[h]==k.attr("name")){b.compairTickers[h]=b.mainTicker;if(typeof(b.afterSwitchMainTickerFromCompareTickers)=="function"){b.afterSwitchMainTickerFromCompareTickers(b.tickerInfos[b.mainTicker],l)}b.mainTicker="";b.acceptTicker(l);break}}}}}})}if(a.volLegendElm!=null){a.volLegendElm.unbind().bind("mouseover.rtqChart",function(f){var h=$(f.target);if(h.parent()&&h.parent().hasClass("rtc-legend")){var g=h.closest(".rtc-legend");g.find(".rtc-legend-remove").removeClass("rtc-remove-hide")}else{a.volLegendElm.find(">.rtc-legend-remove").removeClass("rtc-remove-hide")}}).bind("mouseout.rtqChart",function(f){a.volLegendElm.find(".rtc-legend-remove").toggleClass("rtc-remove-hide",true)}).bind("click.rtqChart",function(f){var h=$(f.target);if(h.hasClass("rtc-legend-remove")){if(h.parent()&&h.parent().hasClass("volLegend")){b.switchVolumeChart(false);if(b.indicatorsData.VPlus.show){b.indicatorsData.VPlus.show=false;b.changeRightMenuClass(2,"VPlus",false);a.indicatorULElm.find("a[value='VPlus']").addClass("rtq-chkbox_off")}else{if(b.indicatorsData.Volume.show){b.indicatorsData.Volume.show=false;b.changeRightMenuClass(2,"Volume",false);a.indicatorULElm.find("a[value='Volume']").addClass("rtq-chkbox_off")}}b.indicatorsData.SMAV.show=false;b.indicatorsData.SMAV.num=null;if(a.indicatorULElm!=null){a.indicatorULElm.find("a[value='SMAV']").addClass("rtq-chkbox_off")}b.changeRightMenuClass(2,"SMAV",false);if(typeof(b.afterRemoveVolumeChart)=="function"){b.afterRemoveVolumeChart()}}else{var g=$(f.target).closest(".rtc-legend");b.legendOnClick(g)}}})}var d=$("#"+this.autoBoxID);if(this.UIConfig.pCtrl1&&this.UIConfig.pCtrl1.showCompair&&d.length>0){if(typeof(GB_qsAutoCompleteBox)=="object"){GB_qsAutoCompleteBox.subscription(this.autoBoxID,function(e){b.validateCompairTicker(e)},{needClear:true})}if(this.UIConfig.chartCtrl!="default"){d.css({color:"#DFDFDF"})}d.val(QSLGTXT.entersecurity||"Enter Security").click(function(){b.clearBox(this)});a.addCompairBtElm.unbind("click").click(function(){var e=$("#"+b.autoBoxID).attr("value");GB_qsAutoCompleteBox.triggerACB(b.autoBoxID)})}this.outObj.find(".rtc-menu-trigger").unbind("click").click(function(){if(b.mainTicker!=""&&b.mainTicker!=null){b.menuButtonClicked(this)}});if(this.UIConfig.chartCtrl=="rtqPanel"){c.$settingPanel.find(".rtc-menu-trigger").unbind("click").click(function(){if(b.mainTicker!=""&&b.mainTicker!=null){b.menuButtonClicked(this)}})}this.attachMouseScoll();this.attachZoomIn()},addSMA:function(){var a=this._elements;this.addIndicators("SMA",a.m1.val(),a.m2.val(),a.m3.val())},clearBox:function(a){if(a==null){return}var b=$(a).val();if(b.substring(0,4)=="Line"||b=="Enter Security"){$(a).val("")}if(this.UIConfig.chartCtrl=="rtqPanel"){$(a).css("color","#DFDFDF")}},getTickerInfo:function(a){if(typeof(gIdMap)!="undefined"&&typeof(gData)!="undefined"){return gData[gIdMap[a]]}else{return this.tickerInfos[a]}},initStartDate:function(){var a=GB_ChartDataManager.dates;this.sDates.iMin=a[1];this.sDates.sMin=a[5];this.sDates.lMin=a[10];this.sDates.d=a.d;this.sDates.w=a.w;this.sDates.m=a.m;this.slider_StartDate=this.getSliderStartDate()},getPidByExchAndTicker:function(b){var d=b.split(":");if(d.length<2){if(this.mainTicker==b){return b}else{for(var a=0;a<this.compairTickers.length;a++){if(this.compairTickers[a]==b){return this.compairTickers[a]}}}}else{if(typeof(this.tickerInfos)=="object"){for(var c in this.tickerInfos){if(this.tickerInfos[c]["gkey"]==b||(this.tickerInfos[c].exch==d[0]&&this.tickerInfos[c].ticker==d[1])){return c}}}}},_setSizeParas:function(d,e){this.chartWidth=d;this.outHeight=e;var a=this.getIChartsHeight();var b=e-a;if(this.showLegend){b=b-25}if(this.isShowTimeSlider){b=b-30}if(this.UIConfig.chartCtrl=="default"){}else{if(this.UIConfig.chartCtrl=="rtqPanel"){b-=30}}var g=b>this.minH?b:this.minH;var c=g-this.iChartHeight;var f=this.iChartHeight-20;if(!this.showVolume){f=0;c=g}this.pChartHeight=c;this.vChartHeight=f},_calFrequencyByRange:function(){var a=(this.endDate.getTime()-this.startDate.getTime())/86400000;return a},_getFrequencyList:function(a){var e=[0,7],f=7,d=0,c=[];if(a=="i"){e=[0,4]}else{if(a=="sm"){e=[1,5]}else{if(a=="lm"){e=[2,6]}else{if(a=="d"){e=[5,7]}else{if(a=="w"){e=[6,7]}else{if(a=="m"){e=[7,7]}}}}}}if(this.requencyMenuCfg.intraday&&!this.requencyMenuCfg.history){f=4}else{if(!this.requencyMenuCfg.intraday&&this.requencyMenuCfg.history){d=5}}for(var b=0;b<this.frequencyListData.length;b++){if(b<e[0]||b>e[1]||b<d||b>f){continue}c.push(this.frequencyListData[b])}return c},calculateFrequency:function(b){var d="minute",c=this._calFrequencyByRange(),a=this.startDate;if(a>=this.sDates.iMin||(c<=5&&this.startDate>=this.sDates.lMin)){d="minute"}else{if(a>=this.sDates.sMin||(c<30&&a>=this.sDates.lMin)){d="minute5"}else{if(a>=this.sDates.lMin){d="minute10"}else{if(a>=this.sDates.d){d="d"}else{if(a>=this.sDates.w){d="w"}else{d="m"}}}}}return d},changeFrequencyStyle:function(c){var b=this.uiComponents,a=this._elements,e,d;if(c==1||c==2||c==0){e="minute";if(this._frequencyIndexMap[this.frequency]>0){this.frequency=e}d="minute"}else{e=this.calculateFrequency(this.startDate);d=this._frequencyIndexMap[e]<1?"minute":e=="w"?"m":e}this.changeFrequency(e);if(this.UIConfig.customFrequency==1&&this.defaultFrequencyMap[c]){this.frequency=this.defaultFrequencyMap[c]}if(b.rightMenu!=null){b.rightMenu.changeUIState(c,"zoom",true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(c,null,true);a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(this.zoomListData[this._zoomIndexMap[c]].txt+" | "+this._frequencyTxtMap[this.frequency])}if(this.noHistoricalData||!this.requencyMenuCfg.history){d="minute"}else{if(!this.requencyMenuCfg.intraday&&this.requencyMenuCfg.history&&d=="minute"){d="d"}}if(this._frequencyIndexMap[d]>0&&d!=this.miniChartFrequency){this.miniChartFrequency=d;this.getSilderChartData()}else{if(this._frequencyIndexMap[d]<=0&&this.miniChartFrequency!="minute"){this.miniChartFrequency="minute";this.getSilderChartData()}else{this.setSliderHandleValues()}}},changeFrequency:function(a){if(this._frequencyIndexMap[a]>this._frequencyIndexMap[this.frequency]){this.frequency=a}else{if((this.zoomRange==13||this.zoomRange==3)&&this._frequencyIndexMap[this.frequency]>1){this.frequency="d"}else{if((this.zoomRange==14||this.zoomRange==4)&&this._frequencyIndexMap[this.frequency]>2){this.frequency="w"}else{if(this.zoomRange==11){if((a=="minute"&&this._frequencyIndexMap[this.frequency]>=this._frequencyIndexMap.d)){this.frequency=a}else{if(a=="minute5"&&this._frequencyIndexMap[this.frequency]>=this._frequencyIndexMap.w){this.frequency="d"}else{if(a=="minute10"&&this._frequencyIndexMap[this.frequency]>=this._frequencyIndexMap.m){this.frequency="w"}else{if(a=="minute10"&&this.frequency=="minute15"){this.frequency="minute30"}}}}}}}}if(this.UIConfig.pCtrl1==null||!this.UIConfig.pCtrl1.showFrequency){if(!this.customizeFreq){this.frequency=a}}this.bindFrequencyMenu(a)},bindFrequencyMenu:function(e){if(this.UIConfig.pCtrl1==null||!this.UIConfig.pCtrl1.showFrequency){return}var c=this._frequencyIndexMap[e],b=this.uiComponents,a=this._elements;if(c!=this.selectFreIndex){if(c<=-4||this.zoomRange<3){b.ddlFrequency.rebindData(this._getFrequencyList("i"))}else{if(c<=-3){b.ddlFrequency.rebindData(this._getFrequencyList("sm"))}else{if(c<=0){b.ddlFrequency.rebindData(this._getFrequencyList("lm"))}else{if(c==1){b.ddlFrequency.rebindData(this._getFrequencyList("d"))}else{if(c==2){b.ddlFrequency.rebindData(this._getFrequencyList("w"))}else{if(c==3){b.ddlFrequency.rebindData(this._getFrequencyList("m"))}}}}}}this.selectFreIndex=c}if(b.ddlFrequency!=null){b.ddlFrequency.setTextValue("",this.frequency);if(b.rightMenu!=null){b.rightMenu.changeUIState(this.frequency,this.zoomRange,true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(this.frequency,this.zoomRange,true);var d=this.zoomListData[this._zoomIndexMap[this.zoomRange]].txt+" | "+this._frequencyTxtMap[this.frequency];a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(d)}}},buildVolLegend:function(a){var e="",g,f,d,b=this.chartData;if(!this.showVolume||!b.VolList||!b.VolList.length){return}for(var c=0;c<b.VolList.length;c++){g=b.VolList[c].legend,d=b.VolList[c].name;if(a!=null&&a>-1){f=this.getVolInfo(a)}else{f=""}e+=this.createLegendSpan((c==0?0:2),g,f,(c==0?-1:c),("name="+d))}e+='<span class="rtc-legend-remove rtc-remove-hide rtc-legend-right"></span>';this._elements.volLegendElm.html(e)},toggleVolumeChartVision:function(){if(this.showVolume){if(this.UIConfig.chartCtrl=="default"){this._elements.volSwitchLink.html(QSLGTXT.show)}}else{if(!this.showVolume){if(this.UIConfig.chartCtrl=="default"){this._elements.volSwitchLink.html(QSLGTXT.hide)}}}var a=this.showVolume?0:1;this.switchVolumeChart(a)},_upMiniFrequency:function(){var a;if(this.miniChartFrequency=="minute"){a="d"}else{if(this.miniChartFrequency=="d"){a="w"}else{if(this.miniChartFrequency=="w"){a="m"}else{a="m"}}}return a},switchVolumeChart:function(a){var c=this._contains,b=this._elements;if(this.showVolume!=(a==1)){this.showVolume=(a==1);if(this.showVolume){c.vChartContainer.show();b.volLegendElm.show();this.pChartHeight=this.pChartHeight-this.iChartHeight;this.vChartHeight=this.iChartHeight-20;c.pChartContainer.css("height",this.pChartHeight);c.vChartContainer.css("height",this.vChartHeight);if(this.pFlot!=null){this.pFlot.changeOutSize(this.chartWidth,this.pChartHeight)}if(this.vFlot!=null){this.vFlot.changeOutSize(this.chartWidth,this.vChartHeight)}}else{this.pChartHeight=this.pChartHeight+this.iChartHeight,this.vChartHeight=0;c.pChartContainer.css("height",this.pChartHeight);c.vChartContainer.css("height",this.vChartHeight);if(this.pFlot!=null){this.pFlot.changeOutSize(this.chartWidth,this.pChartHeight)}c.vChartContainer.hide();b.volLegendElm.hide()}if(this._elements.zoomMask!=null){this._elements.zoomMask.css({height:this.pChartHeight+"px"})}if(typeof(this.volumeChartChanged)=="function"){this.volumeChartChanged({showVolumeChart:this.showVolume})}}},addValuations:function(a){if(this.valuations[a]&&a!="FairValue"){if(this.UIConfig.autoHeight&&!this.valuations[a].show){this.outHeight+=this.iChartHeight}this.valuations[a].show=true;this.setSize(this.chartWidth,this.outHeight);if(this.pFlot!=null){this.pFlot.resizeCanvas(this.chartWidth,this.pChartHeight)}if(this.vFlot!=null&&this.showVolume){this.vFlot.resizeCanvas(this.chartWidth,this.vChartHeight)}this.drawPChart();this.drawVChart();this.getIChartData(a);if(typeof(this.afterAddValuationCallback)=="function"){this.afterAddValuationCallback({name:a})}}else{this.valuations[a].show=true;this.getIChartData(a)}},removeValuations:function(a){if(this.valuations[a]){this.valuations[a].show=false;if(a=="FairValue"){this._removeDataRowFromDataList(a);this.drawPChart()}else{this.removeIChart(a);if(typeof(this.afterRemoveValuationCallback)=="function"){this.afterRemoveValuationCallback({name:a})}}}},refreshIntradayChart:function(a){if(this.zoomRange<3||(this.frequency=="d"&&RTQ_ChartUtil.compareDateByday(this.endDate,this.latestTradeDate))){if(a=="p"){this.getPChartData();for(var b in this.indicatorsData){if(this.indicatorsData[b].type==1&&this.indicatorsData[b].show){this.getIChartData(b)}}}else{if(a=="v"){this.getVChartData()}}}},refreshLastTradeDate:function(a,c){if(RTQ_ChartUtil.compareDateByday(this.latestTradeDate,c)){return}this.slider_EndDate=this.latestTradeDate=c;if(a!=null){this.sDates.iMin=a}if(this.zoomRange!=11){if(this.zoomRange==1){this.startDate=this.latestTradeDate}this.endDate=this.latestTradeDate;if(this.uiComponents.customDateB!=null){this.uiComponents.customDateB.setDate(this.startDate,this.endDate)}var b=this.UIConfig.chartCtrl=="default"?true:false;this.buildLegend(null,null,true,b)}},getPChartData:function(e){var h=this;this.pChartReady=false;var f=[],m=this.compairTickers.length>0?"return":"price";if(this.chartStyle=="growth"||this.chartStyle=="dEffect"||this.chartStyle=="growth10"){m="return"}var l=m=="return"?"return4":m;if(this.chartStyle=="growth10"){m+="_k",l+="_k"}var p={symbol:this.mainTicker,datapoints:{p:l,v:this.showVolume,indicators:[]}};if(this.chartStyle=="postTax"){p={symbol:this.mainTicker,datapoints:{postTax:"return",v:this.showVolume,indicators:[]}}}if(this._frequencyIndexMap[this.frequency]>0){if(this.events.dividend||this.events.splits){p.datapoints.ds={isD:this.events.dividend,isS:this.events.splits}}if(this.events.earnings){p.datapoints.e=true}}if(this.chartStyle=="dEffect"||this.chartStyle=="growth10"){if(this.indicatorsData.SMAV.num!=null){p.datapoints.indicators.push({name:"SMAV",p:[this.indicatorsData.SMAV.num],vtype:"price"})}f.push(p);if(this.chartStyle=="growth10"){if(this.compairTickers.length){for(var b=0;b<this.compairTickers.length;b++){f.push({symbol:this.compairTickers[b],datapoints:{p:m}})}}}}else{for(var g in this.indicatorsData){if(this.indicatorsData[g].type==0){if(g=="EMA"||g=="SMA"){for(var d=0;d<this.indicatorsData[g].num.length;d++){if(this.indicatorsData[g].num[d]!=null){p.datapoints.indicators.push({name:g,p:[this.indicatorsData[g].num[d]],vtype:m})}}}else{if(g=="SMAV"&&this.indicatorsData[g].num!=null){p.datapoints.indicators.push({name:g,p:[this.indicatorsData[g].num],vtype:"price"})}else{if(this.indicatorsData[g].show&&g!="Volume"){if(g=="PrevClose"&&(this.zoomRange!=1||this.compairTickers.length>0||this.chartStyle=="growth"||this.chartStyle=="growth10"||this.chartStyle=="dEffect")){continue}p.datapoints.indicators.push({name:g,p:this.indicatorsData[g].parameter,vtype:m})}}}}}f.push(p);if(this.sType=="FE"&&this.showIIVTicker&&this.iivTicker!=""){f.push({symbol:this.iivTicker,datapoints:{p:m}})}if(this.compairTickers.length){for(var b=0;b<this.compairTickers.length;b++){f.push({symbol:this.compairTickers[b],datapoints:{p:m}})}}}var a=RTQ_ChartUtil.toDateIndex(this.startDate);var n=RTQ_ChartUtil.toDateIndex(this.endDate);if((typeof(this.showLoading)=="function")){this.showLoading()}if(this._frequencyIndexMap[this.frequency]>0){GB_ChartDataManager.getHistoricalData(f,this._frequencyMap[this.frequency],a,n,function(i){h.pChartDataReady(i,e)})}else{if(this.zoomRange<3){for(var c=0;c<f.length;c++){f[c].days=this.zoomRange==1?1:(this.zoomRange==0?3:5)}}GB_ChartDataManager.getIntradayData(f,this._frequencyMap[this.frequency],a,n,function(i){h.pChartDataReady(i,e)})}},getVChartData:function(){var d={symbol:this.mainTicker,datapoints:{v:this.showVolume}},c=this;if(this.indicatorsData.SMAV&&this.indicatorsData.SMAV["num"]!=null){d.datapoints.indicators=[{name:"SMAV",p:[this.indicatorsData.SMAV["num"]],vtype:"price"}]}var b=[d];var a=RTQ_ChartUtil.toDateIndex(this.startDate);var e=RTQ_ChartUtil.toDateIndex(this.endDate);if(this._frequencyIndexMap[this.frequency]>0){GB_ChartDataManager.getHistoricalData(b,this._frequencyMap[this.frequency],a,e,function(f){c.vChartDataReady(f)})}else{if(this.zoomRange<3){b[0].days=this.zoomRange==1?1:5}GB_ChartDataManager.getIntradayData(b,this._frequencyMap[this.frequency],a,e,function(f){c.vChartDataReady(f)})}},getSilderChartData:function(){var c=5,d=this.miniChartFrequency,e=null,f=null,b=this;if(this.miniChartFrequency=="minute"){c=1,d="d"}var a=[{symbol:this.mainTicker,dx:c,datapoints:{p:"price"}}];if(this.miniChartFrequency=="minute"){GB_ChartDataManager.getIntradayData(a,1440,e,f,function(g){b.sliderChartDataReady(g)})}else{GB_ChartDataManager.getHistoricalData(a,d,e,f,function(g){b.sliderChartDataReady(g)})}},vChartDataReady:function(b){this.chartData.VolList=[];if(b&&b.length&&b[0].volume){this.chartData.VolList.push({data:b[0].volume.data,name:"volume",startPos:null,legend:QSLGIN.volume_lg});if(b[0].indicators&&b[0].indicators&&b[0].indicators.SMAV){var a=QSLGIN.smav_lg+"("+this.indicatorsData.SMAV.num+")";this.chartData.VolList.push({data:b[0].indicators.SMAV.data,startPos:null,name:"SMAV",legend:a})}if(this.zoomInMode==1&&this.zoomIndexRange){this._zoomInData(this.zoomIndexRange.s,this.zoomIndexRange.e,this.chartData.VolList)}this.drawVChart();this.mouseOutChart()}},getIChartData:function(d){var e=this.chartData,c=this;if(this.iChartData[d]||d=="FairValue"||d=="MReturnIndex"){var b;var a=RTQ_ChartUtil.toDateIndex(this.startDate);var g=RTQ_ChartUtil.toDateIndex(this.endDate);if(this.indicatorsData[d]||d=="RDividend"||d=="DYield"){var f=d=="RDividend"||d=="DYield"?[]:this.indicatorsData[d].parameter;b=[{symbol:this.mainTicker,datapoints:{indicators:[{name:d,p:f,vtype:"price"}]}}];if(this._frequencyIndexMap[this.frequency]>0){GB_ChartDataManager.getHistoricalData(b,this._frequencyMap[this.frequency],a,g,function(h){c.iChartDataReady(h)})}else{if(d=="RDividend"){this.iChartData[d]=[{data:[],spos:null}];this.drawIChart(d)}else{if(this.zoomRange<3){b[0].days=this.zoomRange==1?1:5}GB_ChartDataManager.getIntradayData(b,this._frequencyMap[this.frequency],a,g,function(h){c.iChartDataReady(h)})}}}else{if(this.valuations[d]||d=="MReturnIndex"){if(this.zoomRange>2){b={symbol:this.mainTicker,fields:[d]};var a=RTQ_ChartUtil.toDateIndex(this.startDate);var g=RTQ_ChartUtil.toDateIndex(this.endDate);GB_ChartDataManager.getFundamentalData(b,this._frequencyMap[this.frequency],a,g,function(h){c.iChartDataReady(h)})}else{if(d!="FairValue"){this.iChartData[d]=[{data:[],spos:null}];this.drawIChart(d)}}}}}},drawChartSegment:function(){this.chartData.fairValueData=null;var a=this;this.getPChartData(function(){for(var b in a.indicatorsData){if(a.indicatorsData[b].type==1&&a.indicatorsData[b].show){a.getIChartData(b)}}for(var b in a.valuations){if((a.valuations[b]&&a.valuations[b].show)){a.getIChartData(b)}}})},getSimpleTicks:function(g){var b,f,a=[];for(var c=0;c<g.length;c++){b=new Date(g[c][g[c].length-1]);var d=b.getHours();if(c==0){f=d}if(d!=f){f=d;var e=d>12?(d-12)+"PM":d+"AM";a.push([c,e])}}return a},drawPChart:function(){var q=this.chartData,t=this,r=this._contains,e=this._elements;if(q.DataList==null||q.DataList.length<1){return}this.mouseOutChart();var n=q.DataList[0].data,k=n?n.length:0;var u=false,j=null;if(this._frequencyIndexMap[this.frequency]<=0&&k>0){u=RTQ_ChartUtil.compareDateByday(new Date(n[k-1][n[k-1].length-1]),new Date(n[0][n[0].length-1]))}if(this.zoomRange>2&&!u){this.ticksize=null,this.Ticks=this.getTicks(q.DataList[0].data,this.frequency);this._isIntradayTimSyle=false}else{this.Ticks=null;if(this.zoomRange==1||u){this._isIntradayTimSyle=true}else{this._isIntradayTimSyle=false}if(this.zoomInMode==1){this.ticksize=Math.round(k/4)}else{this.ticksize=(this.zoomRange==1||(u&&this.zoomRange==11))?60/this._frequencyMap[this.frequency]:q.DataList[0].data.length/(this.zoomRange==0?3:5)}if(this.simpleTick&&this.zoomRange==1){this.ticksize=null;this.Ticks=this.getSimpleTicks(q.DataList[0].data)}this.xLabelAlign=(this.zoomRange==1||(u&&this.zoomRange==11)?"left":"center")}if(this.pFlot==null){this.pFlot=new mstar.flot(r.pChartContainer,this.getChartOption("priceLine"));this.pFlot.setOption({imageHighlight:this.chartCursor==0});r.pChartContainer.unbind("plothover").bind("plothover",function(w,i,v){t.buildLegend(v,i,false,false)});r.pChartContainer.unbind("mouseout").bind("mouseout",function(i){if(Util.contains(r.pChartContainer[0],i.relatedTarget)){return false}else{if(t.timeout){clearTimeout(t.timeout)}t.chartMouseOut()}});r.pChartContainer.unbind("mouseover").bind("mouseover",function(){if(t.timeout){clearTimeout(t.timeout)}var i=$(document);var v=i.scrollLeft(),w=i.scrollTop();var x=r.pChartContainer.offset();t.chartOffset={left:x.left+v,top:x.top+w};e.lineXElm.css({width:t.chartWidth});e.lineYElm.css({height:r.pChartContainer.height()})});this.pFlot.drawObj.beforeRemoveDrawing=function(v,i){GB_ChartDataManager.quoteDataMap[t.mainTicker].removeDrawing(v,i)};this.pFlot.drawObj.onDrawingUpdated=function(v,i){GB_ChartDataManager.quoteDataMap[t.mainTicker].updateDrawing(v,i)};r.pChartContainer.unbind("drawEnd").bind("drawEnd",function(v,w){if(e.$drawBlock!=null&&e.$drawBlock.length){e.$drawBlock.find("[value='"+w+"']").removeClass("draw-row-select")}t.isDrawing=false;var i=t.pFlot.drawObj.getLastDrawing(w);if(i!=null){GB_ChartDataManager.quoteDataMap[t.mainTicker].saveLastDrawing(w,i)}if(t.chartCursor==1){e.crosshairLegendWin.show()}if(typeof(t.afterDrawEnd)=="function"){t.afterDrawEnd(w)}})}var p=[];var b=1,l;for(var d=0;d<q.DataList.length;d++){b=d==0?2:1;l=q.DataList[d].colorIndex==null?d:q.DataList[d].colorIndex;if(q.DataList[d].name=="FairValue"&&this.compairTickers.length){continue}if(q.DataList[d].name=="PSAR"){p.push(this.getChartData(q.DataList[d].data,"points",1,q.DataList[d].colorIndex,1));continue}if(q.DataList[d].name=="VBP"){p.push(this.getChartData(q.DataList[d].data,"VBPBar",1,q.DataList[d].colorIndex,1));continue}var o="line";if(d==0){var f=this.chartStyle;j=q.DataList[d].startPos;o=f=="mountain"||f=="growth"||f=="growth10"||f=="dEffect"||f=="postTax"?"mountain":this.chartStyle}p.push(this.getChartData(q.DataList[d].data,o,1,l,b));if(q.DataList[d].name=="PrevClose"){p[p.length-1].showLegend=this.showLegend?true:false;p[p.length-1].legendLabel=QSLGIN.prevclose_lg}}if(this.zoomRange>2&&this._frequencyIndexMap[this.frequency]>0&&(this.events.dividend||this.events.splits||this.events.earnings)&&q.eventDataList!=null&&q.eventDataList.length>0){p.push(this.getChartData(q.eventDataList,"img",1,null))}var g=this.chartStyle;var a=(this.scaleType=="1"&&(this.compairTickers.length>0||g=="growth"||g=="dEffect"))?0:parseInt(this.scaleType,10);var h=true,m=g=="growth10"?"k":"";if(g=="mountain"||g=="line"||g=="dot"||g=="ab"||g=="growth"||g=="growth10"||g=="dEffect"){var c=(g=="growth"||g=="growth10"||g=="dEffect")?"mountain":g;this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},lines:{lineType:c},yaxis:{scaleType:a},drawingAble:h})}else{if(this.chartStyle=="ohlc"||this.chartStyle=="hlc"){this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},OLHC:{olhcType:this.chartStyle},yaxis:{scaleType:a},drawingAble:h})}else{this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},yaxis:{scaleType:a},drawingAble:h})}}this.pFlot.setOption({yaxis:{align:this.yaxisAlign,unit:m},otherInfo:{ticker:this.mainTicker}});this.pFlot.init(p);if(p&&p.length&&p[0].data.length){var s="price";if(this.compairTickers.length){s="return"}else{if(g=="growth"||g=="dEffect"){s="return"}}if(g=="growth10"){s="return10"}this.pFlot.setChartTypeForDrawings(s,j);this._loadDrawings(p[0].data,function(i){if(t.pFlot.drawObj){t.pFlot.drawObj.setDrawings(i);t.pFlot._triggerRedrawOverlay()}})}this.pChartReady=true},_checkVolume:function(c){if(c==null||!c.length){return false}var b=false;for(var a=0;a<c.length;a++){if(!isNaN(c[a][1])){b=true;break}}return b},drawVChart:function(){var e=this.chartData,c=this,d=this._contains,a=this._elements;if(e.VolList==null||!e.VolList.length||!this.showVolume){return}if(this.UIConfig.autoHideVolume&&!this._checkVolume(e.VolList[0].data)){this._contains.vChartContainer.parent().hide()}else{this._contains.vChartContainer.parent().show()}var g=[];for(var b=0;b<e.VolList.length;b++){if(e.VolList[b].name=="volume"){g.push(this.getChartData(e.VolList[b].data,"bars",1,this.fillColors.vChart))}else{if(e.VolList[b].name=="SMAV"){g.push(this.getChartData(e.VolList[b].data,"line",1,1,1))}}}var f=(this.indicatorsData.VPlus.show)?true:false;if(this.vFlot==null){this.vFlot=new mstar.flot(d.vChartContainer,this.getChartOption("volumeBar"));if(this.UIConfig.RightMenu){d.vChartContainer.bind("contextmenu",function(h){})}}this.vFlot.setOption({yaxis:{align:this.yaxisAlign},xaxis:{tickSize:this.ticksize,ticks:this.Ticks},bars:{isColorBar:f}});this.vFlot.init(g);this.buildVolLegend(-1)},drawSliderChart:function(){var a=this._contains;if(this.UIConfig.Chart==null||(!this.UIConfig.Chart.showTimeSlider&&!this.UIConfig.CustomUI)){return}if(this.mFlot==null){this.mFlot=new mstar.flot(a.mChartContainer,this.getChartOption("miniChart"))}var b=this.chartData.MiniChartData.length?this.getTicks(this.chartData.MiniChartData[0],"d"):[];this.mFlot.setOption({xaxis:{tickSize:null,ticks:b}});this.mFlot.init(this.chartData.MiniChartData)},exportDataToExcel:function(){if(this.mainTicker==""||this.mainTicker==null){return}var e=[this.mainTicker],c=RTQ_ChartUtil.formatDate(this.startDate),a=RTQ_ChartUtil.formatDate(this.endDate);if(this.compairTickers.length){e=e.concat(this.compairTickers)}var d=null,b;if(this.zoomRange==1){d=1,b=0}else{if(this.zoomRange==2){d=5,b=0}else{if(this._frequencyIndexMap[this.frequency]<1){b=2}else{b=1}}}GB_ChartDataManager.exportDataToExcel(e,b,c,a,this._frequencyMap[this.frequency],d)},fileMenuCallback:function(a){if(a=="export"){this.exportDataToExcel()}}});var QS_FundChartComponent=function(c,b,a){this._title="Chart";this.timezone="";this.securityType=[8];this.autoTitle=true;this.defaultFrequencyMenuCfg={intraday:false,history:true,customer:true};this.requencyMenuCfg={intraday:false,history:true,customer:true};this.dataUrl={getTickerInfoURL:(typeof(version)!="undefined"&&version.domain)?(version.domain+"getids.jsp?"):"//quotespeed.morningstar.com/getids.jsp?"};this.region=(b==null?"USA":b);this.lan=(a==null?"en_US":a);this.cur="USD";this.fillColors=typeof(QS_Style)!="undefined"?QS_Style.chart.fillColors:{pChart:"#c9d2dd",vChart:"#2f4880",sChart:"#d9dfeb"};this.colors={borderColor:null,gridColor:typeof(QS_Style)=="undefined"?"#dddddd":QS_Style.flot.grid.tickColor,lableFontColor:typeof(QS_Style)=="undefined"?"#545454":QS_Style.flot.grid.color};this.mainTicker=c;this.tickerMaxNum=7;this.compairTickers=[];this.tickerInfos={};this.mainTickerInfo={type:"1",tenforeTicker:""};this.compairTickerInfo=[];this.events={dividend:false};this.latestTradeDate=new Date();this.endDate=new Date();this.startDate=this.endDate;this.zoomRange=3;this.chartStyle="mountain";this.frequency="d";this.chartCursor=1;this.scaleType=0;this.yaxisAlign="right";this.showGridLines=true;this.isShowTimeSlider=true;this.showLegend=true;this.pChartReady=false;this.sliderObj=null;this.slider_EndDate=this.latestTradeDate;this.slider_StartDate=new Date(this.slider_EndDate.getFullYear()-2,this.slider_EndDate.getMonth(),this.slider_EndDate.getDate());this.sDates={d:null,m:null};this.rangSize=512;this.miniChartFrequency="d";this.ichartSiwtchIndicatorWin={flag:false,oldName:"",newName:"",data:null,ulelm:null};this.scrollAble=false;this._selectedIndicatorName="";this.isDrawing=false;this.lock=false;this.showNotes=false;this.timeout=null;this.mouseWheeTimeout=null;this.wheelNum=0;this.simpleMenu=false;this.chartOffset={left:0,top:0};this.hasConfirmBox=(typeof(Util)!="undefined"&&typeof(Util.confirm)!="undefined")?true:false;this.isShowLastLabel=true;this.selectionMode={pan:true,zoomIn:false,zoomOut:false};this.zoomStack=[];this.legendInfo={OHLC:false,Volume:false,showDateRangeString:true};this.chartWidth=760;this.outHeight=0;this.pChartHeight=300;this.vChartHeight=60;this.miniChartHeight=26;this.yLabelWidth=50;this.minW=300;this.minH=100;this.iChartHeight=80;this.UIConfig={chartCtrl:"default",Chart:{showTimeSlider:true},settingPanel:null,autoHeight:false,RightMenu:true,indicator:{},events:{},drawing:{},MouseWheel:true,ZoomIn:true,showDateRangeInLengend:1,customFrequency:0};this.defaultFrequencyMap={};this.uiComponents={settingGroup:null,ddlFrequency:null,ddlZoom:null,ddlChartType:null,ddlCursorType:null,customDateB:null,tabMenu:null,chartTypeMenu:[],tabZoomMenu:null,rightMenu:null,indexScrollPN:null,miniChartRightMenu:{}};this._contains={pChartContainer:null,mChartContainer:null,toolContainer:null,$settingPanel:null};this._elements={legendElm:null,crosshairLegendElm:null,crosshairLegendWin:null,lineXElm:null,lineYElm:null,xLabelElm:null,addCompairBtElm:null,indicatorWinElm:null,eventULElm:null,valuationULElm:null,indicatorULElm:null,chkLock:null,growthMenu:null,oscIndicatorMenu:null,tabmenuZoomEl:null,$ddlZoom:null,$ddlFrequency:null,$ddlChartType:null,$ddlCursorType:null,$customDate:null,$ratioScale:null,$drawBlock:null,$yaxisAlign:null,zoomMask:null};this.iChartContainers={};this.pFlot=null;this.mFlot=null;this.iFlots={MACD:null,RSI:null,ROC:null,Momentum:null,Mass:null,ForceIndex:null};this.chartData={DataList:[],eventDataList:null,eventInfoList:null,MiniChartData:[]};this.iChartData={MACD:[],RSI:[],ROC:[],Momentum:[],WMA:[],Mass:[],ForceIndex:[]};this._securityTypeMap={ST:1,FE:1,XI:10,FO:8,FC:1};this._zoomIndexMap={3:0,14:1,4:2,5:3,6:4,7:5,8:6,9:7,10:8,11:9};this._frequencyIndexMap={minute:-4,minute5:-3,minute10:-2,minute15:-1,minute30:0,d:1,w:2,m:3};this._frequencyTxtMap={minute:"1 "+QSLGTXT.shortminute,minute5:"5 "+QSLGTXT.shortminute,minute10:"10 "+QSLGTXT.shortminute,minute15:"15 "+QSLGTXT.shortminute,minute30:"30 "+QSLGTXT.shortminute,d:QSLGTXT.daily,w:QSLGTXT.weekly,m:QSLGTXT.monthly};this._frequencyMap={minute:1,minute5:5,minute10:10,minute15:15,minute30:30,d:"d",w:"w",m:"m"};this.tabMap=["mountain","growth"];this.tabIndexMap={mountain:0,dot:0,ab:0,line:0,growth:1,growth10:1,postTax:1};this.indicatorUI={SMA:{title:QSLGIN.sma_t,parameter:[QSLGIN.sma_p1,QSLGIN.sma_p2,QSLGIN.sma_p3],defaultValue:[10,50,]},EMA:{title:QSLGIN.ema_t,parameter:[QSLGIN.ema_p1,QSLGIN.ema_p2,QSLGIN.ema_p3],defaultValue:[10,,]},BBands:{title:QSLGIN.bbands_t,parameter:[QSLGIN.bbands_p1,QSLGIN.bbands_p2],defaultValue:[20,2]},MACD:{title:QSLGIN.macd_t,parameter:[QSLGIN.macd_p1,QSLGIN.macd_p2,QSLGIN.macd_p3],defaultValue:[26,12,9]},RSI:{title:QSLGIN.rsi_t,parameter:[QSLGIN.rsi_p1],defaultValue:[14]},ROC:{title:QSLGIN.roc_t,parameter:[QSLGIN.roc_p1],defaultValue:[12]},MAE:{title:QSLGIN.mae_t,parameter:[QSLGIN.mae_p1,QSLGIN.mae_p2],defaultValue:[14,2]},Momentum:{title:QSLGIN.momentum_t,parameter:[QSLGIN.momentum_p1],defaultValue:[2]},WMA:{title:QSLGIN.wma_t,parameter:[QSLGIN.wma_p1],defaultValue:[15]}};this.indicatorsData={SMA:{show:false,num:[null,null,null],colorIndex:[0,0,0],type:0},SMAV:{show:false,num:null,colorIndex:0,type:0},EMA:{show:false,num:[null,null,null],colorIndex:[0,0,0],type:0},BBands:{show:false,parameter:[10,2],colorIndex:0,type:0},MACD:{show:false,parameter:[26,12,9],type:1,mty:1},RSI:{show:false,parameter:[14],type:1,mty:2},ROC:{show:false,parameter:[12],type:1,mty:1},MAE:{show:false,parameter:[14,2],type:0},Momentum:{show:false,parameter:[2],type:1,mty:1},WMA:{show:false,parameter:[15],type:0,mty:0}};this.eventsData=[{txt:QSLGTXT.dividend,val:"dividend",name:"dividends",type:"checkbox",checked:false}];this.dailyFreMenuData=[{txt:QSLGTXT.daily,val:"d",type:"ratio"},{txt:QSLGTXT.weekly,val:"w",type:"ratio"},{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.weeklyFreMenuData=[{txt:QSLGTXT.weekly,val:"w",type:"ratio"},{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.monthlyFreMenuData=[{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.zoomListData=[{txt:"1 "+QSLGTXT.shortmonth,val:"3",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"2 "+QSLGTXT.shortmonth,val:"14",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"3 "+QSLGTXT.shortmonth,val:"4",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:QSLGTXT.ytd,val:"5",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"1 "+QSLGTXT.shortyear,val:"6",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"3 "+QSLGTXT.shortyear,val:"7",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"5 "+QSLGTXT.shortyear,val:"8",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"10 "+QSLGTXT.shortyear,val:"9",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:QSLGTXT.max,val:"10",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.monthlyFreMenuData},{txt:QSLGTXT.custom,val:"11",type:"ratio"}];this.frequencyListData=[{txt:QSLGTXT.daily,val:"d"},{txt:QSLGTXT.weekly,val:"w"},{txt:QSLGTXT.monthly,val:"m"}];this.cursorTypeListData=[{txt:QSLGTXT.trackball,val:"0",type:"ratio"},{txt:QSLGTXT.crosshair,val:"1",type:"ratio"},{txt:QSLGTXT.off,val:"3",type:"ratio"}];this.chartTypeListData=[{txt:QSLGTXT.mountain,val:"mountain",type:"ratio"},{txt:QSLGTXT.line,val:"line",type:"ratio"},{txt:QSLGTXT.dot,val:"dot",type:"ratio"},{txt:QSLGTXT.abovebelow,val:"ab",type:"ratio"},{txt:QSLGTXT.pergrowth,val:"growth",type:"ratio"},{txt:QSLGTXT.tenkgrowth,val:"growth10",type:"ratio"},{txt:QSLGTXT.posttaxreturn,type:"ratio",val:"postTax"}];this.scaleTypeListData=[{txt:QSLGTXT.linear,val:"0"},{txt:QSLGTXT.logarithmic,val:"1"}];this.yaxisAlignListData=[{txt:QSLGTXT.left,val:"left"},{txt:QSLGTXT.right,val:"right"}];this.selectionModeListData=[{txt:QSLGTXT.pan,val:"pan"},{txt:QSLGTXT.zoomin,val:"zoomin"},{txt:QSLGTXT.reset,val:"reset"}];this.tabList=[{txt:QSLGTXT.line,id:0,closable:false},{txt:QSLGTXT.growth,id:1,closable:false}];this.chartTypeMenuData=[[{txt:QSLGTXT.mountain,type:"ratio",val:"mountain"},{txt:QSLGTXT.line,type:"ratio",val:"line"},{txt:QSLGTXT.dot,type:"ratio",val:"dot"},{txt:QSLGTXT.abovebelow,type:"ratio",val:"ab"}],[{txt:QSLGTXT.pergrowth,type:"ratio",val:"growth"},{txt:QSLGTXT.tenkgrowth,type:"ratio",val:"growth10"},{txt:QSLGTXT.posttaxreturn,type:"ratio",val:"postTax"}]];this.settingGroupList=[{name:QSLGTXT.display,id:1},{name:QSLGTXT.window,id:6},{name:QSLGTXT.compare,id:2,closable:false},{name:QSLGTXT.drawingandnotes,id:3},{name:QSLGTXT.indicators,id:4},{name:QSLGTXT.events,id:5}];this.indicatorTabList=[{txt:QSLGTXT.popular,id:0,closable:false},{txt:QSLGTXT.pricetrends,id:2,closable:false},{txt:QSLGTXT.oscillator,id:3,closable:false}];this.indicatorPanelData=[[{txt:QSLGIN.bbands_name,val:"BBands",type:""},{txt:QSLGIN.macd_name,val:"MACD",type:""},{txt:QSLGIN.roc_name,val:"ROC",type:""},{txt:QSLGIN.rsi_name,val:"RSI",type:""},{txt:QSLGIN.sma_name,val:"SMA",type:""}],[{txt:QSLGIN.bbands_name,val:"BBands",type:""},{txt:QSLGIN.ema_name,val:"EMA",type:""},{txt:QSLGIN.mae_name,val:"MAE",type:""},{txt:QSLGIN.macd_name,val:"MACD",type:""},{txt:QSLGIN.momentum_name,val:"Momentum",type:""},{txt:QSLGIN.roc_name,val:"ROC",type:""},{txt:QSLGIN.sma_name,val:"SMA",type:""},{txt:QSLGIN.wma_name,val:"WMA",type:""}],[{txt:QSLGIN.rsi_name,val:"RSI",type:""}]];this.indicatorL2Data=[{txt:QSLGTXT.pricetrends,selectable:false,val:"mainl2-pricetrend",subMenu:this.indicatorPanelData[1]},{txt:QSLGTXT.oscillator,val:"mainl2-oscillator",selectable:false,subMenu:this.indicatorPanelData[2]}];this.ichartMenuL1Data=[[],[]];this.miniChartRightMenuData=[{txt:"<b>"+QSLGTXT.indicators+"</b>",val:"mini-indicator",selectable:false},{txt:"&nbsp;&nbsp;"+QSLGTXT.pricetrends,val:"minil1-pricetrend",selectable:false,hasSubMenu:true},{txt:"&nbsp;&nbsp;"+QSLGTXT.oscillator,val:"minil1-oscillator",selectable:false,hasSubMenu:true},{type:"separator",val:"s2"},{txt:QSLGTXT.edit,val:"edit"}];this.rightMenuData=[{txt:QSLGTXT.charttype,val:"chartType",type:"",selectable:false,subMenu:this.chartTypeListData},{txt:QSLGTXT.chartcursor,val:"cursorType",type:"",selectable:false,subMenu:this.cursorTypeListData},{txt:QSLGTXT.zoom,val:"zoom",type:"",selectable:false,subMenu:this.zoomListData},{txt:QSLGTXT.events,type:"",val:"event",selectable:false,subMenu:this.eventsData},{txt:QSLGTXT.indicators,val:"indicator",selectable:false,subMenu:this.indicatorL2Data}]};QS_FundChartComponent.prototype=$.extend({},QS_baseChart,{initUIConfig:function(a){$.extend(this.UIConfig,a);if(this.UIConfig.settingPanel!=null){this._contains.$settingPanel=$(this.UIConfig.settingPanel)}},Init:function(c,a,b){if(typeof(this.id)=="undefined"){this.id=c;if(typeof(GB_ChartDataManager)=="object"){GB_ChartDataManager.subscribeChart(this)}}this.objName=a;this.outObj=$("#"+c).addClass("rtc-chart-out");this.autoBoxID=c+"_autoBox";this.createChartUI();this._initConfig(b);this._createUiComponents();var d=[];if(typeof(this.mainTicker)!="undefined"&&this.mainTicker!=null&&this.mainTicker!=""){d.push(this.mainTicker)}if(this.compairTickers&&this.compairTickers.length>0){d=d.concat(this.compairTickers)}if(d.length>0){this.validateSavedTickers(d)}},initStartDate:function(){var c=this.latestTradeDate.getFullYear(),b=this.latestTradeDate.getMonth(),a=this.latestTradeDate.getDate();var a=GB_ChartDataManager.dates;this.sDates.d=a.d;this.sDates.w=a.w;this.sDates.m=new Date(1900,0,1);this.slider_StartDate=this.getSliderStartDate()},_initConfig:function(c){if(c==null||c==""){return}if(c.simpleMenu){this.simpleMenu=true;this.rightMenuData.splice(4,1)}if(c.chartStyle!=null){this.chartStyle=c.chartStyle=="lines"?"mountain":c.chartStyle;var b=false;for(var a=0;a<this.chartTypeListData.length;a++){if(this.chartTypeListData[a].val==this.chartStyle){b=true;break}}if(!b){this.chartStyle="mountain"}}if(c.title){this._title=c.title}if(c.requencyMenuCfg){this.requencyMenuCfg=c.requencyMenuCfg}if(c.autoTitle!=null){this.autoTitle=c.autoTitle}if(c.mTicker!=null){this.mainTicker=c.mTicker}if(c.cTickers!=null){this.compairTickers=c.cTickers}if(c.pWidth!=null){this.chartWidth=c.pWidth}if(c.pHeight!=null){this.pChartHeight=c.pHeight}if(c.zRange!=null){this.zoomRange=c.zRange}if(c.startDate!=null){this.startDate=RTQ_ChartUtil.convertToDate(c.startDate)}if(c.endDate!=null){this.endDate=RTQ_ChartUtil.convertToDate(c.endDate)}if(c.region!=null){this.region=c.region}if(c.lan!=null){this.lan=c.lan}if(c.cur!=null){this.cur=c.cur}if(c.frequency!=null){this.frequency=c.frequency}if(c.slider_StartDate!=null){this.slider_StartDate=RTQ_ChartUtil.convertToDate(c.slider_StartDate)}if(c.miniChartFrequency!=null){this.miniChartFrequency=c.miniChartFrequency}if(c.events!=null){$.extend(true,this.events,c.events)}if(c.tickerInfos){this.tickerInfos=c.tickerInfos}if(c.chartCursor!=null){this.chartCursor=c.chartCursor}if(c.lock!=null){this.lock=c.lock}if(c.showNotes!=null){this.showNotes=c.showNotes}if(c.yaxisAlign!=null){this.yaxisAlign=c.yaxisAlign}if(c.isShowTimeSlider!=null){this.isShowTimeSlider=c.isShowTimeSlider}if(c.showLegend!=null){this.showLegend=c.showLegend}if(c.scaleType){this.scaleType=c.scaleType}if(c.ticksize){this.ticksize=c.ticksize}if(c.Ticks){this.Ticks=c.Ticks}if(c.indicatorsData){for(var a in c.indicatorsData){if(!this.indicatorsData[a]){c.indicatorsData[a]=null;delete c.indicatorsData[a]}}$.extend(true,this.indicatorsData,c.indicatorsData)}if(c.width!=null){this.chartWidth=(c.width>this.minW)?c.width:this.minW}if(c.height!=null){if(this.UIConfig.chartCtrl=="rtqPanel"){this.outHeight=c.height-26}else{this.outHeight=c.height}this._setSizeParas(this.chartWidth,this.outHeight)}this.outObj.css({width:this.chartWidth+"px",height:this.outHeight+"px"});this._contains.pChartContainer.css({width:this.chartWidth+"px",height:this.pChartHeight+"px"});if(this._elements.zoomMask!=null){this._elements.zoomMask.css({height:this.pChartHeight+"px"})}if(this._contains.mChartContainer!=null){this._contains.mChartContainer.css({width:this.chartWidth+"px",height:this.miniChartHeight+"px"})}},saveConfig:function(){var e={title:this._title,autoTitle:this.autoTitle,mTicker:this.mainTicker,cTickers:this.compairTickers,pWidth:this.chartWidth,pHeight:this.pChartHeight,mHeight:this.miniChartHeight,events:this.events,zRange:this.zoomRange,startDate:RTQ_ChartUtil.formatDate(this.startDate),endDate:RTQ_ChartUtil.formatDate(this.endDate),region:this.region,lan:this.lan,cur:this.cur,frequency:this.frequency,slider_StartDate:RTQ_ChartUtil.formatDate(this.slider_StartDate),miniChartFrequency:this.miniChartFrequency,chartStyle:this.chartStyle,tickerInfos:this.tickerInfos,chartCursor:this.chartCursor,scaleType:this.scaleType,yaxisAlign:this.yaxisAlign,ticksize:this.ticksize,Ticks:this.Ticks,lock:this.lock,showNotes:this.showNotes,isShowTimeSlider:this.isShowTimeSlider,requencyMenuCfg:this.requencyMenuCfg};var a={},d={},c=this.indicatorsData;for(var b in c){if(c[b].show){if(b=="SMA"||b=="SMAV"||b=="EMA"){a[b]={show:true,num:typeof(c[b].num)=="object"?$.extend(true,[],c[b].num):c[b].num}}else{a[b]={show:c[b].show,parameter:$.extend(true,[],c[b].parameter)}}}}for(var b in this.valuations){if(this.valuations[b].show){d[b]={show:true}}}e.indicatorsData=a;e.valuations=d;return e},createChartUI:function(){var b=this,c=this.UIConfig,a=this._elements,d=this._contains,e=this.uiComponents;e.ddlChartType=e.ddlFrequency=e.ddlZoom=e.ddlCursorType=null;this.outObj.html("");if(c.chartCtrl=="rtqPanel"){this.outObj.append('<div class="rtc-ul-tab clearfix"><div class="rtc-tab-zoom"><div class="rtq-ddl" style="z-index: 2000; width: 115px;"><div val="1" style="width: 111px;" class="rtq-ddl-ipt"></div></div></div><div class="rtc-tab"></div></div>');a.tabmenuZoomEl=this.outObj.find(".rtc-tab-zoom .rtq-ddl")}var f=$('<div class="rtc-chart-container rtc-price-chart"></div>').appendTo(this.outObj);a.legendElm=$('<div class="rtc-legend-txt"></div>').appendTo(f);d.pChartContainer=$('<div class="rtc-chart rtc-chart-main"></div>').appendTo(f);if(c.ZoomIn){a.zoomMask=$('<div style="display:none" class="chart-zoom-mask"></div>').appendTo(d.pChartContainer)}a.crosshairLegendWin=$('<div class="rtc-legend-win" style="display:none;"><div class="rtc-legend-win-wrap"></div></div>').appendTo(d.pChartContainer);a.crosshairLegendElm=a.crosshairLegendWin.find(".rtc-legend-win-wrap");a.lineXElm=$('<div class="rtc-line-x"><span></span></div>').appendTo(d.pChartContainer);a.lineYElm=$('<div class="rtc-line-y"></div>').appendTo(d.pChartContainer);a.xLabelElm=a.lineXElm.find(":first-child");if(this.UIConfig.Chart.showTimeSlider){var g=$('<div class="rtc-chart-container"></div>').appendTo(this.outObj);d.mChartContainer=$('<div class="rtc-chart"></div>').appendTo(g)}else{this.isShowTimeSlider=false}if(c.chartCtrl=="rtqPanel"){this._createSettingPanelUI()}else{a.indicatorULElm=this.outObj.find(".qs-indicator-list");a.$customDate=this.outObj.find(".customRange");a.eventULElm=this.outObj.find(".qs-event-list");a.valuationULElm=this.outObj.find(".qs-valuation-list");a.indexsULElm=this.outObj.find(".qs-index-list");a.relatedSecULElm=this.outObj.find(".qs-relative-list");a.tabmenuZoomEl=this.outObj.find(".rtc-tab-zoom .rtq-ddl")}if(typeof(this.afterCreateUI)=="function"){this.afterCreateUI()}},_createSettingPanelUI:function(){var f=this._elements,r=this._contains,u=this.uiComponents,t=this;r.$settingPanel.html("");var m=new Util.GroupBox(r.$settingPanel,this.settingGroupList,{width:180,groupBoxHeight:310,autoHeight:true});var p=m.getGroup(1).bd,h="";h+='<div class="clearfix block-row-top"><h4>'+QSLGTXT.charttype+'</h4><div class="ddlChartType"></div></div>';h+='<div class="clearfix block-row"><h4>'+QSLGTXT.verticalscale+'</h4><div class="ratioScale"></div></div>';h+='<div class="clearfix block-row"><h4>'+QSLGTXT.yaxis+'</h4><div class="ratioYaxis"></div></div>';h+='<div class="clearfix block-row"><h4>'+QSLGTXT.selectionmode+'</h4><div class="ratioSelectionMode"></div></div>';h+='<div class="clearfix block-row"><h4>'+QSLGTXT.range+'</h4><div class = "customRange clearfix" ></div></div>';h+='<div class="clearfix block-row"><div class="set-block"><h4>'+QSLGTXT.zoom+'</h4><div class="ddlZoom"></div></div>';h+='<div class="set-block set-right"><h4>'+QSLGTXT.frequency+'</h4><div class="ddlFrequency"></div></div></div>';h+='<div class="clearfix block-row"><div class="set-block"><h4>'+QSLGTXT.chartcursor+'</h4><div class="ddlCursorType"></div></div></div>';p.append(h);f.$customDate=p.find(".customRange");f.$ratioScale=p.find(".ratioScale");f.$yaxisAlign=p.find(".ratioYaxis");f.$selectionMode=p.find(".ratioSelectionMode");var j="",d;for(var e=0;e<this.scaleTypeListData.length;e++){d=e==0?"rtq-ratio-left ":"rtq-ratio-off";j+='<a href="javascript:void(0)" catkey="scale" class="rtc-menu-trigger rtq-ratio '+d+' " ';j+='value="'+this.scaleTypeListData[e].val+'">'+this.scaleTypeListData[e].txt+"</a>"}f.$ratioScale.html(j);j="";for(var e=0;e<this.yaxisAlignListData.length;e++){j+='<a href="javascript:void(0)" catkey="yaxis" class="rtc-menu-trigger rtq-ratio '+(e==0?"rtq-ratio-left ":"rtq-ratio-off")+' " ';j+='value="'+this.yaxisAlignListData[e].val+'">'+this.yaxisAlignListData[e].txt+"</a>"}f.$yaxisAlign.html(j);j="";for(var e=0;e<this.selectionModeListData.length;e++){j+='<a href="javascript:void(0)" catkey="selectionmode" class="rtc-menu-trigger rtq-ratio rtq-menu-selectmode '+(e==0?"rtq-ratio-left ":"rtq-ratio-off")+" "+(this.selectionModeListData[e].val!="reset"?" ":"rtq-ratio-chart-reset")+'" ';j+='value="'+this.selectionModeListData[e].val+'">'+this.selectionModeListData[e].txt+"</a>"}f.$selectionMode.html(j);var q=m.getGroup(2).bd;q.append('<div class="clearfix block-row-top"><h4>'+QSLGTXT.compare+'</h4><div class="clearfix" style="position:relative"><input  id ="'+this.autoBoxID+'" class="qs-ui-ipt" type="text" style="width: 132px;" value="" /><a href="javascript:void(0)" class="qs-ui-btn go qs-compare-button">ADD</a><div></div>');f.addCompairBtElm=q.find(".qs-compare-button");var q=m.getGroup(3).bd;var a="<div class='clearfix block-row-top'><h4></h4>";for(var e=0;e<this.drawingData.length;e++){a+="<div  catkey='draw' class='rtc-menu-trigger draw-row' value="+this.drawingData[e].val+">";a+="<a href='javascript:void(0)'>"+this.drawingData[e].txt+"</a></div>"}a+="</div>";q.append(a);f.$drawBlock=q.find(".block-row-top");var l=m.getGroup(4).bd.addClass("rtq-chart-group-indi2");u.indTabMenu=new Util.TabMenu(l[0],this.indicatorTabList,{onActive:function(i){}},{width:80,isExcuteCallbackAtInit:false,autoFixtoText:false,vertical:true});var j="";for(var e=0;e<u.indTabMenu.tabs.length;e++){j="";for(var g in this.indicatorPanelData[e]){var b=this.indicatorPanelData[e][g];j+='<div class="check-row"><a href="javascript:void(0)" class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off" ';j+=' value="'+b.val+'" catkey="indicator" >'+b.txt+"</a></div>"}u.indTabMenu.tabs[e].panel.append(j)}f.indicatorULElm=l.find(".rtq-tab-panels");l.css({position:"relative"});var k=m.getGroup(5).bd;var c="<div clearfix block-row-top><h4></h4><div class='event'>";for(var e=0;e<this.eventsData.length;e++){var s=this.eventsData[e];c+="<div class='check-row'><a class='rtc-menu-trigger rtq-chkbox rtq-chkbox_off' ";c+="value='"+s.val+"' name='"+s.name+"' catkey='event' href='javascript:void(0)'>"+s.txt+"</a></div>"}c+="</div></div>";k.append(c);f.eventULElm=k.find(".event");var n=m.getGroup(6).bd;u.settingPlugin=new SettingPlugin(n,{className:"rtq-setting-plugin-black",width:170,showLockCheckable:false,showHideCheckable:false},{onChangeTitle:function(i,o,v){t.autoTitle=v;t.onChangeTitle(i,o,v)}});n.append('<div class="clearfix block-row"><div class="set-block"><div class="lock"></div></div></div>');u.chkLock=new Util.ButtonGroup(n.find(".lock"),[{txt:QSLGTXT.showtimerangeslider,val:"showTimeSlider"},{txt:QSLGTXT.lockondoubleclick,val:"lock"},{txt:QSLGTXT.shownotes,val:"showNotes"}],{onClick:function(i,o){if(i=="showTimeSlider"){t.isShowTimeSlider=o.isSelected;if(t.isShowTimeSlider){r.mChartContainer.show()}else{r.mChartContainer.hide()}t.changeOutSize(t.chartWidth,t.outHeight)}else{if(i=="lock"){t.lock=o.isSelected}else{if(i=="showNotes"){t.showNotes=o.isSelected;if(t.showNotes){t._loadChartNote(t.mainTicker)}else{t._contains.pChartContainer.find(".qs-note-flot").remove()}}}}}},{type:"checkbox",vertical:true});u.chkLock.btns.lock.el[0].title="This function allows you to prevent the window from updating when you double-click a security in the watchlist."},_createUiComponents:function(){var a=this.uiComponents,h=this.UIConfig,g=this._contains,b=this._elements,i=this;var e,d="",c="#FEFEFE";if(h.chartCtrl=="rtqPanel"){e=g.$settingPanel;d="rtq-ddl-black",c="#727272"}else{e=this.outObj}if(h.chartCtrl=="rtqPanel"){if(a.ddlZoom==null){a.ddlZoom=new Util.DropDownList(e.find(".ddlZoom")[0],function(l,j){i.zoomSelected(l,j)},i.zoomListData,{triggerByClick:false,width:76,disable:true,actionAtInit:false,className:d})}if(a.ddlFrequency==null){a.ddlFrequency=new Util.DropDownList(e.find(".ddlFrequency")[0],function(l,j){i.frequencySelected(l,j)},i.frequencyListData,{triggerByClick:false,width:76,disable:true,actionAtInit:false,className:d})}if(a.ddlCursorType==null){var f=h.chartCtrl=="default"?75:165;a.ddlCursorType=new Util.DropDownList(e.find(".ddlCursorType")[0],function(l,j){i.cursorTypeSelected(l,j)},i.cursorTypeListData,{triggerByClick:false,width:f,disable:true,actionAtInit:false,className:d})}if(a.ddlChartType==null){var f=h.chartCtrl=="default"?105:165;a.ddlChartType=new Util.DropDownList(e.find(".ddlChartType")[0],function(l,j){i.chartTypeSelected(l,j)},i.chartTypeListData,{triggerByClick:false,width:f,disable:true,actionAtInit:false,className:d})}this._createTabMenu();this._createDateInputBoxes()}this._createIndicatorInputWin(this.outObj);if(h.RightMenu){this._createRightMenu(g.pChartContainer);this._createIChartRightMenu()}},_setSizeParas:function(c,d){this.chartWidth=c;this.outHeight=d;var a=this.getIChartsHeight();var b=d-a;if(this.showLegend){b=b-25}if(this.isShowTimeSlider){b=b-30}if(this.UIConfig.chartCtrl=="rtqPanel"){b-=30}var e=b>this.minH?b:this.minH;this.pChartHeight=e},initComponent:function(){var a=this;this._attachUIEvents();this._initUiComponentsStatus();this.chartData.DataList=this.chartData.eventDataList=null;for(var b in this.iChartData){this.iChartData[b]=[]}this.initStartDate();if(typeof(this.setTitle)=="function"){var c=this._getClientTicker(this.mainTicker);this.setTitle(this._title,c)}this.changeRange(this.zoomRange);setTimeout(function(){a.getSilderChartData()},200)},_initUiComponentsStatus:function(){var a=this._elements,e=this.uiComponents;if(e.ddlZoom!=null){e.ddlZoom.setDisable(false)}if(e.ddlChartType!=null){e.ddlChartType.setDisable(false)}if(e.ddlCursorType!=null){e.ddlCursorType.setDisable(false)}if(e.ddlFrequency!=null){e.ddlFrequency.setDisable(false)}if(e.settingPlugin!=null){e.settingPlugin.setName(this.autoTitle,this.autoTitle?"":this._title)}if(e.rightMenu!=null){if(this.events.dividend){e.rightMenu.changeUIState("dividend",null,true)}e.rightMenu.changeUIState(this.chartStyle,null,true);e.rightMenu.changeUIState(this.chartCursor,null,true)}if(this.chartCursor!="1"&&this.chartCursor!=1){a.lineXElm.hide();a.lineYElm.hide()}if(this.isShowTimeSlider&&e.chkLock!=null){e.chkLock.btns.showTimeSlider.select()}if(this.lock==true&&e.chkLock!=null){e.chkLock.btns.lock.select()}if(this.showNotes==true&&e.chkLock!=null){e.chkLock.btns.showNotes.select()}if(this.yaxisAlign=="right"){if(a.$yaxisAlign!=null){a.$yaxisAlign.find("[value='left']").addClass("rtq-ratio-off");a.$yaxisAlign.find("[value='right']").removeClass("rtq-ratio-off")}a.xLabelElm.css({right:0,left:""})}else{if(a.$yaxisAlign!=null){a.$yaxisAlign.find("[value='right']").addClass("rtq-ratio-off");a.$yaxisAlign.find("[value='left']").removeClass("rtq-ratio-off")}a.xLabelElm.css({left:0,right:""})}if(e.ddlZoom!=null){e.ddlZoom.setTextValue(null,this.zoomRange)}if(e.ddlFrequency!=null){e.ddlFrequency.setTextValue(null,this.frequency)}if(e.ddlCursorType!=null){e.ddlCursorType.setTextValue(null,this.chartCursor)}if(e.ddlChartType!=null){e.ddlChartType.setTextValue(null,this.chartStyle)}if(this.scaleType==1&&a.$ratioScale!=null){a.$ratioScale.find("[value='0']").addClass("rtq-ratio-off");a.$ratioScale.find("[value='1']").removeClass("rtq-ratio-off")}if(e.tabMenu!=null){var b=this.tabIndexMap[this.chartStyle];e.tabMenu.changeTabByIndex(b,false)}for(var c=0;c<this.chartTypeMenuData.length;c++){if(e.chartTypeMenu[c]!=null&&this.tabIndexMap[this.chartStyle]==c){e.chartTypeMenu[c].changeUIState(this.chartStyle,null,true)}}var f=(this.UIConfig.chartCtrl=="default")?this.outObj:a.eventULElm;if(this.events.dividend){f.find("a[value='dividend']").removeClass("rtq-chkbox_off")}for(var d in this.indicatorsData){if(this.indicatorsData.hasOwnProperty(d)){if(this.indicatorsData[d].show){a.indicatorULElm.find("a[value='"+d+"']").removeClass("rtq-chkbox_off");if(this.UIConfig.RightMenu){if(d=="Volume"){this.changeRightMenuClass(2,d,this.showVolume);continue}this.changeRightMenuClass(2,d,true)}}}}},_attachUIEvents:function(){var a=this._elements,b=this,c=this._contains;a.legendElm.unbind().bind("mouseover.rtqChart",function(f){var h=$(f.target);if(f.target.tagName.toUpperCase()=="SPAN"||h.hasClass("rtc-legend")){var g=h.closest(".rtc-legend");if(g.attr("name")!="MReturnIndex"){g.find(".rtc-legend-remove").removeClass("rtc-remove-hide")}}}).bind("mouseout.rtqChart",function(f){a.legendElm.find(".rtc-legend-remove").toggleClass("rtc-remove-hide",true)}).bind("click.rtqChart",function(g){var l=$(g.target),f=l.data("type");if(g.target.tagName.toUpperCase()=="SPAN"&&l.hasClass("rtc-legend-remove")){var k=$(g.target).closest(".rtc-legend");b.legendOnClick(k)}else{if(f=="ct"){a.legendElm.find(".rtc-legend-bold").removeClass("rtc-legend-bold");l.addClass("rtc-legend-bold");var j=l.parent();if(j&&j.attr("name")){var m=b.mainTicker;for(var h=0;h<b.compairTickers.length;h++){if(b.compairTickers[h]==j.attr("name")){b.compairTickers[h]=b.mainTicker;b.mainTicker="";b.acceptTicker(j.attr("name"));break}}}}}});var d=$("#"+this.autoBoxID);if(d.length>0){if(typeof(GB_qsAutoCompleteBox)=="object"){GB_qsAutoCompleteBox.subscription(this.autoBoxID,function(e){b.validateCompairTicker(e)},{needClear:true})}if(this.UIConfig.chartCtrl!="default"){d.css({color:"#DFDFDF"})}d.val(QSLGTXT.entersecurity||"Enter Security").click(function(){b.clearBox(this)});if(a.addCompairBtElm!=null){a.addCompairBtElm.unbind("click").click(function(){var e=$("#"+b.autoBoxID).attr("value");GB_qsAutoCompleteBox.triggerACB(b.autoBoxID)})}}this.outObj.find(".rtc-menu-trigger").unbind("click").click(function(){if(b.mainTicker!=""&&b.mainTicker!=null){b.menuButtonClicked(this)}});if(this.UIConfig.chartCtrl=="rtqPanel"){c.$settingPanel.find(".rtc-menu-trigger").unbind("click").click(function(){if(b.mainTicker!=""&&b.mainTicker!=null){b.menuButtonClicked(this)}})}this.attachMouseScoll();this.attachZoomIn()},clearBox:function(a){if(a==null){return}var b=$(a).val();if(b.substring(0,4)=="Line"||b=="Enter Security"){$(a).val("")}if(this.UIConfig.chartCtrl=="rtqPanel"){$(a).css("color","#DFDFDF")}},getPChartData:function(d){var f=this;this.pChartReady=false;var g=[],h=this.compairTickers.length>0?"return":"price";if(this.chartStyle=="growth"||this.chartStyle=="growth10"){h="return"}if(this.chartStyle=="growth10"){h+="_k"}var l={symbol:this.mainTicker,datapoints:{p:h,indicators:[]}};if(this.chartStyle=="postTax"){l={symbol:this.mainTicker,datapoints:{postTax:"return",indicators:[]}}}if(this._frequencyIndexMap[this.frequency]>0){if(this.events.dividend){l.datapoints.ds={isD:this.events.dividend}}}if(this.chartStyle=="growth10"){g.push(l);if(this.chartStyle=="growth10"){if(this.compairTickers.length){for(var b=0;b<this.compairTickers.length;b++){g.push({symbol:this.compairTickers[b],datapoints:{p:h}})}}}}else{for(var e in this.indicatorsData){if(this.indicatorsData[e].type==0){if(e=="EMA"||e=="SMA"){for(var c=0;c<this.indicatorsData[e].num.length;c++){if(this.indicatorsData[e].num[c]!=null){l.datapoints.indicators.push({name:e,p:[this.indicatorsData[e].num[c]],vtype:h})}}}else{if(this.indicatorsData[e].show){l.datapoints.indicators.push({name:e,p:this.indicatorsData[e].parameter,vtype:h})}}}}g.push(l);if(this.compairTickers.length){for(var b=0;b<this.compairTickers.length;b++){g.push({symbol:this.compairTickers[b],datapoints:{p:h}})}}}var a=RTQ_ChartUtil.toDateIndex(this.startDate);var k=RTQ_ChartUtil.toDateIndex(this.endDate);if(this.UIConfig.chartCtrl=="rtqPanel"&&(typeof(this.showLoading)=="function")){this.showLoading()}if(this._frequencyIndexMap[this.frequency]>0){GB_ChartDataManager.getHistoricalData(g,this._frequencyMap[this.frequency],a,k,function(i){f.pChartDataReady(i,d)})}},getSilderChartData:function(){var c=5,d=this.miniChartFrequency,e=null,f=null,b=this;if(this.miniChartFrequency=="minute"){c=1,d="d";e=RTQ_ChartUtil.toDateIndex(this.sDates.lMin),f=RTQ_ChartUtil.toDateIndex(this.slider_EndDate)}var a=[{symbol:this.mainTicker,dx:c,datapoints:{p:"price"}}];GB_ChartDataManager.getHistoricalData(a,d,e,f,function(g){b.sliderChartDataReady(g)})},getIChartData:function(d){var e=this.chartData,c=this;if(this.iChartData[d]||d=="FairValue"||d=="MReturnIndex"){var b;var a=RTQ_ChartUtil.toDateIndex(this.startDate);var g=RTQ_ChartUtil.toDateIndex(this.endDate);if(this.indicatorsData[d]||d=="RDividend"||d=="DYield"){var f=d=="RDividend"||d=="DYield"?[]:this.indicatorsData[d].parameter;b=[{symbol:this.mainTicker,datapoints:{indicators:[{name:d,p:f,vtype:"price"}]}}];if(this._frequencyIndexMap[this.frequency]>0){GB_ChartDataManager.getHistoricalData(b,this._frequencyMap[this.frequency],a,g,function(h){c.iChartDataReady(h)})}}}},drawPChart:function(){var o=this.chartData,r=this,p=this._contains,e=this._elements;if(o.DataList==null||o.DataList.length<1){return}this.mouseOutChart();if(this.zoomRange>2){this.ticksize=null,this.Ticks=this.getTicks(o.DataList[0].data,this.frequency)}if(this.pFlot==null){this.pFlot=new mstar.flot(p.pChartContainer,this.getChartOption("priceLine"));this.pFlot.setOption({imageHighlight:this.chartCursor==0});p.pChartContainer.unbind("plothover").bind("plothover",function(t,i,s){r.buildLegend(s,i,false,false)});p.pChartContainer.unbind("mouseout").bind("mouseout",function(i){var s=i.relatedTarget?i.relatedTarget.nodeName.toLowerCase():"";if(Util.contains(p.pChartContainer[0],i.relatedTarget)){return false}else{if(r.timeout){clearTimeout(r.timeout)}r.chartMouseOut()}});p.pChartContainer.unbind("mouseover").bind("mouseover",function(){if(r.timeout){clearTimeout(r.timeout)}var i=$(document);var s=i.scrollLeft(),u=i.scrollTop();var v=p.pChartContainer.offset();r.chartOffset={left:v.left+s,top:v.top+u};e.lineXElm.css({width:r.chartWidth});e.lineYElm.css({height:p.pChartContainer.height()})});this.pFlot.drawObj.beforeRemoveDrawing=function(s,i){GB_ChartDataManager.quoteDataMap[r.mainTicker].removeDrawing(s,i)};this.pFlot.drawObj.onDrawingUpdated=function(s,i){GB_ChartDataManager.quoteDataMap[r.mainTicker].updateDrawing(s,i)};p.pChartContainer.unbind("drawEnd").bind("drawEnd",function(s,t){if(typeof(e.$drawBlock)!="undefined"&&e.$drawBlock!=null&&e.$drawBlock.length){e.$drawBlock.find("[value='"+t+"']").removeClass("draw-row-select")}r.isDrawing=false;var i=r.pFlot.drawObj.getLastDrawing(t);if(i!=null){GB_ChartDataManager.quoteDataMap[r.mainTicker].saveLastDrawing(t,i)}if(r.chartCursor==1){e.crosshairLegendWin.show()}if(typeof(r.afterDrawEnd)=="function"){r.afterDrawEnd(t)}})}var n=[],j=null;var b=1,k;for(var d=0;d<o.DataList.length;d++){b=d==0?2:1;k=o.DataList[d].colorIndex==null?d:o.DataList[d].colorIndex;var m="line";if(d==0){var f=this.chartStyle;m=f=="mountain"||f=="growth"||f=="growth10"||f=="dEffect"||f=="postTax"?"mountain":this.chartStyle;j=o.DataList[d].startPos}n.push(this.getChartData(o.DataList[d].data,m,1,k,b))}if(this.zoomRange>2&&this._frequencyIndexMap[this.frequency]>0&&(this.events.dividend||this.events.splits||this.events.earnings)&&o.eventDataList!=null&&o.eventDataList.length>0){n.push(this.getChartData(o.eventDataList,"img",1,null))}var g=this.chartStyle;var a=(this.scaleType=="1"&&(this.compairTickers.length>0||g=="growth"||g=="dEffect"))?0:parseInt(this.scaleType,10);var h=true,l=g=="growth10"?"k":"";if(g=="mountain"||g=="line"||g=="dot"||g=="ab"||g=="growth"||g=="growth10"||g=="dEffect"){var c=(g=="growth"||g=="growth10"||g=="dEffect")?"mountain":g;this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},lines:{lineType:c},yaxis:{scaleType:a},drawingAble:h})}else{if(this.chartStyle=="ohlc"||this.chartStyle=="hlc"){this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},OLHC:{olhcType:this.chartStyle},yaxis:{scaleType:a},drawingAble:h})}else{this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},yaxis:{scaleType:a},drawingAble:h})}}this.pFlot.setOption({yaxis:{align:this.yaxisAlign,unit:l},otherInfo:{ticker:this.mainTicker}});this.pFlot.init(n);if(n&&n.length&&n[0].data.length){var q="price";if(this.compairTickers.length){q="return"}else{if(g=="growth"||g=="dEffect"){q="return"}}if(g=="growth10"){q="return10"}this.pFlot.setChartTypeForDrawings(q,j);this._loadDrawings(n[0].data,function(i){if(r.pFlot.drawObj){r.pFlot.drawObj.setDrawings(i);r.pFlot._triggerRedrawOverlay()}})}this.pChartReady=true},changeFrequencyStyle:function(c){var b=this.uiComponents,a=this._elements,e,d;d=e=this.calculateFrequency(this.startDate);this.changeFrequency(e);if(this.UIConfig.customFrequency==1&&this.defaultFrequencyMap[c]){this.frequency=this.defaultFrequencyMap[c]}if(b.rightMenu!=null){b.rightMenu.changeUIState(c,"zoom",true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(c,null,true);a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(this.zoomListData[this._zoomIndexMap[c]].txt+" | "+this._frequencyTxtMap[this.frequency])}if(this._frequencyIndexMap[d]>0&&d!=this.miniChartFrequency){this.miniChartFrequency=d;this.getSilderChartData()}else{if(this._frequencyIndexMap[d]<=0&&this.miniChartFrequency!="minute"){this.miniChartFrequency="minute";this.getSilderChartData()}else{this.setSliderHandleValues()}}},changeFrequency:function(a){if(this._frequencyIndexMap[a]>this._frequencyIndexMap[this.frequency]){this.frequency=a}this.bindFrequencyMenu(a)},bindFrequencyMenu:function(e){var c=this._frequencyIndexMap[e],b=this.uiComponents,a=this._elements;if(c!=this.selectFreIndex){if(b.ddlFrequency!=null){if(c==1){b.ddlFrequency.rebindData(this.dailyFreMenuData)}else{if(c==2){b.ddlFrequency.rebindData(this.weeklyFreMenuData)}else{if(c==3){b.ddlFrequency.rebindData(this.monthlyFreMenuData)}}}}this.selectFreIndex=c}if(b.ddlFrequency!=null){b.ddlFrequency.setTextValue("",this.frequency);if(b.rightMenu!=null){b.rightMenu.changeUIState(this.frequency,this.zoomRange,true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(this.frequency,this.zoomRange,true);var d=this.zoomListData[this._zoomIndexMap[this.zoomRange]].txt+" | "+this._frequencyTxtMap[this.frequency];a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(d)}}},calculateFrequency:function(a){var b="d";if(a>=this.sDates.d){b="d"}else{if(a>=this.sDates.w){b="w"}else{b="m"}}return b},_upMiniFrequency:function(){var a;if(this.miniChartFrequency=="d"){a="m"}else{a="m"}return a},drawSliderChart:function(){var a=this._contains;if(a.mChartContainer==null){return false}if(this.mFlot==null){this.mFlot=new mstar.flot(a.mChartContainer,this.getChartOption("miniChart"))}var b=this.chartData.MiniChartData.length?this.getTicks(this.chartData.MiniChartData[0],"d"):[];this.mFlot.setOption({xaxis:{tickSize:null,ticks:b}});this.mFlot.init(this.chartData.MiniChartData)},exportDataToExcel:function(){if(this.mainTicker==""||this.mainTicker==null){return}var c=[this.mainTicker],b=RTQ_ChartUtil.formatDate(this.startDate),a=RTQ_ChartUtil.formatDate(this.endDate);if(this.compairTickers.length){c=c.concat(this.compairTickers)}GB_ChartDataManager.exportDataToExcel(c,4,b,a,this._frequencyMap[this.frequency],null)},fileMenuCallback:function(a){if(a=="export"){this.exportDataToExcel()}},refreshLastTradeDate:function(){}});var QS_ForexChartComponent=function(c,b,a){this._title="Chart";this.timezone="GMT";this.securityType=[20];this.precision=4;this.autoTitle=true;this.dataUrl={getTickerInfoURL:this.protocol+"qt.morningstar.com/switchservice/getids.ashx?"};this.defaultFrequencyMenuCfg={intraday:true,history:true,customer:true};this.requencyMenuCfg={intraday:true,history:true,customer:true};this.region=(b==null?"USA":b);this.lan=(a==null?"en_US":a);this.cur="USD";this.fillColors=typeof(QS_Style)!="undefined"?QS_Style.chart.fillColors:{pChart:"#c9d2dd",vChart:"#2f4880",sChart:"#d9dfeb"};this.colors={borderColor:null,gridColor:typeof(QS_Style)=="undefined"?"#dddddd":QS_Style.flot.grid.tickColor,lableFontColor:typeof(QS_Style)=="undefined"?"#545454":QS_Style.flot.grid.color};this.mainTicker=c;this.tickerMaxNum=7;this.compairTickers=[];this.tickerInfos={};this.mainTickerInfo={type:"1",tenforeTicker:""};this.compairTickerInfo=[];this.events={dividend:false};this.latestTradeDate=new Date();this.endDate=new Date();this.startDate=this.endDate;this.zoomRange=1;this.chartStyle="mountain";this.frequency="minute";this.chartCursor=1;this.scaleType=0;this.yaxisAlign="right";this.isShowTimeSlider=true;this.showLegend=true;this.pChartReady=false;this.sliderObj=null;this.slider_EndDate=this.latestTradeDate;this.slider_StartDate=new Date(this.slider_EndDate.getFullYear()-2,this.slider_EndDate.getMonth(),this.slider_EndDate.getDate());this.sDates={d:null,m:null};this.rangSize=512;this.miniChartFrequency="d";this.ichartSiwtchIndicatorWin={flag:false,oldName:"",newName:"",data:null,ulelm:null};this.scrollAble=false;this._selectedIndicatorName="";this.isDrawing=false;this.lock=false;this.showNotes=false;this.timeout=null;this.mouseWheeTimeout=null;this.wheelNum=0;this.simpleMenu=false;this.chartOffset={left:0,top:0};this.hasConfirmBox=(typeof(Util)!="undefined"&&typeof(Util.confirm)!="undefined")?true:false;this.isShowLastLabel=true;this.selectionMode={pan:true,zoomIn:false,zoomOut:false};this.zoomStack=[];this.legendInfo={OHLC:true,Volume:false,showDateRangeString:true};this.chartWidth=760;this.outHeight=0;this.pChartHeight=300;this.vChartHeight=60;this.miniChartHeight=26;this.yLabelWidth=50;this.minW=300;this.minH=100;this.showGridLines=true;this.iChartHeight=80;this.UIConfig={chartCtrl:"default",Chart:{showTimeSlider:true},settingPanel:null,autoHeight:false,RightMenu:true,indicator:{},events:{},drawing:{},MouseWheel:true,ZoomIn:true,showDateRangeInLengend:1,customFrequency:0};this.defaultFrequencyMap={};this.uiComponents={settingGroup:null,ddlFrequency:null,ddlZoom:null,ddlChartType:null,ddlCursorType:null,customDateB:null,tabMenu:null,chartTypeMenu:[],tabZoomMenu:null,rightMenu:null,indexScrollPN:null,miniChartRightMenu:{}};this._contains={pChartContainer:null,mChartContainer:null,toolContainer:null,$settingPanel:null};this._elements={legendElm:null,crosshairLegendElm:null,crosshairLegendWin:null,lineXElm:null,lineYElm:null,xLabelElm:null,addCompairBtElm:null,indicatorWinElm:null,eventULElm:null,valuationULElm:null,indicatorULElm:null,chkLock:null,growthMenu:null,oscIndicatorMenu:null,tabmenuZoomEl:null,$ddlZoom:null,$ddlFrequency:null,$ddlChartType:null,$ddlCursorType:null,$customDate:null,$ratioScale:null,$drawBlock:null,$yaxisAlign:null,zoomMask:null};this.iChartContainers={};this.pFlot=null;this.mFlot=null;this.iFlots={MACD:null,RSI:null,ROC:null,Momentum:null,Mass:null,ForceIndex:null};this.chartData={DataList:[],eventDataList:null,eventInfoList:null,MiniChartData:[]};this.iChartData={MACD:[],RSI:[],ROC:[],Momentum:[],WMA:[],Mass:[],ForceIndex:[]};this._securityTypeMap={ST:1,FE:1,XI:10,FO:8,FC:1};this._zoomIndexMap={1:0,2:1,13:2,3:3,14:4,4:5,5:6,6:7,7:8,8:9,9:10,10:11,11:12};this._frequencyIndexMap={minute:-4,minute5:-3,minute10:-2,minute15:-1,minute30:0,d:1,w:2,m:3};this._frequencyTxtMap={minute:"1 "+QSLGTXT.shortminute,minute5:"5 "+QSLGTXT.shortminute,minute10:"10 "+QSLGTXT.shortminute,minute15:"15 "+QSLGTXT.shortminute,minute30:"30 "+QSLGTXT.shortminute,d:QSLGTXT.daily,w:QSLGTXT.weekly,m:QSLGTXT.monthly};this._frequencyMap={minute:1,minute5:5,minute10:10,minute15:15,minute30:30,d:"d",w:"w",m:"m"};this.tabMap=["mountain","ohlc","candle","growth"];this.tabIndexMap={mountain:0,dot:0,ab:0,line:0,ohlc:1,hlc:1,candle:2,growth:3,growth10:3};this.indicatorUI={SMA:{title:QSLGIN.sma_t,parameter:[QSLGIN.sma_p1,QSLGIN.sma_p2,QSLGIN.sma_p3],defaultValue:[10,50,]},EMA:{title:QSLGIN.ema_t,parameter:[QSLGIN.ema_p1,QSLGIN.ema_p2,QSLGIN.ema_p3],defaultValue:[10,,]},BBands:{title:QSLGIN.bbands_t,parameter:[QSLGIN.bbands_p1,QSLGIN.bbands_p2],defaultValue:[20,2]},MACD:{title:QSLGIN.macd_t,parameter:[QSLGIN.macd_p1,QSLGIN.macd_p2,QSLGIN.macd_p3],defaultValue:[26,12,9]},RSI:{title:QSLGIN.rsi_t,parameter:[QSLGIN.rsi_p1],defaultValue:[14]},ROC:{title:QSLGIN.roc_t,parameter:[QSLGIN.roc_p1],defaultValue:[12]},MAE:{title:QSLGIN.mae_t,parameter:[QSLGIN.mae_p1,QSLGIN.mae_p2],defaultValue:[14,2]},Momentum:{title:QSLGIN.momentum_t,parameter:[QSLGIN.momentum_p1],defaultValue:[2]},WMA:{title:QSLGIN.wma_t,parameter:[QSLGIN.wma_p1],defaultValue:[15]}};this.indicatorsData={SMA:{show:false,num:[null,null,null],colorIndex:[0,0,0],type:0},SMAV:{show:false,num:null,colorIndex:0,type:0},EMA:{show:false,num:[null,null,null],colorIndex:[0,0,0],type:0},BBands:{show:false,parameter:[10,2],colorIndex:0,type:0},MACD:{show:false,parameter:[26,12,9],type:1,mty:1},RSI:{show:false,parameter:[14],type:1,mty:2},ROC:{show:false,parameter:[12],type:1,mty:1},MAE:{show:false,parameter:[14,2],type:0},Momentum:{show:false,parameter:[2],type:1,mty:1},WMA:{show:false,parameter:[15],type:0,mty:0}};this.eventsData=[];this.intradayFreMenuData=[{txt:"1 "+QSLGTXT.shortminute,val:"minute",type:"ratio"},{txt:"5 "+QSLGTXT.shortminute,val:"minute5",type:"ratio"},{txt:"10 "+QSLGTXT.shortminute,val:"minute10",type:"ratio"},{txt:"15 "+QSLGTXT.shortminute,val:"minute15",type:"ratio"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30",type:"ratio"}];this.sMinuteFreMenuData=[{txt:"5 "+QSLGTXT.shortminute,val:"minute5",type:"ratio"},{txt:"10 "+QSLGTXT.shortminute,val:"minute10",type:"ratio"},{txt:"15 "+QSLGTXT.shortminute,val:"minute15",type:"ratio"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30",type:"ratio"},{txt:QSLGTXT.daily,val:"d",type:"ratio"}];this.lMinuteFreMenuData=[{txt:"10 "+QSLGTXT.shortminute,val:"minute10",type:"ratio"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30",type:"ratio"},{txt:QSLGTXT.daily,val:"d",type:"ratio"},{txt:QSLGTXT.weekly,val:"w",type:"ratio"}];this.dailyFreMenuData=[{txt:QSLGTXT.daily,val:"d",type:"ratio"},{txt:QSLGTXT.weekly,val:"w",type:"ratio"},{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.weeklyFreMenuData=[{txt:QSLGTXT.weekly,val:"w",type:"ratio"},{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.monthlyFreMenuData=[{txt:QSLGTXT.monthly,val:"m",type:"ratio"}];this.zoomListData=[{txt:"1 "+QSLGTXT.shortmonth,val:"3",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"2 "+QSLGTXT.shortmonth,val:"14",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"3 "+QSLGTXT.shortmonth,val:"4",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:QSLGTXT.ytd,val:"5",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"1 "+QSLGTXT.shortyear,val:"6",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"3 "+QSLGTXT.shortyear,val:"7",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"5 "+QSLGTXT.shortyear,val:"8",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"10 "+QSLGTXT.shortyear,val:"9",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:QSLGTXT.max,val:"10",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.monthlyFreMenuData},{txt:QSLGTXT.custom,val:"11",type:"ratio"}];this.cursorTypeListData=[{txt:QSLGTXT.trackball,val:"0",type:"ratio"},{txt:QSLGTXT.crosshair,val:"1",type:"ratio"},{txt:QSLGTXT.off,val:"3",type:"ratio"}];this.scaleTypeListData=[{txt:QSLGTXT.linear,val:"0"},{txt:QSLGTXT.logarithmic,val:"1"}];this.yaxisAlignListData=[{txt:QSLGTXT.left,val:"left"},{txt:QSLGTXT.right,val:"right"}];this.selectionModeListData=[{txt:QSLGTXT.pan,val:"pan"},{txt:QSLGTXT.zoomin,val:"zoomin"},{txt:QSLGTXT.reset,val:"reset"}];this.tabList=[{txt:QSLGTXT.line,id:0,closable:false},{txt:QSLGTXT.bar,id:1,closable:false},{txt:QSLGTXT.candlestick,id:2,closable:false},{txt:QSLGTXT.growth,id:3,closable:false}];this.chartTypeMenuData=[[{txt:QSLGTXT.mountain,type:"ratio",val:"mountain"},{txt:QSLGTXT.line,type:"ratio",val:"line"},{txt:QSLGTXT.dot,type:"ratio",val:"dot"},{txt:QSLGTXT.abovebelow,type:"ratio",val:"ab"}],[{txt:QSLGTXT.ohlc,type:"ratio",val:"ohlc"},{txt:QSLGTXT.hlc,type:"ratio",val:"hlc"}],[],[{txt:QSLGTXT.pergrowth,type:"ratio",val:"growth"},{txt:QSLGTXT.tenkgrowth,type:"ratio",val:"growth10"}]];this.settingGroupList=[{name:QSLGTXT.display,id:1},{name:QSLGTXT.window,id:6},{name:QSLGTXT.compare,id:2,closable:false},{name:QSLGTXT.drawingandnotes,id:3},{name:QSLGTXT.indicators,id:4}];this.indicatorTabList=[{txt:QSLGTXT.popular,id:0,closable:false},{txt:QSLGTXT.pricetrends,id:2,closable:false},{txt:QSLGTXT.oscillator,id:3,closable:false}];this.indicatorPanelData=[[{txt:QSLGIN.bbands_name,val:"BBands",type:""},{txt:QSLGIN.macd_name,val:"MACD",type:""},{txt:QSLGIN.roc_name,val:"ROC",type:""},{txt:QSLGIN.rsi_name,val:"RSI",type:""},{txt:QSLGIN.sma_name,val:"SMA",type:""}],[{txt:QSLGIN.bbands_name,val:"BBands",type:""},{txt:QSLGIN.ema_name,val:"EMA",type:""},{txt:QSLGIN.mae_name,val:"MAE",type:""},{txt:QSLGIN.macd_name,val:"MACD",type:""},{txt:QSLGIN.momentum_name,val:"Momentum",type:""},{txt:QSLGIN.roc_name,val:"ROC",type:""},{txt:QSLGIN.sma_name,val:"SMA",type:""},{txt:QSLGIN.wma_name,val:"WMA",type:""}],[{txt:QSLGIN.rsi_name,val:"RSI",type:""}]];this.zoomListData=[{txt:"1 "+QSLGTXT.shortday,val:"1",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.intradayFreMenuData},{txt:"5 "+QSLGTXT.shortday,val:"2",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.intradayFreMenuData},{txt:"15 "+QSLGTXT.shortday,val:"13",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.sMinuteFreMenuData},{txt:"1 "+QSLGTXT.shortmonth,val:"3",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.sMinuteFreMenuData},{txt:"2 "+QSLGTXT.shortmonth,val:"14",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.lMinuteFreMenuData},{txt:"3 "+QSLGTXT.shortmonth,val:"4",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.lMinuteFreMenuData},{txt:QSLGTXT.ytd,val:"5",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"1 "+QSLGTXT.shortyear,val:"6",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"3 "+QSLGTXT.shortyear,val:"7",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"5 "+QSLGTXT.shortyear,val:"8",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:"10 "+QSLGTXT.shortyear,val:"9",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.dailyFreMenuData},{txt:QSLGTXT.max,val:"10",type:"ratio",catekey:"zoom",selectable:false,subMenu:this.monthlyFreMenuData},{txt:QSLGTXT.custom,val:"11",type:"ratio"}];this.frequencyListData=[{txt:"1 "+QSLGTXT.shortminute,val:"minute"},{txt:"5 "+QSLGTXT.shortminute,val:"minute5"},{txt:"10 "+QSLGTXT.shortminute,val:"minute10"},{txt:"15 "+QSLGTXT.shortminute,val:"minute15"},{txt:"30 "+QSLGTXT.shortminute,val:"minute30"},{txt:QSLGTXT.daily,val:"d"},{txt:QSLGTXT.weekly,val:"w"},{txt:QSLGTXT.monthly,val:"m"}];this.chartTypeListData=[{txt:QSLGTXT.mountain,val:"mountain",type:"ratio"},{txt:QSLGTXT.line,val:"line",type:"ratio"},{txt:QSLGTXT.dot,val:"dot",type:"ratio"},{txt:QSLGTXT.abovebelow,val:"ab",type:"ratio"},{txt:QSLGTXT.ohlc,val:"ohlc",type:"ratio"},{txt:QSLGTXT.hlc,val:"hlc",type:"ratio"},{txt:QSLGTXT.candlestick,val:"candle",type:"ratio"},{txt:QSLGTXT.pergrowth,val:"growth",type:"ratio"},{txt:QSLGTXT.tenkgrowth,val:"growth10",type:"ratio"}];this.indicatorL2Data=[{txt:QSLGTXT.pricetrends,selectable:false,val:"mainl2-pricetrend",subMenu:this.indicatorPanelData[1]},{txt:QSLGTXT.oscillator,val:"mainl2-oscillator",selectable:false,subMenu:this.indicatorPanelData[2]}];this.ichartMenuL1Data=[[],[]];this.miniChartRightMenuData=[{txt:"<b>"+QSLGTXT.indicators+"</b>",val:"mini-indicator",selectable:false},{txt:"&nbsp;&nbsp;"+QSLGTXT.pricetrends,val:"minil1-pricetrend",selectable:false,hasSubMenu:true},{txt:"&nbsp;&nbsp;"+QSLGTXT.oscillator,val:"minil1-oscillator",selectable:false,hasSubMenu:true},{type:"separator",val:"s2"},{txt:QSLGTXT.edit,val:"edit"}];this.rightMenuData=[{txt:QSLGTXT.charttype,val:"chartType",type:"",selectable:false,subMenu:this.chartTypeListData},{txt:QSLGTXT.chartcursor,val:"cursorType",type:"",selectable:false,subMenu:this.cursorTypeListData},{txt:QSLGTXT.zoom,val:"zoom",type:"",selectable:false,subMenu:this.zoomListData},{txt:QSLGTXT.indicators,val:"indicator",selectable:false,subMenu:this.indicatorL2Data}]};QS_ForexChartComponent.prototype=$.extend({},QS_baseChart,{initUIConfig:function(a){$.extend(this.UIConfig,a);if(this.UIConfig.settingPanel!=null){this._contains.$settingPanel=$(this.UIConfig.settingPanel)}},Init:function(c,a,b){if(typeof(this.id)=="undefined"){this.id=c;if(typeof(GB_ChartDataManager)=="object"){GB_ChartDataManager.subscribeChart(this)}}this.objName=a;this.outObj=$("#"+c).addClass("rtc-chart-out");this.autoBoxID=c+"_autoBox";this.createChartUI();this._initConfig(b);this._createUiComponents();var d=[];if(typeof(this.mainTicker)!="undefined"&&this.mainTicker!=null&&this.mainTicker!=""){d.push(this.mainTicker)}if(this.compairTickers&&this.compairTickers.length>0){d=d.concat(this.compairTickers)}if(d.length>0){this.validateSavedTickers(d)}},initStartDate:function(){var a=GB_ChartDataManager.dates;this.sDates.iMin=a[1];this.sDates.sMin=a[5];this.sDates.lMin=a[10];this.sDates.d=a.d;this.sDates.w=a.w;this.sDates.m=a.m;this.slider_StartDate=this.getSliderStartDate()},_initConfig:function(c){if(c==null||c==""){return}if(c.simpleMenu){this.simpleMenu=true;this.rightMenuData.splice(4,1)}if(c.chartStyle!=null){this.chartStyle=c.chartStyle=="lines"?"mountain":c.chartStyle;var b=false;for(var a=0;a<this.chartTypeListData.length;a++){if(this.chartTypeListData[a].val==this.chartStyle){b=true;break}}if(!b){this.chartStyle="mountain"}}if(c.title){this._title=c.title}if(c.autoTitle!=null){this.autoTitle=c.autoTitle}if(c.mTicker!=null){this.mainTicker=c.mTicker}if(c.cTickers!=null){this.compairTickers=c.cTickers}if(c.pWidth!=null){this.chartWidth=c.pWidth}if(c.pHeight!=null){this.pChartHeight=c.pHeight}if(c.zRange!=null){this.zoomRange=c.zRange}if(c.startDate!=null){this.startDate=RTQ_ChartUtil.convertToDate(c.startDate)}if(c.endDate!=null){this.endDate=RTQ_ChartUtil.convertToDate(c.endDate)}if(c.region!=null){this.region=c.region}if(c.lan!=null){this.lan=c.lan}if(c.cur!=null){this.cur=c.cur}if(c.frequency!=null){this.frequency=c.frequency}if(c.slider_StartDate!=null){this.slider_StartDate=RTQ_ChartUtil.convertToDate(c.slider_StartDate)}if(c.miniChartFrequency!=null){this.miniChartFrequency=c.miniChartFrequency}if(c.events!=null){$.extend(true,this.events,c.events)}if(c.tickerInfos){this.tickerInfos=c.tickerInfos}if(c.chartCursor!=null){this.chartCursor=c.chartCursor}if(c.lock!=null){this.lock=c.lock}if(c.showNotes!=null){this.showNotes=c.showNotes}if(c.yaxisAlign!=null){this.yaxisAlign=c.yaxisAlign}if(c.isShowTimeSlider!=null){this.isShowTimeSlider=c.isShowTimeSlider}if(c.showLegend!=null){this.showLegend=c.showLegend}if(c.scaleType){this.scaleType=c.scaleType}if(c.ticksize){this.ticksize=c.ticksize}if(c.Ticks){this.Ticks=c.Ticks}if(c.indicatorsData){for(var a in c.indicatorsData){if(!this.indicatorsData[a]){c.indicatorsData[a]=null;delete c.indicatorsData[a]}}$.extend(true,this.indicatorsData,c.indicatorsData)}if(c.width!=null){this.chartWidth=(c.width>this.minW)?c.width:this.minW}if(c.height!=null){if(this.UIConfig.chartCtrl=="rtqPanel"){this.outHeight=c.height-26}else{this.outHeight=c.height}this._setSizeParas(this.chartWidth,this.outHeight)}this.outObj.css({width:this.chartWidth+"px",height:this.outHeight+"px"});this._contains.pChartContainer.css({width:this.chartWidth+"px",height:this.pChartHeight+"px"});if(this._elements.zoomMask!=null){this._elements.zoomMask.css({height:this.pChartHeight+"px"})}if(this._contains.mChartContainer!=null){this._contains.mChartContainer.css({width:this.chartWidth+"px",height:this.miniChartHeight+"px"})}},saveConfig:function(){var e={title:this._title,autoTitle:this.autoTitle,mTicker:this.mainTicker,cTickers:this.compairTickers,pWidth:this.chartWidth,pHeight:this.pChartHeight,mHeight:this.miniChartHeight,events:this.events,zRange:this.zoomRange,startDate:RTQ_ChartUtil.formatDate(this.startDate),endDate:RTQ_ChartUtil.formatDate(this.endDate),region:this.region,lan:this.lan,cur:this.cur,frequency:this.frequency,slider_StartDate:RTQ_ChartUtil.formatDate(this.slider_StartDate),miniChartFrequency:this.miniChartFrequency,chartStyle:this.chartStyle,tickerInfos:this.tickerInfos,chartCursor:this.chartCursor,scaleType:this.scaleType,yaxisAlign:this.yaxisAlign,ticksize:this.ticksize,Ticks:this.Ticks,lock:this.lock,showNotes:this.showNotes,isShowTimeSlider:this.isShowTimeSlider};var a={},d={},c=this.indicatorsData;for(var b in c){if(c[b].show){if(b=="SMA"||b=="SMAV"||b=="EMA"){a[b]={show:true,num:typeof(c[b].num)=="object"?$.extend(true,[],c[b].num):c[b].num}}else{a[b]={show:c[b].show,parameter:$.extend(true,[],c[b].parameter)}}}}for(var b in this.valuations){if(this.valuations[b].show){d[b]={show:true}}}e.indicatorsData=a;e.valuations=d;return e},createChartUI:function(){var b=this,c=this.UIConfig,a=this._elements,d=this._contains,e=this.uiComponents;e.ddlChartType=e.ddlFrequency=e.ddlZoom=e.ddlCursorType=null;this.outObj.html("");if(c.chartCtrl=="rtqPanel"){this.outObj.append('<div class="rtc-ul-tab clearfix"><div class="rtc-tab-zoom"><div class="rtq-ddl" style="z-index: 2000; width: 115px;"><div val="1" style="width: 111px;" class="rtq-ddl-ipt"></div></div></div><div class="rtc-tab"></div></div>');a.tabmenuZoomEl=this.outObj.find(".rtc-tab-zoom .rtq-ddl")}var f=$('<div class="rtc-chart-container rtc-price-chart"></div>').appendTo(this.outObj);a.legendElm=$('<div class="rtc-legend-txt"></div>').appendTo(f);d.pChartContainer=$('<div class="rtc-chart rtc-chart-main"></div>').appendTo(f);if(c.ZoomIn){a.zoomMask=$('<div style="display:none" class="chart-zoom-mask"></div>').appendTo(d.pChartContainer)}a.crosshairLegendWin=$('<div class="rtc-legend-win" style="display:none;"><div class="rtc-legend-win-wrap"></div></div>').appendTo(d.pChartContainer);a.crosshairLegendElm=a.crosshairLegendWin.find(".rtc-legend-win-wrap");a.lineXElm=$('<div class="rtc-line-x"><span></span></div>').appendTo(d.pChartContainer);a.lineYElm=$('<div class="rtc-line-y"></div>').appendTo(d.pChartContainer);a.xLabelElm=a.lineXElm.find(":first-child");if(this.UIConfig.Chart.showTimeSlider){var g=$('<div class="rtc-chart-container"></div>').appendTo(this.outObj);d.mChartContainer=$('<div class="rtc-chart"></div>').appendTo(g)}else{this.isShowTimeSlider=false}if(c.chartCtrl=="rtqPanel"){this._createSettingPanelUI()}else{a.indicatorULElm=this.outObj.find(".qs-indicator-list");a.$customDate=this.outObj.find(".customRange");a.eventULElm=this.outObj.find(".qs-event-list");a.valuationULElm=this.outObj.find(".qs-valuation-list");a.indexsULElm=this.outObj.find(".qs-index-list");a.relatedSecULElm=this.outObj.find(".qs-relative-list");a.tabmenuZoomEl=this.outObj.find(".rtc-tab-zoom .rtq-ddl")}if(typeof(this.afterCreateUI)=="function"){this.afterCreateUI()}},_createSettingPanelUI:function(){var e=this._elements,g=this._contains,a=this.uiComponents,l=this;g.$settingPanel.html("");var b=new Util.GroupBox(g.$settingPanel,this.settingGroupList,{width:180,groupBoxHeight:310,autoHeight:true});var m=b.getGroup(1).bd,p="";p+='<div class="clearfix block-row-top"><h4>'+QSLGTXT.charttype+'</h4><div class="ddlChartType"></div></div>';p+='<div class="clearfix block-row"><h4>'+QSLGTXT.verticalscale+'</h4><div class="ratioScale"></div></div>';p+='<div class="clearfix block-row"><h4>'+QSLGTXT.yaxis+'</h4><div class="ratioYaxis"></div></div>';p+='<div class="clearfix block-row"><h4>'+QSLGTXT.selectionmode+'</h4><div class="ratioSelectionMode"></div></div>';p+='<div class="clearfix block-row"><h4>'+QSLGTXT.range+'</h4><div class = "customRange clearfix" ></div></div>';p+='<div class="clearfix block-row"><div class="set-block"><h4>'+QSLGTXT.zoom+'</h4><div class="ddlZoom"></div></div>';p+='<div class="set-block set-right"><h4>'+QSLGTXT.frequency+'</h4><div class="ddlFrequency"></div></div></div>';p+='<div class="clearfix block-row"><div class="set-block"><h4>'+QSLGTXT.chartcursor+'</h4><div class="ddlCursorType"></div></div></div>';m.append(p);e.$customDate=m.find(".customRange");e.$ratioScale=m.find(".ratioScale");e.$yaxisAlign=m.find(".ratioYaxis");e.$selectionMode=m.find(".ratioSelectionMode");var d="",f;for(var h=0;h<this.scaleTypeListData.length;h++){f=h==0?"rtq-ratio-left ":"rtq-ratio-off";d+='<a href="javascript:void(0)" catkey="scale" class="rtc-menu-trigger rtq-ratio '+f+' " ';d+='value="'+this.scaleTypeListData[h].val+'">'+this.scaleTypeListData[h].txt+"</a>"}e.$ratioScale.html(d);d="";for(var h=0;h<this.yaxisAlignListData.length;h++){d+='<a href="javascript:void(0)" catkey="yaxis" class="rtc-menu-trigger rtq-ratio '+(h==0?"rtq-ratio-left ":"rtq-ratio-off")+' " ';d+='value="'+this.yaxisAlignListData[h].val+'">'+this.yaxisAlignListData[h].txt+"</a>"}e.$yaxisAlign.html(d);d="";for(var h=0;h<this.selectionModeListData.length;h++){d+='<a href="javascript:void(0)" catkey="selectionmode" class="rtc-menu-trigger rtq-ratio rtq-menu-selectmode '+(h==0?"rtq-ratio-left ":"rtq-ratio-off")+" "+(this.selectionModeListData[h].val!="reset"?" ":"rtq-ratio-chart-reset")+'" ';d+='value="'+this.selectionModeListData[h].val+'">'+this.selectionModeListData[h].txt+"</a>"}e.$selectionMode.html(d);var q=b.getGroup(2).bd;q.append('<div class="clearfix block-row-top"><h4>'+QSLGTXT.compare+'</h4><div class="clearfix" style="position:relative"><input  id ="'+this.autoBoxID+'" class="qs-ui-ipt" type="text" style="width: 132px;" value="" /><a href="javascript:void(0)" class="qs-ui-btn go qs-compare-button">ADD</a><div></div>');e.addCompairBtElm=q.find(".qs-compare-button");var q=b.getGroup(3).bd;var k="<div class='clearfix block-row-top'><h4></h4>";for(var h=0;h<this.drawingData.length;h++){k+="<div  catkey='draw' class='rtc-menu-trigger draw-row' value="+this.drawingData[h].val+">";k+="<a href='javascript:void(0)'>"+this.drawingData[h].txt+"</a></div>"}k+="</div>";q.append(k);e.$drawBlock=q.find(".block-row-top");var j=b.getGroup(4).bd.addClass("rtq-chart-group-indi2");a.indTabMenu=new Util.TabMenu(j[0],this.indicatorTabList,{onActive:function(i){}},{width:80,isExcuteCallbackAtInit:false,autoFixtoText:false,vertical:true});var d="";for(var h=0;h<a.indTabMenu.tabs.length;h++){d="";for(var n in this.indicatorPanelData[h]){var r=this.indicatorPanelData[h][n];d+='<div class="check-row"><a href="javascript:void(0)" class="rtc-menu-trigger rtq-chkbox rtq-chkbox_off" ';d+=' value="'+r.val+'" catkey="indicator" >'+r.txt+"</a></div>"}a.indTabMenu.tabs[h].panel.append(d)}e.indicatorULElm=j.find(".rtq-tab-panels");j.css({position:"relative"});var c=b.getGroup(6).bd;a.settingPlugin=new SettingPlugin(c,{className:"rtq-setting-plugin-black",width:170,showLockCheckable:false,showHideCheckable:false},{onChangeTitle:function(i,o,s){l.autoTitle=s;l.onChangeTitle(i,o,s)}});c.append('<div class="clearfix block-row"><div class="set-block"><div class="lock"></div></div></div>');a.chkLock=new Util.ButtonGroup(c.find(".lock"),[{txt:QSLGTXT.showtimerangeslider,val:"showTimeSlider"},{txt:QSLGTXT.lockondoubleclick,val:"lock"},{txt:QSLGTXT.shownotes,val:"showNotes"}],{onClick:function(i,o){if(i=="showTimeSlider"){l.isShowTimeSlider=o.isSelected;if(l.isShowTimeSlider){g.mChartContainer.show()}else{g.mChartContainer.hide()}l.changeOutSize(l.chartWidth,l.outHeight)}else{if(i=="lock"){l.lock=o.isSelected}else{if(i=="showNotes"){l.showNotes=o.isSelected;if(l.showNotes){l._loadChartNote(l.mainTicker)}else{l._contains.pChartContainer.find(".qs-note-flot").remove()}}}}}},{type:"checkbox",vertical:true});a.chkLock.btns.lock.el[0].title="This function allows you to prevent the window from updating when you double-click a security in the watchlist."},_createUiComponents:function(){var a=this.uiComponents,h=this.UIConfig,g=this._contains,b=this._elements,i=this;var e,d="",c="#FEFEFE";if(h.chartCtrl=="rtqPanel"){e=g.$settingPanel;d="rtq-ddl-black",c="#727272"}else{e=this.outObj}if(h.chartCtrl=="rtqPanel"){if(a.ddlZoom==null){a.ddlZoom=new Util.DropDownList(e.find(".ddlZoom")[0],function(l,j){i.zoomSelected(l,j)},i.zoomListData,{triggerByClick:false,width:76,disable:true,actionAtInit:false,className:d})}if(a.ddlFrequency==null){a.ddlFrequency=new Util.DropDownList(e.find(".ddlFrequency")[0],function(l,j){i.frequencySelected(l,j)},i.frequencyListData,{triggerByClick:false,width:76,disable:true,actionAtInit:false,className:d})}if(a.ddlCursorType==null){var f=h.chartCtrl=="default"?75:165;a.ddlCursorType=new Util.DropDownList(e.find(".ddlCursorType")[0],function(l,j){i.cursorTypeSelected(l,j)},i.cursorTypeListData,{triggerByClick:false,width:f,disable:true,actionAtInit:false,className:d})}if(a.ddlChartType==null){var f=h.chartCtrl=="default"?105:165;a.ddlChartType=new Util.DropDownList(e.find(".ddlChartType")[0],function(l,j){i.chartTypeSelected(l,j)},i.chartTypeListData,{triggerByClick:false,width:f,disable:true,actionAtInit:false,className:d})}this._createTabMenu();this._createDateInputBoxes()}this._createIndicatorInputWin(this.outObj);if(h.RightMenu){this._createRightMenu(g.pChartContainer);this._createIChartRightMenu()}},_setSizeParas:function(c,d){this.chartWidth=c;this.outHeight=d;var a=this.getIChartsHeight();var b=d-a;if(this.showLegend){b=b-25}if(this.isShowTimeSlider){b=b-30}if(this.UIConfig.chartCtrl=="rtqPanel"){b-=30}var e=b>this.minH?b:this.minH;this.pChartHeight=e},initComponent:function(){var a=this;this._attachUIEvents();this._initUiComponentsStatus();this.chartData.DataList=this.chartData.eventDataList=null;for(var b in this.iChartData){this.iChartData[b]=[]}this.initStartDate();if(typeof(this.setTitle)=="function"){var c=this._getClientTicker(this.mainTicker);this.setTitle(this._title,c)}this.changeRange(this.zoomRange);setTimeout(function(){a.getSilderChartData()},200)},_initUiComponentsStatus:function(){var a=this._elements,e=this.uiComponents;if(e.ddlZoom!=null){e.ddlZoom.setDisable(false)}if(e.ddlChartType!=null){e.ddlChartType.setDisable(false)}if(e.ddlCursorType!=null){e.ddlCursorType.setDisable(false)}if(e.ddlFrequency!=null){e.ddlFrequency.setDisable(false)}if(e.settingPlugin!=null){e.settingPlugin.setName(this.autoTitle,this.autoTitle?"":this._title)}if(e.rightMenu!=null){if(this.events.dividend){e.rightMenu.changeUIState("dividend",null,true)}e.rightMenu.changeUIState(this.chartStyle,null,true);e.rightMenu.changeUIState(this.chartCursor,null,true)}if(this.chartCursor!="1"&&this.chartCursor!=1){a.lineXElm.hide();a.lineYElm.hide()}if(this.isShowTimeSlider&&e.chkLock!=null){e.chkLock.btns.showTimeSlider.select()}if(this.lock==true&&e.chkLock!=null){e.chkLock.btns.lock.select()}if(this.showNotes==true&&e.chkLock!=null){e.chkLock.btns.showNotes.select()}if(this.yaxisAlign=="right"){if(a.$yaxisAlign!=null){a.$yaxisAlign.find("[value='left']").addClass("rtq-ratio-off");a.$yaxisAlign.find("[value='right']").removeClass("rtq-ratio-off")}a.xLabelElm.css({right:0,left:""})}else{if(a.$yaxisAlign!=null){a.$yaxisAlign.find("[value='right']").addClass("rtq-ratio-off");a.$yaxisAlign.find("[value='left']").removeClass("rtq-ratio-off")}a.xLabelElm.css({left:0,right:""})}if(e.ddlZoom!=null){e.ddlZoom.setTextValue(null,this.zoomRange)}if(e.ddlFrequency!=null){e.ddlFrequency.setTextValue(null,this.frequency)}if(e.ddlCursorType!=null){e.ddlCursorType.setTextValue(null,this.chartCursor)}if(e.ddlChartType!=null){e.ddlChartType.setTextValue(null,this.chartStyle)}if(this.scaleType==1&&a.$ratioScale!=null){a.$ratioScale.find("[value='0']").addClass("rtq-ratio-off");a.$ratioScale.find("[value='1']").removeClass("rtq-ratio-off")}if(e.tabMenu!=null){var b=this.tabIndexMap[this.chartStyle];e.tabMenu.changeTabByIndex(b,false)}for(var c=0;c<this.chartTypeMenuData.length;c++){if(e.chartTypeMenu[c]!=null&&this.tabIndexMap[this.chartStyle]==c){e.chartTypeMenu[c].changeUIState(this.chartStyle,null,true)}}var f=(this.UIConfig.chartCtrl=="default")?this.outObj:a.eventULElm;if(this.events.dividend){f.find("a[value='dividend']").removeClass("rtq-chkbox_off")}for(var d in this.indicatorsData){if(this.indicatorsData.hasOwnProperty(d)){if(this.indicatorsData[d].show){a.indicatorULElm.find("a[value='"+d+"']").removeClass("rtq-chkbox_off");if(this.UIConfig.RightMenu){if(d=="Volume"){this.changeRightMenuClass(2,d,this.showVolume);continue}this.changeRightMenuClass(2,d,true)}}}}},_attachUIEvents:function(){var a=this._elements,b=this,c=this._contains;a.legendElm.unbind().bind("mouseover.rtqChart",function(f){var h=$(f.target);if(f.target.tagName.toUpperCase()=="SPAN"||h.hasClass("rtc-legend")){var g=h.closest(".rtc-legend");if(g.attr("name")!="MReturnIndex"){g.find(".rtc-legend-remove").removeClass("rtc-remove-hide")}}}).bind("mouseout.rtqChart",function(f){a.legendElm.find(".rtc-legend-remove").toggleClass("rtc-remove-hide",true)}).bind("click.rtqChart",function(g){var l=$(g.target),f=l.data("type");if(g.target.tagName.toUpperCase()=="SPAN"&&l.hasClass("rtc-legend-remove")){var k=$(g.target).closest(".rtc-legend");b.legendOnClick(k)}else{if(f=="ct"){a.legendElm.find(".rtc-legend-bold").removeClass("rtc-legend-bold");l.addClass("rtc-legend-bold");var j=l.parent();if(j&&j.attr("name")){var m=b.mainTicker;for(var h=0;h<b.compairTickers.length;h++){if(b.compairTickers[h]==j.attr("name")){b.compairTickers[h]=b.mainTicker;b.mainTicker="";b.acceptTicker(j.attr("name"));break}}}}}});var d=$("#"+this.autoBoxID);if(d.length>0){if(typeof(GB_qsAutoCompleteBox)=="object"){GB_qsAutoCompleteBox.subscription(this.autoBoxID,function(e){b.validateCompairTicker(e)},{needClear:true})}if(this.UIConfig.chartCtrl!="default"){d.css({color:"#DFDFDF"})}d.val(QSLGTXT.entersecurity||"Enter Security").click(function(){b.clearBox(this)});if(a.addCompairBtElm!=null){a.addCompairBtElm.unbind("click").click(function(){var e=$("#"+b.autoBoxID).attr("value");GB_qsAutoCompleteBox.triggerACB(b.autoBoxID)})}}this.outObj.find(".rtc-menu-trigger").unbind("click").click(function(){if(b.mainTicker!=""&&b.mainTicker!=null){b.menuButtonClicked(this)}});if(this.UIConfig.chartCtrl=="rtqPanel"){c.$settingPanel.find(".rtc-menu-trigger").unbind("click").click(function(){if(b.mainTicker!=""&&b.mainTicker!=null){b.menuButtonClicked(this)}})}this.attachMouseScoll();this.attachZoomIn()},clearBox:function(a){if(a==null){return}var b=$(a).val();if(b.substring(0,4)=="Line"||b=="Enter Security"){$(a).val("")}if(this.UIConfig.chartCtrl=="rtqPanel"){$(a).css("color","#DFDFDF")}},getPChartData:function(d){var f=this;this.pChartReady=false;var g=[],h=this.compairTickers.length>0?"return":"price";if(this.chartStyle=="growth"||this.chartStyle=="growth10"){h="return"}if(this.chartStyle=="growth10"){h+="_k"}var l={symbol:this.mainTicker,datapoints:{p:h,indicators:[]}};if(this.chartStyle=="postTax"){l={symbol:this.mainTicker,datapoints:{postTax:"return",indicators:[]}}}if(this._frequencyIndexMap[this.frequency]>0){if(this.events.dividend){l.datapoints.ds={isD:this.events.dividend}}}if(this.chartStyle=="growth10"){g.push(l);if(this.chartStyle=="growth10"){if(this.compairTickers.length){for(var b=0;b<this.compairTickers.length;b++){g.push({symbol:this.compairTickers[b],datapoints:{p:h}})}}}}else{for(var e in this.indicatorsData){if(this.indicatorsData[e].type==0){if(e=="EMA"||e=="SMA"){for(var c=0;c<this.indicatorsData[e].num.length;c++){if(this.indicatorsData[e].num[c]!=null){l.datapoints.indicators.push({name:e,p:[this.indicatorsData[e].num[c]],vtype:h})}}}else{if(this.indicatorsData[e].show){l.datapoints.indicators.push({name:e,p:this.indicatorsData[e].parameter,vtype:h})}}}}g.push(l);if(this.compairTickers.length){for(var b=0;b<this.compairTickers.length;b++){g.push({symbol:this.compairTickers[b],datapoints:{p:h}})}}}var a=RTQ_ChartUtil.toDateIndex(this.startDate);var k=RTQ_ChartUtil.toDateIndex(this.endDate);if(this.UIConfig.chartCtrl=="rtqPanel"&&(typeof(this.showLoading)=="function")){this.showLoading()}if(this._frequencyIndexMap[this.frequency]>0){GB_ChartDataManager.getHistoricalData(g,this._frequencyMap[this.frequency],a,k,function(i){f.pChartDataReady(i,d)})}else{GB_ChartDataManager.getIntradayData(g,this._frequencyMap[this.frequency],a,k,function(i){f.pChartDataReady(i,d)})}},getSilderChartData:function(){var c=5,d=this.miniChartFrequency,e=null,f=null,b=this;if(this.miniChartFrequency=="minute"){c=1,d="d";e=RTQ_ChartUtil.toDateIndex(this.sDates.lMin),f=RTQ_ChartUtil.toDateIndex(this.slider_EndDate)}var a=[{symbol:this.mainTicker,dx:c,datapoints:{p:"price"}}];GB_ChartDataManager.getHistoricalData(a,d,e,f,function(g){b.sliderChartDataReady(g)})},getIChartData:function(d){var e=this.chartData,c=this;if(this.iChartData[d]||d=="FairValue"||d=="MReturnIndex"){var b;var a=RTQ_ChartUtil.toDateIndex(this.startDate);var g=RTQ_ChartUtil.toDateIndex(this.endDate);if(this.indicatorsData[d]||d=="RDividend"||d=="DYield"){var f=d=="RDividend"||d=="DYield"?[]:this.indicatorsData[d].parameter;b=[{symbol:this.mainTicker,datapoints:{indicators:[{name:d,p:f,vtype:"price"}]}}];if(this._frequencyIndexMap[this.frequency]>0){GB_ChartDataManager.getHistoricalData(b,this._frequencyMap[this.frequency],a,g,function(h){c.iChartDataReady(h)})}else{if(this.zoomRange<3){b[0].days=this.zoomRange==1?1:5}GB_ChartDataManager.getIntradayData(b,this._frequencyMap[this.frequency],a,g,function(h){c.iChartDataReady(h)})}}}},drawPChart:function(){var q=this.chartData,t=this,r=this._contains,e=this._elements;if(q.DataList==null||q.DataList.length<1){return}this.mouseOutChart();var n=q.DataList[0].data,k=n?n.length:0;var u=false,j=null;if(this._frequencyIndexMap[this.frequency]<=0&&k>0){u=RTQ_ChartUtil.compareDateByday(new Date(n[k-1][n[k-1].length-1]),new Date(n[0][n[0].length-1]))}if(this.zoomRange>2&&!u){this.ticksize=null,this.Ticks=this.getTicks(q.DataList[0].data,this.frequency);this._isIntradayTimSyle=false}else{this.Ticks=null;if(this.zoomRange==1||u){this._isIntradayTimSyle=true}else{this._isIntradayTimSyle=false}if(this.zoomInMode==1){this.ticksize=Math.round(k/4)}else{this.ticksize=(this.zoomRange==1||(u&&this.zoomRange==11))?60/this._frequencyMap[this.frequency]:Math.ceil(q.DataList[0].data.length/(this.zoomRange==0?3:5))}this.xLabelAlign=(this.zoomRange==1||(u&&this.zoomRange==11)?"left":"center")}if(this.pFlot==null){this.pFlot=new mstar.flot(r.pChartContainer,this.getChartOption("priceLine"));this.pFlot.setOption({imageHighlight:this.chartCursor==0});r.pChartContainer.unbind("plothover").bind("plothover",function(w,i,v){t.buildLegend(v,i,false,false)});r.pChartContainer.unbind("mouseout").bind("mouseout",function(i){var v=i.relatedTarget?i.relatedTarget.nodeName.toLowerCase():"";if(Util.contains(r.pChartContainer[0],i.relatedTarget)){return false}else{if(t.timeout){clearTimeout(t.timeout)}t.chartMouseOut()}});r.pChartContainer.unbind("mouseover").bind("mouseover",function(){if(t.timeout){clearTimeout(t.timeout)}t.chartOffset=r.pChartContainer.offset();e.lineXElm.css({width:t.chartWidth});e.lineYElm.css({height:r.pChartContainer.height()})});this.pFlot.drawObj.beforeRemoveDrawing=function(v,i){GB_ChartDataManager.quoteDataMap[t.mainTicker].removeDrawing(v,i)};this.pFlot.drawObj.onDrawingUpdated=function(v,i){GB_ChartDataManager.quoteDataMap[t.mainTicker].updateDrawing(v,i)};r.pChartContainer.unbind("drawEnd").bind("drawEnd",function(v,w){if(typeof(e.$drawBlock)!="undefined"&&e.$drawBlock!=null&&e.$drawBlock.length){e.$drawBlock.find("[value='"+w+"']").removeClass("draw-row-select")}var i=t.pFlot.drawObj.getLastDrawing(w);if(i!=null){GB_ChartDataManager.quoteDataMap[t.mainTicker].saveLastDrawing(w,i)}t.isDrawing=false;if(t.chartCursor==1){e.crosshairLegendWin.show()}if(typeof(t.afterDrawEnd)=="function"){t.afterDrawEnd(w)}})}var p=[];var b=1,l;for(var d=0;d<q.DataList.length;d++){b=d==0?2:1;l=q.DataList[d].colorIndex==null?d:q.DataList[d].colorIndex;var o="line";if(d==0){var f=this.chartStyle;j=q.DataList[d].startPos;o=f=="mountain"||f=="growth"||f=="growth10"||f=="dEffect"||f=="postTax"?"mountain":this.chartStyle}p.push(this.getChartData(q.DataList[d].data,o,1,l,b))}if(this.zoomRange>2&&this._frequencyIndexMap[this.frequency]>0&&(this.events.dividend||this.events.splits||this.events.earnings)&&q.eventDataList!=null&&q.eventDataList.length>0){p.push(this.getChartData(q.eventDataList,"img",1,null))}var g=this.chartStyle;var a=(this.scaleType=="1"&&(this.compairTickers.length>0||g=="growth"||g=="dEffect"))?0:parseInt(this.scaleType,10);var h=true,m=g=="growth10"?"k":"";if(g=="mountain"||g=="line"||g=="dot"||g=="ab"||g=="growth"||g=="growth10"||g=="dEffect"){var c=(g=="growth"||g=="growth10"||g=="dEffect")?"mountain":g;this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},lines:{lineType:c},yaxis:{scaleType:a},drawingAble:h})}else{if(this.chartStyle=="ohlc"||this.chartStyle=="hlc"){this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},OLHC:{olhcType:this.chartStyle},yaxis:{scaleType:a},drawingAble:h})}else{this.pFlot.setOption({xaxis:{tickSize:this.ticksize,ticks:this.Ticks,textAlign:this.xLabelAlign},yaxis:{scaleType:a},drawingAble:h})}}this.pFlot.setOption({yaxis:{align:this.yaxisAlign,unit:m},otherInfo:{ticker:this.mainTicker}});this.pFlot.init(p);if(p&&p.length&&p[0].data.length){var s="price";if(this.compairTickers.length){s="return"}else{if(g=="growth"||g=="dEffect"){s="return"}}if(g=="growth10"){s="return10"}this.pFlot.setChartTypeForDrawings(s,j);this._loadDrawings(p[0].data,function(i){if(t.pFlot.drawObj){t.pFlot.drawObj.setDrawings(i);t.pFlot._triggerRedrawOverlay()}})}this.pChartReady=true},changeFrequencyStyle:function(c){var b=this.uiComponents,a=this._elements,e,d;if(c==1||c==2||c==0){e="minute";if(this._frequencyIndexMap[this.frequency]>0){this.frequency=e}d="minute"}else{e=this.calculateFrequency(this.startDate);d=e}this.changeFrequency(e);if(this.UIConfig.customFrequency==1&&this.defaultFrequencyMap[c]){this.frequency=this.defaultFrequencyMap[c]}if(b.rightMenu!=null){b.rightMenu.changeUIState(c,"zoom",true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(c,null,true);a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(this.zoomListData[this._zoomIndexMap[c]].txt+" | "+this._frequencyTxtMap[this.frequency])}if(this._frequencyIndexMap[d]>0&&d!=this.miniChartFrequency){this.miniChartFrequency=d;this.getSilderChartData()}else{if(this._frequencyIndexMap[d]<=0&&this.miniChartFrequency!="minute"){this.miniChartFrequency="minute";this.getSilderChartData()}else{this.setSliderHandleValues()}}},changeFrequency:function(a){if(this._frequencyIndexMap[a]>this._frequencyIndexMap[this.frequency]){this.frequency=a}else{if((this.zoomRange==13||this.zoomRange==3)&&this._frequencyIndexMap[this.frequency]>1){this.frequency="d"}else{if((this.zoomRange==14||this.zoomRange==4)&&this._frequencyIndexMap[this.frequency]>2){this.frequency="w"}else{if(this.zoomRange==11){if((a=="minute"&&this._frequencyIndexMap[this.frequency]>=this._frequencyIndexMap.d)){this.frequency=a}else{if(a=="minute5"&&this._frequencyIndexMap[this.frequency]>=this._frequencyIndexMap.w){this.frequency="d"}else{if(a=="minute10"&&this._frequencyIndexMap[this.frequency]>=this._frequencyIndexMap.m){this.frequency="w"}else{if(a=="minute10"&&this.frequency=="minute15"){this.frequency="minute30"}}}}}}}}if(this.UIConfig.pCtrl1==null||!this.UIConfig.pCtrl1.showFrequency){this.frequency=a}this.bindFrequencyMenu(this.frequency)},bindFrequencyMenu:function(e){var c=this._frequencyIndexMap[e],b=this.uiComponents,a=this._elements;if(c!=this.selectFreIndex){if(b.ddlFrequency!=null){if(c<=-4||this.zoomRange<3){b.ddlFrequency.rebindData(this.intradayFreMenuData)}else{if(c<=-3){b.ddlFrequency.rebindData(this.sMinuteFreMenuData)}else{if(c<=0){b.ddlFrequency.rebindData(this.lMinuteFreMenuData)}else{if(c==1){b.ddlFrequency.rebindData(this.dailyFreMenuData)}else{if(c==2){b.ddlFrequency.rebindData(this.weeklyFreMenuData)}else{if(c==3){b.ddlFrequency.rebindData(this.monthlyFreMenuData)}}}}}}}this.selectFreIndex=c}if(b.ddlFrequency!=null){b.ddlFrequency.setTextValue("",this.frequency);if(b.rightMenu!=null){b.rightMenu.changeUIState(this.frequency,this.zoomRange,true)}if(b.tabZoomMenu!=null){b.tabZoomMenu.changeUIState(this.frequency,this.zoomRange,true);var d=this.zoomListData[this._zoomIndexMap[this.zoomRange]].txt+" | "+this._frequencyTxtMap[this.frequency];a.tabmenuZoomEl.find(".rtq-ddl-ipt").html(d)}}},calculateFrequency:function(b){var d="minute",c=this._calFrequencyByRange(),a=this.startDate;if(a>=this.sDates.iMin||(c<=5&&this.startDate>=this.sDates.lMin)){d="minute"}else{if(a>=this.sDates.sMin||(c<30&&a>=this.sDates.lMin)){d="minute5"}else{if(a>=this.sDates.lMin){d="minute10"}else{if(a>=this.sDates.d){d="d"}else{if(a>=this.sDates.w){d="w"}else{d="m"}}}}}return d},_calFrequencyByRange:function(){var a=(this.endDate.getTime()-this.startDate.getTime())/86400000;return a},_upMiniFrequency:function(){var a;if(this.miniChartFrequency=="d"){a="m"}else{a="m"}return a},drawSliderChart:function(){var a=this._contains;if(a.mChartContainer==null){return false}if(this.mFlot==null){this.mFlot=new mstar.flot(a.mChartContainer,this.getChartOption("miniChart"))}var b=this.chartData.MiniChartData.length?this.getTicks(this.chartData.MiniChartData[0],"d"):[];this.mFlot.setOption({xaxis:{tickSize:null,ticks:b}});this.mFlot.init(this.chartData.MiniChartData)},exportDataToExcel:function(){if(this.mainTicker==""||this.mainTicker==null){return}var c=[this.mainTicker],b=RTQ_ChartUtil.formatDate(this.startDate),a=RTQ_ChartUtil.formatDate(this.endDate);if(this.compairTickers.length){c=c.concat(this.compairTickers)}if(this._frequencyIndexMap[this.frequency]<1){ty=3}else{ty=5}GB_ChartDataManager.exportDataToExcel(c,ty,b,a,this._frequencyMap[this.frequency],null)},fileMenuCallback:function(a){if(a=="export"){this.exportDataToExcel()}},refreshIntradayChart:function(a){if(this.zoomRange<3||(this.frequency=="d"&&RTQ_ChartUtil.compareDateByday(this.endDate,this.latestTradeDate))){if(a=="p"){this.getPChartData();for(var b in this.indicatorsData){if(this.indicatorsData[b].type==1&&this.indicatorsData[b].show){this.getIChartData(b)}}}else{if(a=="v"){this.getVChartData()}}}},refreshLastTradeDate:function(){}});if(typeof(mstar)=="undefined"){var mstar={}}mstar.flotUtil={floorInBase:function(a,b){return b*Math.floor(a/b)},colorToRGB:function(a,d){var b=this.colorType(a);if(arguments.length>1){return"rgba("+b.r+","+b.g+","+b.b+","+d+")"}else{if(b.t=="rgba"){return"rgba("+b.r+","+b.g+","+b.b+","+b.a+")"}else{return"rgb("+b.r+","+b.g+","+b.b+")"}}},colorType:function(a){var c={t:"rgb",r:255,g:255,b:255,a:1},b="";if(b=/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/.exec(a)){c={t:"h6",r:parseInt(b[1],16),g:parseInt(b[2],16),b:parseInt(b[3],16),a:1}}else{if(b=/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/.exec(a)){c={t:"h3",r:parseInt(b[1]+b[1],16),g:parseInt(b[2]+b[2],16),b:parseInt(b[3]+b[3],16),a:1}}else{if(b=/rgb\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*\)/.exec(a)){c={t:"rgb",r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10),a:1}}else{if(b=/rgba\(\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]{1,3})\s*,\s*([0-9]+(?:\.[0-9]+)?)\s*\)/.exec(a)){c={t:"rgba",r:parseInt(b[1],10),g:parseInt(b[2],10),b:parseInt(b[3],10),a:parseFloat(b[4])}}}}}return c},colorRange:function(a){return a<0?0:(a>255?255:a)},avoidSelect:function(){if(!$.browser.msie||$.browser.msie&&parseInt($.browser.version)!=8){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty()}}};mstar.flot=function(b,a){this.options={colors:["#728fb2","#9b0033","#e96610","#f1ad02","#9faa00","#006065","#809aba","#e1b2c1","#e2e5b2","#293f6f","#fbe6b3","#f2a370","#b2cfd0","#bec5d4","#c5cc66","#f8d1b7","#c36685","#c9cbcb","#ff7f27"],xaxis:{mode:null,min:null,max:null,autoscaleMargin:null,ticks:null,tickFormatter:null,labelWidth:null,labelHeight:null,showLabel:true,tickDecimals:null,tickSize:null,minTickSize:null,monthNames:null,timeformat:null,posStyle:null,textAlign:"left"},yaxis:{autoscaleMargin:0.02,showLabel:true,scaleType:0,align:"right",labelFormatter:null,showLastLabel:false,minTopLine:NaN,minBottomLine:NaN},x2axis:{autoscaleMargin:null,showLabel:true},y2axis:{autoscaleMargin:0.02,showLabel:false},points:{show:false,radius:1.5,lineWidth:2,fill:false,fillColor:"#ffffff"},lines:{show:false,lineWidth:2,fill:true,fillColor:"#4A596A",lineType:"mountain",dot:{radius:2,fill:true,color:"#728fb2"},ab:{showBorder:true,aColor:"#65A125",bColor:"#CA3239",mColor:"#fff",midLineValue:NaN,bHasCloseLine:true}},bars:{show:false,outLine:false,lineWidth:2,barWidth:1,minBarWidth:2,maxBarWidth:16,upColor:"#008000",downColor:"#ff0000",fill:true,fillColor:null,align:"left"},OLHC:{show:false,lineWidth:2,fill:false,fillColor:null,maxBarWidth:10,minBarWidth:2,barWidth:null,highLightColor:"#ff0000",olhcType:"ohlc"},candleStick:{show:false,lineWidth:1,fill:true,upColor:"#008000",downColor:"#ff0000",maxCandleWidth:16,minCandleWidth:2,candleWidth:null,highLightColor:"#2f4880"},volumeByPrice:{show:false,fillColor:"#999d9c",highlightColor:"#508a88",opacity:0.5},imagePoints:{show:false,imageObj:null},points:{show:false,radius:1.5,lineWidth:2,fill:false,fillColor:"#ffffff"},grid:{color:"#545454",backgroundColor:null,tickColor:"#dddddd",labelMargin:6,borderWidth:0.5,markings:null,markingsColor:"#f4f4f4",markingsLineWidth:1,clickable:false,hoverable:false,autoHighlight:true,mouseActiveRadius:10,bottomColor:"#666666",_borderColor:"#fff"},showGridLines:true,higlightIndex:0,drawingAble:true,imageHighlight:true};this.text={mini_chart_no_data:"Data not available"};this.drawObj=null;this.series=[];this.canvas=null;this.overlay=null;this.eventHolder=null;this.ctx=null;this.octx=null;this.target=typeof(b)=="string"?$("#"+b):b;this.axes={xaxis:{},yaxis:{},x2axis:{},y2axis:{}};this.plotOffset={left:0,right:0,top:0,bottom:0};this.canvasWidth=0;this.canvasHeight=0;this.plotWidth=0;this.plotHeight=0;this.lastMousePos={pageX:null,pageY:null};this.highlights=[];this.redrawTimeout=null;this.hoverTimeout=null;this.volumeByPrice={show:false,series:{},area:[],highlights:[],hintDom:null,data:null,index:0,scale:0.4};this.__parseOptions(a);this.__constructCanvas();this.imgDataList=[];this._dataAvailable=false;this.drawObj=null;if(typeof(mstar.draw)!="undefined"){this.drawObj=new mstar.draw(null,null,this.target)}};mstar.flot.prototype={init:function(a){this.canvasWidth=this.target.width();this.canvasHeight=this.target.height();this.clearHighlights();this.imgDataList=[];if(!this._processData(a)){this._dataAvailable=false;this._removeDrawing();return}this._removeDrawing();this._dataAvailable=true;this._calculateAndMeasure();this._constructChart()},renderNote:function(a){this.drawObj.renderNote(this.series[0],a,this.target)},resizeCanvas:function(c,a){this.target.css({width:c+"px",height:a+"px"});var b=$.browser.msie;this.canvasWidth=c;this.canvasHeight=a;this.canvas.width=c;this.canvas.height=a;this.overlay.width=this.canvasWidth;this.overlay.height=this.canvasHeight;if(b&&parseInt($.browser.version)<9){this.canvas=window.G_vmlCanvasManager.initElement(this.canvas);this.overlay=window.G_vmlCanvasManager.initElement(this.overlay)}this.ctx=this.canvas.getContext("2d");this.octx=this.overlay.getContext("2d");this.eventHolder=$([this.canvas,this.overlay])},changeOutSize:function(b,a){this.resizeCanvas(b,a);if(!this._dataAvailable){return}this._calculateAndMeasure();this._constructChart();this._triggerRedrawOverlay()},setOption:function(a){if(a.xaxis&&a.xaxis.ticks!=null){this.options.xaxis.ticks=null}if(a.colors&&a.colors.length){this.options.colors=null}$.extend(true,this.options,a)},clearHighlights:function(){if(this.highlights!=null&&this.highlights.length>0){var a;for(var b=0;b<this.highlights.length;++b){a=this.highlights[b];if(a.auto){this._unhighlight(a.series,a.point)}}}},beginDrawing:function(a){for(var b in this.drawObj.getDrawTypes()){this.drawObj.setDrawType(b,false);if(a==b){this.drawObj.setDrawType(b,true)}}},cancelDrawing:function(a){for(var b in this.drawObj.getDrawTypes()){if(a==b){this.drawObj.setDrawType(b,false)}}},getDataPostion:function(a,b){return[this.axes.xaxis.p2c(a),this.axes.y2axis.p2c(b)]},__constructCanvas:function(){this.target.find("canvas").remove();this.target.css({position:"relative","float":"left"});this.canvasWidth=this.target.width();this.canvasHeight=this.target.height();this._clearTickLabels();if(this.canvasWidth<=0||this.canvasHeight<=0){throw"Invalid dimensions for plot, width = "+this.canvasWidth+", height = "+this.canvasHeight}if(this.canvas==null){this.__createCanvas()}this.__attachFlotEvent()},__createCanvas:function(){if(this.ctx==null&&this.canvas!=null){this._clearCanvas()}var a=$.browser.msie;if(a&&parseInt($.browser.version)<9){window.G_vmlCanvasManager.init_(document)}this.canvas=document.createElement("canvas");this.canvas.width=this.canvasWidth;this.canvas.height=this.canvasHeight;this.canvas.style["float"]="left";this.target.append(this.canvas);if(a&&parseInt($.browser.version)<9){this.canvas=window.G_vmlCanvasManager.initElement(this.canvas)}this.ctx=this.canvas.getContext("2d");this.overlay=document.createElement("canvas");this.overlay.width=this.canvasWidth;this.overlay.height=this.canvasHeight;this.overlay.style.position="absolute";this.overlay.style.left="0px";this.overlay.style.top="0px";this.target.append(this.overlay);if(a&&parseInt($.browser.version)<9){this.overlay=window.G_vmlCanvasManager.initElement(this.overlay)}this.octx=this.overlay.getContext("2d");this.eventHolder=$([this.canvas,this.overlay])},__parseOptions:function(a){this.options.xaxis.ticks=null;$.extend(true,this.options,a);if(this.options.xaxis.noTicks&&this.options.xaxis.ticks==null){this.options.xaxis.ticks=this.options.xaxis.noTicks}if(this.options.yaxis.noTicks&&this.options.yaxis.ticks==null){this.options.yaxis.ticks=this.options.yaxis.noTicks}},__attachFlotEvent:function(){var a=this;if(this.options.grid.hoverable){a.eventHolder.each(function(){$(this).bind("mousemove",function(b){a._onMouseMove.call(a,b)})});$(a.eventHolder).bind("mousedown",function(b){a._onMouseDown.call(a,b)})}if(this.options.grid.clickable){a.eventHolder.click(function(b){a._onClick.call(a,b)});a.eventHolder.dblclick(function(b){a._ondbClick.call(a,b)})}},_createLegend:function(e,a,b,c){var d='<div class="changeHintDiv rtq-chart-hover-hint" style="display: block; left: '+b+"px; top: "+c+'px;">';d+='<div class="wrap-img"><span class="arrow"></span>';d+='<span class="wrap-text-close"><span class="rtq-trendline-hinttext">'+e+"|"+a+"</span>";d+="</span></div></div>";return $(d).appendTo(this.target.find(".tickLabels"))},_removeDrawing:function(){if(!this.volumeByPrice.show&&this.volumeByPrice.hintDom!=null){this.volumeByPrice.hintDom.hide()}if(!this.options.drawingAble){if(this.drawObj){this.drawObj.clearDrawing(this.target)}}else{if(this.series[0].data!=undefined){if(this.drawObj){this.drawObj.clearDrawing(this.target)}}}this._triggerRedrawOverlay()},_clearTickLabels:function(){this.target.find(".tickLabels").html("")},_processData:function(a){this.series=this._parseData(a);if(this._checkData(this.series)){return false}this._parseOptionToSeries();this._calculateAxisExtreme();return true},_checkData:function(a){var f=false;if(a==null||a.length==0){f=true}else{for(var b=0;b<a.length;b++){if(a[b].data.length>0){break}if(b==a.length-1){f=true}}}var e=this.target.find(".flot-minichart");if(f){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight);this._clearTickLabels();if(e.length==0){var c="<div class='flot-minichart'>"+this.text.mini_chart_no_data+"</div>";this.target.append(c)}else{e.show()}}else{e.hide()}return f},_parseData:function(a){var e=[];for(var b=0;b<a.length;++b){var c;if(a[b].data){c={};for(var f in a[b]){c[f]=a[b][f]}}else{c={data:a[b]}}e.push(c)}return e},_parseOptionToSeries:function(){var a=0,b,c=this.options;for(i=0;i<this.series.length;++i){b=this.series[i];if(b.color==null){b.color=mstar.flotUtil.colorToRGB(this.options.colors[a++])}else{if(typeof b.color=="number"){b.color=mstar.flotUtil.colorToRGB(this.options.colors[b.color])}}b.lines=$.extend(true,{},c.lines,b.lines);b.points=$.extend(true,{},c.points,b.points);b.bars=$.extend(true,{},c.bars,b.bars);b.OLHC=$.extend(true,{},c.OLHC,b.OLHC);b.imagePoints=$.extend(true,{},c.imagePoints,b.imagePoints);b.candleStick=$.extend(true,{},c.candleStick,b.candleStick);b.volumeByPrice=$.extend(true,{},c.volumeByPrice,b.volumeByPrice);b.otherInfo=$.extend(true,{},c.otherInfo,b.otherInfo);if(b.xaxis&&b.xaxis==2){b.xaxis=this.axes.x2axis}else{b.xaxis=this.axes.xaxis}if(b.yaxis&&b.yaxis==2){b.yaxis=this.axes.y2axis}else{b.yaxis=$.extend(this.axes.yaxis,this.options.yaxis)}}},_calculateAxisExtreme:function(){var m=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY,c;for(c in this.axes){this.axes[c].datamin=m;this.axes[c].datamax=d;this.axes[c].used=false}var e,p,a,b=0,n=0;for(var h=0;h<this.series.length;++h){e=this.series[h].data,p=this.series[h].xaxis,a=this.series[h].yaxis;if((this.series[h].imagePoints&&this.series[h].imagePoints.show)||(this.series[h].volumeByPrice&&this.series[h].volumeByPrice.show)){continue}p.used=a.used=true;var o,l,k,f=false;if((this.series[h].OLHC.show||this.series[h].candleStick.show)){f=true}for(var g=0;g<e.length;++g){if(e[g]==null){continue}o=e[g][0],l=f?e[g][2]:e[g][1],k=f?e[g][3]:e[g][1];if(o!=null&&!isNaN(o=+o)){if(o+b<p.datamin){p.datamin=o+b}if(o+n>p.datamax){p.datamax=o+n}}if(k!=null&&k<a.datamin&&!isNaN(k)){a.datamin=k}if(l!=null&&l>a.datamax&&!isNaN(l)){a.datamax=l}}}for(c in this.axes){if(this.axes[c].datamin==m){this.axes[c].datamin=0}if(this.axes[c].datamax==d){this.axes[c].datamax=1}}},_calculateAndMeasure:function(){var c,b;for(var a in this.axes){c=this.axes[a],b=this.options[a];this._calculateAxisRange(c,b);this._prepareTickGeneration(c,b);this._generateTicks(c,b);this._calculateP2CC2P(c,b,c)}this._calculateSpacing()},_calculateP2CC2P:function(b,a){if(b==this.axes.xaxis||b==this.axes.x2axis){b.p2c=function(c){return(c-b.min)*b.scale};b.c2p=function(d){return b.min+d/b.scale}}else{if(b.scaleType==1){b.p2c=function(c){return((Math.log(b.max)-Math.log(c+b.dx))*b.scale)};b.c2p=function(d){return Math.exp(Math.log(b.max)-d/b.scale)-b.dx}}else{b.p2c=function(c){return(b.max-c)*b.scale};b.c2p=function(d){return b.max-d/b.scale}}}},_calculateAxisRange:function(f,a){var d=a.min!=null?a.min:f.datamin;var c=a.max!=null?a.max:f.datamax;if(a.posStyle){f.posStyle=a.posStyle}if(c-d==0){var e;if(c==0){e=1}else{e=0.01}d-=e;c+=e}else{var b=a.autoscaleMargin;if(b!=null){if(a.min==null){d-=(c-d)*b;if(d<0&&f.datamin>=0){d=0}}if(a.max==null){c+=(c-d)*b;if(c>0&&f.datamax<=0){c=0}}}}if(!isNaN(a.minBottomLine)){d=Math.min(d,a.minBottomLine)}if(!isNaN(a.minTopLine)){c=Math.max(c,a.minTopLine)}f.min=d;f.max=c;if(f.scaleType==1){f.dx=0;if(f.min<1){f.dx=1-f.min;f.min=1;f.max=f.max+f.dx}}},_generateTicks:function(a,d){a.ticks=[];if(!a.used){return}if(d.showLabel){a.showLabel=d.showLabel}if(d.ticks==null){a.ticks=a.tickGenerator(a)}else{if(typeof d.ticks=="number"){if(d.ticks>0){a.ticks=a.tickGenerator(a)}}else{if(d.ticks){var h=d.ticks;if($.isFunction(h)){h=h({min:a.min,max:a.max})}var e,b;for(e=0;e<h.length;++e){var f=null;var c=h[e];if(typeof c=="object"){b=c[0];if(c.length>1){f=c[1]}}else{b=c}if(f==null){f=a.tickFormatter(b,a)}a.ticks[e]={v:b,label:f}}}}}if(d.autoscaleMargin!=null&&a.ticks.length>0){if(d.min==null){if(a.scaleType!=1||a.ticks[0].v>0){a.min=Math.min(a.min,a.ticks[0].v)}}if(d.max==null&&a.ticks.length>1){var g=0;if(a.ticks.length>1){g=a.tickSize/2;a.max=Math.max(a.max,a.ticks[a.ticks.length-1].v-g)}else{a.max=Math.min(a.max,a.ticks[a.ticks.length-1].v)}}}},_calculateSpacing:function(){var c=this.options.grid,a=this.axes;var b=c.borderWidth/2;for(i=0;i<this.series.length;++i){if(typeof(this.series[i].points)!="undefined"){b=Math.max(b,2*(this.series[i].points.radius+this.series[i].points.lineWidth/2))}}this.plotOffset.left=this.plotOffset.right=this.plotOffset.top=this.plotOffset.bottom=2;if(a.xaxis.showLabel&&a.xaxis.labelHeight>0&&!a.xaxis.posStyle&&!a.xaxis.posStyle!="inner"){this.plotOffset.bottom=Math.max(0,a.xaxis.labelHeight+2*c.labelMargin)}if(a.yaxis.showLabel&&a.yaxis.labelWidth>0){this.plotOffset.left=Math.max(b,a.yaxis.labelWidth+c.labelMargin)}if(a.x2axis.showLabel&&a.x2axis.labelHeight>0){this.plotOffset.top=Math.max(0,a.x2axis.labelHeight+c.labelMargin)}if(a.y2axis.showLabel&&a.y2axis.labelWidth>0){this.plotOffset.right=Math.max(b,a.y2axis.labelWidth+c.labelMargin)}this.plotWidth=this.canvasWidth-this.plotOffset.left-this.plotOffset.right;this.plotHeight=this.canvasHeight-this.plotOffset.bottom-this.plotOffset.top;if(this.options.yaxis.align=="right"){this.plotOffset.left=0}a.xaxis.scale=parseFloat((this.plotWidth/(a.xaxis.max-a.xaxis.min)).toFixed(5));if(a.yaxis.scaleType==1){a.yaxis.scale=parseFloat(this.plotHeight/(Math.log(a.yaxis.max)-Math.log(a.yaxis.min+a.yaxis.dx)))}else{a.yaxis.scale=parseFloat((this.plotHeight/(a.yaxis.max-a.yaxis.min)).toFixed(5))}a.x2axis.scale=this.plotWidth/(a.x2axis.max-a.x2axis.min);a.y2axis.scale=this.plotHeight/(a.y2axis.max-a.y2axis.min)},_prepareTickGeneration:function(a,b){var c;if(typeof b.ticks=="number"&&b.ticks>0){c=b.ticks}else{if(a==this.axes.xaxis||a==this.axes.x2axis){c=this.canvasWidth/100}else{c=this.canvasHeight/60}}var l=(a.max-a.min)/c;var f,h,n,m,g,j,k;if(b.mode=="time"){}else{var d=b.tickDecimals;var e=-Math.floor(Math.log(l)/Math.LN10);if(d!=null&&e>d){e=d}j=Math.pow(10,-e);k=l/j;if(k<1.5){f=1}else{if(k<3){f=2;if(k>2.25&&(d==null||e+1<=d)){f=2.5;++e}}else{if(k<7.5){f=5}else{f=10}}}f*=j;if(b.minTickSize!=null&&f<b.minTickSize){f=b.minTickSize}if(b.tickSize!=null){f=b.tickSize}a.tickDecimals=Math.max(0,(d!=null)?d:e);h=function(u){var t=[];var r=(u.scaleType==1&&u.dx)?u.dx:0;var o=mstar.flotUtil.floorInBase(u.min,u.tickSize),p=0,s=Number.NaN,q;do{q=s;s=o+p*u.tickSize-r;t.push({v:s,label:u.tickFormatter(s,u)+""});++p}while(s<(u.max-r)&&s!=q);return t};m=function(o,r){if(o>1000&&r.unit=="k"){var p=typeof(QS_Lang.Chart.txt)=="undefined"?" k":(" "+QS_Lang.Chart.txt.shortKilo);return(typeof(QS_NumFmt)=="undefined"?(o/1000).toFixed(2):QS_NumFmt.Fmt2(o/1000,true,"",2))+p}var q=r.unit=="%"?(" "+r.unit):"";return typeof(QS_NumFmt)!="undefined"?QS_NumFmt.Fmt2(o,true," ",r.tickDecimals)+q:o.toFixed(r.tickDecimals)+q}}a.tickSize=n?[f,n]:f;a.tickGenerator=h;if($.isFunction(b.tickFormatter)){a.tickFormatter=function(o,p){return""+b.tickFormatter(o,p)}}else{a.tickFormatter=m}if(b.labelWidth!=null){a.labelWidth=b.labelWidth}if(b.labelHeight!=null){a.labelHeight=b.labelHeight}},_getAxisLabelHtml:function(f){var a,c,k,j="",e=this.plotOffset;if(f=="xaxis"){a=this.axes.xaxis;c=this.plotOffset.top+this.plotHeight+this.options.grid.labelMargin;if(a.showLabel){var d,g;for(var h=0;h<a.ticks.length;++h){k=a.ticks[h],d=k.s,txt=k.label+"";if(!k.label||k.v<a.min||k.v>a.max){continue}if(!k.on||(h==0&&(txt.length*7+4)>k.w)||(h==a.ticks.length-1&&(txt.length*7+4)>k.w)){continue}if(k.label!=null&&typeof(k.label)=="string"){g=k.label.replace(":","").replace(".","");g.length>4?g=g.substr(0,4):g}j+='<div style="position:absolute;text-align:'+(this.axes.xaxis.alternate?"left":this.options.xaxis.textAlign)+"; top:"+(a.posStyle&&a.posStyle=="inner"?(c-23):c)+"px;left:"+(e.left+d)+"px;width:"+k.w+'px;" class="tickLabel tickLabel-x x'+g+'">'+k.label+"</div>"}}}else{if(f=="yaxis"){a=this.axes.yaxis;if(a.showLabel){for(var h=0;h<a.ticks.length;++h){k=a.ticks[h];if(!k.label||k.v>a.max){continue}var b=(e.top+a.p2c(k.v)-a.labelHeight-4);if(b<=-2){b=0}else{if((b+a.labelHeight)>this.plotHeight){continue}}j+='<div style="position:absolute;top:'+b+"px;right:"+(e.right+((this.options.yaxis.align!="right")?this.plotWidth:0)+this.options.grid.labelMargin)+"px;width:"+a.labelWidth+'px;text-align:right" class="tickLabel">'+k.label+"</div>"}}}else{if(f=="x2axis"){a=this.axes.x2axis;if(a.showLabel){for(var h=0;h<a.ticks.length;++h){k=a.ticks[h];if(!k.label||k.v<a.min||k.v>a.max){continue}j+='<div style="position:absolute;bottom:'+(e.bottom+this.plotHeight+this.options.grid.labelMargin)+"px;left:"+(e.left+a.p2c(k.v)-a.labelWidth/2)+"px;width:"+a.labelWidth+'px;text-align:center" class="tickLabel">'+k.label+"</div>"}}}else{if(f=="y2axis"){a=this.axes.y2axis;if(a.showLabel){for(var h=0;h<a.ticks.length;++h){k=a.ticks[h];if(!k.label||k.v<a.min||k.v>a.max){continue}j+='<div style="position:absolute;top:'+(e.top+a.p2c(k.v)-a.labelHeight/2)+"px;left:"+(e.left+this.plotWidth+this.options.grid.labelMargin)+"px;width:"+a.labelWidth+'px;text-align:left" class="tickLabel">'+k.label+"</div>"}}}}}}return j},_insertAxisLabels:function(){var b=this.target.find(".tickLabels"),a="";if(b.length<1){this.target.append('<div class="tickLabels" style="color:'+this.options.grid.color+'"></div>')}else{b.html("")}a+=this._getAxisLabelHtml("xaxis");a+=this._getAxisLabelHtml("x2axis");a+=this._getAxisLabelHtml("yaxis");a+=this._getAxisLabelHtml("y2axis");this.target.find(".tickLabels").html(a);b=null;a=null},_drawGrid:function(){var d,c=this.ctx,n=this.plotOffset;c.save();c.clearRect(0,0,this.canvasWidth,this.canvasHeight);if(this.options.grid.borderWidth){this._setCanvasContext(c,{ss:this.options.grid.tickColor});c.beginPath();c.moveTo(0,c.lineWidth/2);c.lineTo(this.canvasWidth+c.lineWidth,c.lineWidth/2);if(this.options.yaxis.align=="right"){c.moveTo(((this.options.yaxis.align!="right")?n.left:this.plotWidth)+c.lineWidth/2,0);c.lineTo(((this.options.yaxis.align!="right")?n.left:this.plotWidth)+c.lineWidth/2,(this.axes.xaxis.showLabel?(this.canvasHeight-1):this.plotHeight+n.top))}c.stroke();c.strokeStyle=this.options.grid.bottomColor;c.beginPath();c.moveTo(this.canvasWidth+c.lineWidth,this.plotHeight+n.top+c.lineWidth/2);c.lineTo(0,this.plotHeight+n.top+c.lineWidth/2);if(this.axes.xaxis.showLabel&&this.axes.xaxis.posStyle!="inner"){c.moveTo(0,this.canvasHeight-c.lineWidth/2);c.lineTo(this.canvasWidth,this.canvasHeight-c.lineWidth/2)}c.stroke()}if(this.axes.xaxis.showLabel&&this.options.grid._borderColor!=null){c.beginPath();this._setCanvasContext(c,{ss:this.options.grid._borderColor});c.rect((this.options.yaxis.align=="right"?1:n.left),0,this.plotWidth,this.plotHeight+n.top);c.stroke()}c.translate(n.left,n.top);if(this.options.grid.backgroundColor){c.fillStyle=this.options.grid.backgroundColor;c.fillRect(0,0,this.plotWidth,this.plotHeight)}c.lineWidth=1;c.strokeStyle=this.options.grid.tickColor;c.beginPath();var g,k=this.axes.xaxis;var f=k.showLabel?(this.canvasHeight-3):this.plotHeight,s=0;var q=0,p=0,l=0;if(k.ticks.length>0){var j=Math.round(k.ticks.length/2);if(j>=k.ticks.length){j=k.ticks.length-1}l=(this.axes.xaxis.ticks[j].label+"").length*7+4}var h=Math.ceil(k.ticks.length/(this.plotWidth/l));this.axes.xaxis.alternate=false;var a=0,o=0,b=0,e=0;for(d=0;d<k.ticks.length;++d){g=k.ticks[d].v;this.axes.xaxis.ticks[d].on=false;if(isNaN(g)||k.ticks[d].label==""){continue}var s=Math.floor(k.p2c(g));if(a%h==0){this.axes.xaxis.ticks[d].s=s;this.axes.xaxis.ticks[d].on=true;if(o==0&&b==1){o=this.axes.xaxis.ticks[d].s-this.axes.xaxis.ticks[d-h].s;this.axes.xaxis.ticks[d-h].w=o}if(o!=0&&b==2){o=this.axes.xaxis.ticks[d].s-this.axes.xaxis.ticks[d-h].s;this.axes.xaxis.ticks[d-h].w=o}this.axes.xaxis.ticks[d].w=o;c.moveTo(s+c.lineWidth/2,-1);c.lineTo(s+c.lineWidth/2,f);b++;e=d}else{c.moveTo(s+c.lineWidth/2,-1);c.lineTo(s+c.lineWidth/2,this.plotHeight)}if(d==k.ticks.length-1){var r=this.axes.xaxis.ticks[e];var m=this.plotWidth-r.s;if(m<r.w){r.w=m}if(m<l){r.on=false}}a++;if(g<=k.min||g>=k.max){continue}}if(h>1){this.options.xaxis.textAlign="left"}k=this.axes.yaxis;for(d=0;d<k.ticks.length;++d){g=k.ticks[d].v;if(isNaN(g)||g<=k.min||g>=k.max){continue}c.moveTo(this.plotOffset.left*(-1),Math.floor(k.p2c(g))+c.lineWidth/2);c.lineTo(this.canvasWidth,Math.floor(k.p2c(g))+c.lineWidth/2)}k=this.axes.x2axis;for(d=0;d<k.ticks.length;++d){g=k.ticks[d].v;if(g<=k.min||g>=k.max){continue}c.moveTo(Math.floor(k.p2c(g))+c.lineWidth/2,-5);c.lineTo(Math.floor(k.p2c(g))+c.lineWidth/2,5)}k=this.axes.y2axis;for(d=0;d<k.ticks.length;++d){g=k.ticks[d].v;if(g<=k.min||g>=k.max){continue}c.moveTo(this.plotWidth-5,Math.floor(k.p2c(g))+c.lineWidth/2);c.lineTo(this.plotWidth+5,Math.floor(k.p2c(g))+c.lineWidth/2)}if(!this.options.showGridLines){return}c.stroke();c.restore()},_setFillStyle:function(a,b){if(!a.fill){return}if(typeof(a.fillColor)!="undefined"&&a.fillColor!=null){this.ctx.fillStyle=mstar.flotUtil.colorToRGB(a.fillColor,typeof(QS_Style)=="undefined"?0.7:QS_Style.flot.alpha)}else{this.ctx.fillStyle=mstar.flotUtil.colorToRGB(b,typeof(QS_Style)=="undefined"?0.7:QS_Style.flot.alpha)}},_getDx:function(a){if(this.plotWidth<=0){dx=1}else{dx=Math.ceil(a/this.plotWidth)}return dx},_plotLine:function(f,d,p,a){var k,b=null,l=null,e=null;var n=f.length;var o=this._getDx(n);var m,c,g,h;this.ctx.beginPath();for(var j=0;j<n;j+=o){k=b;if(f[j]!=null&&!isNaN(f[j][1])){b=f[j]}else{continue}if(b==null){continue}if(k!=null){m=k[0],c=k[1]}g=b[0],h=b[1];l=p.p2c(g);e=a.p2c(h)+d;if(!isNaN(l)){if(k==null){this.ctx.moveTo(l,e)}else{this.ctx.lineTo(l,e)}}}this.ctx.stroke()},_plotDot:function(f,d,q,a,p){var k,b=null,l=null,e=null;var n=f.length;var o=this._getDx(n);var m,c,g,h;this.ctx.beginPath();this._setCanvasContext(this.ctx,{ss:p.color,fs:p.color});for(var j=0;j<n;j+=o){k=b;if(f[j]!=null&&!isNaN(f[j][1])){b=f[j]}else{continue}if(b==null){continue}g=b[0],h=b[1];l=q.p2c(g);e=a.p2c(h)+d;if(!isNaN(l)){this.ctx.moveTo(l,e);this.ctx.arc(l,e,p.radius,0,2*Math.PI,true)}}if(p.fill){this.ctx.fill()}else{this.ctx.stroke()}this.ctx.restore()},_plotAboveBelow:function(w,t,B,a,f){if(!isNaN(f.midLineValue)){w.unshift([w[0][0],f.midLineValue])}var u,o=null,p=null,h=null;var x=w.length;var j=this._getDx(x);var v,e,z,A;var l=[],m=0;var c=[],y=[],q=0;var n=0,s=0;for(var g=0;g<x;g+=j){u=o;if(w[g]!=null&&!isNaN(w[g][1])){o=w[g]}else{continue}if(o==null){continue}if(u!=null){v=u[0],e=u[1]}z=o[0],A=o[1];p=B.p2c(z);h=a.p2c(A)+t;if(!isNaN(p)){if(u==null){l[0]=[p,h]}else{l[m]=[p,h];if(q==0){if(h<l[0][1]){c.push([l[0][0],l[0][1]]);c.push([l[m][0],l[m][1]]);q=1}else{if(h>l[0][1]){y.push([l[0][0],l[0][1]]);y.push([l[m][0],l[m][1]]);q=-1}else{c.push([l[0][0],l[0][1]]);y.push([l[0][0],l[0][1]]);c.push([l[m][0],l[m][1]]);y.push([l[m][0],l[m][1]]);q=0}}}else{if(h<l[0][1]&&q==1){c.push([l[m][0],l[m][1]]);q=1}else{if(h>l[0][1]&&q==-1){y.push([l[m][0],l[m][1]]);q=-1}else{if(h==l[0][1]){c.push([l[m][0],l[m][1]]);y.push([l[m][0],l[m][1]])}else{n=(h-l[m-1][1])/(p-l[m-1][0]);s=(l[m-1][0]*h-p*l[m-1][1])/(l[m-1][0]-p);var d=(l[0][1]-s)/n;c.push([d,l[0][1]]);y.push([d,l[0][1]]);if(q==-1){c.push([l[m][0],l[m][1]])}else{y.push([l[m][0],l[m][1]])}q=-q}}}}}m++}}c.push([l[l.length-1][0],l[0][1]]);y.push([l[l.length-1][0],l[0][1]]);var r=0;if(!f.bHasCloseLine){r=1}this.ctx.beginPath();this.ctx.strokeStyle=mstar.flotUtil.colorToRGB(f.aColor);for(var g=r;g<c.length-r;g++){if(g==r){this.ctx.moveTo(c[g][0],c[g][1])}else{this.ctx.lineTo(c[g][0],c[g][1])}}this.ctx.stroke();this.ctx.beginPath();this.ctx.fillStyle=mstar.flotUtil.colorToRGB(f.aFillColor||f.aColor,0.7);for(var g=0;g<c.length;g++){if(g==0){this.ctx.moveTo(c[g][0],c[g][1])}else{this.ctx.lineTo(c[g][0],c[g][1])}}this.ctx.fill();this.ctx.beginPath();this.ctx.strokeStyle=mstar.flotUtil.colorToRGB(f.bColor);for(var g=r;g<y.length-r;g++){if(g==r){this.ctx.moveTo(y[g][0],y[g][1])}else{this.ctx.lineTo(y[g][0],y[g][1])}}this.ctx.stroke();this.ctx.beginPath();this.ctx.fillStyle=mstar.flotUtil.colorToRGB(f.bFillColor||f.bColor,0.7);for(var g=0;g<y.length;g++){if(g==0){this.ctx.moveTo(y[g][0],y[g][1])}else{this.ctx.lineTo(y[g][0],y[g][1])}}this.ctx.fill();this.ctx.beginPath();this.ctx.strokeStyle=mstar.flotUtil.colorToRGB(f.mColor);this.ctx.moveTo(l[0][0],l[0][1]);this.ctx.lineTo(l[l.length-1][0]+2,l[0][1]);this.ctx.stroke();if(!isNaN(f.midLineValue)){w.shift()}},_plotPoints:function(c,f,b,n,a){var j,k,l,h,m,g=c.length;var e=this.ctx;e.beginPath();for(var d=0;d<g;++d){if(c[d]==null||isNaN(c[d][1])){continue}j=c[d][0],k=c[d][1];l=n.p2c(j);h=a.p2c(k);m=2*Math.PI;if(j<n.min||j>n.max||k<a.min||k>a.max){continue}e.moveTo(l,h);e.arc(l,h,f,0,m,true)}if(b){e.fill()}e.stroke()},_plotVolumeByPrice:function(f,d,h,a){this.ctx.beginPath();var m=f,e=m[1][0],o=m[1][1];var n=Math.abs(a.p2c(e)-a.p2c(o));var j=(n-39)/14;var c=Math.max(a.p2c(e),a.p2c(o));this.volumeByPrice.data=m;var b=(this.plotWidth*this.volumeByPrice.scale)/m[2],g=null,k;this.volumeByPrice.area.length=0;for(var l=0;l<14;l++){k=c-(l+1)*j-l*3;g=[0,k,m[0][l][2]*b,j];this.ctx.rect(g[0],g[1],g[2],g[3]);this.volumeByPrice.area.push(g)}this.ctx.fill()},_plotLineArea:function(e,q,a){var k,b=null;var n=a.min;var h,p=0;var m=e.length;var l=this._getDx(m);var g=false;var d,c,f,o;for(var j=0;j<e.length;j+=l){k=b;if(e[j]!=null&&!isNaN(e[j][1])){b=e[j]}else{continue}if(g&&k!=null&&b==null){ctx.lineTo(q.p2c(p),a.p2c(n));ctx.fill();g=false;continue}if(b==null){continue}if(k!=null){d=k[0],c=k[1]}f=b[0],o=b[1];if(!isNaN(f)){if(!g){this.ctx.beginPath();this.ctx.moveTo(q.p2c(f),a.p2c(n));g=true}this.ctx.lineTo(q.p2c(f),a.p2c(o))}p=f}if(g){this.ctx.lineTo(q.p2c(p),a.p2c(n));this.ctx.fill()}},_plotOLHC:function(y,s,d,a,b){var v=this.plotOffset,g=this.ctx;var e=(this.canvasWidth-v.left-v.right-s)/y.length;if(e>b.maxBarWidth){e=b.maxBarWidth}if(e<b.minBarWidth){e=b.minBarWidth}b.barWidth=e;var A,p,j,n,m,z,B,C,r,f;var q=this.canvasWidth-v.left-v.right-s-e/2;var t=y.length;g.beginPath();for(var k=0;k<t;++k){if(y[k]==null){continue}var u=y[k];if(u.length<6||isNaN(u[1])||isNaN(u[2])||isNaN(u[3])||isNaN(u[4])){continue}A=u[0],p=u[1],j=u[2],n=u[3],m=u[4];z=d.p2c(A),B=a.p2c(p),C=a.p2c(m),r=a.p2c(n),f=a.p2c(j);if(k==0&&z<e/2){z=e/2}if(k==t-1&&z>q){z=q}g.moveTo(z,f);g.lineTo(z,r);if(b.olhcType=="ohlc"){g.moveTo(z,C);g.lineTo(z-e/2,C)}g.moveTo(z,B);g.lineTo(z+e/2,B)}g.stroke()},_drawCandleStick:function(j,f,d,h,b,a,l,k,g){g.moveTo(j-l/2,f);g.lineTo(j+l/2,f);if(b!=f){g.lineTo(j+l/2,b);g.lineTo(j-l/2,b);g.lineTo(j-l/2,f)}g.moveTo(j,d);var c=f>b?f:b;var e=f>b?b:f;if(d!=c){g.lineTo(j,c)}g.moveTo(j,h);if(h!=e){g.lineTo(j,e)}},_drawColorCandle:function(e,s,D,a,y){var u=[];var B=e.length;var n,v,r,m,q,p,A,d,C,t,w;var b=this.canvasWidth-this.plotOffset.right-this.plotOffset.left-y/2;var f=this.ctx;f.strokeStyle=s;f.lineWidth=1;f.beginPath();for(var g=0;g<B;g++){n=e[g];v=n[0],r=n[1],m=n[2],q=n[3],p=n[4];A=D.p2c(v);d=a.p2c(r),C=a.p2c(p),t=a.p2c(q),w=a.p2c(m);if(g==(B-1)&&A>b){A=b}if(g==0&&A<y/2){A=y/2}if(r<p){u.push([A,C,d])}this._drawCandleStick(A,C,t,w,d,n,y,s,this.ctx)}f.stroke();if(u.length>0){f.lineWidth=y;f.lineCap="butt";f.beginPath();for(var z=0;z<u.length;z++){if(u[z][1]!=u[z][2]){f.moveTo(u[z][0],u[z][1]);f.lineTo(u[z][0],u[z][2])}}f.stroke()}},_plotCandleStick:function(e,d,o,a,l){var h=(l.maxCandleWidth==null)?16:l.maxCandleWidth;var c=(l.minCandleWidth==null)?4:l.minCandleWidth;var n=Math.floor(0.7*(this.canvasWidth-this.plotOffset.left-this.plotOffset.right)/e.length);var m=[],k=[],f;var b=e.length;if(n<c){n=c}if(n>h){n=h}l.candleWidth=n;for(var g=0;g<b;g++){f=e[g];if(f==null||f.length<6||isNaN(f[1])||isNaN(f[2])||isNaN(f[3])||isNaN(f[4])){continue}if(f[5]>0){m.push(f)}else{k.push(f)}}this._drawColorCandle(m,l.upColor,o,a,n);this._drawColorCandle(k,l.downColor,o,a,n)},_drawBar:function(m,n,q,e,p,r,a,d){var b=false,f=false,j=false,h=false;var l=0,g=n,k=this.canvasWidth-this.plotOffset.right-this.plotOffset.left-e-q/2;var o=r.p2c(m);if(o>k){o=k}if(o<q/2){o=q/2}if(q<=16){d.lineWidth=q;d.strokeStyle=p;if(l!=g){d.moveTo(o,a.p2c(l)+e);d.lineTo(o,a.p2c(g)+e)}}else{d.lineWidth=0;d.strokeStyle=p;d.fillStyle=p;d.beginPath();d.moveTo((o-q/2),a.p2c(l)+e);d.lineTo((o-q/2),a.p2c(g)+e);d.lineTo((o+q/2),a.p2c(g)+e);d.lineTo((o+q/2),a.p2c(l)+e);d.fill()}if(this.series[0].bars.outLine){d.beginPath();left=r.p2c(left);l=a.p2c(l);right=r.p2c(right);g=a.p2c(g);d.moveTo(left,l+e);if(b){d.lineTo(left,g+e)}else{d.moveTo(left,g+e)}if(j){d.lineTo(right,g+e)}else{d.moveTo(right,g+e)}if(f){d.lineTo(right,l+e)}else{d.moveTo(right,l+e)}if(h){d.lineTo(left,l+e)}else{d.moveTo(left,l+e)}d.stroke()}},_plotBars:function(d,c,l,h,a,e,n){var g=(l.maxBarWidth==null)?16:l.maxBarWidth;var f=(l.minBarWidth==null)?4:l.minBarWidth;var m=Math.floor(0.7*(this.canvasWidth-this.plotOffset.left-this.plotOffset.right)/n);var k=d.length;if(m<f){m=f}if(m>g){m=g}l.barWidth=m;this.ctx.beginPath();var b=this._getDx(k);for(var j=0;j<k;j+=b){if(d[j]==null||isNaN(d[j][1])){continue}this._drawBar(d[j][0],d[j][1],m,c,e,h,a,this.ctx)}this.ctx.stroke()},_drawTriangle:function(a,b,c){c.lineWidth=1;c.beginPath();c.moveTo(a,b);c.lineTo(a-6.5,b-8);c.lineTo(a+6.5,b-8);c.lineTo(a+1,b-1);c.fill();c.beginPath();c.moveTo(a-7.5,b-8);c.lineTo(a,b);c.lineTo(a+7.5,b-8);c.stroke()},_drawRectangleImg:function(a,b,c){c.beginPath();c.moveTo(a-6.5,b);c.lineTo(a+6.5,b);c.lineTo(a+6.5,b-12);c.lineTo(a-6.5,b-12);c.lineTo(a-6.5,b);c.fill();c.beginPath();c.moveTo(a+7.5,b);c.lineTo(a+7.5,b-13);c.lineTo(a-7.5,b-13);c.lineTo(a-7.5,b);c.stroke()},_drawDividendImg:function(a,b,c,d){c.lineWidth=1;c.strokeStyle="rgb(255,255,255)";c.fillStyle="rgb(47,72,128)";if(d){this._drawTriangle(a,b,c);b-=8}this._drawRectangleImg(a,b,c);b-=7;c.beginPath();c.lineWidth=1.5;c.arc(a-1,b+1,4,-Math.PI*3/5,Math.PI*3/5,false);c.moveTo(a-2,b-3);c.lineTo(a-2,b+5);c.stroke()},_drawSplitsImg:function(a,b,c,d){c.lineWidth=1;c.fillStyle="rgb(47,72,128)";c.strokeStyle="rgb(255,255,255)";if(d){this._drawTriangle(a,b,c);b-=8}this._drawRectangleImg(a,b,c);b-=7;c.beginPath();c.lineWidth=2;c.arc(a,b-1,2,0,Math.PI/2,true);c.arc(a,b+2.5,2,-Math.PI/2,Math.PI,false);c.stroke()},_drawEarningsImg:function(a,b,d,c,e){d.lineWidth=1;d.strokeStyle="rgb(255,255,255)";if(typeof(c)!="undefined"){if(c==0){d.fillStyle="rgb(255,0,0)"}else{d.fillStyle="rgb(76,182,62)"}}if(e){this._drawTriangle(a,b,d);b-=8}this._drawRectangleImg(a,b,d);b-=7;d.beginPath();d.moveTo(a-7,b-7);d.lineTo(a-7,b+7);d.lineTo(a,b+14);d.lineTo(a+7,b+7);d.lineTo(a+7,b-7);d.lineTo(a-7,b-7);d.stroke();d.beginPath();d.lineWidth=1.5;d.moveTo(a+2.5,b+5);d.lineTo(a-2.5,b+5);d.lineTo(a-2.5,b-3);d.lineTo(a+2.5,b-3);d.moveTo(a-2.5,b+1);d.lineTo(a+2.5,b+1);d.stroke();d.lineWidth=2;d.beginPath();d.moveTo(a-3,b-3.5);d.lineTo(a-3,b+5.5);d.stroke()},_plotImages:function(c,b,n,a){var m,l,k,h,g=c.length,e=0;for(var f=g-1;f>=0;f--){m=c[f];if(typeof(m)=="undefined"){continue}k=n.p2c(m[0]),h=this.plotHeight;for(var d=1;d<m.length;d++){if(m[d]==3){this._drawEarningsImg(k,h,this.ctx,0,d==1)}else{if(m[d]==4){this._drawEarningsImg(k,h,this.ctx,1,d==1)}else{if(m[d]==1){this._drawDividendImg(k,h,this.ctx,d==1)}else{if(m[d]==2){this._drawSplitsImg(k,h,this.ctx,d==1)}}}}h-=d==1?21:13}this.imgDataList[f]=h}},_setCanvasContext:function(b,a){b.save();if(typeof(a.cr)!="undefined"&&a.cr.length>0){b.clearRect(a.cr[0],a.cr[1],a.cr[2],a.cr[3])}if(typeof(a.tl)!="undefined"&&a.tl.length>0){b.translate(a.tl[0],a.tl[1])}b.lineJoin=typeof(a.lj)=="undefined"?"round":a.lj;b.lineWidth=typeof(a.lw)=="undefined"?1:a.lw;b.strokeStyle=typeof(a.ss)=="undefined"?"rgb(100,100,100)":a.ss;if(typeof(a.ga)!="undefined"){b.globalAlpha=a.ga}if(typeof(a.fs)!="undefined"){b.fillStyle=a.fs}},_drawSeriesLines:function(f){var c=this.ctx;var e=f.lineW==null?f.lines.lineWidth:f.lineW;this._setCanvasContext(c,{lw:e,tl:[this.plotOffset.left,this.plotOffset.top],ss:f.color});this._setFillStyle(f.lines,f.color);var g=f.lines.lineType,a=f.showLegend,b=f.legendLabel;if(g=="line"){this._plotLine(f.data,0,f.xaxis,f.yaxis)}else{if(g=="mountain"){this._plotLineArea(f.data,f.xaxis,f.yaxis);if(!f.lines.noLine){this._plotLine(f.data,0,f.xaxis,f.yaxis)}}else{if(g=="dot"){this._plotDot(f.data,0,f.xaxis,f.yaxis,f.lines.dot)}else{if(g=="ab"){this._plotAboveBelow(f.data,0,f.xaxis,f.yaxis,f.lines.ab)}}}}c.restore();if(a){if(f.data&&f.data.length){var k=f.data[f.data.length-1];var h=f.xaxis.p2c(k[0]),j=f.yaxis.p2c(k[1]);this._createLegend(isNaN(k[1])?"":(typeof(QS_NumFmt)!="undefined"?QS_NumFmt.Fmt2(k[1],true," ",f.yaxis.tickDecimals):k[1].toFixed(2)),b,h-150+this.plotOffset.left,j-18)}}},_drawSeriesOLHC:function(a){this._setCanvasContext(this.ctx,{tl:[this.plotOffset.left,this.plotOffset.top],ss:a.color});this._setFillStyle(a.OLHC,a.color);this._plotOLHC(a.data,0,a.xaxis,a.yaxis,a.OLHC);this.ctx.restore()},_drawSeriesCandleStick:function(a){this._setCanvasContext(this.ctx,{tl:[this.plotOffset.left,this.plotOffset.top],ss:a.color});this._setFillStyle(a.candleStick,a.color);this._plotCandleStick(a.data,0,a.xaxis,a.yaxis,a.candleStick);this.ctx.restore()},_drawSeriesPoints:function(b){var c=this.ctx;var a=b.lines.lineWidth;c.save();c.translate(this.plotOffset.left,this.plotOffset.top);c.lineWidth=b.points.lineWidth;c.strokeStyle=b.color;this._setFillStyle(b.points,b.color);this._plotPoints(b.data,b.points.radius,b.points.fill,b.xaxis,b.yaxis);c.restore()},_drawSeriesBars:function(d){this._setCanvasContext(this.ctx,{lw:d.bars.lineWidth,tl:[this.plotOffset.left,this.plotOffset.top],ss:d.color});var e=d.data.length;if(d.bars.isColorBar){var b=[],c=[];for(var a=0;a<e;a++){if(d.data[a]!=null&&d.data[a].length>3&&d.data[a][2]==1){b.push(d.data[a])}else{c.push(d.data[a])}}this._setFillStyle(d.bars,d.bars.upColor);this._plotBars(b,0,d.bars,d.xaxis,d.yaxis,d.bars.upColor,e);this._setFillStyle(d.bars,d.bars.downColor);this._plotBars(c,0,d.bars,d.xaxis,d.yaxis,d.bars.downColor,e)}else{this._setFillStyle(d.bars,d.color);this._plotBars(d.data,0,d.bars,d.xaxis,d.yaxis,d.color,e)}this.ctx.restore()},_drawSeriesImage:function(a){this._setCanvasContext(this.ctx,{tl:[this.plotOffset.left,this.plotOffset.top],ss:a.color});this._plotImages(a.data,0,a.xaxis,a.yaxis,a.imagePoints);this.ctx.restore()},_drawSeriesVolumeByPrice:function(a){var b=this.ctx;this._setCanvasContext(this.ctx,{lw:a.lines.lineWidth,tl:[this.plotOffset.left,this.plotOffset.top],fs:a.volumeByPrice.fillColor,ga:a.volumeByPrice.opacity});this._plotVolumeByPrice(a.data,0,a.xaxis,a.yaxis);b.restore()},_drawPointHighlight:function(e,g){var d=this.octx;var h=g[0],f=g[1],j=e.xaxis,a=e.yaxis;if(h<j.min||h>j.max||f<a.min||f>a.max){return}var b=e.points.radius+e.points.lineWidth/2;var c=1.5*b;d.lineWidth=b;d.strokeStyle=mstar.flotUtil.colorToRGB(e.color,0.5);d.beginPath();d.arc(j.p2c(h),a.p2c(f),c,0,2*Math.PI,true);d.stroke()},_drawVolumeByPriceHighlight:function(c){if(this.volumeByPrice.show&&this.volumeByPrice.highlights.length!=0){var e=this.octx;e.save();if(typeof(this.volumeByPrice.series.volumeByPrice)!="undefined"){e.fillStyle=this.volumeByPrice.series.volumeByPrice.highlightColor}e.beginPath();var b=this.volumeByPrice.highlights;e.rect(b[0],b[1],b[2],b[3]);this.volumeByPrice.hintDom.css({left:(b[0]+b[2]+this.plotOffset.left),top:(b[1]+this.plotOffset.top-this.volumeByPrice.hintDom.height()-b[3])});var a=this.volumeByPrice.data[0][this.volumeByPrice.index];this.volumeByPrice.hintDom.html("Vol: "+(typeof(QS_NumFmt)=="undefined"?(a[2].toFixed(2)+" mil  Range: "+a[0].toFixed(2)+"~"+a[1].toFixed(2)):(QS_NumFmt.Fmt(a[2]*1000000,true)+"  Range: "+QS_NumFmt.Fmt2(a[0],true," ",2)+"~"+QS_NumFmt.Fmt2(a[1],true," ",2))));this.volumeByPrice.hintDom.show();e.fill();e.restore()}},_drawSegment:function(a,b){a.moveTo(b.spos[0],b.spos[1]);a.arc(b.spos[0],b.spos[1],1,0,2*Math.PI,true);a.lineTo(b.epos[0],b.epos[1]);a.arc(b.epos[0],b.epos[1],1,0,2*Math.PI,true)},_drawBarHighlight:function(d,f){if(f==null){return}var c=this.octx;var g=f[0],e=f[1],h=d.bars.barWidth;var a=d.color,b=d.bars;this._setCanvasContext(c,{fs:mstar.flotUtil.colorToRGB(d.color),lw:d.bars.lineWidth,ss:mstar.flotUtil.colorToRGB(d.color)});if(f.length>3){a=f[2]==1?b.upColor:b.downColor}this._drawBar(g,e,h,0,a,d.xaxis,d.yaxis,this.octx);c.restore()},_drawOLHCHighlight:function(b,s){var t=s,p=this.octx,d=b.OLHC.barWidth;if(t.length<6||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])||isNaN(t[4])){return}var q=t[0],a=t[1],g=t[2],m=t[3],k=t[4];var n=b.xaxis.p2c(q);var f=b.yaxis.p2c(a),r=b.yaxis.p2c(k),j=b.yaxis.p2c(m),e=b.yaxis.p2c(g);if(n<d/2){n=d/2}if(n>(this.canvasWidth-this.plotOffset.left-this.plotOffset.right-d/2)){n=this.canvasWidth-this.plotOffset.left-this.plotOffset.right-d/2}this._setCanvasContext(p,{lw:b.OLHC.lineWidth+1,ss:b.OLHC.highLightColor});p.beginPath();p.moveTo(n,e);p.lineTo(n,j);if(b.OLHC.olhcType=="ohlc"){p.moveTo(n,r);p.lineTo(n-d/2,r)}p.moveTo(n,f);p.lineTo(n+d/2,f);p.stroke();p.restore()},_drawCandleStickHighlight:function(r,a){var d=this.octx;var s=r.candleStick;var v=(s.maxCandleWidth==null)?16:s.maxCandleWidth;var e=(s.minCandleWidth==null)?4:s.minCandleWidth;var u=Math.floor(0.7*(this.canvasWidth-this.plotOffset.left-this.plotOffset.right)/r.data.length);if(u<e){u=e}if(u>v){u=v}var g=a,p;if(g.length<6||isNaN(g[1])||isNaN(g[2])||isNaN(g[3])||isNaN(g[4])){return}this._setCanvasContext(d,{lw:2,ss:s.highLightColor,fs:s.highLightColor});var y=g[0],m=g[1],f=g[2],k=g[3],j=g[4];var w=r.xaxis.p2c(y);var b=r.yaxis.p2c(m),z=r.yaxis.p2c(j),q=r.yaxis.p2c(k),t=r.yaxis.p2c(f);var n=this.canvasWidth-this.plotOffset.right-this.plotOffset.left-u/2;if(w>n){w=n}if(w<u/2){w=u/2}p=(m>j)?s.upColor:s.downColor;d.beginPath();this._drawCandleStick(w,z,q,t,b,g,u,s.highLightColor,d);d.stroke();d.restore()},_drawImgHighlight:function(d,b,a){var f=this.octx;f.beginPath();this._setCanvasContext(f,{lw:1.5,ss:"#fff"});var c=this.axes.xaxis.p2c(b[0]),e=this.axes.yaxis.p2c(b[a==0?1:3]);if(a==0){e+=3}f.moveTo(c,e);f.lineTo(c,this.imgDataList[b[0]]);f.stroke();f.restore()},_indexOfHighlight:function(c,d){var a;for(var b=0;b<this.highlights.length;++b){a=this.highlights[b];if(a.series==c&&a.point[0]==d[0]&&a.point[1]==d[1]){return b}}return -1},_getResultItem:function(a,b){return{datapoint:this.series[a].data[b],dataIndex:b,series:this.series[a],seriesIndex:a}},_highlight:function(b,c,d){if(typeof b=="number"){b=this.series[b]}if(typeof c=="number"){c=b.data[c]}var a=this._indexOfHighlight(b,c);if(a==-1){this.highlights.push({series:b,point:c,auto:d});this._triggerRedrawOverlay()}else{if(!d){this.highlights[a].auto=false}}if((this.drawObj.getStart()!=""||this.volumeByPrice.show)&&a!=-1){this._triggerRedrawOverlay()}},_unhighlight:function(b,c){if(typeof b=="number"){b=series[b]}if(typeof c=="number"){c=b.data[c]}var a=this._indexOfHighlight(b,c);if(a!=-1){this.highlights.splice(a,1);this._triggerRedrawOverlay()}},_redrawOverlay:function(){var c=this.octx;this.redrawTimeout=null;if(this.octx==null){return}c.save();this._setCanvasContext(c,{cr:[0,0,this.canvasWidth,this.canvasHeight],tl:[this.plotOffset.left,this.plotOffset.top]});if(this.drawObj){this.drawObj.drawGraph(c,this.axes,this.plotOffset,this.plotWidth,this.options.yaxis.align,this.plotHeight)}var a,b;for(a=0;a<this.highlights.length;++a){b=this.highlights[a],type=1;if(b.series.bars.show){this._drawBarHighlight(b.series,b.point)}else{if(b.series.lines.show||b.series.points.show){this._drawPointHighlight(b.series,b.point);type=0}else{if(b.series.OLHC.show){this._drawOLHCHighlight(b.series,b.point)}else{if(b.series.candleStick.show){this._drawCandleStickHighlight(b.series,b.point)}else{type=0;this._drawPointHighlight(b.series,b.point)}}}}if(this.options.imageHighlight&&this.imgDataList.length>0&&typeof(this.imgDataList[b.point[0]])!="undefined"){this._drawImgHighlight(b.series,b.point,type)}}this._drawVolumeByPriceHighlight();c.restore()},_triggerRedrawOverlay:function(){var a=this;if(!this.redrawTimeout){clearTimeout(this.redrawTimeout)}this.redrawTimeout=setTimeout(function(){a._redrawOverlay()},50)},_triggerClickHoverEvent:function(j,c){mstar.flotUtil.avoidSelect();if(this.eventHolder==null){return false}var m=this._getScrollOffset(c);var a=this.eventHolder.offset(),g={pageX:this.lastMousePos.pageX,pageY:this.lastMousePos.pageY},d=c.pageX-a.left-this.plotOffset.left,e=c.pageY-a.top-this.plotOffset.top-m[1];if(this.axes.xaxis.used){g.x=this.axes.xaxis.c2p(d)}if(this.axes.yaxis.used){g.y=this.axes.yaxis.c2p(e)}if(this.axes.x2axis.used){g.x2=this.axes.x2axis.c2p(d)}if(this.axes.y2axis.used){g.y2=this.axes.y2axis.c2p(e)}var n=this._findNearbyItem(d,e);if(n){n.pageX=parseInt(n.series.xaxis.p2c(n.datapoint[0])+a.left+this.plotOffset.left);n.pageY=parseInt(n.series.yaxis.p2c(n.datapoint[1])+a.top+this.plotOffset.top);if(n.datapoint.length>4){n.maxY=parseInt(n.series.yaxis.p2c(n.datapoint[2])+a.top+this.plotOffset.top)}}this.drawObj.mouseMove(n,d,e,this.plotOffset,this.target);if(this.volumeByPrice.show){var l=false;for(var k=0;k<this.volumeByPrice.area.length;k++){var b=this.volumeByPrice.area[k];if(d>b[0]&&d<(b[0]+b[2])&&e>b[1]&&e<(b[1]+b[3])){this.volumeByPrice.highlights=[b[0],b[1],b[2],b[3]];l=true;this.volumeByPrice.index=k;break}}if(this.volumeByPrice.hintDom==null){this.volumeByPrice.hintDom=$("<div class='rtq-volumeByPriceHint'>dfs</div>");this.target.append(this.volumeByPrice.hintDom);this.volumeByPrice.hintDom.hide()}if(!l){this.volumeByPrice.highlights.length=0;this.volumeByPrice.hintDom.hide()}}if(this.options.grid.autoHighlight){var f;for(var k=0;k<this.highlights.length;++k){f=this.highlights[k];if(f.auto&&!(n&&f.series==n.series&&f.point==n.datapoint)){this._unhighlight(f.series,f.point)}}if(n){this._highlight(n.series,n.datapoint,true)}else{this._triggerRedrawOverlay()}}if(j=="drawEnd"){this.target.trigger(j,[c.drawType])}else{this.target.trigger(j,[g,n])}},_findNearbyItem:function(k,A){var u=this.options.grid.mouseActiveRadius;var q=u*u+1;var c=null,t=false;var z,E,a,d,r,D,l,B,e,g,h,v,p,f;var b=this.series[0],m=0;if(b&&this.options.higlightIndex<b.length){b=this.series[this.options.higlightIndex];m=this.options.higlightIndex}if(!b||!b.xaxis||!b.yaxis){return null}z=b.data,E=b.xaxis,a=b.yaxis;d=E.c2p(k),r=a.c2p(A);D=u/E.scale,l=u/a.scale;B=b.bars.show,e=b.candleStick.show,g=b.OLHC.show;h=(!g&&!e&&!B)||(b.lines.show||b.points.show);if(b.bars.show&&typeof(b[m])!="undefined"){v=b[m].bars.align=="left"?0:-b.bars.barWidth/2,p=v+b.bars.barWidth}if(b.candleStick.show){f=b.candleStick.candleWidth==null?0:b.candleStick.candleWidth}var C,n,o=z.length;for(var w=0;w<o;++w){if(z[w]==null||isNaN(z[w][1])||(z[w].length>6&&z[w][6]==1)){continue}C=z[w][0],n=z[w][1];if(b.bars.show){if(!t&&d>=C+v&&d<=C+p&&r>=Math.min(0,n)&&r<=Math.max(0,n)){c=this._getResultItem(m,w);c.y=r;c.py=a.p2c(n)}}else{if(b.candleStick.show||b.OLHC.show){if((d<=C+0.5)){t=true;c=this._getResultItem(m,w);c.y=r;c.py=a.p2c(n);return c}}else{if((d<=C+0.5)){t=true;c=this._getResultItem(m,w);c.y=r;c.py=a.p2c(n);return c}}}}return c},_getScrollOffset:function(e){var c=document.documentElement,d=document.body;var a=c&&c.scrollLeft||d.scrollLeft||0,f=c&&c.scrollTop||d.scrollTop||0;return[a,f]},_onMouseMove:function(d){mstar.flotUtil.avoidSelect();var b=this;var c=d||window.event;var a=this._getScrollOffset(d);sl=a[0],sr=a[1];if(c.pageX==null&&c.pageX!=null){this.lastMousePos.pageX=c.pageX+sl;this.lastMousePos.pageY=c.pageY+sr}else{this.lastMousePos.pageX=c.pageX+sl;this.lastMousePos.pageY=c.pageY+sr}if(this.options.grid.hoverable&&!this.hoverTimeout){this.hoverTimeout=setTimeout(function(){b._onHover()},100)}},_getItem:function(c){var b=this.eventHolder.offset();var a=this._getCanvasXY(c);var f=a[0],g=a[1];var d=this._findNearbyItem(f,g);if(d){d.pageX=parseInt(d.series.xaxis.p2c(d.datapoint[0])+b.left+this.plotOffset.left);d.pageY=parseInt(d.series.yaxis.p2c(d.datapoint[1])+b.top+this.plotOffset.top)}return d},_onMouseDown:function(b){mstar.flotUtil.avoidSelect();var d=this;if(b.which!=1&&(typeof(__isMobile)=="undefined"||__isMobile===false)){return}document.body.focus();this.lastMousePos.pageX=null;var a=this._getCanvasXY(b);var f=a[0],g=a[1];var c=this._getItem(b);this.drawObj.mouseDown(b,a,c,this.axes,this.target,this.plotOffset,this.series);this._triggerRedrawOverlay();if(typeof(__isMobile)!="undefined"&&__isMobile===true){$(document).bind("mouseup.msflot",function(h){d._onMouseUp.call(d,h);$(document).unbind("mouseup.msflot")})}else{$(document).one("mouseup",function(h){d._onMouseUp.call(d,h)})}},_getCanvasXY:function(d){var c=this.eventHolder.offset();var g,f;var a=document.documentElement,j=document.body;var k=a&&a.scrollLeft||j.scrollLeft||0,h=a&&a.scrollTop||j.scrollTop||0;if(d.pageX==null&&d.pageX!=null){g=d.pageX+k;f=d.pageY+h}else{g=d.pageX+k;f=d.pageY+h}canvasX=d.pageX-c.left-this.plotOffset.left,canvasY=d.pageY-c.top-this.plotOffset.top;return[canvasX,canvasY]},_onClick:function(b){var a=this.eventHolder.offset();if(b.pageX<(this.eventHolder.offset().left+this.plotOffset.left)){return}this._triggerClickHoverEvent("plotclick",b)},_ondbClick:function(b){var a=this._getCanvasXY(b);var c=this._getItem(b);this.drawObj.dbClick(b,a,c);this._triggerRedrawOverlay()},_onHover:function(){this._triggerClickHoverEvent("plothover",this.lastMousePos);this.hoverTimeout=null},_onMouseUp:function(c){var b=this.eventHolder.offset();var a=this._getCanvasXY(c);var d=this._findNearbyItem(a[0],a[1]);fl=this.drawObj.mouseUp(c,a,d,b,this.plotOffset,this.plotHeight,this.axes,this.target);c.drawType=fl[0];c.moving=fl[1];c.draging=fl[2];this.target.css("cursor","");this._triggerRedrawOverlay();if(c.drawType&&!c.moving&&!c.draging){this._triggerClickHoverEvent("drawEnd",c)}return false},_insertLastDataPointAxisLabel:function(h){var c=h.color,a=h.data.length,j="",e,d,f=this.plotOffset,b=h.yaxis;for(var g=a-1;g>=0;g--){d=h.data[g][1];if(!isNaN(d)){break}}if(!h.showLegend&&b.showLastLabel){e=f.top+b.p2c(d)-b.labelHeight;if(e<0){e=0}if(typeof b.labelFormatter=="function"){d=b.labelFormatter(d)}j='<div style="background:'+c+";color:#000;position:absolute;top:"+e+"px;right:"+(f.right+((this.options.yaxis.align!="right")?this.plotWidth:0)+this.options.grid.labelMargin)+'px;text-align:right" class="tickLabel">'+d+"</div>";this.target.find(".tickLabels")[0].innerHTML+=j}},_drawSeries:function(a){var b=false;if(a.lines.show||(!a.bars.show&&!a.points.show&&!a.OLHC.show&&!a.candleStick.show&&!a.imagePoints.show&&!a.volumeByPrice.show)){b=true;this._drawSeriesLines(a)}if(a.bars.show){b=true;this._drawSeriesBars(a)}if(a.points.show){b=true;this._drawSeriesPoints(a)}if(a.OLHC.show){b=true;this._drawSeriesOLHC(a)}if(a.candleStick.show){b=true;this._drawSeriesCandleStick(a)}if(a.imagePoints.show){b=false;this._drawSeriesImage(a)}if(a.volumeByPrice.show){b=true;this.volumeByPrice.show=true;this.volumeByPrice.series=a;this._drawSeriesVolumeByPrice(a)}if(b){this._insertLastDataPointAxisLabel(a)}},_constructChart:function(){this._drawGrid();this._insertAxisLabels();this.volumeByPrice.show=false;for(var a=0;a<this.series.length;a++){this._drawSeries(this.series[a])}},setChartTypeForDrawings:function(a,b){if(this.drawObj){this.drawObj.chartType=a;this.drawObj.startPos=b}},_clearCanvas:function(){if(this.ctx&&this.octx){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight);this.octx.clearRect(0,0,this.canvasWidth,this.canvasHeight);if($.browser.msie){this.ctx.canvas.onPropertyChange=null;this.ctx.canvas.onResize=null;this.octx.canvas.onPropertyChange=null;this.octx.canvas.onResize=null;this.ctx.element_=null;this.ctx.canvas=null;this.ctx.currentPath_=null;this.ctx.m_=null;this.octx.element_=null;this.octx.canvas=null;this.octx.currentPath_=null;this.octx.m_=null}this.target.unbind("plothover");this.eventHolder.each(function(){$(this).unbind("mousemove");$(this).unbind("mousedown");$(this).unbind("click")});this.ctx=this.octx=this.canvas=this.overlay=this.eventHolder=null}this.target.find(".flot-minichart").remove();this.target.find("canvas,.tickLabels").remove()},clear:function(){this._clearCanvas();this.target=this.series=this.options=this.axes=null;for(var a in this){if(!a||a=="clear"){continue}this[a]=null;delete this[a]}}};