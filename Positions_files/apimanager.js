if(typeof QS=="undefined"){var QS={}}if(typeof QS.browserOpera=="undefined"){QS.browserOpera=/opera/.test(navigator.userAgent.toLowerCase())}if(typeof QS.class2type=="undefined"){QS.class2type={};var _array="Boolean Number String Function Array Date RegExp Object".split(" ");for(var i=0,l=_array.length;i<l;i++){var name=_array[i];QS.class2type["[object "+name+"]"]=name.toLowerCase()}}if(typeof QS.type!="function"){QS.type=function(a){return a==null?String(a):QS.class2type[Object.prototype.toString.call(a)]||"object"}}if(typeof QS.isFunction!="function"){QS.isFunction=function(a){return QS.type(a)==="function"}}if(typeof QS.isArray!="function"){QS.isArray=Array.isArray||function(a){return QS.type(a)==="array"}}if(typeof QS.each!=="function"){QS.each=function(d,a,g){var e,b=0,c=d.length,f=c===undefined||QS.isFunction(d);if(g){if(f){for(e in d){if(a.apply(d[e],g)===false){break}}}else{for(;b<c;){if(a.apply(d[b++],g)===false){break}}}}else{if(f){for(e in d){if(a.call(d[e],e,d[e])===false){break}}}else{for(;b<c;){if(a.call(d[b],b,d[b++])===false){break}}}}return d}}if(typeof QS.param!=="function"){QS.param=function(d){var b=[];function c(a,f){b[b.length]=encodeURIComponent(a)+"="+encodeURIComponent(f)}if(QS.isArray(d)||d.jquery){QS.each(d,function(){c(this.name,this.value)})}else{for(var e in d){if(QS.isArray(d[e])){QS.each(d[e],function(){c(e,this)})}else{c(e,QS.isFunction(d[e])?d[e]():d[e])}}}return b.join("&").replace(/%20/g,"+")}}if(typeof QS.quoteString!=="function"){QS.quoteString=function(c){var a=/["\\\x00-\x1f\x7f-\x9f]/g,b={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};if(c.match(a)){return'"'+c.replace(a,function(e){var d=b[e];if(typeof d==="string"){return d}d=e.charCodeAt();return"\\u00"+Math.floor(d/16).toString(16)+(d%16).toString(16)})+'"'}return'"'+c+'"'}}if(typeof QS.toJSON!=="function"){QS.toJSON=typeof JSON==="object"&&JSON.stringify?JSON.stringify:function(g){if(g===null){return"null"}var f,d,b,e,m=QS.type(g);if(m==="undefined"){return undefined}if(m==="number"||m==="boolean"){return String(g)}if(m==="string"){return QS.quoteString(g)}if(typeof g.toJSON==="function"){return QS.toJSON(g.toJSON())}if(m==="date"){var c=g.getUTCMonth()+1,j=g.getUTCDate(),h=g.getUTCFullYear(),p=g.getUTCHours(),n=g.getUTCMinutes(),a=g.getUTCSeconds(),q=g.getUTCMilliseconds();if(c<10){c="0"+c}if(j<10){j="0"+j}if(p<10){p="0"+p}if(n<10){n="0"+n}if(a<10){a="0"+a}if(q<100){q="0"+q}if(q<10){q="0"+q}return'"'+h+"-"+c+"-"+j+"T"+p+":"+n+":"+a+"."+q+'Z"'}f=[];if(QS.isArray(g)){for(d=0;d<g.length;d++){f.push(QS.toJSON(g[d])||"null")}return"["+f.join(",")+"]"}if(typeof g==="object"){for(d in g){if(Object.prototype.hasOwnProperty.call(g,d)){m=typeof d;if(m==="number"){b='"'+d+'"'}else{if(m==="string"){b=QS.quoteString(d)}else{continue}}m=typeof g[d];if(m!=="function"&&m!=="undefined"){e=QS.toJSON(g[d]);f.push(b+":"+e)}}}return"{"+f.join(",")+"}"}}}(function(u){var m,v,n=1,s,q=this,t=!1,o="postMessage",k="addEventListener",r,p=q[o]&&!u.browserOpera;u[o]=function(c,a,b){if(!a){return}c=typeof c==="string"?c:u.param(c);b=b||parent;if(p){b[o](c,a.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}else{if(a){b.location=a.replace(/#.*$/,"")+"#"+(+new Date)+(n++)+"&"+c}}};u.receiveMessage=r=function(a,b,c){if(p){if(a){s&&r();s=function(d){if((typeof b==="string"&&d.origin!==b)||(u.isFunction(b)&&b(d.origin)===t)){return t}a(d)}}if(q[k]){q[a?k:"removeEventListener"]("message",s,t)}else{q[a?"attachEvent":"detachEvent"]("onmessage",s)}}else{m&&clearInterval(m);m=null;if(a){c=typeof b==="number"?b:typeof c==="number"?c:100;m=setInterval(function(){var e=document.location.hash,d=/^#?\d+&/;if(e!==v&&d.test(e)){v=e;a({data:e.replace(d,"")})}},c)}}}})(QS);var Queue=function(c){var b=c||100;var e=500;var a=[];var f=null;var g=true;var h=a.length;var d=function(){h=a.length;if(h>=e){a=a.slice(h-e,h)}if(h>0){f=window.setTimeout(function(){a[0]();a.splice(0,1);d();g=false},g?2000:b)}else{f=window.setTimeout(function(){d()})}};d();return{add:function(j){a.push(j)}}};var QS_APIManager=function(){this.xwinProxy=null;this.instId=null;this.SSOSuccessful=false;this.cfg={sessionKey:"",env:"production"};this.URLs={stage:{SSOURL:"https://awsstgmain.morningstar.com/SMLOGINMS/SMLoginMS.asp",targetURL:"https://qsstage.morningstar.com/apis/login.jsp",cookieValidatorURL:"//qsstage.morningstar.com/apis/cookieValidator.jsp"},production:{SSOURL:"https://advtools.morningstar.com/SMLOGINMS/SMLoginMS.asp",targetURL:"https://quotespeed.morningstar.com/apis/login.jsp",cookieValidatorURL:"//quotespeed.morningstar.com/apis/cookieValidator.jsp"}};this.MAX_CHECKSSO=30;this.checkCount=0;this.currentTimeInterval=0;this.customPushDomain=null;this.customWebDomain=null;this.module={watchlist:{js:[],css:[]}},this.intervals=[0,1000,300,200];this.inited=false;this.callbackArray=[];this.cookieName={stage:"qs_wsid_stage",production:"qs_wsid_live"}};QS_APIManager.prototype={_buildSSOIframe:function(){var a=this.URLs[this.cfg.env]?this.URLs[this.cfg.env].SSOURL:this.URLs.production.SSOURL,c=this.URLs[this.cfg.env]?this.URLs[this.cfg.env].targetURL:this.URLs.production.targetURL;a=this._setParameter(a,"INSTID",this.instId);a=this._setParameter(a,"url",encodeURIComponent(this.cfg.profileurl));a=this._setParameter(a,"targeturl",encodeURIComponent(c));var b=document.createElement("iframe");b.setAttribute("frameborder","0",0);b.setAttribute("scrolling","no",0);b.src=a;b.style.display="none";document.body.appendChild(b)},_getCookie:function(a){var b,d,e,f=document.cookie.split(";"),c=null;for(b=0;b<f.length;b++){d=f[b].substr(0,f[b].indexOf("="));e=f[b].substr(f[b].indexOf("=")+1);d=d.replace(/^\s+|\s+$/g,"");if(d==a){c=unescape(e);break}}return c},setCookie:function(b,d,a,g,f,h){var c=new Date();c.setTime(c.getTime());if(a){a=a*1000*60}var e=new Date(c.getTime()+(a));document.cookie=b+"="+escape(d)+((a)?";expires="+e.toGMTString():"")+((g)?";path="+g:"")+((f)?";domain="+f:"")+((h)?";secure":"")},_getTimerInterval:function(){var a=500;if(this.currentTimeInterval<4){a=this.intervals[this.currentTimeInterval]}this.currentTimeInterval++;if(this.currentTimeInterval==1&&this.instId.toUpperCase()=="PRIP"){a=this.intervals[1];this.currentTimeInterval++}return a},_globalEval:function(a){if(a&&/\S/.test(a)){(window.execScript||function(b){window["eval"].call(window,b)})(a)}},_now:function(){return(new Date()).getTime()},_getXHR:function(){var a;if(window.XMLHttpRequest){a=new XMLHttpRequest()}else{if(window.ActiveXObject){a=new ActiveXObject("Microsoft.XMLHTTP")}}return a},_getJSON:function(h,b){if(typeof $!="undefined"&&typeof $.getJSON=="function"){$.getJSON(h,b)}else{var g=/=\?(&|$)/g,m=this._now(),a="jsonp"+m++;if(h.match(g)){h=h.replace(g,"="+a+"$1");window[a]=function(p){b(p);window[a]=undefined;try{delete window[a]}catch(o){}if(n){n.removeChild(f)}}}var d=this._now();var k=h.replace(/(\?|&)_=.*?(&|$)/,"$1_="+d+"$2");h=k+((k==h)?(h.match(/\?/)?"&":"?")+"_="+d:"");var j=/^(\w+:)?\/\/([^\/?#]+)/.exec(h);if(j&&(j[1]&&j[1]!=location.protocol||j[2]!=location.host)){var n=document.getElementsByTagName("head")[0];var f=document.createElement("script");f.src=h;f.charset="UTF-8";n.appendChild(f);return undefined}var c=this._getXHR();if(c){c.open("GET",h,true);var e=this;c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){e._globalEval(c.responseText)}};c.send()}}},_checkSSOStatus:function(b,a){this.initing=true;var c=this;this.checkCount++;var d=this.URLs[this.cfg.env]?this.URLs[this.cfg.env].cookieValidatorURL:this.URLs.production.cookieValidatorURL;var e=setTimeout(function(){c._getJSON(d+"?mail="+b+"&jsoncallback=?",function(f){if(f.status=="ok"){c.checkCount=0;c.currentTimeInterval=0;c.SSOSuccessful=true;a();if(c.instId.toUpperCase()=="PRIP"){c.setCookie("qs_logined","1",null,"/",null,false)}}else{if(c.checkCount<c.MAX_CHECKSSO){c._checkSSOStatus(b,a)}}})},this._getTimerInterval())},init:function(d,e,a){this.instId=d;if(e){for(var b in e){if(e[b]){this.cfg[b]=e[b]}}}if(typeof(this.xwinProxy)=="undefined"||this.xwinProxy==null){if(this.customPushDomain&&this.customWebDomain){document.domain="ml.com";this.xwinProxy=new QSXwinProxy_parent();this.xwinProxy.dataManager={batchSubscribe:function(){},getMarketQuoteData:function(){}};QS.setDataMethod("streaming");this.xwinProxy.dataManager=QS.Data;this.xwinProxy.dataManager.register(this.xwinProxy)}else{this.xwinProxy=new QSXwinProxy_parent(true);this.xwinProxy.dataManager={batchSubscribe:function(){},getMarketQuoteData:function(){}};var c=this;window.QSAPI_DATA_batchSubscribe=function(f){c.xwinProxy.dataCenter.callFunction("QSAPI_DATA_batchSubscribe",f)}}}if(this.cfg.profileurl){if(this.inited){if(typeof(a)=="function"){a()}return}else{if(this.initing){this.callbackArray.push(a);return}}if(this._getCookie("qs_logined")==1&&this.instId.toUpperCase()=="PRIP"){this.inited=true;if(typeof(a)=="function"){a()}return}this._buildSSOIframe();if(this.cfg.email&&typeof a=="function"){this.callbackArray.push(a);var c=this;this._checkSSOStatus(this.cfg.email,function(){for(var f=0;f<c.callbackArray.length;f++){c.callbackArray[f]()}c.callbackArray=[];c.initing=false;c.inited=true})}}else{if(this.cfg.sessionKey){if(typeof a=="function"){a()}}}},addIframe:function(){for(var a=0;a<arguments.length;a++){this.xwinProxy.addChild(this.xwinProxy.createChild(document.getElementById(arguments[a])),"QSAPI_IFRAME_"+arguments[a])}},setWebDomain:function(a){this.customWebDomain=a},setSessionKey:function(a){this.cfg.sessionKey=a},setPushDomain:function(a){this.customPushDomain=a},openWidget:function(d,c,b,a){this.xwinProxy.buildXDMRpc(d,c,b,a)},getIfameId:function(){if(!this.__iframeIdSeed){this.__iframeIdSeed=0}return"QSAPI_IFRAME_"+(this.__iframeIdSeed++)},_setXWinProxyDomain:function(a){if(this.xwinProxy&&a){var b=/[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+\.?/;var c=b.exec(a);if(c!=null){this.xwinProxy.setQSDomain(c[0])}}},_setCallbacks:function(frameId,widgetURL,config,callbacks){var self=this;callbacks=callbacks||{};if(config.fixHeight===false){var onHeightChangeName="QSAPI_CB_onHeightChange_"+frameId;var onLoadName="QSAPI_CB_onLoad_"+frameId;var oldOnload=callbacks.onLoad||this._getParameter("onLoad",widgetURL);var oldOnHeightChange=callbacks.onHeightChange||this._getParameter("onHeightChange",widgetURL);widgetURL=this._setParameter(widgetURL,"onHeightChange",onHeightChangeName);widgetURL=this._setParameter(widgetURL,"onLoad",onLoadName);window[onHeightChangeName]=function(para){self.xwinProxy.callFunction(oldOnHeightChange,para);if(typeof(para)=="string"){para=eval("("+para+")")}var ifm=document.getElementById(frameId);ifm.style.height=para.height+"px"};window[onLoadName]=function(para){self.xwinProxy.callFunction(oldOnload,para);if(typeof(para)=="string"){para=eval("("+para+")")}var ifm=document.getElementById(frameId);ifm.style.height=para.height+"px"}}if(config.fixWidth===false){var onWidthChangeName="QSAPI_CB_onWidthChange_"+frameId;var oldOnWidthChange=callbacks.onWidthChange||this._getParameter("onWidthChange",widgetURL);widgetURL=this._setParameter(widgetURL,"onWidthChange",onWidthChangeName);window[onWidthChangeName]=function(para){self.xwinProxy.callFunction(oldOnWidthChange,para);if(typeof(para)=="string"){para=eval("("+para+")")}if(para.width>0){var ifm=document.getElementById(frameId);ifm.style.width=para.width+"px"}}}for(var c in callbacks){if(c!="onLoad"&&c!="onHeightChange"&&c!="onWidthChange"){widgetURL=this._setParameter(widgetURL,c,callbacks[c])}}return widgetURL},createWidget:function(g,d,b,f){b=b||{width:200,height:300};this._setXWinProxyDomain(d);var h=this;var e=document.createElement("iframe");var a=b.id?b.id:this.getIfameId();e.setAttribute("frameborder","0",0);e.setAttribute("scrolling","no",0);e.id=a;g.appendChild(e);this.addIframe(a);d=this._setParameter(d,"instid",this.instId);for(var c in b){if(c=="id"){continue}d=this._setParameter(d,c,b[c]);if(c=="width"||c=="height"){e[c]=b[c]}}d=this._setCallbacks(a,d,b,f);if(this.cfg.sessionKey&&this.cfg.sessionKey.length>0){d=this._setParameter(d,"qs_wsid",this.cfg.sessionKey)}d=this._setParameter(d,"wid",a);if(this.cfg.proxyurl){d=this._setParameter(d,"proxyurl",this.cfg.proxyurl)}e.src=d},createWidgetInIframe:function(a,c,b){this.xwinProxy.buildXDMObj(a,c,b)},_getParameter:function(b,a){return unescape((RegExp(b+"=(.+?)(&|$)").exec(a||location.search)||[,""])[1])},_setParameter:function(c,e,f){var g=e+"=([^&]*)";var a=e+"="+f;var b=c.match(g);if(b){var d=b[0];d=c.replace(d,a);return d}else{if(c.match("[?]")){return c+"&"+a}else{return c+"?"+a}}return c},setTicker:function(a,b){if(typeof b!="undefined"){this.xwinProxy._callChildFunction("acceptTicker",a,b)}else{this.xwinProxy._callChildFunction("acceptTicker",a)}},call:function(b,a){this.xwinProxy._callChildFunction(b,a)}};var QSAPI=new QS_APIManager();var QSXwinProxy_parent=function(a){this.qsDomain="quotespeed.morningstar.com";this.children={};this._cid=0;this._xid=0;this.parentHost=(window.location.protocol+"//"+window.location.host)||"";this.isXDM=a===true?true:false;this._XDMType_HTMLProxy=0;this._XDMType_PostMessage=1;this.IE7method=1;this.xdmType=window.postMessage?this._XDMType_PostMessage:this._XDMType_HTMLProxy;this.xdmObj={};this.xdmRpc={};this.dataManager=null;this.dataCenter=null;this._init()};QSXwinProxy_parent.prototype={_init:function(){var a=this;this._setReceiveMessageListen();this.dataCenter=this.createChild(document.getElementById("QSAPI_ifmDataCenter"))},_setReceiveMessageListen:function(){var a=this;if(this.xdmType==this._XDMType_PostMessage){QS.receiveMessage(function(b){var d=decodeURIComponent(b.data).split("|");var f=d[0];var c=d[1];try{a.callFunction(f,c)}catch(b){}},window.location.protocol+"//"+a.qsDomain)}},setQSDomain:function(a){if(typeof a!="undefined"&&a.length>0&&this.qsDomain!=a){this.qsDomain=a;this._setReceiveMessageListen()}},createChild:function(c){if(c){this.isXDM=c.src.indexOf(this.parentHost)==0?false:true;var b="QSAPI_DATA_updateData_"+c.id;var a=this;window[b]=function(d){a.children["QSAPI_IFRAME_"+c.id].callFunction("QSAPI_DATA_updateData",d)};if(!this.isXDM){return{ifm:c,queue:new Queue(100),callFunction:function(e,d){if(typeof c.contentWindow[e]=="function"){d=typeof d=="string"?d:QS.toJSON(d);c.contentWindow[e](d)}}}}else{if(this.xdmType==this._XDMType_PostMessage){return{ifm:c,queue:new Queue(100),callFunction:function(f,e){var d=this;setTimeout(function(){e=typeof e=="string"?e:QS.toJSON(e);QS.postMessage(encodeURIComponent(f+"|"+e),d.ifm.src,d.ifm.contentWindow)},0)}}}else{return this.IE7method==1?{ifm:c,queue:new Queue(100),callFunction:function(f,e){var d=this;this.queue.add(function(){e=typeof e=="string"?e:QS.toJSON(e);d.ifm.contentWindow.location=d.ifm.src.replace(/#.*$/,"")+"#"+encodeURIComponent(f+"|"+e)})}}:{ifm:c,callFunction:function(f,e){var d=this;e=typeof e=="string"?e:QS.toJSON(e);d.ifm.contentWindow.location=d.ifm.src.replace(/#.*$/,"")+"#"+encodeURIComponent(f+"|"+e);if(this.proxy){this.proxy.localHelperIfm.width=this.proxy.localHelperIfm.width>50?50:100}}}}}}return null},subscribe:function(a){this.dataManager.batchSubscribe(a)},getMarketQuoteData:function(a,b){return this.dataManager.getMarketQuoteData(a,b)},addChild:function(b,a){this.children[a||this._cid++]=b},setDataCenter:function(a){this.dataCenter=a},removeChild:function(a){this.children[a]=null;delete this.children[a]},callFunction:function(b,a){if(window[b]){window[b](a)}},_callChildFunction:function(g,a,d){if(typeof d!="undefined"){if(this.children["QSAPI_IFRAME_"+d]){this.children["QSAPI_IFRAME_"+d].callFunction(g,a)}}else{for(var f in this.children){try{this.children[f].callFunction(g,a)}catch(b){this.removeChild(f)}}}},callChildFunction:function(b,a){this._callChildFunction(b,a)},setXDM:function(a){this.isXDM=a}};